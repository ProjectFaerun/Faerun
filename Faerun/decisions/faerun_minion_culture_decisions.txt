decisions = {
	faerun_dragon_minion_show_management_decision = {
		ai = no
		potential = {
			trait = creature_dragon
			culture_group = draconic_culture_group
			OR = {
				not_casting = yes
				has_character_flag = minion_culture_manage
			}
		}
		effect = {
			if = {
				limit = {
					NOT = { has_character_flag = minion_culture_manage }
				}
				
				custom_tooltip = {
					text = FAERUN_DRAGON_MINION_MANAGEMENT_EXPAND_TP

					set_character_flag = minion_culture_manage
				}
			}
			else = {
				custom_tooltip = {
					text = FAERUN_DRAGON_MINION_MANAGEMENT_COLLAPSE_TP

					clr_character_flag = minion_culture_manage
				}
				
			}
			any_demesne_province = { refresh_minion_culture_province_modifiers_effect = yes }
		}
	}
	faerun_dragon_minion_kobold_decision = {
		ai = no
		potential = {
			trait = creature_dragon
			culture_group = draconic_culture_group
			has_character_flag = minion_culture_manage
		}
		allow = {
			custom_tooltip = {
				text = IS_NOT_PRIMARY_MINION

				NOT = { persistent_event_target:minion_culture_primary_persist = { always = yes culture = kobold } }
			}
		}
		effect = {
			kobold = {
				ROOT = {
					save_persistent_event_target = {
						name = minion_culture_primary_persist
						scope = PREV
					}
				}
			}
			any_demesne_province = { refresh_minion_culture_province_modifiers_effect = yes }
		}
	}
	faerun_dragon_minion_lizardfolk_decision = {
		ai = no
		potential = {
			trait = creature_dragon
			culture_group = draconic_culture_group
			has_character_flag = minion_culture_manage
		}
		allow = {
			custom_tooltip = {
				text = IS_NOT_PRIMARY_MINION

				NOT = { persistent_event_target:minion_culture_primary_persist = { always = yes culture = lizardfolk } }
			}
		}
		effect = {
			lizardfolk = {
				ROOT = {
					save_persistent_event_target = {
						name = minion_culture_primary_persist
						scope = PREV
					}
				}
			}
			any_demesne_province = { refresh_minion_culture_province_modifiers_effect = yes }
		}
	}
	faerun_dragon_minion_firenewt_decision = {
		ai = no
		potential = {
			trait = creature_dragon
			culture_group = draconic_culture_group
			has_character_flag = minion_culture_manage
		}
		allow = {
			custom_tooltip = {
				text = IS_NOT_PRIMARY_MINION

				NOT = { persistent_event_target:minion_culture_primary_persist = { always = yes culture = firenewt } }
			}
		}
		effect = {
			firenewt = {
				ROOT = {
					save_persistent_event_target = {
						name = minion_culture_primary_persist
						scope = PREV
					}
				}
			}
			any_demesne_province = { refresh_minion_culture_province_modifiers_effect = yes }
		}
	}
	faerun_dragon_minion_strixiki_decision = {
		ai = no
		potential = {
			trait = creature_dragon
			culture_group = draconic_culture_group
			has_character_flag = minion_culture_manage
		}
		allow = {
			is_innate_master_for_strixiki_trigger = yes
			custom_tooltip = {
				text = IS_NOT_PRIMARY_MINION

				NOT = { persistent_event_target:minion_culture_primary_persist = { always = yes culture = strixiki } }
			}
		}
		effect = {
			strixiki = {
				ROOT = {
					save_persistent_event_target = {
						name = minion_culture_primary_persist
						scope = PREV
					}
				}
			}
			any_demesne_province = { refresh_minion_culture_province_modifiers_effect = yes }
		}
	}
	faerun_dragon_minion_dragonspawn_decision = {
		ai = no
		potential = {
			trait = creature_dragon
			culture_group = draconic_culture_group
			has_character_flag = minion_culture_manage
		}
		allow = {
			is_innate_master_for_dragonspawn_trigger = yes
			custom_tooltip = {
				text = IS_NOT_PRIMARY_MINION

				NOT = { persistent_event_target:minion_culture_primary_persist = { always = yes culture = dragonspawn } }
			}
		}
		effect = {
			dragonspawn = {
				ROOT = {
					save_persistent_event_target = {
						name = minion_culture_primary_persist
						scope = PREV
					}
				}
			}
			any_demesne_province = { refresh_minion_culture_province_modifiers_effect = yes }
		}
	}
	faerun_dragon_minion_fire_giant_decision = {
		ai = no
		potential = {
			trait = creature_dragon
			culture_group = draconic_culture_group
			has_character_flag = minion_culture_manage
		}
		allow = {
			is_innate_master_for_fire_giant_trigger = yes
			custom_tooltip = {
				text = IS_NOT_PRIMARY_MINION

				NOT = { persistent_event_target:minion_culture_primary_persist = { always = yes culture = fire_giant } }
			}
		}
		effect = {
			fire_giant = {
				ROOT = {
					save_persistent_event_target = {
						name = minion_culture_primary_persist
						scope = PREV
					}
				}
			}
			any_demesne_province = { refresh_minion_culture_province_modifiers_effect = yes }
		}
	}
	faerun_dragon_minion_shield_dwarf_decision = {
		ai = no
		potential = {
			trait = creature_dragon
			culture_group = draconic_culture_group
			has_character_flag = minion_culture_manage
		}
		allow = {
			is_innate_master_for_shield_dwarf_trigger = yes
			custom_tooltip = {
				text = IS_NOT_PRIMARY_MINION

				NOT = { persistent_event_target:minion_culture_primary_persist = { always = yes culture = shield_dwarf } }
			}
		}
		effect = {
			shield_dwarf = {
				ROOT = {
					save_persistent_event_target = {
						name = minion_culture_primary_persist
						scope = PREV
					}
				}
			}
			any_demesne_province = { refresh_minion_culture_province_modifiers_effect = yes }
		}
	}
	faerun_dragon_minion_storm_giant_decision = {
		ai = no
		potential = {
			trait = creature_dragon
			culture_group = draconic_culture_group
			has_character_flag = minion_culture_manage
		}
		allow = {
			is_innate_master_for_storm_giant_trigger = yes
			custom_tooltip = {
				text = IS_NOT_PRIMARY_MINION

				NOT = { persistent_event_target:minion_culture_primary_persist = { always = yes culture = storm_giant } }
			}
		}
		effect = {
			storm_giant = {
				ROOT = {
					save_persistent_event_target = {
						name = minion_culture_primary_persist
						scope = PREV
					}
				}
			}
			any_demesne_province = { refresh_minion_culture_province_modifiers_effect = yes }
		}
	}
	faerun_dragon_minion_arctic_dwarf_decision = {
		ai = no
		potential = {
			trait = creature_dragon
			culture_group = draconic_culture_group
			has_character_flag = minion_culture_manage
		}
		allow = {
			is_innate_master_for_arctic_dwarf_trigger = yes
			custom_tooltip = {
				text = IS_NOT_PRIMARY_MINION

				NOT = { persistent_event_target:minion_culture_primary_persist = { always = yes culture = arctic_dwarf } }
			}
		}
		effect = {
			arctic_dwarf = {
				ROOT = {
					save_persistent_event_target = {
						name = minion_culture_primary_persist
						scope = PREV
					}
				}
			}
			any_demesne_province = { refresh_minion_culture_province_modifiers_effect = yes }
		}
	}
	faerun_dragon_minion_chessentan_decision = {
		ai = no
		potential = {
			trait = creature_dragon
			culture_group = draconic_culture_group
			has_character_flag = minion_culture_manage
		}
		allow = {
			is_innate_master_for_chessentan_trigger = yes
			custom_tooltip = {
				text = IS_NOT_PRIMARY_MINION

				NOT = { persistent_event_target:minion_culture_primary_persist = { always = yes culture = chessentan } }
			}
		}
		effect = {
			chessentan = {
				ROOT = {
					save_persistent_event_target = {
						name = minion_culture_primary_persist
						scope = PREV
					}
				}
			}
			any_demesne_province = { refresh_minion_culture_province_modifiers_effect = yes }
		}
	}
	faerun_dragon_minion_culture_1_decision = {
		ai = no
		potential = {
			trait = creature_dragon
			culture_group = draconic_culture_group
			has_character_flag = minion_culture_manage
			persistent_event_target:minion_culture_1_persist = { always = yes }
		}
		allow = {
			custom_tooltip = {
				text = IS_NOT_PRIMARY_MINION

				NOT = { 
					persistent_event_target:minion_culture_primary_persist = { 
						always = yes
						ROOT = {
							persistent_event_target:minion_culture_1_persist = {
								culture = PREVPREV
							}
						}
					} 
				}
			}
		}
		effect = {
			persistent_event_target:minion_culture_1_persist = {
				ROOT = {
					save_persistent_event_target = {
						name = minion_culture_primary_persist
						scope = PREV
					}
				}
			}
			any_demesne_province = { refresh_minion_culture_province_modifiers_effect = yes }
		}
	}
	faerun_dragon_minion_culture_2_decision = {
		ai = no
		potential = {
			trait = creature_dragon
			culture_group = draconic_culture_group
			has_character_flag = minion_culture_manage
			persistent_event_target:minion_culture_2_persist = { always = yes }
		}
		allow = {
			custom_tooltip = {
				text = IS_NOT_PRIMARY_MINION

				NOT = { 
					persistent_event_target:minion_culture_primary_persist = { 
						always = yes
						ROOT = {
							persistent_event_target:minion_culture_2_persist = {
								culture = PREVPREV
							}
						}
					} 
				} 
			}
		}
		effect = {
			persistent_event_target:minion_culture_2_persist = {
				ROOT = {
					save_persistent_event_target = {
						name = minion_culture_primary_persist
						scope = PREV
					}
				}
			}
			any_demesne_province = { refresh_minion_culture_province_modifiers_effect = yes }
		}
	}
	faerun_dragon_minion_culture_3_decision = {
		ai = no
		potential = {
			trait = creature_dragon
			culture_group = draconic_culture_group
			has_character_flag = minion_culture_manage
			persistent_event_target:minion_culture_3_persist = { always = yes }
		}
		allow = {
			custom_tooltip = {
				text = IS_NOT_PRIMARY_MINION

				NOT = { 
					persistent_event_target:minion_culture_primary_persist = { 
						always = yes
						ROOT = {
							persistent_event_target:minion_culture_3_persist = {
								culture = PREVPREV
							}
						}
					} 
				} 
			}
		}
		effect = {
			persistent_event_target:minion_culture_3_persist = {
				ROOT = {
					save_persistent_event_target = {
						name = minion_culture_primary_persist
						scope = PREV
					}
				}
			}
			any_demesne_province = { refresh_minion_culture_province_modifiers_effect = yes }
		}
	}
	faerun_dragon_minion_pick_extra_decision = {
		ai = no
		potential = {
			trait = creature_dragon
			culture_group = draconic_culture_group
			has_character_flag = minion_culture_manage
			NOT = { trait = dragon_wyrmling }
		}
		allow = {
			custom_tooltip = {
				text = DRAGON_RULER_HAS_FREE_MINION_SLOT_TP

				trigger_if = {
					limit = { trait = dragon_young }

					NOR = {
						persistent_event_target:minion_culture_1_persist = { always = yes }
						persistent_event_target:minion_culture_2_persist = { always = yes }
						persistent_event_target:minion_culture_3_persist = { always = yes }
					}
				}
				trigger_else_if = {
					limit = { trait = dragon_adult }

					calc_true_if = {
						amount < 2

						persistent_event_target:minion_culture_1_persist = { always = yes }
						persistent_event_target:minion_culture_2_persist = { always = yes }
						persistent_event_target:minion_culture_3_persist = { always = yes }
					}
				}
				trigger_else = {
					NAND = {
						persistent_event_target:minion_culture_1_persist = { always = yes }
						persistent_event_target:minion_culture_2_persist = { always = yes }
						persistent_event_target:minion_culture_3_persist = { always = yes }
					}
				}
			}
		}
		effect = {
			any_demesne_province = { refresh_minion_culture_province_modifiers_effect = yes }
		}
	}
	faerun_dragon_minion_culture_1_remove_decision = {
		ai = no
		potential = {
			trait = creature_dragon
			culture_group = draconic_culture_group
			has_character_flag = minion_culture_manage
			persistent_event_target:minion_culture_1_persist = { always = yes }
		}
		allow = {
			custom_tooltip = {
				text = IS_NOT_PRIMARY_MINION

				NOT = { 
					persistent_event_target:minion_culture_primary_persist = { 
						always = yes
						ROOT = {
							persistent_event_target:minion_culture_1_persist = {
								culture = PREVPREV
							}
						}
					} 
				}
			}
		}
		effect = {
			clear_persistent_event_target = minion_culture_1_persist
			any_demesne_province = { refresh_minion_culture_province_modifiers_effect = yes }
		}
	}
	faerun_dragon_minion_culture_2_remove_decision = {
		ai = no
		potential = {
			trait = creature_dragon
			culture_group = draconic_culture_group
			has_character_flag = minion_culture_manage
			persistent_event_target:minion_culture_2_persist = { always = yes }
		}
		allow = {
			custom_tooltip = {
				text = IS_NOT_PRIMARY_MINION

				NOT = { 
					persistent_event_target:minion_culture_primary_persist = { 
						always = yes
						ROOT = {
							persistent_event_target:minion_culture_2_persist = {
								culture = PREVPREV
							}
						}
					} 
				} 
			}
		}
		effect = {
			clear_persistent_event_target = minion_culture_2_persist
			any_demesne_province = { refresh_minion_culture_province_modifiers_effect = yes }
		}
	}
	faerun_dragon_minion_culture_3_remove_decision = {
		ai = no
		potential = {
			trait = creature_dragon
			culture_group = draconic_culture_group
			has_character_flag = minion_culture_manage
			persistent_event_target:minion_culture_3_persist = { always = yes }
		}
		allow = {
			custom_tooltip = {
				text = IS_NOT_PRIMARY_MINION

				NOT = { 
					persistent_event_target:minion_culture_primary_persist = { 
						always = yes
						ROOT = {
							persistent_event_target:minion_culture_3_persist = {
								culture = PREVPREV
							}
						}
					} 
				} 
			}
		}
		effect = {
			clear_persistent_event_target = minion_culture_3_persist
			any_demesne_province = { refresh_minion_culture_province_modifiers_effect = yes }
		}
	}
}

title_decisions = {
	faerun_dragon_minion_pick_culture_title_decision = {
		filter = owned
		ai_target_filter = owned

		ai = no

		from_potential = {
			has_character_flag = minion_culture_manage
		}

		potential = {
			location = {
				owned_by = FROM
			}
			NOT = { higher_tier_than = COUNT }
		}
		allow = {
			location = {
				show_scope_change = no
				FROM = {
					show_scope_change = no
					is_not_master_dragon_for_PREV_trigger = yes
				}
			}
			custom_tooltip = {
				text = DRAGON_RULER_HAS_FREE_MINION_SLOT_TP

				FROM = {
					NAND = {
						persistent_event_target:minion_culture_1_persist = { always = yes }
						persistent_event_target:minion_culture_2_persist = { always = yes }
						persistent_event_target:minion_culture_3_persist = { always = yes }
					}
				}
			}
			trigger_if = {
				limit = {
					FROM = {
						NOR = {
							persistent_event_target:minion_culture_1_persist = { always = yes }
							persistent_event_target:minion_culture_2_persist = { always = yes }
							persistent_event_target:minion_culture_3_persist = { always = yes }
						}
					}
				}

				FROM = { prestige >= 1000 }
			}
			trigger_else_if = {
				limit = {
					FROM = {
						calc_true_if = {
							amount < 2

							persistent_event_target:minion_culture_1_persist = { always = yes }
							persistent_event_target:minion_culture_2_persist = { always = yes }
							persistent_event_target:minion_culture_3_persist = { always = yes }
						}
					}
				}

				FROM = { prestige >= 2500 }
			}
			trigger_else = {
				FROM = { prestige >= 5000 }
			}
			location = {
				unconvertable_culture_trigger = no
			}
		}
		effect = {
			location = {
				show_scope_change = no
				if = {
					limit = {
						FROM = {
							NOR = {
								persistent_event_target:minion_culture_1_persist = { always = yes }
								persistent_event_target:minion_culture_2_persist = { always = yes }
								persistent_event_target:minion_culture_3_persist = { always = yes }
							}
						}
					}

					FROM = { show_scope_change = no prestige = -1000 }
				}
				else_if = {
					limit = {
						FROM = {
							calc_true_if = {
								amount < 2

								persistent_event_target:minion_culture_1_persist = { always = yes }
								persistent_event_target:minion_culture_2_persist = { always = yes }
								persistent_event_target:minion_culture_3_persist = { always = yes }
							}
						}
					}

					FROM = { show_scope_change = no prestige = -2500 }
				}
				else = { FROM = { show_scope_change = no prestige = -5000 } }

				if = {
					limit = { FROM = { NOT = { persistent_event_target:minion_culture_1_persist = { always = yes } } } }

					culture_scope = {
						FROM = {
							save_persistent_event_target = {
								name = minion_culture_1_persist
								scope = PREV
							}
						}
					}
				}
				else_if = {
					limit = { FROM = { NOT = { persistent_event_target:minion_culture_2_persist = { always = yes } } } }

					culture_scope = {
						FROM = {
							save_persistent_event_target = {
								name = minion_culture_2_persist
								scope = PREV
							}
						}
					}
				}
				else = {
					culture_scope = {
						FROM = {
							save_persistent_event_target = {
								name = minion_culture_3_persist
								scope = PREV
							}
						}
					}
				}
			}

			FROM = {
				any_demesne_province = { refresh_minion_culture_province_modifiers_effect = yes }
			}
		}
	}
}

settlement_decisions = {
	faerun_dragon_minion_pick_culture_settlement_decision = {
		filter = owned
		ai_target_filter = owned

		ai = no

		from_potential = {
			has_character_flag = minion_culture_manage
		}

		potential = {
			location = {
				owned_by = FROM
			}
		}

		allow = {
			location = {
				show_scope_change = no
				FROM = {
					show_scope_change = no
					is_not_master_dragon_for_PREV_trigger = yes
				}
			}
			custom_tooltip = {
				text = DRAGON_RULER_HAS_FREE_MINION_SLOT_TP

				FROM = {
					NAND = {
						persistent_event_target:minion_culture_1_persist = { always = yes }
						persistent_event_target:minion_culture_2_persist = { always = yes }
						persistent_event_target:minion_culture_3_persist = { always = yes }
					}
				}
			}
			trigger_if = {
				limit = {
					FROM = {
						NOR = {
							persistent_event_target:minion_culture_1_persist = { always = yes }
							persistent_event_target:minion_culture_2_persist = { always = yes }
							persistent_event_target:minion_culture_3_persist = { always = yes }
						}
					}
				}

				FROM = { prestige >= 1000 }
			}
			trigger_else_if = {
				limit = {
					FROM = {
						calc_true_if = {
							amount < 2

							persistent_event_target:minion_culture_1_persist = { always = yes }
							persistent_event_target:minion_culture_2_persist = { always = yes }
							persistent_event_target:minion_culture_3_persist = { always = yes }
						}
					}
				}

				FROM = { prestige >= 2500 }
			}
			trigger_else = {
				FROM = { prestige >= 5000 }
			}
			location = {
				unconvertable_culture_trigger = no
			}
		}
		effect = {
			location = {
				show_scope_change = no
				if = {
					limit = {
						FROM = {
							NOR = {
								persistent_event_target:minion_culture_1_persist = { always = yes }
								persistent_event_target:minion_culture_2_persist = { always = yes }
								persistent_event_target:minion_culture_3_persist = { always = yes }
							}
						}
					}

					FROM = { show_scope_change = no prestige = -1000 }
				}
				else_if = {
					limit = {
						FROM = {
							calc_true_if = {
								amount < 2

								persistent_event_target:minion_culture_1_persist = { always = yes }
								persistent_event_target:minion_culture_2_persist = { always = yes }
								persistent_event_target:minion_culture_3_persist = { always = yes }
							}
						}
					}

					FROM = { show_scope_change = no prestige = -2500 }
				}
				else = { FROM = { show_scope_change = no prestige = -5000 } }

				if = {
					limit = { FROM = { NOT = { persistent_event_target:minion_culture_1_persist = { always = yes } } } }

					culture_scope = {
						FROM = {
							save_persistent_event_target = {
								name = minion_culture_1_persist
								scope = PREV
							}
						}
					}
				}
				else_if = {
					limit = { FROM = { NOT = { persistent_event_target:minion_culture_2_persist = { always = yes } } } }

					culture_scope = {
						FROM = {
							save_persistent_event_target = {
								name = minion_culture_2_persist
								scope = PREV
							}
						}
					}
				}
				else = {
					culture_scope = {
						FROM = {
							save_persistent_event_target = {
								name = minion_culture_3_persist
								scope = PREV
							}
						}
					}
				}
			}

			FROM = {
				any_demesne_province = { refresh_minion_culture_province_modifiers_effect = yes }
			}
		}
	}
}
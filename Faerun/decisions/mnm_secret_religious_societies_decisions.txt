###########################################
#
# Society decisions for secret religious societies
#
###########################################

society_decisions = {

	secret_religions_openly_adopt_faith = {
		is_high_prio = yes
		is_in_society = yes
		ai_check_interval = 18

		potential = {
			society_member_of = secret_religious_cult
			not_casting = yes
			society_rank == 4
		}

		allow = {
			OR = {
				has_society_currency_major_trigger = yes
				hidden_tooltip = {
					ai = yes
				}
			}
			prisoner = no
			NOT = { trait = incapable }
			NOT = { is_inaccessible_trigger = yes }
			war = no
		}

		effect = {
			#hidden_effect = { # To track the number of Revealed Cults
			#	change_variable = { which = global_revealed_cults value = 1 }
			#	if = {
			#		limit = {
			#			secret_religion = calishite_faith
			#		}
			#		change_variable = { which = global_calishite_faith_revealed_cults value = 1 }
			#	}
			#	if = {
			#		limit = {
			#			secret_religion = chauntean_faith
			#		}
			#		change_variable = { which = global_chauntean_faith_revealed_cults value = 1 }
			#	}
			#	if = {
			#		limit = {
			#			secret_religion = mulhorandi_faith
			#		}
			#		change_variable = { which = global_mulhorandi_faith_revealed_cults value = 1 }
			#	}
			#	if = {
			#		limit = {
			#			secret_religion = tuigan_shamanism
			#		}
			#		change_variable = { which = global_tuigan_shamanism_revealed_cults value = 1 }
			#	}
			#}
			detract_society_currency_major_effect = yes
			custom_tooltip = {
				text = openly_adopt_faith_effect_tooltip
				if = { # Caliphates and Fylkirates are forfeit
					limit = {
						# OR = {
							# religion_group = muslim
							# religion = norse_pagan_reformed
						# }
						any_demesne_title = {
							controls_religion = yes
						}
					}
					any_demesne_title = {
						limit = {
							controls_religion = yes
						}
						destroy_landed_title = THIS
					}
				}
				if = { # Papacies are given to a random new character
					limit = {
						# NOR = {
							# religion_group = muslim
							# religion = norse_pagan_reformed
						# }
						any_demesne_title = {
							controls_religion = yes
						}
					}
					hidden_tooltip = {
						liege = {
							save_event_target_as = liege_target
						}
						create_character = {
							age = 38
							dynasty = none
							religion = ROOT
							culture = ROOT
							random_traits = yes
						}
						new_character = {
							save_event_target_as = new_holder
						}
					}
					any_demesne_title = {
						limit = {
							controls_religion = yes
						}
						grant_title = event_target:new_holder
						holder_scope = {
							any_vassal = {
								set_defacto_liege = event_target:liege_target
							}
						}
					}
					hidden_tooltip = {
						set_defacto_liege = event_target:liege_target
					}
				}
				if = { # Holy Orders/Static Mercs are given to a random new character
					limit = {
						any_demesne_title = {
							OR = {
								holy_order = yes
								mercenary = yes
							}
						}
					}
					hidden_tooltip = {
						liege = {
							save_event_target_as = liege_target
						}
						create_character = {
							age = 38
							dynasty = none
							religion = ROOT
							culture = ROOT
							random_traits = yes
						}
						new_character = {
							save_event_target_as = new_holder
						}
					}
					any_demesne_title = {
						limit = {
							OR = {
								holy_order = yes
								mercenary = yes
							}
						}
						grant_title = event_target:new_holder
						holder_scope = {
							any_vassal = {
								set_defacto_liege = event_target:liege_target
							}
						}
					}
					hidden_tooltip = {
						set_defacto_liege = event_target:liege_target
					}
				}
				hidden_effect = {
					character_event = { id = MNM.3811 }
					any_society_member = {
						if = {
							limit = {
								NOT = {
									character = ROOT
								}
								same_society_as = ROOT
							}
							character_event = { id = MNM.3800 } # Convert cultists
						}
					}
					top_liege = {
						any_realm_character = {
							if = {
								limit = {
									NOT = {
										same_society_as = ROOT
									}
									OR = {
										has_prevs_secret_religion_truly_trigger = yes
										has_sympathy_for_true_religion_of_prev_trigger = yes
									}
								}
								character_event = { id = MNM.3810 } # Allow sympathisers the chance to flip
							}

							if = {
								limit = {
									is_ruler = yes
									any_demesne_province = {
										OR = {
											AND = {
												has_province_modifier = secret_triadic_community
												ROOT = {
													society_member_of = secret_religious_society_triadic
												}
											}
											AND = {
												has_province_modifier = secret_arcane_community
												ROOT = {
													society_member_of = secret_religious_society_arcane
												}
											}
											AND = {
												has_province_modifier = secret_rasallesian_community
												ROOT = {
													society_member_of = secret_religious_society_rasallesian
												}
											}
											AND = {
												has_province_modifier = secret_chessic_community
												ROOT = {
													society_member_of = secret_religious_society_chessic
												}
											}
											AND = {
												has_province_modifier = secret_mercantile_community
												ROOT = {
													society_member_of = secret_religious_society_mercantile
												}
											}
											AND = {
												has_province_modifier = secret_inventive_community
												ROOT = {
													society_member_of = secret_religious_society_inventive
												}
											}
											AND = {
												has_province_modifier = secret_joyful_community
												ROOT = {
													society_member_of = secret_religious_society_joyful
												}
											}
											AND = {
												has_province_modifier = secret_calishite_faith_community
												ROOT = {
													society_member_of = secret_religious_society_calishite_faith
												}
											}
											AND = {
												has_province_modifier = secret_lapal_faith_community
												ROOT = {
													society_member_of = secret_religious_society_lapal_faith
												}
											}
											AND = {
												has_province_modifier = secret_chauntean_faith_community
												ROOT = {
													society_member_of = secret_religious_society_chauntean_faith
												}
											}
											AND = {
												has_province_modifier = secret_mulhorandi_faith_community
												ROOT = {
													society_member_of = secret_religious_society_mulhorandi_faith
												}
											}
											AND = {
												has_province_modifier = secret_untheric_faith_community
												ROOT = {
													society_member_of = secret_religious_society_untheric_faith
												}
											}
											AND = {
												has_province_modifier = secret_enlil_community
												ROOT = {
													society_member_of = secret_religious_society_enlil
												}
											}
											AND = {
												has_province_modifier = secret_halfling_pantheon_community
												ROOT = {
													society_member_of = secret_religious_society_halfling_pantheon
												}
											}
											AND = {
												has_province_modifier = secret_solar_community
												ROOT = {
													society_member_of = secret_religious_society_solar
												}
											}
											AND = {
												has_province_modifier = secret_deities_of_fury_community
												ROOT = {
													society_member_of = secret_religious_society_deities_of_fury
												}
											}
											AND = {
												has_province_modifier = secret_natural_community
												ROOT = {
													society_member_of = secret_religious_society_natural
												}
											}
											AND = {
												has_province_modifier = secret_kossuth_community
												ROOT = {
													society_member_of = secret_religious_society_kossuth
												}
											}
											AND = {
												has_province_modifier = secret_geomancy_community
												ROOT = {
													society_member_of = secret_religious_society_geomancy
												}
											}
											AND = {
												has_province_modifier = secret_primordial_community
												ROOT = {
													society_member_of = secret_religious_society_primordial
												}
											}
											AND = {
												has_province_modifier = secret_tuigan_shamanism_community
												ROOT = {
													society_member_of = secret_religious_society_tuigan_shamanism
												}
											}
											AND = {
												has_province_modifier = secret_uthgardt_reformed_community
												ROOT = {
													society_member_of = secret_religious_society_uthgardt_reformed
												}
											}
											AND = {
												has_province_modifier = secret_uthgardt_faith_community
												ROOT = {
													society_member_of = secret_religious_society_uthgardt_faith
												}
											}
											AND = {
												has_province_modifier = secret_martial_faith_community
												ROOT = {
													society_member_of = secret_religious_society_martial_faith
												}
											}
											AND = {
												has_province_modifier = secret_ubtao_worship_community
												ROOT = {
													society_member_of = secret_religious_society_ubtao_worship
												}
											}
											AND = {
												has_province_modifier = secret_earthmother_reformed_community
												ROOT = {
													society_member_of = secret_religious_society_earthmother_reformed
												}
											}
											AND = {
												has_province_modifier = secret_earthmother_community
												ROOT = {
													society_member_of = secret_religious_society_earthmother
												}
											}
											AND = {
												has_province_modifier = secret_toteteohuan_community
												ROOT = {
													society_member_of = secret_religious_society_toteteohuan
												}
											}
											AND = {
												has_province_modifier = secret_dead_three_community
												ROOT = {
													society_member_of = secret_religious_society_dead_three
												}
											}
											AND = {
												has_province_modifier = secret_shadow_gods_community
												ROOT = {
													society_member_of = secret_religious_society_shadow_gods
												}
											}
											AND = {
												has_province_modifier = secret_ghaunadaur_community
												ROOT = {
													society_member_of = secret_religious_society_ghaunadaur
												}
											}
											AND = {
												has_province_modifier = secret_loviatar_community
												ROOT = {
													society_member_of = secret_religious_society_loviatar
												}
											}
											AND = {
												has_province_modifier = secret_church_of_cyric_community
												ROOT = {
													society_member_of = secret_religious_society_church_of_cyric
												}
											}
											AND = {
												has_province_modifier = secret_abyssal_cult_community
												ROOT = {
													society_member_of = secret_religious_society_abyssal_cult
												}
											}
											AND = {
												has_province_modifier = secret_infernal_community
												ROOT = {
													society_member_of = secret_religious_society_infernal
												}
											}
											AND = {
												has_province_modifier = secret_scale_cult_community
												ROOT = {
													society_member_of = secret_religious_society_scale_cult
												}
											}
											AND = {
												has_province_modifier = secret_ten_thousand_gods_community
												ROOT = {
													society_member_of = secret_religious_society_ten_thousand_gods
												}
											}
											AND = {
												has_province_modifier = secret_qisma_community
												ROOT = {
													society_member_of = secret_religious_society_qisma
												}
											}
											AND = {
												has_province_modifier = secret_pantheist_league_community
												ROOT = {
													society_member_of = secret_religious_society_pantheist_league
												}
											}
											AND = {
												has_province_modifier = secret_muhjari_community
												ROOT = {
													society_member_of = secret_religious_society_muhjari
												}
											}
											AND = {
												has_province_modifier = secret_kahin_community
												ROOT = {
													society_member_of = secret_religious_society_kahin
												}
											}
											AND = {
												has_province_modifier = secret_thasmudyanic_community
												ROOT = {
													society_member_of = secret_religious_society_thasmudyanic
												}
											}
											AND = {
												has_province_modifier = secret_nogari_reformed_community
												ROOT = {
													society_member_of = secret_religious_society_nogari_reformed
												}
											}
											AND = {
												has_province_modifier = secret_nogari_community
												ROOT = {
													society_member_of = secret_religious_society_nogari
												}
											}
											AND = {
												has_province_modifier = secret_jaziri_community
												ROOT = {
													society_member_of = secret_religious_society_jaziri
												}
											}
											AND = {
												has_province_modifier = secret_jaziri_reformed_community
												ROOT = {
													society_member_of = secret_religious_society_jaziri_reformed
												}
											}
											AND = {
												has_province_modifier = secret_padhran_community
												ROOT = {
													society_member_of = secret_religious_society_padhran
												}
											}
											AND = {
												has_province_modifier = secret_the_path_community
												ROOT = {
													society_member_of = secret_religious_society_the_path
												}
											}
											AND = {
												has_province_modifier = secret_chung_tao_community
												ROOT = {
													society_member_of = secret_religious_society_chung_tao
												}
											}
											AND = {
												has_province_modifier = secret_nine_travelers_community
												ROOT = {
													society_member_of = secret_religious_society_nine_travelers
												}
											}
											AND = {
												has_province_modifier = secret_adama_community
												ROOT = {
													society_member_of = secret_religious_society_adama
												}
											}
											AND = {
												has_province_modifier = secret_animist_community
												ROOT = {
													society_member_of = secret_religious_society_animist
												}
											}
											AND = {
												has_province_modifier = secret_elven_pantheon_community
												ROOT = {
													society_member_of = secret_religious_society_elven_pantheon
												}
											}
											AND = {
												has_province_modifier = secret_asathalfinare_community
												ROOT = {
													society_member_of = secret_religious_society_asathalfinare
												}
											}
											AND = {
												has_province_modifier = secret_sylvan_community
												ROOT = {
													society_member_of = secret_religious_society_sylvan
												}
											}
											AND = {
												has_province_modifier = secret_eilistraee_community
												ROOT = {
													society_member_of = secret_religious_society_eilistraee
												}
											}
											AND = {
												has_province_modifier = secret_yuir_reformed_community
												ROOT = {
													society_member_of = secret_religious_society_yuir_reformed
												}
											}
											AND = {
												has_province_modifier = secret_yuir_community
												ROOT = {
													society_member_of = secret_religious_society_yuir
												}
											}
											AND = {
												has_province_modifier = secret_lolth_cult_community
												ROOT = {
													society_member_of = secret_religious_society_lolth_cult
												}
											}
											AND = {
												has_province_modifier = secret_vhaeraun_community
												ROOT = {
													society_member_of = secret_religious_society_vhaeraun
												}
											}
											AND = {
												has_province_modifier = secret_kiaransalee_community
												ROOT = {
													society_member_of = secret_religious_society_kiaransalee
												}
											}
											AND = {
												has_province_modifier = secret_dwarven_pantheon_community
												ROOT = {
													society_member_of = secret_religious_society_dwarven_pantheon
												}
											}
											AND = {
												has_province_modifier = secret_laduguer_community
												ROOT = {
													society_member_of = secret_religious_society_laduguer
												}
											}
											AND = {
												has_province_modifier = secret_gnome_pantheon_community
												ROOT = {
													society_member_of = secret_religious_society_gnome_pantheon
												}
											}
											AND = {
												has_province_modifier = secret_urdlen_community
												ROOT = {
													society_member_of = secret_religious_society_urdlen
												}
											}
											AND = {
												has_province_modifier = secret_giant_pantheon_community
												ROOT = {
													society_member_of = secret_religious_society_giant_pantheon
												}
											}
											AND = {
												has_province_modifier = secret_vaprak_community
												ROOT = {
													society_member_of = secret_religious_society_vaprak
												}
											}
											AND = {
												has_province_modifier = secret_karontor_community
												ROOT = {
													society_member_of = secret_religious_society_karontor
												}
											}
											AND = {
												has_province_modifier = secret_ulutiuan_reformed_community
												ROOT = {
													society_member_of = secret_religious_society_ulutiuan_reformed
												}
											}
											AND = {
												has_province_modifier = secret_ulutiuan_community
												ROOT = {
													society_member_of = secret_religious_society_ulutiuan
												}
											}
											AND = {
												has_province_modifier = secret_draconic_pantheon_community
												ROOT = {
													society_member_of = secret_religious_society_draconic_pantheon
												}
											}
											AND = {
												has_province_modifier = secret_tiamat_community
												ROOT = {
													society_member_of = secret_religious_society_tiamat
												}
											}
											AND = {
												has_province_modifier = secret_bahamut_community
												ROOT = {
													society_member_of = secret_religious_society_bahamut
												}
											}
											AND = {
												has_province_modifier = secret_goblin_pantheon_community
												ROOT = {
													society_member_of = secret_religious_society_goblin_pantheon
												}
											}
											AND = {
												has_province_modifier = secret_goblin_reformed_community
												ROOT = {
													society_member_of = secret_religious_society_goblin_reformed
												}
											}
											AND = {
												has_province_modifier = secret_orc_pantheon_community
												ROOT = {
													society_member_of = secret_religious_society_orc_pantheon
												}
											}
											AND = {
												has_province_modifier = secret_orc_reformed_community
												ROOT = {
													society_member_of = secret_religious_society_orc_reformed
												}
											}
											AND = {
												has_province_modifier = secret_faithless_community
												ROOT = {
													society_member_of = secret_religious_society_faithless
												}
											}
											AND = {
												has_province_modifier = secret_entropy_community
												ROOT = {
													society_member_of = secret_religious_society_entropy
												}
											}
											AND = {
												has_province_modifier = secret_blue_flame_community
												ROOT = {
													society_member_of = secret_religious_society_blue_flame
												}
											}
											AND = {
												has_province_modifier = secret_ancestral_cult_community
												ROOT = {
													society_member_of = secret_religious_society_ancestral_cult
												}
											}
											AND = {
												has_province_modifier = secret_qukoku_community
												ROOT = {
													society_member_of = secret_religious_society_qukoku
												}
											}
											AND = {
												has_province_modifier = secret_beholder_pantheon_community
												ROOT = {
													society_member_of = secret_religious_society_beholder_pantheon
												}
											}
											AND = {
												has_province_modifier = secret_illithid_pantheon_community
												ROOT = {
													society_member_of = secret_religious_society_illithid_pantheon
												}
											}
											AND = {
												has_province_modifier = secret_faceless_god_community
												ROOT = {
													society_member_of = secret_religious_society_faceless_god
												}
											}
										}
									}
								}
								if = {
									limit = { NOT = { has_character_flag = currently_part_of_secret_religion_uncovering } }
									character_event = { id = MNM.3820 } # Flip provinces with local cult modifier
								}
								if = {
									limit = { has_character_flag = currently_part_of_secret_religion_uncovering }
									ROOT = {
										trigger_switch = {
											on_trigger = society_member_of
											secret_religious_society_triadic = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_triadic_community
														}
														religion = triadic
														remove_province_modifier = secret_triadic_community
													}
												}
											}
											secret_religious_society_arcane = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_arcane_community
														}
														religion = arcane
														remove_province_modifier = secret_arcane_community
													}
												}
											}
											secret_religious_society_rasallesian = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_rasallesian_community
														}
														religion = rasallesian
														remove_province_modifier = secret_rasallesian_community
													}
												}
											}
											secret_religious_society_chessic = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_chessic_community
														}
														religion = chessic
														remove_province_modifier = secret_chessic_community
													}
												}
											}
											secret_religious_society_mercantile = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_mercantile_community
														}
														religion = mercantile
														remove_province_modifier = secret_mercantile_community
													}
												}
											}
											secret_religious_society_inventive = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_inventive_community
														}
														religion = inventive
														remove_province_modifier = secret_inventive_community
													}
												}
											}
											secret_religious_society_joyful = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_joyful_community
														}
														religion = joyful
														remove_province_modifier = secret_joyful_community
													}
												}
											}
											secret_religious_society_calishite_faith = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_calishite_faith_community
														}
														religion = calishite_faith
														remove_province_modifier = secret_calishite_faith_community
													}
												}
											}
											secret_religious_society_lapal_faith = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_lapal_faith_community
														}
														religion = lapal_faith
														remove_province_modifier = secret_lapal_faith_community
													}
												}
											}
											secret_religious_society_chauntean_faith = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_chauntean_faith_community
														}
														religion = chauntean_faith
														remove_province_modifier = secret_chauntean_faith_community
													}
												}
											}
											secret_religious_society_mulhorandi_faith = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_mulhorandi_faith_community
														}
														religion = mulhorandi_faith
														remove_province_modifier = secret_mulhorandi_faith_community
													}
												}
											}
											secret_religious_society_untheric_faith = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_untheric_faith_community
														}
														religion = untheric_faith
														remove_province_modifier = secret_untheric_faith_community
													}
												}
											}
											secret_religious_society_enlil = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_enlil_community
														}
														religion = enlil
														remove_province_modifier = secret_enlil_community
													}
												}
											}
											secret_religious_society_halfling_pantheon = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_halfling_pantheon_community
														}
														religion = halfling_pantheon
														remove_province_modifier = secret_halfling_pantheon_community
													}
												}
											}
											secret_religious_society_solar = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_solar_community
														}
														religion = solar
														remove_province_modifier = secret_solar_community
													}
												}
											}
											secret_religious_society_deities_of_fury = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_deities_of_fury_community
														}
														religion = deities_of_fury
														remove_province_modifier = secret_deities_of_fury_community
													}
												}
											}
											secret_religious_society_natural = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_natural_community
														}
														religion = natural
														remove_province_modifier = secret_natural_community
													}
												}
											}
											secret_religious_society_kossuth = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_kossuth_community
														}
														religion = kossuth
														remove_province_modifier = secret_kossuth_community
													}
												}
											}
											secret_religious_society_geomancy = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_geomancy_community
														}
														religion = geomancy
														remove_province_modifier = secret_geomancy_community
													}
												}
											}
											secret_religious_society_primordial = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_primordial_community
														}
														religion = primordial
														remove_province_modifier = secret_primordial_community
													}
												}
											}
											secret_religious_society_tuigan_shamanism = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_tuigan_shamanism_community
														}
														religion = tuigan_shamanism
														remove_province_modifier = secret_tuigan_shamanism_community
													}
												}
											}
											secret_religious_society_uthgardt_reformed = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_uthgardt_reformed_community
														}
														religion = uthgardt_reformed
														remove_province_modifier = secret_uthgardt_reformed_community
													}
												}
											}
											secret_religious_society_uthgardt_faith = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_uthgardt_faith_community
														}
														religion = uthgardt_faith
														remove_province_modifier = secret_uthgardt_faith_community
													}
												}
											}
											secret_religious_society_martial_faith = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_martial_faith_community
														}
														religion = martial_faith
														remove_province_modifier = secret_martial_faith_community
													}
												}
											}
											secret_religious_society_ubtao_worship = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_ubtao_worship_community
														}
														religion = ubtao_worship
														remove_province_modifier = secret_ubtao_worship_community
													}
												}
											}
											secret_religious_society_earthmother_reformed = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_earthmother_reformed_community
														}
														religion = earthmother_reformed
														remove_province_modifier = secret_earthmother_reformed_community
													}
												}
											}
											secret_religious_society_earthmother = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_earthmother_community
														}
														religion = earthmother
														remove_province_modifier = secret_earthmother_community
													}
												}
											}
											secret_religious_society_toteteohuan = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_toteteohuan_community
														}
														religion = toteteohuan
														remove_province_modifier = secret_toteteohuan_community
													}
												}
											}
											secret_religious_society_dead_three = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_dead_three_community
														}
														religion = dead_three
														remove_province_modifier = secret_dead_three_community
													}
												}
											}
											secret_religious_society_shadow_gods = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_shadow_gods_community
														}
														religion = shadow_gods
														remove_province_modifier = secret_shadow_gods_community
													}
												}
											}
											secret_religious_society_ghaunadaur = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_ghaunadaur_community
														}
														religion = ghaunadaur
														remove_province_modifier = secret_ghaunadaur_community
													}
												}
											}
											secret_religious_society_loviatar = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_loviatar_community
														}
														religion = loviatar
														remove_province_modifier = secret_loviatar_community
													}
												}
											}
											secret_religious_society_church_of_cyric = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_church_of_cyric_community
														}
														religion = church_of_cyric
														remove_province_modifier = secret_church_of_cyric_community
													}
												}
											}
											secret_religious_society_abyssal_cult = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_abyssal_cult_community
														}
														religion = abyssal_cult
														remove_province_modifier = secret_abyssal_cult_community
													}
												}
											}
											secret_religious_society_infernal = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_infernal_community
														}
														religion = infernal
														remove_province_modifier = secret_infernal_community
													}
												}
											}
											secret_religious_society_scale_cult = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_scale_cult_community
														}
														religion = scale_cult
														remove_province_modifier = secret_scale_cult_community
													}
												}
											}
											secret_religious_society_ten_thousand_gods = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_ten_thousand_gods_community
														}
														religion = ten_thousand_gods
														remove_province_modifier = secret_ten_thousand_gods_community
													}
												}
											}
											secret_religious_society_qisma = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_qisma_community
														}
														religion = qisma
														remove_province_modifier = secret_qisma_community
													}
												}
											}
											secret_religious_society_pantheist_league = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_pantheist_league_community
														}
														religion = pantheist_league
														remove_province_modifier = secret_pantheist_league_community
													}
												}
											}
											secret_religious_society_muhjari = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_muhjari_community
														}
														religion = muhjari
														remove_province_modifier = secret_muhjari_community
													}
												}
											}
											secret_religious_society_kahin = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_kahin_community
														}
														religion = kahin
														remove_province_modifier = secret_kahin_community
													}
												}
											}
											secret_religious_society_thasmudyanic = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_thasmudyanic_community
														}
														religion = thasmudyanic
														remove_province_modifier = secret_thasmudyanic_community
													}
												}
											}
											secret_religious_society_nogari_reformed = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_nogari_reformed_community
														}
														religion = nogari_reformed
														remove_province_modifier = secret_nogari_reformed_community
													}
												}
											}
											secret_religious_society_nogari = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_nogari_community
														}
														religion = nogari
														remove_province_modifier = secret_nogari_community
													}
												}
											}
											secret_religious_society_jaziri = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_jaziri_community
														}
														religion = jaziri
														remove_province_modifier = secret_jaziri_community
													}
												}
											}
											secret_religious_society_jaziri_reformed = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_jaziri_reformed_community
														}
														religion = jaziri_reformed
														remove_province_modifier = secret_jaziri_reformed_community
													}
												}
											}
											secret_religious_society_padhran = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_padhran_community
														}
														religion = padhran
														remove_province_modifier = secret_padhran_community
													}
												}
											}
											secret_religious_society_the_path = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_the_path_community
														}
														religion = the_path
														remove_province_modifier = secret_the_path_community
													}
												}
											}
											secret_religious_society_chung_tao = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_chung_tao_community
														}
														religion = chung_tao
														remove_province_modifier = secret_chung_tao_community
													}
												}
											}
											secret_religious_society_nine_travelers = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_nine_travelers_community
														}
														religion = nine_travelers
														remove_province_modifier = secret_nine_travelers_community
													}
												}
											}
											secret_religious_society_adama = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_adama_community
														}
														religion = adama
														remove_province_modifier = secret_adama_community
													}
												}
											}
											secret_religious_society_animist = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_animist_community
														}
														religion = animist
														remove_province_modifier = secret_animist_community
													}
												}
											}
											secret_religious_society_elven_pantheon = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_elven_pantheon_community
														}
														religion = elven_pantheon
														remove_province_modifier = secret_elven_pantheon_community
													}
												}
											}
											secret_religious_society_asathalfinare = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_asathalfinare_community
														}
														religion = asathalfinare
														remove_province_modifier = secret_asathalfinare_community
													}
												}
											}
											secret_religious_society_sylvan = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_sylvan_community
														}
														religion = sylvan
														remove_province_modifier = secret_sylvan_community
													}
												}
											}
											secret_religious_society_eilistraee = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_eilistraee_community
														}
														religion = eilistraee
														remove_province_modifier = secret_eilistraee_community
													}
												}
											}
											secret_religious_society_yuir_reformed = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_yuir_reformed_community
														}
														religion = yuir_reformed
														remove_province_modifier = secret_yuir_reformed_community
													}
												}
											}
											secret_religious_society_yuir = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_yuir_community
														}
														religion = yuir
														remove_province_modifier = secret_yuir_community
													}
												}
											}
											secret_religious_society_lolth_cult = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_lolth_cult_community
														}
														religion = lolth_cult
														remove_province_modifier = secret_lolth_cult_community
													}
												}
											}
											secret_religious_society_vhaeraun = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_vhaeraun_community
														}
														religion = vhaeraun
														remove_province_modifier = secret_vhaeraun_community
													}
												}
											}
											secret_religious_society_kiaransalee = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_kiaransalee_community
														}
														religion = kiaransalee
														remove_province_modifier = secret_kiaransalee_community
													}
												}
											}
											secret_religious_society_dwarven_pantheon = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_dwarven_pantheon_community
														}
														religion = dwarven_pantheon
														remove_province_modifier = secret_dwarven_pantheon_community
													}
												}
											}
											secret_religious_society_laduguer = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_laduguer_community
														}
														religion = laduguer
														remove_province_modifier = secret_laduguer_community
													}
												}
											}
											secret_religious_society_gnome_pantheon = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_gnome_pantheon_community
														}
														religion = gnome_pantheon
														remove_province_modifier = secret_gnome_pantheon_community
													}
												}
											}
											secret_religious_society_urdlen = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_urdlen_community
														}
														religion = urdlen
														remove_province_modifier = secret_urdlen_community
													}
												}
											}
											secret_religious_society_giant_pantheon = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_giant_pantheon_community
														}
														religion = giant_pantheon
														remove_province_modifier = secret_giant_pantheon_community
													}
												}
											}
											secret_religious_society_vaprak = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_vaprak_community
														}
														religion = vaprak
														remove_province_modifier = secret_vaprak_community
													}
												}
											}
											secret_religious_society_karontor = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_karontor_community
														}
														religion = karontor
														remove_province_modifier = secret_karontor_community
													}
												}
											}
											secret_religious_society_ulutiuan_reformed = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_ulutiuan_reformed_community
														}
														religion = ulutiuan_reformed
														remove_province_modifier = secret_ulutiuan_reformed_community
													}
												}
											}
											secret_religious_society_ulutiuan = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_ulutiuan_community
														}
														religion = ulutiuan
														remove_province_modifier = secret_ulutiuan_community
													}
												}
											}
											secret_religious_society_draconic_pantheon = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_draconic_pantheon_community
														}
														religion = draconic_pantheon
														remove_province_modifier = secret_draconic_pantheon_community
													}
												}
											}
											secret_religious_society_tiamat = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_tiamat_community
														}
														religion = tiamat
														remove_province_modifier = secret_tiamat_community
													}
												}
											}
											secret_religious_society_bahamut = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_bahamut_community
														}
														religion = bahamut
														remove_province_modifier = secret_bahamut_community
													}
												}
											}
											secret_religious_society_goblin_pantheon = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_goblin_pantheon_community
														}
														religion = goblin_pantheon
														remove_province_modifier = secret_goblin_pantheon_community
													}
												}
											}
											secret_religious_society_goblin_reformed = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_goblin_reformed_community
														}
														religion = goblin_reformed
														remove_province_modifier = secret_goblin_reformed_community
													}
												}
											}
											secret_religious_society_orc_pantheon = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_orc_pantheon_community
														}
														religion = orc_pantheon
														remove_province_modifier = secret_orc_pantheon_community
													}
												}
											}
											secret_religious_society_orc_reformed = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_orc_reformed_community
														}
														religion = orc_reformed
														remove_province_modifier = secret_orc_reformed_community
													}
												}
											}
											secret_religious_society_faithless = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_faithless_community
														}
														religion = faithless
														remove_province_modifier = secret_faithless_community
													}
												}
											}
											secret_religious_society_entropy = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_entropy_community
														}
														religion = entropy
														remove_province_modifier = secret_entropy_community
													}
												}
											}
											secret_religious_society_blue_flame = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_blue_flame_community
														}
														religion = blue_flame
														remove_province_modifier = secret_blue_flame_community
													}
												}
											}
											secret_religious_society_ancestral_cult = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_ancestral_cult_community
														}
														religion = ancestral_cult
														remove_province_modifier = secret_ancestral_cult_community
													}
												}
											}
											secret_religious_society_qukoku = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_qukoku_community
														}
														religion = qukoku
														remove_province_modifier = secret_qukoku_community
													}
												}
											}
											secret_religious_society_beholder_pantheon = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_beholder_pantheon_community
														}
														religion = beholder_pantheon
														remove_province_modifier = secret_beholder_pantheon_community
													}
												}
											}
											secret_religious_society_illithid_pantheon = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_illithid_pantheon_community
														}
														religion = illithid_pantheon
														remove_province_modifier = secret_illithid_pantheon_community
													}
												}
											}
											secret_religious_society_faceless_god = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_faceless_god_community
														}
														religion = faceless_god
														remove_province_modifier = secret_faceless_god_community
													}
												}
											}
										}
									}
								}
							}
						}
					}
					flip_secret_religious_community_provinces = yes
					convert_to_secret_religion = yes

					top_liege = {
						any_realm_lord = {
							character_event = { id = MNM.3830 } # Inform lieges unless they're part of the cult flipping, save a flag on previous events.
						}

						any_realm_character = {
							limit = {
								NOT = {
									character = ROOT
								}
								same_society_as = ROOT
							}
							leave_society = yes
						}

						any_realm_character = {
							limit = {
								has_character_flag = currently_part_of_secret_religion_uncovering
							}
							clr_character_flag = currently_part_of_secret_religion_uncovering
						}
					}
					any_society_member = {
						limit = {
							NOT = {
								character = ROOT
							}
							same_society_as = ROOT
						}
						leave_society = yes
					}
					leave_society = yes
				}
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				is_landed = no
			}
			modifier = {
				factor = 0
				prisoner = yes
			}
			modifier = {
				factor = 0.001
				any_society_member = {
					NOT = { character = ROOT }
					same_realm = ROOT
					ai = no
				}
				NOT = {
					top_liege = {
						OR = {
							same_society_as = ROOT
							is_openly_of_roots_secret_religion_trigger = yes
						}
					}
				}
			}
			modifier = {
				factor = 0
				top_liege = {
					war = yes
				}
			}
			modifier = { #Don't do it unless you are confident in support
				factor = 0
				NOR = {
					AND = { # The Top Liege is in the Secret Cult, and at least 3 of the Liege's direct vassals are also members
						top_liege = {
							OR = {
								same_society_as = ROOT
								is_openly_of_roots_secret_religion_trigger = yes
							}
						}
						top_liege = {
							any_vassal = {
								count = 3
								higher_tier_than = BARON
								prisoner = no
								OR = {
									same_society_as = ROOT
									is_openly_of_roots_secret_religion_trigger = yes
								}
							}
						}
					}
					top_liege = { # At least 5 direct vassals of the Top Liege is in the Secret Cult
						any_vassal = {
							count = 5
							higher_tier_than = BARON
							prisoner = no
							OR = {
								same_society_as = ROOT
								is_openly_of_roots_secret_religion_trigger = yes
							}
						}
					}
					top_liege = { # All direct vassals of the Top Liege are in the Secret Cult
						NOT = {
							any_vassal = {
								higher_tier_than = BARON
								NOR = {
									same_society_as = ROOT
									is_openly_of_roots_secret_religion_trigger = yes
								}
							}
						}
					}
					top_liege = {
						realm_character_percent = {
							target = 0.30
							OR = {
								same_society_as = ROOT
								is_openly_of_prevs_secret_religion_trigger = yes
							}
						}
					}
					AND = {
						top_liege = {
							realm_character_percent = {
								target = 0.25
								OR = {
									same_society_as = ROOT
									is_openly_of_prevs_secret_religion_trigger = yes
								}
							}
						}
						liege = {
							OR = {
								same_society_as = ROOT
								is_openly_of_prevs_secret_religion_trigger = yes
							}
						}
					}
					AND = {
						top_liege = {
							realm_character_percent = {
								target = 0.20
								OR = {
									same_society_as = ROOT
									is_openly_of_prevs_secret_religion_trigger = yes
								}
							}
						}
						top_liege = {
							OR = {
								same_society_as = ROOT
								is_openly_of_prevs_secret_religion_trigger = yes
							}
						}
						liege = {
							OR = {
								same_society_as = ROOT
								is_openly_of_prevs_secret_religion_trigger = yes
							}
						}
					}
					AND = {
						top_liege = {
							realm_character_percent = {
								target = 0.15
								OR = {
									same_society_as = ROOT
									is_openly_of_prevs_secret_religion_trigger = yes
								}
							}
						}
						any_vassal = {
							OR = {
								same_society_as = ROOT
								is_openly_of_prevs_secret_religion_trigger = yes
							}
						}
						top_liege = {
							OR = {
								same_society_as = ROOT
								is_openly_of_prevs_secret_religion_trigger = yes
							}
						}
						liege = {
							OR = {
								same_society_as = ROOT
								is_openly_of_prevs_secret_religion_trigger = yes
							}
						}
					}
				}
			}
			modifier = {
				factor = 1.5
				trait = ambitious
			}
			modifier = {
				factor = 1.5
				realm_character_percent = {
					target = 0.15
					OR = {
						same_society_as = ROOT
						is_openly_of_prevs_secret_religion_trigger = yes
					}
				}
			}
			modifier = {
				factor = 1.5
				realm_character_percent = {
					target = 0.25
					OR = {
						same_society_as = ROOT
						is_openly_of_prevs_secret_religion_trigger = yes
					}
				}
			}
			modifier = {
				factor = 1.5
				realm_character_percent = {
					target = 0.35
					OR = {
						same_society_as = ROOT
						is_openly_of_prevs_secret_religion_trigger = yes
					}
				}
			}
			modifier = {
				factor = 1.5
				realm_character_percent = {
					target = 0.5
					OR = {
						same_society_as = ROOT
						is_openly_of_prevs_secret_religion_trigger = yes
					}
				}
			}
			modifier = {
				factor = 1.5
				realm_character_percent = {
					target = 0.65
					OR = {
						same_society_as = ROOT
						is_openly_of_prevs_secret_religion_trigger = yes
					}
				}
			}
		}
	}

	secret_religions_blend_in = {
		ai_check_interval = 12
		is_in_society = yes

		potential = {
			not_casting = yes
			society_member_of = secret_religious_cult
			has_quest = quest_secret_religions_societies_blend_in
			NOT = { has_character_modifier = attempting_to_blend_in }
		}
		allow = {
			has_quest = quest_secret_religions_societies_blend_in
			prisoner = no
			NOT = { trait = incapable }
			NOT = { is_inaccessible_trigger = yes }
			custom_tooltip = {
				text = quest_secret_religions_societies_blend_in_allow_tt
				OR = {
					NOT = { has_character_flag = blending_in_timer }
					had_character_flag = { flag = blending_in_timer days = 1000 }
				}
			}
		}

		effect = {
			add_character_modifier = {
				name = attempting_to_blend_in
				duration = -1
			}
			hidden_effect = { character_event = { id = MNM.3399 } }
		}

		ai_will_do = {
			factor = 0.3

			modifier = {
				factor = 0.01
				war = yes
			}
			modifier = {
				factor = 2
				OR = {
					trait = gregarious
					trait = socializer
				}
			}
			modifier = {
				factor = 0.1
				trait = shy
			}
			modifier = {
				factor = 0.1
				is_dumb_trigger = yes
			}
		}
	}
}

targeted_decisions = {
	secret_religions_conduct_secret_ceremony = {
		is_in_society = yes
		ai_check_interval = 12
		filter = self
		ai_target_filter = self

		potential = {
			society_member_of = secret_religious_cult
			has_quest = quest_secret_religions_conduct_secret_ceremony
		}
		allow = {
			has_quest = quest_secret_religions_conduct_secret_ceremony
			prisoner = no
			NOT = { trait = incapable }
			NOT = { is_inaccessible_trigger = yes }
			custom_tooltip = {
				text = quest_secret_religions_conduct_secret_ceremony_allow_tt
				OR = {
					NOT = { has_character_flag = conduct_secret_ceremony_timer }
					had_character_flag = { flag = conduct_secret_ceremony_timer days = 1000 }
				}
			}
		}

		effect = {
			set_character_flag = conduct_secret_ceremony_timer
			hidden_effect = { character_event = { id = MNM.3235 days = 5 } }
		}

		ai_will_do = {
			factor = 0.5
			modifier = {
				is_ruler = yes
				factor = 10
			}
			modifier = {
				diplomacy = 12
    			factor = 3
			}
			modifier = {
				diplomacy = 15
    			factor = 3
			}
			modifier = {
				trait = paranoid
    			factor = 0.1
			}
			modifier = {
				trait = craven
    			factor = 0.1
			}
		}
	}

	secret_religions_induct_child = {
		is_in_society = yes
		ai_check_interval = 12
		ai_target_filter = home_court

		from_potential = {
			society_member_of = secret_religious_cult
		}

		potential = {
			NOT = {
				character = FROM
			}
			OR = {
				mother = { character = FROM }
				father = { character = FROM }
				educator = { character = FROM }
				guardian = { character = FROM }
			}
			has_secret_religion_trait_trigger = no
			FROM = { ROOT = { is_openly_of_prevs_secret_religion_trigger = no } }
			is_adult = no
            NOT = { FROM = { religion = infernal } }
		}

		allow = {
			FROM = {
				prisoner = no
				is_inaccessible_trigger = no
				NOT = { trait = incapable }
			}
			age = 8
			prisoner = no
			NOT = { trait = incapable }
			NOT = { is_inaccessible_trigger = yes }
			custom_tooltip = {
				text = secret_religions_induct_child_allow_tt
				FROM = { shares_prevs_secret_religion_trigger = no }
			}
			custom_tooltip = {
				text = secret_religions_induct_character_cd_tt
				NOT = { has_character_modifier = secret_religions_induct_child_timer }
			}
		}

		effect = {
			custom_tooltip = {
				text = secret_religions_induct_child_effect

				FROM = { character_event = { id = MNM.3438 } }

				hidden_effect = {
					add_character_modifier = {
						name = secret_religions_induct_child_timer
						years = 6
						hidden = yes
					}
				}
			}
			FROM = {
				if = {
					limit = {
						is_society_grandmaster = yes
					}
					increase_visibility_minor_effect = yes
				}
				if = {
					limit = {
						NOT = { is_society_grandmaster = yes }
					}
					increase_visibility_effect = yes
				}
			}
		}

		ai_will_do = {
			factor = 5
			modifier = {
				FROM = { has_quest = quest_secret_religious_societies_induct_ruler }
    			is_quest_target_of = FROM
    			factor = 100
			}
			modifier = {
				FROM = { has_quest = quest_secret_religious_societies_induct_ruler }
    			NOT = {
					is_quest_target_of = FROM
				}
    			factor = 0.01
			}
			modifier = {
				OR = {
					mother = { character = FROM }
					father = { character = FROM }
				}
				factor = 10
			}
			modifier = {
				FROM = { current_heir = { character = ROOT } }
				factor = 10
			}
			modifier = {
				is_friend = FROM
				factor = 10
			}
			modifier = {
				trait = trusting
				factor = 5
			}
			modifier = {
				ai = no
				factor = 5
			}
			modifier = {
				OR = {
					mother = { ai = no }
					father = { ai = no }
				}
				factor = 0.1
			}
		}
	}

	secret_religions_recruit = {
		is_in_society = yes
		ai_check_interval = 12
		filter = realm
		ai_target_filter = realm

		from_potential = {
			society_member_of = secret_religious_cult
			is_adult = yes
			prisoner = no
			NOT = { trait = incapable }
			NOT = { is_inaccessible_trigger = yes }
			OR = { # Performance saving measures
				has_society_currency_tiny_trigger = yes
				ai = no
			}
			OR = {
				ai = no
				is_society_grandmaster = yes
				num_of_society_members < 90
			}
		}

		potential = {
			OR = {
				FROM = { ai = no } #Either a player is using the decision, OR the target is interested in the AI's secret religious cult
				ai = yes # Or the target is an AI...
				AND = {
					ai = no
					is_in_society = no
					interested_in_society_of_character = FROM
				}
			}

			FROM = {
				OR = {
					ai = yes
					same_realm = PREV
				}
				secret_religion = PREV
			}

			is_adult = yes
			NOT = {
				character = FROM
				society = {
					FROM = {
						society = {
							society_type = prevprev
						}
					}
				}
			}

			#AI can't invite when the society is full
			NAND = {
				ai = yes
				FROM = { ai = yes }
				NOT = {
					FROM = {
						society = {
							ROOT = {
								can_join_society = PREV
							}
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				NOT = {
					has_character_modifier = accused_apostate
				}
				prisoner = no
				is_inaccessible_trigger = no
				NOT = { trait = incapable }
			}
			prisoner = no
			NOT = { trait = incapable }
			NOT = { is_inaccessible_trigger = yes }
			custom_tooltip = {
				text = secret_religions_recruit_allow_tt
				FROM = { shares_prevs_secret_religion_trigger = yes }
			}
			custom_tooltip = {
				text = secret_religions_recruit_cd_tt
				NOT = { has_character_modifier = secret_religions_recruitment_timer }
			}
		}

		effect = {
			custom_tooltip = {
				text = secret_religions_recruit_effect_tt
				FROM = { save_event_target_as = secret_religion_recruiter }
				character_event = { id = MNM.3420 }

				add_character_modifier = {
					name = secret_religions_recruitment_timer
					years = 10
					hidden = yes
				}
			}
			FROM = {
				if = {
					limit = {
						is_society_grandmaster = yes
					}
					increase_visibility_minor_effect = yes
				}
				if = {
					limit = {
						NOT = { is_society_grandmaster = yes }
					}
					increase_visibility_effect = yes
				}
			}
		}

		ai_will_do = {
			factor = 5
			modifier = {
				is_ruler = yes
				factor = 10
			}
			modifier = {
				ai = no
				factor = 5
			}
			modifier = {
				diplomacy = 12
    			factor = 3
			}
			modifier = {
				diplomacy = 15
    			factor = 3
			}
			modifier = {
				trait = paranoid
    			factor = 0.1
			}
			modifier = {
				trait = craven
    			factor = 0.1
			}
			modifier = {
				factor = 0 # don't recruit characters interested in something else
				NOT = { interested_in_society = secret_religious_cult }
				is_interested_in_any_society = yes
			}
			modifier = {
				NOT = {
					any_realm_character = {
						ai = no
					}
				}
    			factor = 0.1
			}
		}
	}

	secret_religions_induct_character = {
		is_in_society = yes
		ai_check_interval = 12
		filter = realm
		ai_target_filter = realm

		from_potential = {
			society_member_of = secret_religious_cult
			society_rank >= 2
			is_adult = yes
			prisoner = no
			NOT = { trait = incapable }
			NOT = { is_inaccessible_trigger = yes }
			OR = { # Performance saving measure
				has_society_currency_tiny_trigger = yes
				ai = no
			}
			OR = {
				ai = no
				is_society_grandmaster = yes
				num_of_society_members < 90
			}
		}

		potential = {
			NOT = {
				character = FROM
			}
			is_adult = yes
			FROM = {
				ROOT = {
					NOR = {
						secret_religion = PREV
                        # AND = {
                        # NOT = { has_game_rule = { name = devil_worshipers value = none } }
                        # religion = infernal
                        # }
					}
					is_openly_of_prevs_secret_religion_trigger = no
				}
			}
			FROM = {
				ROOT = {
					OR = {
						has_sympathy_for_true_religion_of_prev_trigger = yes
						is_openly_of_prevs_true_religion_group = yes
					}
				}
			}
		}

		allow = {
			FROM = {
				NOT = {
					has_character_modifier = accused_apostate
				}
				prisoner = no
				is_inaccessible_trigger = no
				NOT = { trait = incapable }
			}
			prisoner = no
            NOT = { same_society_as = FROM }
			is_incapable = no
			NOT = { is_inaccessible_trigger = yes }
			custom_tooltip = {
				text = secret_religions_induct_character_cd_tt
				OR = {
					NOT = { has_character_modifier = secret_religion_induction_timer }
					has_quest = quest_secret_religious_societies_induct_ruler
				}
			}
			can_change_faith_trigger = yes
			OR = {
				AND = {
					is_ruler = no
					FROM = { has_society_currency_tiny_trigger = yes }
				}
				hidden_tooltip = {
					FROM = {
						has_society_currency_tiny_trigger = yes
						ai = yes
						is_society_grandmaster = yes
					}
				}
				AND = {
					is_ruler = yes
					FROM = { has_society_currency_minor_trigger = yes }
				}
			}
		}

		effect = {
			if = {
				limit = {
					is_ruler = no
					hidden_tooltip = {
						FROM = {
							NAND = {
								ai = yes
								is_society_grandmaster = yes
							}
						}
					}
				}
				FROM = { detract_society_currency_tiny_effect = yes }
			}
			if = {
				limit = {
					FROM = {
						ai = yes
						is_society_grandmaster = yes
					}
				}
				FROM = { detract_society_currency_tiny_effect = yes }
			}
			if = {
				limit = {
					is_ruler = yes
					hidden_tooltip = {
						FROM = {
							NAND = {
								ai = yes
								is_society_grandmaster = yes
							}
						}
					}
				}
				FROM = { detract_society_currency_minor_effect = yes }
			}

			hidden_effect = {
				add_character_modifier = {
					name = secret_religion_induction_timer
					years = 10
					hidden = yes
				}
			}

			custom_tooltip = {
				text = secret_religions_induct_character_effect_tt
				FROM = { character_event = { id = MNM.3408 days = 10 } }
			}
			FROM = {
				if = {
					limit = {
						is_society_grandmaster = yes
					}
					increase_visibility_minor_effect = yes
				}
				if = {
					limit = {
						NOT = { is_society_grandmaster = yes }
					}
					increase_visibility_effect = yes
				}
			}
		}

		ai_will_do = {
			factor = 5
			modifier = {
				FROM = { has_quest = quest_secret_religious_societies_induct_ruler }
    			is_quest_target_of = FROM
    			factor = 100
			}
			modifier = {
				FROM = { has_quest = quest_secret_religious_societies_induct_ruler }
				NOT = {
					is_quest_target_of = FROM
				}
				factor = 0.01 #to save targets for missions
			}
			modifier = {
				FROM = {
					NOT = {
						is_society_grandmaster = yes
					}
				}
				factor = 0.1
			}
			modifier = {
				ai = no
				factor = 5
			}
			modifier = {
				is_ruler = yes
				factor = 10
			}
			modifier = {
				is_close_relative = FROM
				factor = 10
			}
			modifier = {
				is_lover = FROM
				factor = 10
			}
			modifier = {
				is_friend = FROM
				factor = 10
			}
			modifier = {
				trait = trusting
				factor = 5
			}
			modifier = {
				NOT = {
					any_realm_character = {
						ai = no
					}
				}
    			factor = 0.01
			}
		}
	}

	secret_religions_evoke_sympathy = {
		is_in_society = yes
		ai_check_interval = 12
		filter = realm
		ai_target_filter = realm

		from_potential = {
			society_member_of = secret_religious_cult
			is_adult = yes
			prisoner = no
			is_incapable = no
			NOT = { is_inaccessible_trigger = yes }
			OR = { # Performance saving measure
				has_society_currency_tiny_trigger = yes
				ai = no
			}
			OR = {
				ai = no
				is_society_grandmaster = yes
				num_of_society_members < 90
			}
		}

		potential = {
			same_realm = FROM
			is_adult = yes
			NOT = { same_society_as = FROM }
			FROM = {
				ROOT = {
					has_sympathy_for_true_religion_of_prev_trigger = no
					is_openly_of_prevs_true_religion_group = no
					shares_prevs_secret_religion_trigger = no
				}
			}
			NOT = {
				character = FROM
				society = {
					FROM = {
						society = {
							society_type = PREVPREV
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				NOT = {
					has_character_modifier = accused_apostate
				}
				prisoner = no
				is_inaccessible_trigger = no
				NOT = { trait = incapable }
			}
			prisoner = no
			is_incapable = no
			NOT = { is_inaccessible_trigger = yes }
			custom_tooltip = {
				text = secret_religions_evoke_sympathy_cd_tt
				OR = {
					NOT = { has_character_modifier = secret_religion_sympathy_timer }
					FROM = {
						has_quest = quest_secret_religious_societies_sympathy_ruler
						ROOT = { is_quest_target_of = FROM }
					}
				}
			}
			FROM = {
				OR = {
					custom_tooltip = {
						text = evoke_sympathy_of_tt
						has_quest = quest_secret_religious_societies_sympathy_ruler
						ROOT = { is_quest_target_of = FROM }
					}
					has_society_currency_tiny_trigger = yes
				}
			}
		}

		effect = {
			if = {
				limit = {
					NOT = {
						AND = {
							FROM = { has_quest = quest_secret_religious_societies_sympathy_ruler }
							ROOT = { is_quest_target_of = FROM }
						}
					}
				}
				FROM = { detract_society_currency_tiny_effect = yes }
			}

			hidden_effect = {
				add_character_modifier = {
					name = secret_religion_sympathy_timer
					years = 10
					hidden = yes
				}
			}

			custom_tooltip = {
				text = secret_religions_evoke_sympathy_tt
				FROM = { character_event = { id = MNM.3404 days = 7 } }
			}
			FROM = {
				if = {
					limit = {
						NOT = { is_society_grandmaster = yes }
					}
					increase_visibility_minor_effect = yes
				}
			}
		}

		ai_will_do = {
			factor = 5
			modifier = {
				FROM = { has_quest = quest_secret_religious_societies_sympathy_ruler }
    			is_quest_target_of = FROM
    			factor = 100
			}
			modifier = {
				FROM = { has_quest = quest_secret_religious_societies_sympathy_ruler }
				NOT = {
					is_quest_target_of = FROM
				}
				factor = 0.01 #to save targets for missions
			}
			modifier = {
				FROM = { has_quest = quest_secret_religious_societies_induct_ruler } #to complete this mission, sympathy is needed first
    			is_quest_target_of = FROM
    			factor = 100
			}
			modifier = {
				FROM = { has_quest = quest_secret_religious_societies_induct_ruler }
    			NOT = {
					is_quest_target_of = FROM
				}
    			factor = 0.01
			}
			modifier = {
				FROM = {
					NOT = {
						is_society_grandmaster = yes
					}
				}
				factor = 0.1
			}
			modifier = {
				is_ruler = yes
				factor = 3
			}
			modifier = {
				trait = zealous
				factor = 0.0001
			}
			modifier = {
				is_close_relative = FROM
				factor = 10
			}
			modifier = {
				is_lover = FROM
				factor = 10
			}
			modifier = {
				is_friend = FROM
				factor = 10
			}
			modifier = {
				trait = kind
				factor = 5
			}
			modifier = {
				trait = trusting
				factor = 5
			}
			modifier = {
				ai = no
				factor = 5
			}
		}
	}

	secret_religions_renounce_secret_religion = {
		only_playable = yes
		ai = no
		filter = self
		ai_target_filter = self

		potential = {
			character = FROM
			has_secret_religion = yes
		}

		allow = {
			NOT = { trait = incapable }
		}

		effect = {
			if = {
				limit = {
					society_member_of = secret_religious_cult
					is_society_grandmaster = yes
				}
				leave_society = yes
			}
			if = {
				limit = {
					capital_scope = {
						ROOT = { NOT = { true_religion_group = PREV } }
					}
				}
				prestige = -1000
			}
			if = {
				limit = {
					capital_scope = {
						ROOT = { true_religion_group = PREV }
						ROOT = { NOT = { true_religion = PREV } }
					}
				}
				prestige = -500
			}
			piety = 250
			true_religion_scope = {
				show_scope_change = no
				religion_authority = {
					modifier = ruler_converted_from
				}
			}
			clear_secret_religion = yes
		}

		ai_will_do = {
			factor = 0
		}
	}

	secret_religions_personally_adopt_secret_religion = {
		only_playable = yes
		ai = no
		filter = self
		ai_target_filter = self

		potential = {
			character = FROM
			has_secret_religion = yes
		}

		allow = {
			NOT = { trait = incapable }
		}

		effect = {
			convert_to_secret_religion = yes
			trigger_switch = {
				on_trigger = religion
				triadic = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_triadic_community } religion = triadic
					}
				}
				arcane = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_arcane_community } religion = arcane
					}
				}
				rasallesian = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_rasallesian_community } religion = rasallesian
					}
				}
				chessic = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_chessic_community } religion = chessic
					}
				}
				mercantile = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_mercantile_community } religion = mercantile
					}
				}
				inventive = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_inventive_community } religion = inventive
					}
				}
				joyful = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_joyful_community } religion = joyful
					}
				}
				calishite_faith = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_calishite_faith_community } religion = calishite_faith
					}
				}
				lapal_faith = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_lapal_faith_community } religion = lapal_faith
					}
				}
				chauntean_faith = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_chauntean_faith_community } religion = chauntean_faith
					}
				}
				mulhorandi_faith = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_mulhorandi_faith_community } religion = mulhorandi_faith
					}
				}
				untheric_faith = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_untheric_faith_community } religion = untheric_faith
					}
				}
				enlil = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_enlil_community } religion = enlil
					}
				}
				halfling_pantheon = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_halfling_pantheon_community } religion = halfling_pantheon
					}
				}
				solar = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_solar_community } religion = solar
					}
				}
				deities_of_fury = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_deities_of_fury_community } religion = deities_of_fury
					}
				}
				natural = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_natural_community } religion = natural
					}
				}
				kossuth = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_kossuth_community } religion = kossuth
					}
				}
				geomancy = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_geomancy_community } religion = geomancy
					}
				}
				primordial = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_primordial_community } religion = primordial
					}
				}
				tuigan_shamanism = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_tuigan_shamanism_community } religion = tuigan_shamanism
					}
				}
				uthgardt_reformed = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_uthgardt_reformed_community } religion = uthgardt_reformed
					}
				}
				uthgardt_faith = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_uthgardt_faith_community } religion = uthgardt_faith
					}
				}
				martial_faith = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_martial_faith_community } religion = martial_faith
					}
				}
				ubtao_worship = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_ubtao_worship_community } religion = ubtao_worship
					}
				}
				earthmother_reformed = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_earthmother_reformed_community } religion = earthmother_reformed
					}
				}
				earthmother = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_earthmother_community } religion = earthmother
					}
				}
				toteteohuan = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_toteteohuan_community } religion = toteteohuan
					}
				}
				dead_three = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_dead_three_community } religion = dead_three
					}
				}
				shadow_gods = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_shadow_gods_community } religion = shadow_gods
					}
				}
				ghaunadaur = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_ghaunadaur_community } religion = ghaunadaur
					}
				}
				loviatar = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_loviatar_community } religion = loviatar
					}
				}
				church_of_cyric = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_church_of_cyric_community } religion = church_of_cyric
					}
				}
				abyssal_cult = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_abyssal_cult_community } religion = abyssal_cult
					}
				}
				infernal = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_infernal_community } religion = infernal
					}
				}
				scale_cult = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_scale_cult_community } religion = scale_cult
					}
				}
				ten_thousand_gods = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_ten_thousand_gods_community } religion = ten_thousand_gods
					}
				}
				qisma = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_qisma_community } religion = qisma
					}
				}
				pantheist_league = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_pantheist_league_community } religion = pantheist_league
					}
				}
				muhjari = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_muhjari_community } religion = muhjari
					}
				}
				kahin = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_kahin_community } religion = kahin
					}
				}
				thasmudyanic = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_thasmudyanic_community } religion = thasmudyanic
					}
				}
				nogari_reformed = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_nogari_reformed_community } religion = nogari_reformed
					}
				}
				nogari = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_nogari_community } religion = nogari
					}
				}
				jaziri = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_jaziri_community } religion = jaziri
					}
				}
				jaziri_reformed = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_jaziri_reformed_community } religion = jaziri_reformed
					}
				}
				padhran = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_padhran_community } religion = padhran
					}
				}
				the_path = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_the_path_community } religion = the_path
					}
				}
				chung_tao = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_chung_tao_community } religion = chung_tao
					}
				}
				nine_travelers = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_nine_travelers_community } religion = nine_travelers
					}
				}
				adama = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_adama_community } religion = adama
					}
				}
				animist = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_animist_community } religion = animist
					}
				}
				elven_pantheon = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_elven_pantheon_community } religion = elven_pantheon
					}
				}
				asathalfinare = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_asathalfinare_community } religion = asathalfinare
					}
				}
				sylvan = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_sylvan_community } religion = sylvan
					}
				}
				eilistraee = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_eilistraee_community } religion = eilistraee
					}
				}
				yuir_reformed = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_yuir_reformed_community } religion = yuir_reformed
					}
				}
				yuir = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_yuir_community } religion = yuir
					}
				}
				lolth_cult = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_lolth_cult_community } religion = lolth_cult
					}
				}
				vhaeraun = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_vhaeraun_community } religion = vhaeraun
					}
				}
				kiaransalee = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_kiaransalee_community } religion = kiaransalee
					}
				}
				dwarven_pantheon = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_dwarven_pantheon_community } religion = dwarven_pantheon
					}
				}
				laduguer = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_laduguer_community } religion = laduguer
					}
				}
				gnome_pantheon = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_gnome_pantheon_community } religion = gnome_pantheon
					}
				}
				urdlen = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_urdlen_community } religion = urdlen
					}
				}
				giant_pantheon = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_giant_pantheon_community } religion = giant_pantheon
					}
				}
				vaprak = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_vaprak_community } religion = vaprak
					}
				}
				karontor = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_karontor_community } religion = karontor
					}
				}
				ulutiuan_reformed = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_ulutiuan_reformed_community } religion = ulutiuan_reformed
					}
				}
				ulutiuan = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_ulutiuan_community } religion = ulutiuan
					}
				}
				draconic_pantheon = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_draconic_pantheon_community } religion = draconic_pantheon
					}
				}
				tiamat = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_tiamat_community } religion = tiamat
					}
				}
				bahamut = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_bahamut_community } religion = bahamut
					}
				}
				goblin_pantheon = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_goblin_pantheon_community } religion = goblin_pantheon
					}
				}
				goblin_reformed = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_goblin_reformed_community } religion = goblin_reformed
					}
				}
				orc_pantheon = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_orc_pantheon_community } religion = orc_pantheon
					}
				}
				orc_reformed = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_orc_reformed_community } religion = orc_reformed
					}
				}
				faithless = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_faithless_community } religion = faithless
					}
				}
				entropy = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_entropy_community } religion = entropy
					}
				}
				blue_flame = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_blue_flame_community } religion = blue_flame
					}
				}
				ancestral_cult = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_ancestral_cult_community } religion = ancestral_cult
					}
				}
				qukoku = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_qukoku_community } religion = qukoku
					}
				}
				beholder_pantheon = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_beholder_pantheon_community } religion = beholder_pantheon
					}
				}
				illithid_pantheon = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_illithid_pantheon_community } religion = illithid_pantheon
					}
				}
				faceless_god = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_faceless_god_community } religion = faceless_god
					}
				}
			}
			if = {
				limit = {
					liege = {
						NOT = {
							character = ROOT
						}
					}
				}
				liege = {
					character_event = { id = MNM.3840 }
				}
			}
			hidden_tooltip = {
				set_variable = { which = visibility_value value = 0 }
				remove_character_modifier = highly_suspect
				remove_character_modifier = under_suspicion
			}
		}

		ai_will_do = {
			factor = 0
		}
	}
}

#########################################################################################################
################ Secret society title decisions
#########################################################################################################
title_decisions = {
	secret_religions_prepare_grounds = {
		only_playable = yes
		is_in_society = yes
		ai_check_interval = 6
		ai_target_filter = realm_owned
		filter = realm_owned

		from_potential = {
			society_rank > 2
			society_member_of = secret_religious_cult
		}

		potential = {
			tier = COUNT
			holder_scope = {
				OR = {
					character = FROM
					any_liege = { character = FROM }
				}
			}
			OR = {
				#good_human_pantheon_group
					AND = {
						FROM = {
							society_member_of = secret_religious_society_triadic
						}
						NOT = { location = { religion = triadic } }
						NOT = { location = { has_province_modifier = secret_triadic_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_arcane
						}
						NOT = { location = { religion = arcane } }
						NOT = { location = { has_province_modifier = secret_arcane_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_rasallesian
						}
						NOT = { location = { religion = rasallesian } }
						NOT = { location = { has_province_modifier = secret_rasallesian_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_chessic
						}
						NOT = { location = { religion = chessic } }
						NOT = { location = { has_province_modifier = secret_chessic_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_mercantile
						}
						NOT = { location = { religion = mercantile } }
						NOT = { location = { has_province_modifier = secret_mercantile_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_inventive
						}
						NOT = { location = { religion = inventive } }
						NOT = { location = { has_province_modifier = secret_inventive_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_joyful
						}
						NOT = { location = { religion = joyful } }
						NOT = { location = { has_province_modifier = secret_joyful_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_calishite_faith
						}
						NOT = { location = { religion = calishite_faith } }
						NOT = { location = { has_province_modifier = secret_calishite_faith_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_lapal_faith
						}
						NOT = { location = { religion = lapal_faith } }
						NOT = { location = { has_province_modifier = secret_lapal_faith_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_chauntean_faith
						}
						NOT = { location = { religion = chauntean_faith } }
						NOT = { location = { has_province_modifier = secret_chauntean_faith_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_mulhorandi_faith
						}
						NOT = { location = { religion = mulhorandi_faith } }
						NOT = { location = { has_province_modifier = secret_mulhorandi_faith_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_untheric_faith
						}
						NOT = { location = { religion = untheric_faith } }
						NOT = { location = { has_province_modifier = secret_untheric_faith_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_enlil
						}
						NOT = { location = { religion = enlil } }
						NOT = { location = { has_province_modifier = secret_enlil_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_halfling_pantheon
						}
						NOT = { location = { religion = halfling_pantheon } }
						NOT = { location = { has_province_modifier = secret_halfling_pantheon_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_solar
						}
						NOT = { location = { religion = solar } }
						NOT = { location = { has_province_modifier = secret_solar_community } }
					}
				#wild_human_pantheon_group
					AND = {
						FROM = {
							society_member_of = secret_religious_society_deities_of_fury
						}
						NOT = { location = { religion = deities_of_fury } }
						NOT = { location = { has_province_modifier = secret_deities_of_fury_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_natural
						}
						NOT = { location = { religion = natural } }
						NOT = { location = { has_province_modifier = secret_natural_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_kossuth
						}
						NOT = { location = { religion = kossuth } }
						NOT = { location = { has_province_modifier = secret_kossuth_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_geomancy
						}
						NOT = { location = { religion = geomancy } }
						NOT = { location = { has_province_modifier = secret_geomancy_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_primordial
						}
						NOT = { location = { religion = primordial } }
						NOT = { location = { has_province_modifier = secret_primordial_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_tuigan_shamanism
						}
						NOT = { location = { religion = tuigan_shamanism } }
						NOT = { location = { has_province_modifier = secret_tuigan_shamanism_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_uthgardt_reformed
						}
						NOT = { location = { religion = uthgardt_reformed } }
						NOT = { location = { has_province_modifier = secret_uthgardt_reformed_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_uthgardt_faith
						}
						NOT = { location = { religion = uthgardt_faith } }
						NOT = { location = { has_province_modifier = secret_uthgardt_faith_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_martial_faith
						}
						NOT = { location = { religion = martial_faith } }
						NOT = { location = { has_province_modifier = secret_martial_faith_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_ubtao_worship
						}
						NOT = { location = { religion = ubtao_worship } }
						NOT = { location = { has_province_modifier = secret_ubtao_worship_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_earthmother_reformed
						}
						NOT = { location = { religion = earthmother_reformed } }
						NOT = { location = { has_province_modifier = secret_earthmother_reformed_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_earthmother
						}
						NOT = { location = { religion = earthmother } }
						NOT = { location = { has_province_modifier = secret_earthmother_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_toteteohuan
						}
						NOT = { location = { religion = toteteohuan } }
						NOT = { location = { has_province_modifier = secret_toteteohuan_community } }
					}
				#evil_human_pantheon_group
					AND = {
						FROM = {
							society_member_of = secret_religious_society_dead_three
						}
						NOT = { location = { religion = dead_three } }
						NOT = { location = { has_province_modifier = secret_dead_three_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_shadow_gods
						}
						NOT = { location = { religion = shadow_gods } }
						NOT = { location = { has_province_modifier = secret_shadow_gods_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_ghaunadaur
						}
						NOT = { location = { religion = ghaunadaur } }
						NOT = { location = { has_province_modifier = secret_ghaunadaur_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_loviatar
						}
						NOT = { location = { religion = loviatar } }
						NOT = { location = { has_province_modifier = secret_loviatar_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_church_of_cyric
						}
						NOT = { location = { religion = church_of_cyric } }
						NOT = { location = { has_province_modifier = secret_church_of_cyric_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_abyssal_cult
						}
						NOT = { location = { religion = abyssal_cult } }
						NOT = { location = { has_province_modifier = secret_abyssal_cult_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_infernal
						}
						NOT = { location = { religion = infernal } }
						NOT = { location = { has_province_modifier = secret_infernal_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_scale_cult
						}
						NOT = { location = { religion = scale_cult } }
						NOT = { location = { has_province_modifier = secret_scale_cult_community } }
					}
				#qismaite_group
					AND = {
						FROM = {
							society_member_of = secret_religious_society_ten_thousand_gods
						}
						NOT = { location = { religion = ten_thousand_gods } }
						NOT = { location = { has_province_modifier = secret_ten_thousand_gods_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_qisma
						}
						NOT = { location = { religion = qisma } }
						NOT = { location = { has_province_modifier = secret_qisma_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_pantheist_league
						}
						NOT = { location = { religion = pantheist_league } }
						NOT = { location = { has_province_modifier = secret_pantheist_league_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_muhjari
						}
						NOT = { location = { religion = muhjari } }
						NOT = { location = { has_province_modifier = secret_muhjari_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_kahin
						}
						NOT = { location = { religion = kahin } }
						NOT = { location = { has_province_modifier = secret_kahin_community } }
					}
				#unenlightened_group
					AND = {
						FROM = {
							society_member_of = secret_religious_society_thasmudyanic
						}
						NOT = { location = { religion = thasmudyanic } }
						NOT = { location = { has_province_modifier = secret_thasmudyanic_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_nogari_reformed
						}
						NOT = { location = { religion = nogari_reformed } }
						NOT = { location = { has_province_modifier = secret_nogari_reformed_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_nogari
						}
						NOT = { location = { religion = nogari } }
						NOT = { location = { has_province_modifier = secret_nogari_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_jaziri
						}
						NOT = { location = { religion = jaziri } }
						NOT = { location = { has_province_modifier = secret_jaziri_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_jaziri_reformed
						}
						NOT = { location = { religion = jaziri_reformed } }
						NOT = { location = { has_province_modifier = secret_jaziri_reformed_community } }
					}
				#karaturan_group
					AND = {
						FROM = {
							society_member_of = secret_religious_society_padhran
						}
						NOT = { location = { religion = padhran } }
						NOT = { location = { has_province_modifier = secret_padhran_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_the_path
						}
						NOT = { location = { religion = the_path } }
						NOT = { location = { has_province_modifier = secret_the_path_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_chung_tao
						}
						NOT = { location = { religion = chung_tao } }
						NOT = { location = { has_province_modifier = secret_chung_tao_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_nine_travelers
						}
						NOT = { location = { religion = nine_travelers } }
						NOT = { location = { has_province_modifier = secret_nine_travelers_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_adama
						}
						NOT = { location = { religion = adama } }
						NOT = { location = { has_province_modifier = secret_adama_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_animist
						}
						NOT = { location = { religion = animist } }
						NOT = { location = { has_province_modifier = secret_animist_community } }
					}
				#elven_pantheon_group
					AND = {
						FROM = {
							society_member_of = secret_religious_society_elven_pantheon
						}
						NOT = { location = { religion = elven_pantheon } }
						NOT = { location = { has_province_modifier = secret_elven_pantheon_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_asathalfinare
						}
						NOT = { location = { religion = asathalfinare } }
						NOT = { location = { has_province_modifier = secret_asathalfinare_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_sylvan
						}
						NOT = { location = { religion = sylvan } }
						NOT = { location = { has_province_modifier = secret_sylvan_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_eilistraee
						}
						NOT = { location = { religion = eilistraee } }
						NOT = { location = { has_province_modifier = secret_eilistraee_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_yuir_reformed
						}
						NOT = { location = { religion = yuir_reformed } }
						NOT = { location = { has_province_modifier = secret_yuir_reformed_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_yuir
						}
						NOT = { location = { religion = yuir } }
						NOT = { location = { has_province_modifier = secret_yuir_community } }
					}
				#drow_pantheon
					AND = {
						FROM = {
							society_member_of = secret_religious_society_lolth_cult
						}
						NOT = { location = { religion = lolth_cult } }
						NOT = { location = { has_province_modifier = secret_lolth_cult_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_vhaeraun
						}
						NOT = { location = { religion = vhaeraun } }
						NOT = { location = { has_province_modifier = secret_vhaeraun_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_kiaransalee
						}
						NOT = { location = { religion = kiaransalee } }
						NOT = { location = { has_province_modifier = secret_kiaransalee_community } }
					}
				#dwarven_pantheon_group
					AND = {
						FROM = {
							society_member_of = secret_religious_society_dwarven_pantheon
						}
						NOT = { location = { religion = dwarven_pantheon } }
						NOT = { location = { has_province_modifier = secret_dwarven_pantheon_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_laduguer
						}
						NOT = { location = { religion = laduguer } }
						NOT = { location = { has_province_modifier = secret_laduguer_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_gnome_pantheon
						}
						NOT = { location = { religion = gnome_pantheon } }
						NOT = { location = { has_province_modifier = secret_gnome_pantheon_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_urdlen
						}
						NOT = { location = { religion = urdlen } }
						NOT = { location = { has_province_modifier = secret_urdlen_community } }
					}
				#giant_pantheon_group
					AND = {
						FROM = {
							society_member_of = secret_religious_society_giant_pantheon
						}
						NOT = { location = { religion = giant_pantheon } }
						NOT = { location = { has_province_modifier = secret_giant_pantheon_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_vaprak
						}
						NOT = { location = { religion = vaprak } }
						NOT = { location = { has_province_modifier = secret_vaprak_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_karontor
						}
						NOT = { location = { religion = karontor } }
						NOT = { location = { has_province_modifier = secret_karontor_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_ulutiuan_reformed
						}
						NOT = { location = { religion = ulutiuan_reformed } }
						NOT = { location = { has_province_modifier = secret_ulutiuan_reformed_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_ulutiuan
						}
						NOT = { location = { religion = ulutiuan } }
						NOT = { location = { has_province_modifier = secret_ulutiuan_community } }
					}
				#draconic_group
					AND = {
						FROM = {
							society_member_of = secret_religious_society_draconic_pantheon
						}
						NOT = { location = { religion = draconic_pantheon } }
						NOT = { location = { has_province_modifier = secret_draconic_pantheon_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_tiamat
						}
						NOT = { location = { religion = tiamat } }
						NOT = { location = { has_province_modifier = secret_tiamat_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_bahamut
						}
						NOT = { location = { religion = bahamut } }
						NOT = { location = { has_province_modifier = secret_bahamut_community } }
					}
				#humanoid_group
					AND = {
						FROM = {
							society_member_of = secret_religious_society_goblin_pantheon
						}
						NOT = { location = { religion = goblin_pantheon } }
						NOT = { location = { has_province_modifier = secret_goblin_pantheon_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_goblin_reformed
						}
						NOT = { location = { religion = goblin_reformed } }
						NOT = { location = { has_province_modifier = secret_goblin_reformed_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_orc_pantheon
						}
						NOT = { location = { religion = orc_pantheon } }
						NOT = { location = { has_province_modifier = secret_orc_pantheon_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_orc_reformed
						}
						NOT = { location = { religion = orc_reformed } }
						NOT = { location = { has_province_modifier = secret_orc_reformed_community } }
					}
				#atheist_group
					AND = {
						FROM = {
							society_member_of = secret_religious_society_faithless
						}
						NOT = { location = { religion = faithless } }
						NOT = { location = { has_province_modifier = secret_faithless_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_entropy
						}
						NOT = { location = { religion = entropy } }
						NOT = { location = { has_province_modifier = secret_entropy_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_blue_flame
						}
						NOT = { location = { religion = blue_flame } }
						NOT = { location = { has_province_modifier = secret_blue_flame_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_ancestral_cult
						}
						NOT = { location = { religion = ancestral_cult } }
						NOT = { location = { has_province_modifier = secret_ancestral_cult_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_qukoku
						}
						NOT = { location = { religion = qukoku } }
						NOT = { location = { has_province_modifier = secret_qukoku_community } }
					}
				#aberration_group
					AND = {
						FROM = {
							society_member_of = secret_religious_society_beholder_pantheon
						}
						NOT = { location = { religion = beholder_pantheon } }
						NOT = { location = { has_province_modifier = secret_beholder_pantheon_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_illithid_pantheon
						}
						NOT = { location = { religion = illithid_pantheon } }
						NOT = { location = { has_province_modifier = secret_illithid_pantheon_community } }
					}
					AND = {
						FROM = {
							society_member_of = secret_religious_society_faceless_god
						}
						NOT = { location = { religion = faceless_god } }
						NOT = { location = { has_province_modifier = secret_faceless_god_community } }
					}
			}
		}

		allow = {
			FROM = {
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				has_society_currency_medium_trigger = yes
			}
			custom_tooltip = {
				text = prepare_grounds_allow_tooltip
				hidden_trigger = {
					location = {
						ROOT_FROM = {
							NOT = { has_character_flag = preparing_grounds_in_@PREV }
						}
					}
				}
			}
		}

		effect = {
			location = {
				save_event_target_as = target_province
			}
			FROM = {
				society = {
					save_event_target_as = original_society
				}
				if = {
					limit = {
						ai = no
					}
					detract_society_currency_medium_effect = yes
				}
				custom_tooltip = {
					text = secret_religions_prepare_grounds_effect_tooltip
					character_event = { id = MNM.3850 days = 2 }
				}
			}
			FROM = {
				if = {
					limit = {
						is_society_grandmaster = yes
					}
					increase_visibility_minor_effect = yes
				}
				if = {
					limit = {
						NOT = { is_society_grandmaster = yes }
					}
					increase_visibility_effect = yes
				}
				set_character_flag = preparing_grounds_in_@event_target:target_province
				character_event = { id = MNM.3849 days = 1200 }
			}
		}

		ai_will_do = {
			factor = 0.5
		}
	}
}

#########################################################################################################
################ Secret society normal decisions
#########################################################################################################
decisions = {
	secret_religions_found_secret_religious_society = {
		only_playable = yes
		ai_check_interval = 36
		is_high_prio = yes

		potential = {
			not_casting = yes
			has_secret_religion = yes
			secret_religious_cult = { # Has no members
				NOT = {
					any_society_member = { always = yes }
				}
			}
			NOT = {
				has_game_rule = {
					name = secret_cults
					value = none
				}
			}
		}

		allow = {
			is_adult = yes
			prestige = 250
			NOT = { is_in_society = yes }
			prisoner = no
			NOT = { trait = incapable }
			NOT = { is_inaccessible_trigger = yes }
		}

		effect = {
			#hidden_effect = { # To track the number of Founded Cults
			#	change_variable = { which = global_founded_cults value = 1 }
			#	if = {
			#		limit = {
			#			secret_religion = calishite_faith
			#		}
			#		change_variable = { which = global_calishite_faith_founded_cults value = 1 }
			#	}
			#	if = {
			#		limit = {
			#			secret_religion = chauntean_faith
			#		}
			#		change_variable = { which = global_chauntean_faith_founded_cults value = 1 }
			#	}
			#	if = {
			#		limit = {
			#			secret_religion = mulhorandi_faith
			#		}
			#		change_variable = { which = global_mulhorandi_faith_founded_cults value = 1 }
			#	}
			#	if = {
			#		limit = {
			#			secret_religion = tuigan_shamanism
			#		}
			#		change_variable = { which = global_tuigan_shamanism_founded_cults value = 1 }
			#	}
			#}
			character_event = { id = MNM.3950 }
			prestige = -250
			join_society = secret_religious_cult
			set_society_grandmaster = yes # Set character as Grand Master
			hidden_tooltip = { add_society_currency_massive_effect = yes } # Give the Grand Master a start-up capital to induct members
		}

		ai_will_do = {
			factor = 0.1
			modifier = {
				factor = 2
				OR = {
					top_liege = { # If the characters top liege is a player
						ai = no
					}
					top_liege = {
						any_realm_lord = { # If there is a player vassal in the same realm that is not secretly religious
							ai = no
							independent = no
							has_secret_religion_trait_trigger = no
						}
					}
				}
			}
			modifier = {
				factor = 0.1
				NOT = {
					trait = zealous
				}
			}
			modifier = {
				factor = 0.1
				OR = {
					trait = content
					trait = trusting
					trait = shy
				}
			}
			modifier = { # Do not create more than one society per realm
				factor = 0
				any_realm_lord = {
					society_member_of = secret_religious_cult
				}
			}
			modifier = {
				factor = 0
				any_player = {
					shares_prevs_secret_religion_trigger = yes
				}
			}
		}
	}

	secret_religions_falsely_confess_faith = {
		is_high_prio = yes
		only_playable = yes
		ai = no

		potential = {
			not_casting = yes
			OR = {
				liege = {
					NOT = {
						religion = ROOT
					}
				}
				top_liege = {
					NOT = {
						religion = ROOT
					}
				}
			}
			NOT = { controls_religion = yes }
			is_immune_to_conversion_trigger = no
		}
		allow = {
			piety = 100
			prisoner = no
			NOT = { trait = incapable }
			NOT = { is_inaccessible_trigger = yes }
		}
		effect = {
			character_event = { id = MNM.3951 days = 1 }
			if = {
				limit = { has_secret_religion = yes }
				secret_religion_scope = { save_event_target_as = actual_religion }
				piety = -50
				custom_tooltip = { text = confess_faith_already_has_secret_rel_tt }
			}
			else = {
				religion_scope = { save_event_target_as = actual_religion }
				piety = -100
				hidden_effect = {
					set_secret_religion = event_target:actual_religion # This has to actually happen after the religion is set
				}
			}
			custom_tooltip = {
				text = confess_faith_decision_tooltip
				hidden_effect = {
					if = {
						limit = {
							liege = {
								NOT = {
									religion = ROOT
								}
							}
						}
						liege = {
							religion_scope = { save_event_target_as = false_religion }
						}
					}
					else_if = {
						limit = {
							top_liege = {
								NOT = {
									religion = ROOT
								}
							}
						}
						top_liege = {
							religion_scope = { save_event_target_as = false_religion }
						}
					}
					ROOT = {
						religion = event_target:false_religion
						set_secret_religion = event_target:actual_religion
					}
				}
			}
			custom_tooltip = {
				text = confess_faith_courtiers_decision_tooltip
				hidden_effect = {
					any_courtier = {
						limit = {
							religion = event_target:actual_religion
							employer = { character = ROOT }
							NOT = { trait = zealous }
							NOT = { has_secret_religion = yes }
						}
						random = {
							chance = 50
							modifier = {
								factor = 1.5
								is_close_relative = ROOT
							}
							modifier = {
								factor = 1.2
								trait = cynical
							}
							religion = event_target:false_religion
							set_secret_religion = event_target:actual_religion
						}
					}
				}
			}
		}

		ai_will_do = {
			factor = 0
		}
	}
}

title_decisions = {
	secretly_convert_to_province_religion = {
		filter = owned
		ai_target_filter = self
		ai = no
		only_playable = yes

		from_potential = {
			ai = no
			NOT = { controls_religion = yes }
			is_immune_to_conversion_trigger = no
		}

		potential = {
			tier = COUNT
			NOT = { location = { religion = FROM } }
			NOT = { location = { religion = monster_pantheon } }
			NOT = { location = { religion = { target_type = secret target = FROM } } }
			owner = { character = FROM }
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { location = { religion = monster_pantheon } }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			location = { save_event_target_as = location }
			FROM = {
				set_secret_religion = event_target:location
				piety = -250
			}
		}

		ai_will_do = {
			factor = 0
		}
	}

	# Faerun

	secretly_convert_to_calishite_faith_holy_site = {
		filter = owned
		ai_target_filter = self
		ai = no
		only_playable = yes

		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { secret_religion = calishite_faith }
			NOT = { religion = calishite_faith }
			NOT = { controls_religion = yes }
			is_immune_to_conversion_trigger = no
		}

		potential = {
			tier = COUNT
			NOT = {
				location = { religion = calishite_faith }
			}
			OR = {
				is_holy_site = calishite_faith
				any_de_jure_vassal_title = {
					is_holy_site = calishite_faith
				}
			}
			OR = {
				holder_scope = {
					character = FROM
				}
				AND = {
					tier = BARON
					holder_scope = {
						liege = {
							character = FROM
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			FROM = {
				piety = -250
				set_secret_religion = calishite_faith
			}
		}

		ai_will_do = {
			factor = 0
		}
	}

	secretly_convert_to_mulhorandi_faith_holy_site = {
		filter = owned
		ai_target_filter = self
		ai = no
		only_playable = yes

		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { secret_religion = mulhorandi_faith }
			NOT = { religion = mulhorandi_faith }
			NOT = { controls_religion = yes }
			is_immune_to_conversion_trigger = no
		}

		potential = {
			tier = COUNT
			NOT = {
				location = { religion = mulhorandi_faith }
			}
			OR = {
				is_holy_site = mulhorandi_faith
				any_de_jure_vassal_title = {
					is_holy_site = mulhorandi_faith
				}
			}
			OR = {
				holder_scope = {
					character = FROM
				}
				AND = {
					tier = BARON
					holder_scope = {
						liege = {
							character = FROM
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			FROM = {
				piety = -250
				set_secret_religion = mulhorandi_faith
			}
		}

		ai_will_do = {
			factor = 0
		}
	}

	secretly_convert_to_tuigan_shamanism_holy_site = {
		filter = owned
		ai_target_filter = self
		ai = no
		only_playable = yes

		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { secret_religion = tuigan_shamanism }
			NOT = { religion = tuigan_shamanism }
			NOT = { controls_religion = yes }
			is_immune_to_conversion_trigger = no
		}

		potential = {
			tier = COUNT
			NOT = {
				location = { religion = tuigan_shamanism }
			}
			OR = {
				is_holy_site = tuigan_shamanism
				any_de_jure_vassal_title = {
					is_holy_site = tuigan_shamanism
				}
			}
			OR = {
				holder_scope = {
					character = FROM
				}
				AND = {
					tier = BARON
					holder_scope = {
						liege = {
							character = FROM
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			FROM = {
				piety = -250
				set_secret_religion = tuigan_shamanism
			}
		}

		ai_will_do = {
			factor = 0
		}
	}
}

targeted_decisions = {
	secretly_convert_to_close_relations_religion = {
		#filter
		ai_target_filter = self
		ai = no
		only_playable = yes

		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { controls_religion = yes }
			is_immune_to_conversion_trigger = no
		}

		potential = {
			OR = {
				AND = {
					spouse = {
						character = FROM
					}
					NOR = {
						religion = FROM
						religion = { target_type = secret target = FROM }
					}
				}
				AND = {
					consort = {
						character = FROM
					}
					NOR = {
						religion = FROM
						religion = { target_type = secret target = FROM }
					}
				}
				AND = {
					is_friend = FROM
					NOR = {
						religion = FROM
						religion = { target_type = secret target = FROM }
					}
				}
			}
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			FROM = { set_secret_religion = { target_type = public target = PREV } }
			FROM = { piety = -250 }
		}

		ai_will_do = {
			factor = 0
		}
	}
}

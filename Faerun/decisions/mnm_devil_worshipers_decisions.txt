###########################################
#
# Devil worshiper decisions for Monks and Mystics
#
###########################################

targeted_decisions = {

	# Power: Summon familiar
	devil_worshipers_summon_familiar = {
		filter = self
		ai_target_filter = self
		ai_check_interval = 12

		is_in_society = yes

		potential = {
			society_member_of = the_satanists
			society_rank >= 2
			is_incapable = no
			prisoner = no
		}

		allow = {
			has_society_currency_major_trigger = yes

			custom_tooltip = {
				text = devil_worshipers_summon_familiar_cd_tooltip

				NOT = { has_character_modifier = summon_familiar_cooldown }
			}
		}

		effect = {
			increase_visibility_effect = yes
			detract_society_currency_major_effect = yes

			add_character_modifier = {
				name = summon_familiar_cooldown
				years = 5
				hidden = yes
			}

			character_event = { id = MNM.7815 }
		}

		ai_will_do = {
			factor = 1

			trigger = {
				NOR = {
					has_character_modifier = wolf_familiar
					has_character_modifier = cat_familiar
					has_character_modifier = owl_familiar
					has_character_modifier = raven_familiar
				}
			}
		}
	}

	#Power: Tainted touch
	# the_devil_worshipers_tainted_touch = {
		# is_in_society = yes

		# ai_target_filter = realm
		# ai_check_interval = 6

		# from_potential = {
			# prisoner = no
			# NOT = { trait = incapable }

			# OR = {
				# has_society_currency_major_trigger = yes
				# ai = no
			# }

			# OR = {
				# war = yes
				# num_of_rivals = 1
				# ai = no
			# }

			# society_member_of = the_satanists
			# society_rank > 1
			# #NOT = { character = FROM }
		# }

		# potential = {
			# NOT = { character = FROM }

			# OR = {
				# NOR = {
					# character_disease_trigger = yes
					# has_character_flag = developing_illness
					# has_character_flag = disease_not_serious
				# }
				# FROM = {
					# ai = no
				# }
			# }

			# OR = {
				# NOT = {
					# has_character_modifier = curse_cooldown_timer
				# }
				# FROM = {
					# ai = no
				# }
			# }

			# OR = {
				# AND = {
					# FROM = { ai = no }
					# is_within_diplo_range = FROM
				# }
				# AND = {
					# FROM = { ai = yes }
					# same_realm = FROM
				# }
			# }

			# #Makes sure the AI does good choices
			# OR = {
				# FROM = { ai = no }
				# is_foe = FROM
				# war_with = FROM
				# holds_favor_on = FROM
				# any_spouse = { #Unfaithful spouse
					# character = FROM
					# any_lover = { NOT = { character = FROM } }
				# }
				# any_lover = { any_spouse = { character = FROM  } } #Lover of spouse
				# any_lover = { any_lover = { character = FROM } } #Lover of lover
			# }
		# }

		# allow = {
			# FROM = { has_society_currency_major_trigger = yes }

			# OR = {
				# same_realm = FROM
				# is_foe = FROM
				# same_society_as = FROM
				# war_with = FROM
			# }

			# custom_tooltip = {
				# text = the_devil_worshipers_tainted_touch_allow_2_tt
				# hidden_tooltip = {
					# NOT = {
						# has_character_modifier = curse_cooldown_timer
					# }
				# }
			# }

			# custom_tooltip = {
				# text = the_devil_worshipers_tainted_touch_allow_tt
				# NOR = {
					# character_disease_trigger = yes
					# has_character_flag = developing_illness
					# has_character_flag = disease_not_serious
				# }
			# }
		# }

		# effect = {
			# FROM = { increase_visibility_effect = yes }
			# hidden_tooltip = {
				# add_character_modifier = {
					# name = curse_cooldown_timer
					# hidden = yes
					# years = 10
				# }
			# }
			# custom_tooltip = {
				# text = the_devil_worshipers_tainted_touch_tooltip

				# if = {
					# limit = { has_dlc = "Reapers" }
					# character_event = { id = MNM.7819 days = 3 }
				# }
				# if = {
					# limit = { NOT = { has_dlc = "Reapers" } }
					# character_event = { id = MNM.7819 days = 14 random = 14 }
				# }
			# }

			# FROM = {
				# save_event_target_as = curser
				# detract_society_currency_major_effect = yes
			# }
		# }

		# revoke_allowed = {
			# always = no
		# }

		# ai_will_do = {
			# factor = 1
		# }
	# }


	#Power: dark divorce
	# devil_worshipers_dark_divorce = {
	# 	is_in_society = yes

	# 	filter = spouse
	# 	ai_target_filter = spouse
	# 	ai_check_interval = 120

	# 	from_potential = {
	# 		society_member_of = the_satanists
	# 		society_rank > 2
	# 		is_married = yes
	# 		prisoner = no
	# 		is_incapable = no
	# 	}

	# 	potential = {
	# 		ai = yes
	# 		any_spouse = { character = FROM }
	# 		NOT = { has_character_flag = being_dark_divorced }

	# 		is_within_diplo_range = FROM

	# 		#Reasons allowing dark divorce for ai
	# 		OR = {
	# 			FROM = { ai = no }
	# 			NOT = {
	# 				reverse_opinion = {
	# 					who = FROM
	# 					value = 0
	# 				}
	# 			}
	# 			is_rival = FROM
	# 			has_character_modifier = adulterer
	# 			has_character_modifier = adulteress
	# 			has_character_modifier = incestuous_adulterer
	# 			has_character_modifier = incestuous_adulteress
	# 			AND = {
	# 				FROM = { is_ruler = yes }
	# 				is_female = yes
	# 				OR = {
	# 					age = 45
	# 					NOT = { fertility = 0.3 }
	# 				}
	# 				FROM = { current_heir = { dynasty = FROM } }
	# 			}
	# 			trait = lunatic
	# 			trait = possessed
	# 			trait = cruel
	# 			is_any_kinslayer_trigger = yes
	# 			trait = cannibal_trait
	# 			AND = {
	# 				trait = wroth
	# 				trait = drunkard
	# 			}
	# 			AND = {
	# 				trait = zealous
	# 				is_devil_worshiper_trigger = no
	# 			}
	# 		}

	# 		#Stopping the ai from making stupid choices
	# 		OR = {
	# 			FROM = { ai = no }
	# 			NOR = {
	# 				is_friend = FROM
	# 				is_lover = FROM
	# 				is_pregnant = yes
	# 			}
	# 		}
	# 	}

	# 	allow = {
	# 		FROM = {
	# 			NOT = { has_character_modifier = recently_did_dark_divorce }
	# 			has_society_currency_minor_trigger = yes
	# 		}
	# 	}

	# 	effect = {
	# 		FROM = { increase_visibility_effect = yes }
	# 		set_character_flag = being_dark_divorced
	# 		FROM = {
	# 			add_character_modifier = {
	# 				name = recently_did_dark_divorce
	# 				years = 2
	# 			}
	# 		}
	# 		hidden_effect = {
	# 			character_event = { id = MNM.7800 days = 1 }
	# 		}
	# 	}
	# 	revoke_allowed = {
	# 		always = no
	# 	}

	# 	ai_will_do = {
	# 		factor = 1
	# 		modifier = {
	# 			factor = 0.01 # slow down
	# 		}
	# 		modifier = {
	# 			factor = 0.5
	# 			FROM = { is_benevolent_trigger = yes }
	# 		}
	# 		modifier = {
	# 			factor = 100
	# 			FROM = { is_evil_trigger = yes }
	# 		}
	# 		modifier = {
	# 			is_heir = yes
	# 			factor = 0.01
	# 		}
	# 	}
	# }

	# Power: Dark healing
	devil_worshipers_dark_healing = {
		filter = self
		ai_target_filter = self
		ai_check_interval = 6

		is_in_society = yes

		potential = {
			society_member_of = the_satanists
			society_rank >= 3

			NOR = {
				has_character_flag = dark_healing_in_effect
				has_character_modifier = dark_healing_recent
			}
		}

		allow = {
			has_society_currency_medium_trigger = yes

			custom_tooltip = {
				text = devil_worshipers_dark_healing_tooltip

				OR = {
					is_ill = yes
					has_symptom_trigger = yes
					has_injury_trigger = yes
					is_maimed_trigger = yes
					trait = infirm
					trait = mangled
					trait = eunuch
					trait = blinded
					trait = incapable
				}
			}
		}

		effect = {
			detract_society_currency_medium_effect = yes
			increase_visibility_effect = yes
			set_character_flag = dark_healing_in_effect
			character_event = { id = MNM.7118 }
		}

		ai_will_do = {
			factor = 0.5
			modifier = {
				factor = 2
				OR = {
					is_maimed_trigger = yes
					has_disease_trigger = yes
					trait = mangled
					trait = infirm
					trait = incapable
					trait = eunuch
				}
			}
		}
	}

	#Power: Demonic Possession
	# devil_worshipers_demonic_possession = {
		# is_in_society = yes

		# ai_target_filter = sub_realm
		# ai_check_interval = 12

		# from_potential = {
			# society_member_of = the_satanists
			# society_rank > 1
		# }

		# potential = {
			# OR = {
				# host = { character = FROM }
				# liege = { character = FROM }
			# }
			# NOT = { character = FROM }
			# ai = yes
		# }

		# allow = {
			# FROM = {
				# prisoner = no
				# NOT = { trait = incapable }
				# has_society_currency_minor_trigger = yes

				# custom_tooltip = {
					# text = is_accessible
					# OR = {
						# is_inaccessible_trigger = no
						# AND = {
							# FROM = {
								# has_character_modifier = in_seclusion
								# at_location = ROOT
							# }
							# ROOT = {
								# has_character_modifier = in_seclusion
							# }
						# }
					# }
				# }
			# }
			# ROOT = {

				# NOT = { trait = incapable }

				# custom_tooltip = {
					# text = possess_courtier_already_done
					# NOR = {
						# has_character_flag = possessing_courtier
						# has_opinion_modifier = { who = FROM modifier = opinion_loyal_servant }
						# trait = possessed
						# trait = lunatic
					# }
				# }
			# }
		# }

		# effect = {
			# ROOT = {
				# set_character_flag = possessing_courtier
				# hidden_effect = {
					# character_event = { id = MNM.7840 days = 3 random = 7 }
				# }
			# }
			# FROM = {
				# detract_society_currency_minor_effect = yes
			# }
			# if = {
				# limit = {
					# NOT = {
						# is_quest_target_of = FROM
					# }
				# }
				# FROM = {
					# increase_visibility_effect = yes
				# }
			# }
			# if = {
				# limit = {
					# is_quest_target_of = FROM
				# }
				# FROM = {
					# increase_visibility_minor_effect = yes
				# }
			# }
		# }

		# ai_will_do = {
			# factor = 1
			# modifier = {
				# factor = 0.1 # slow down
			# }
			# modifier = {
				# factor = 0.5
				# is_benevolent_trigger = yes
			# }
			# modifier = {
				# factor = 0.25
				# ROOT = {
					# is_landed = no
				# }
			# }
			# modifier = {
				# factor = 3
				# ROOT = {
					# among_most_powerful_vassals = 5
				# }
			# }
		# }
	# }

	#Action: satanist recruit
	satanists_recruit = {
		filter = all
		ai_target_filter = realm
		ai_check_interval = 12

		is_in_society = yes

		from_potential = {
			society_member_of = the_satanists
			is_adult = yes
			prisoner = no
			is_incapable = no
			NOT = { has_character_modifier = recruitment_timer }

			trigger_if = {
				limit = { ai = yes }

				OR = {
					society_rank == 2
					society_rank == 3
				}
			}
		}

		potential = {
			# AI only checks realm, so by definition in range
			trigger_if = {
				limit = { FROM = { ai = no } }
				is_within_diplo_range = FROM
			}

			# Blocks so AI recruits sensible people (who might say no)
			trigger_else = {
				OR = {
					is_friend = FROM
					is_lover = FROM
					is_close_relative = FROM
					trait = trusting
					trait = drunkard
					trait = possessed
					trait = lunatic
					has_impious_trait_trigger = yes
					interested_in_society = the_satanists
				}

				# AI cannot invite other AIs when society is full
				trigger_if = {
					limit = { ai = yes }
					can_join_society = the_satanists
				}

				is_adult = yes
				prisoner = no
				is_incapable = no
				is_in_society = no
			}
		}

		allow = {
			ROOT = {
				has_starpact_prerequisites = yes
				is_inaccessible_trigger = no

				custom_tooltip = {
					text = satanists_recruit_block_tooltip

					OR = {
						NOT = { has_character_flag = satanists_attempted_recruitment }
						interested_in_society = the_satanists
					}
					NOT = { has_character_flag = being_recruited_by_the_satanists }
				}
			}

			FROM = {
				is_inaccessible_trigger = no
				NOT = {
					has_character_modifier = accused_apostate
				}

				custom_tooltip = {
					text = recruit_delay_timer_tooltip

					NOT = { has_character_modifier = recruitment_delay_timer }
				}
			}
		}

		effect = {
			hidden_effect = {
				set_character_flag = satanists_attempted_recruitment
				set_character_flag = being_recruited_by_the_satanists

				FROM = {
					save_event_target_as = satanists_recruiter

					if = {
						limit = { ai = yes }

						add_character_modifier = {
							name = recruitment_timer
							years = 2
							hidden = yes
						}
					}

					add_character_modifier = {
						name = recruitment_delay_timer
						months = 3
						hidden = yes
					}
				}

				character_event = {
					id = MNM.7001 # Recruitment chain
					days = 3
				}

				letter_event = {
					id = MNM.7030 # Delayed back up, in case recruitment fails somehow
					years = 1
				}
			}
		}

		ai_will_do = {
			factor = 1

			trigger = {
				# Don't recruit characters interested in something else
				is_interested_in_any_society = yes
				NOT = { interested_in_society = the_satanists }
			}

			mult_modifier = {
				factor = 0.2 # Slow down
				FROM = {
					society = { num_of_society_members > 20 }
				}
			}

			mult_modifier = {
				factor = 10 # Recruit interested parties
				interested_in_society = the_satanists
			}
		}
	}

	# Action: Sacrifice prisoner
	prisoner_dark_sacrifice = {
		filter = court
		ai_target_filter = court
		ai_check_interval = 12

		is_in_society = yes
		only_playable = yes

		from_potential = {
			society_member_of = the_satanists
			is_adult = yes
			prisoner = no
			is_incapable = no
		}

		potential = {
			prisoner = yes
			host = { character = FROM }
			#NOT = { has_character_flag = demon_child_non_pagan }
		}

		allow = {
			diplomatic_immunity = no
		}

		effect = {
			death = { death_reason = death_missing }

			FROM = {
				show_scope_change = no

				save_event_target_as = satanist
				increase_visibility_minor_effect = yes
				minor_soul_corruption_effect = yes

				hidden_effect = { murder_bloodline_check_effect = yes }

				# Head of Religion
				if = {
					limit = {
						ROOT = { controls_religion = yes }
					}

					character_event = { id = MNM.7500 }

					# Check quests to resolve, add extra currency and play special sound effect
					if = { # Priestly
						limit = { has_quest = quest_the_devil_worshipers_sacrifice_holy_person }

						clr_quest = quest_the_devil_worshipers_sacrifice_holy_person
						add_society_currency_major_effect = yes
					}

					else_if = { # Virgin
						limit = {
							has_quest = quest_the_devil_worshipers_sacrifice_virgin
							ROOT = { is_virgin_trigger = yes }
						}

						clr_quest = quest_the_devil_worshipers_sacrifice_virgin
						add_society_currency_major_effect = yes
					}

					else_if = { # Ruler
						limit = {
							has_quest = quest_the_devil_worshipers_sacrifice_ruler
							ROOT = { is_landed = yes }
						}

						clr_quest = quest_the_devil_worshipers_sacrifice_ruler
						add_society_currency_major_effect = yes
					}

					else = { # No quest so add default
						add_society_currency_medium_effect = yes
					}
				}

				# Holy Man
				else_if = {
					limit = {
						ROOT = {
							OR = {
								is_ascetic_trigger = yes
								z_divine_caster = yes
								z_monk = yes
								AND = {
									is_landed = yes
									OR = {
										government = theocracy_government
										government = baron_theocracy_government
										government = divine_feudal_government
										government = theocratic_feudal_government
									}
								}
							}
						}
					}

					character_event = { id = MNM.7500 }

					# Check quests to resolve, add extra currency and play special sound effect
					if = { # Priestly
						limit = { has_quest = quest_the_devil_worshipers_sacrifice_holy_person }

						clr_quest = quest_the_devil_worshipers_sacrifice_holy_person
						add_society_currency_medium_effect = yes
					}

					else_if = { # Virgin
						limit = {
							has_quest = quest_the_devil_worshipers_sacrifice_virgin
							ROOT = { is_virgin_trigger = yes }
						}
						clr_quest = quest_the_devil_worshipers_sacrifice_virgin
						add_society_currency_medium_effect = yes
					}

					else_if = { # Ruler
						limit = {
							has_quest = quest_the_devil_worshipers_sacrifice_ruler
							ROOT = { is_landed = yes }
						}

						clr_quest = quest_the_devil_worshipers_sacrifice_ruler
						add_society_currency_medium_effect = yes
					}

					else = { # No quest so add default
						add_society_currency_minor_effect = yes
					}
				}

				# Regular character
				else = {
					if = {
						limit = { ROOT = { is_adult = no } }
						character_event = { id = MNM.7503 }
					}
					else_if = {
						limit = { ROOT = { is_virgin_trigger = yes } }
						character_event = { id = MNM.7504 }
					}
					else = {
						character_event = { id = MNM.7505 }
					}

					# Check quests to resolve, add extra currency and play special sound effect
					if = { # Virgin
						limit = {
							has_quest = quest_the_devil_worshipers_sacrifice_virgin
							ROOT = { is_virgin_trigger = yes }
						}

						clr_quest = quest_the_devil_worshipers_sacrifice_virgin
						add_society_currency_minor_effect = yes
					}

					else_if = { # Ruler
						limit = {
							has_quest = quest_the_devil_worshipers_sacrifice_ruler
							ROOT = { is_landed = yes }
						}

						clr_quest = quest_the_devil_worshipers_sacrifice_ruler
						add_society_currency_minor_effect = yes
					}

					else = { # No quest so add default
						add_society_currency_trivial_effect = yes
					}
				}
			}

			# CleanSlate: There exists a devil_worshippers_sacrifice_child sound_effect, but it is unused in vanilla
			if = {
				limit = {
					OR = {
						controls_religion = yes
						is_priest = yes
						is_ascetic_trigger = yes
						z_divine_caster = yes
						z_monk = yes
						AND = {
							is_landed = yes
							government = theocracy_government
						}
					}
				}

				trigger_switch = {
					on_trigger = is_female

					yes = { FROM = { sound_effect = devil_worshippers_sacrifice_holy_woman } }
					no = { FROM = { sound_effect = devil_worshippers_sacrifice_holy_man } }
				}
			}

			else_if = {
				limit = { is_virgin_trigger = yes }

				trigger_switch = {
					on_trigger = is_female

					yes = { FROM = { sound_effect = devil_worshippers_sacrifice_virgin_female } }
					no = { FROM = { sound_effect = devil_worshippers_sacrifice_virgin_male } }
				}
			}

			else_if = {
				limit = { trait = dwarf }

				trigger_switch = {
					on_trigger = is_female

					yes = { FROM = { sound_effect = devil_worshippers_sacrifice_dwarf_female } }
					no = { FROM = { sound_effect = devil_worshippers_sacrifice_dwarf_male } }
				}
			}

			else = {
				trigger_switch = {
					on_trigger = is_female

					yes = { FROM = { sound_effect = devil_worshippers_sacrifice_ruler_female } }
					no = { FROM = { sound_effect = devil_worshippers_sacrifice_ruler_male } }
				}
			}

			long_character_event = { id = MNM.7506 }
		}

		ai_will_do = {
			factor = 0.01

			mult_modifier = {
				factor = 50

				OR = {
					is_landed = yes
					is_priest = yes
					is_ascetic_trigger = yes
					is_virgin_trigger = yes
				}
			}
		}
	}

	# Action: Demonic impregnation
	DW_demonic_impregnation = {
		filter = court_including_me
		ai_target_filter = court_including_me
		ai_check_interval = 120

		is_in_society = yes
		only_playable = yes

		from_potential = {
			society_member_of = the_satanists

			trigger_if = {
				limit = { has_quest = quest_the_devil_worshipers_demonic_impregnation }
				society_rank >= 3
			}
			trigger_else = {
				society_rank >= 4
			}

			is_adult = yes
			prisoner = no
			is_incapable = no
		}

		potential = {
			is_female = yes
			host = { character = FROM }
			is_pregnant = no
			is_adult = yes
			is_infertile_race = no

			FROM = {
				OR = {
					character = ROOT
					has_quest = quest_the_devil_worshipers_demonic_impregnation
				}
			}
		}

		allow = {
			FROM = { has_society_currency_major_trigger = yes }
			society_member_of = the_satanists
			is_female = yes
			is_pregnant = no
			NOT = { has_character_flag = menopause }
			FROM = {
				OR = {
					NOT = { # prevent spam
						any_child = {
							count = 2
							is_alive = yes
						}
					}
					has_quest = quest_the_devil_worshipers_demonic_impregnation # or has the quest
				}
			}
		}

		effect = {
			FROM = {
				show_scope_change = no

				increase_visibility_effect = yes
				detract_society_currency_major_effect = yes

				character_event = { id = MNM.7507 }
			}
		}

		ai_will_do = {
			factor = 0.01

			mult_modifier = {
				factor = 100
				has_quest = quest_the_devil_worshipers_demonic_impregnation
			}
		}
	}

	# Action: Prolong Life/Absorb Lifeforce
	DW_prolong_life = {
		filter = dynasty
		ai_target_filter = dynasty
		ai_check_interval = 12

		is_in_society = yes
		only_playable = yes

		from_potential = {
			society_rank == 4
			society_member_of = the_satanists
			is_adult = yes
			prisoner = no
			is_incapable = no
		}

		potential = {
			is_child_of = FROM
			is_adult = no
			host = { character = FROM }
			#NOT = { has_character_flag = demon_child_non_pagan }
		}

		allow = {
			FROM = { has_society_currency_major_trigger = yes }
		}

		effect = {
			FROM = {
				show_scope_change = no

				increase_visibility_effect = yes
				detract_society_currency_major_effect = yes

				character_event = { id = MNM.7509 }
			}
		}

		ai_will_do = {
			factor = 0.05

			trigger = {
				NOT = { has_character_modifier = stolen_life_major }
			}

			mult_modifier = {
				factor = 10
				NOR = {
					has_character_modifier = stolen_life_minor
					has_character_modifier = stolen_life_medium
					has_character_modifier = stolen_life_major
				}
			}
		}
	}

	# Action: corrupt a priest
	devil_worshipers_corrupt_priest = {
		ai_target_filter = realm
		ai_check_interval = 12

		is_in_society = yes
		only_playable = yes

		from_potential = {
			society_member_of = the_satanists
			society_rank > 1
		}

		potential = {
			trigger_if = {
				limit = { FROM = { ai = no } }
				is_within_diplo_range = FROM
			}

			ai = yes
			religion = FROM

			OR = {
				FROM = {
					has_quest = quest_devil_worshipers_corrupt_priest
					quest_target = { character = ROOT }
				}

				AND = {
					same_realm = FROM
					is_ruler = yes
					OR = {
						is_theocracy = yes
						government = theocracy_government
						z_cleric = yes
					}
				}
			}
		}

		allow = {
			FROM = {
				prisoner = no
				is_incapable = no

				OR = {
					has_society_currency_tiny_trigger = yes

					custom_tooltip = {
						text = corrupt_priest_has_quest

						has_quest = quest_devil_worshipers_corrupt_priest
					}
				}

				custom_tooltip = {
					text = is_accessible

					trigger_if = {
						limit = { is_inaccessible_trigger = yes }

						in_seclusion = yes
						at_location = ROOT

						ROOT = {
							in_seclusion = yes
						}
					}
				}

				OR = {
					custom_tooltip = {
						text = corrupt_priest_not_recently_attempted

						ROOT = {
							NOR = {
								has_character_flag = attempted_corrupt_priest

								has_opinion_modifier = {
									name = opinion_successful_corruption
									who = FROM
								}

								has_opinion_modifier = {
									name = opinion_failed_corruption
									who = FROM
								}
							}
						}
					}

					custom_tooltip = {
						text = corrupt_priest_has_quest

						has_quest = quest_devil_worshipers_corrupt_priest
					}
				}
			}

			ROOT = {
				prisoner = no
				is_incapable = no
				is_inaccessible_trigger = no
			}
		}

		effect = {
			custom_tooltip = { text = corrupt_priest_effect_TOOLTIP }
			save_event_target_as = corrupt_priest_target
			set_character_flag = attempted_corrupt_priest

			FROM = {
				show_scope_change = no

				save_event_target_as = corrupt_priest_spell_caster

				if = {
					limit = {
						has_quest = quest_devil_worshipers_corrupt_priest
						ROOT = { is_quest_target_of = FROM }
					}

					increase_visibility_minor_effect = yes
				}
				else = {
					increase_visibility_effect = yes
					detract_society_currency_tiny_effect = yes
				}

				character_event = {
					id = MNM.7826
					days = 3
					random = 7
				}
			}
		}

		ai_will_do = {
			factor = 0.1

			mult_modifier = {
				factor = 0.5
				is_benevolent_trigger = yes
			}

			mult_modifier = {
				factor = 2
				is_evil_trigger = yes
			}

			mult_modifier = {
				factor = 50
				FROM = { is_quest_target_of = ROOT }
			}

			mult_modifier = {
				factor = 0.5
				NOT = { vassal_of = FROM }
			}
		}
	}

	devil_worshipers_induction = {
		filter = court
		ai_target_filter = court
		ai_check_interval = 12

		is_in_society = yes
		# TODO: Should this be restricted to only_playable or are we fine with courtiers torturing their liege's prisoners?

		from_potential = {
			society_member_of = the_satanists
			society_rank >= 2
			is_inaccessible_trigger = no
			is_incapable = no
			prisoner = no

			trigger_if = {
				limit = { ai = yes }

				NOT = {
					is_society_rank_full = {
						society = the_satanists
						rank = 1
					}
				}
			}
		}

		potential = {
			ai = yes
			prisoner = yes
			is_adult = yes
			is_incapable = no
		}

		allow = {
			FROM = { society_currency >= 25 }
			is_adult = yes
			NOT = { same_society_as = FROM }
			trigger_if = {
				limit = { NOT = { religion = faithless } }
				NOT = { trait = zealous }
			}
			NOT = { has_character_modifier = recent_induction_attempt }
		}

		effect = {
			save_event_target_as = dw_induction_target

			FROM = {
				show_scope_change = no

				change_society_currency = -25
				increase_visibility_minor_effect = yes
				character_event = { id = MNM.7121 }
			}
		}

		ai_will_do = {
			factor = 1

			trigger = {
				NOT = { is_rival = FROM }

				# Don't recruit unimportant unrelated characters
				trigger_if = {
					limit = {
						NOT = { dynasty = FROM }
					}

					is_ruler = yes
				}
			}
		}
	}
}

title_decisions = {
	# Execute desecrate temple mission
	devil_worshiper_desecrate_temple_decision = {
		# filter = realm_owned # CleanSlate: Nonfunctional
		ai_target_filter = realm_owned
		ai_check_interval = 12

		is_in_society = yes
		only_playable = yes

		from_potential = {
			has_dlc = "Mystics"
			society_member_of = the_satanists
			has_quest = quest_devil_worshipers_desecrate_temple
			prisoner = no
			is_incapable = no
			NOT = { has_character_flag = desecration_in_progress }
		}

		potential = {
			lower_real_tier_than = DUKE

			OR = {
				is_quest_target_of = FROM

				location = {
					capital_holding = {
						is_quest_target_of = FROM
					}
				}
			}
		}

		allow = {
			FROM = { has_quest = quest_devil_worshipers_desecrate_temple }

			OR = {
				is_quest_target_of = FROM

				location = {
					capital_holding = {
						is_quest_target_of = FROM
					}
				}
			}
		}

		effect = {
			custom_tooltip = { text = devil_worshiper_desecrate_temple_decision_tt }

			FROM = {
				show_scope_change = no

				increase_visibility_minor_effect = yes

				if = {
					limit = { has_landed_title = ROOT }

					ROOT = {
						show_scope_change = no

						add_holding_modifier = {
							name = desecrated_temple
							years = 5
						}
					}

					sound_effect = devil_worshippers_desecrate_temple
					clr_quest = quest_devil_worshipers_desecrate_temple
					add_society_currency_medium_effect = yes
				}

				else = {
					set_character_flag = desecration_in_progress

					character_event = {
						id = MNM.7112
						days = 7
					}
				}
			}
		}

		ai_will_do = {
			factor = 1
		}
	}
}

society_decisions = {
	#Power: Invite disciple of devil
	# devil_worshipers_invite_disciple_of_devil = {
		# only_playable = yes

		# potential = {
			# has_dlc = "Mystics"
			# society_rank >= 3
			# society_member_of = the_satanists
			# NOT = { has_character_flag = disciple_arriving }
		# }

		# allow = {
			# has_society_currency_minor_trigger = yes
			# is_inaccessible_trigger = no
		# }

		# effect = {
			# #increase_visibility_effect = yes
			# set_character_flag = disciple_arriving
			# detract_society_currency_minor_effect = yes

			# custom_tooltip = {
				# text = devil_worshipers_invite_disciple_of_devil_tt
				# character_event = { id = MNM.7822 days = 7 }
			# }
		# }
		# revoke_allowed = {
			# always = no
		# }
		# ai_will_do = {
			# factor = 0
		# #	factor = 0.001
		# #	modifier = {
		# #		factor = 0.1
		# #		any_courtier = { society_member_of = the_satanists } #Less likely to invite if there is already someone else at court
		# #	}
		# }
	# }

	# Power: Make a deal with Asmodeus
	#devil_worshipers_deal_with_asmodeus = {
	#	only_playable = yes
  #      is_high_prio = yes
	#			ai_check_interval = 12
	#	potential = {
	#		has_dlc = "Mystics"
	#		society_rank >= 4
	#		society_member_of = the_satanists
  #          is_adult = yes
  #          is_landed = yes
	#		is_incapable = no
	#		prisoner = no
	#		NOR = {
	#			trait = creature_fiend
	#			trait = greater_fiend
  #              has_character_flag = selecting_asmodean_deal
  #              has_dynasty_flag = dealt_with_asmodeus
  #              }
	#	}
	#	allow = {
	#		has_society_currency_major_trigger = yes
	#		is_inaccessible_trigger = no
	#	}
	#	effect = {
	#		increase_visibility_effect = yes
	#		set_character_flag = selecting_asmodean_deal
	#		detract_society_currency_major_effect = yes
	#		character_event = { id = asmodeusdeal.1 }
	#		# custom_tooltip = {
	#			# text = asmodeusdealdesc_decision
	#			# character_event = { id = asmodeusdeal.1 }
	#		# }
	#	}
	#	ai_will_do = {
	#		factor = 0
	#	#	factor = 0.001
	#	#	modifier = {
	#	#		factor = 0.1
	#	#		any_courtier = { is_devil_worshiper_trigger = no }
	#	#	}
	#	}
	#}
	#asmodean_openly_adopt_faith = {
	#	is_high_prio = yes
	#	ai_check_interval = 60
	#	potential = {
	#		society_member_of = the_satanists
	#		not_casting = yes
	#		society_rank == 4
  #          NOT = { has_character_flag = asmodean_openly_adopted_faith }
	#	}
	#	allow = {
	#		OR = {
	#			has_society_currency_major_trigger = yes
	#			hidden_tooltip = {
	#				ai = yes
	#			}
	#		}
	#		prisoner = no
	#		NOT = { trait = incapable }
	#		NOT = { is_inaccessible_trigger = yes }
	#		war = no
	#	}
	#	effect = {
	#		detract_society_currency_major_effect = yes
	#		increase_visibility_effect = yes
	#		minor_soul_corruption_effect = yes
  #          set_character_flag = asmodean_openly_adopted_faith
	#		custom_tooltip = {
	#			text = openly_adopt_faith_effect_tooltip
	#			# if = { # Caliphates and Fylkirates are forfeit
	#				# limit = {
	#					# OR = {
	#						# religion_group = muslim
	#						# religion = norse_pagan_reformed
	#					# }
	#					# any_demesne_title = {
	#						# controls_religion = yes
	#					# }
	#				# }
	#				# any_demesne_title = {
	#					# limit = {
	#						# controls_religion = yes
	#					# }
	#					# destroy_landed_title = THIS
	#				# }
	#			# }
	#			if = { # Papacies are given to a random new character
	#				limit = {
	#					# NOR = {
	#						# religion_group = muslim
	#						# religion = norse_pagan_reformed
	#					# }
	#					any_demesne_title = {
	#						controls_religion = yes
	#					}
	#				}
	#				hidden_tooltip = {
	#					liege = {
	#						save_event_target_as = liege_target
	#					}
	#					create_character = {
	#						age = 38
	#						dynasty = random
	#						religion = ROOT
	#						culture = ROOT
	#						random_traits = yes
	#					}
	#					new_character = {
	#						save_event_target_as = new_holder
	#					}
	#				}
	#				any_demesne_title = {
	#					limit = {
	#						controls_religion = yes
	#					}
	#					grant_title = event_target:new_holder
	#					holder_scope = {
	#						any_vassal = {
	#							set_defacto_liege = event_target:liege_target
	#						}
	#					}
	#				}
	#				hidden_tooltip = {
	#					set_defacto_liege = event_target:liege_target
	#				}
	#			}
	#			if = { # Holy Orders/Static Mercs are given to a random new character
	#				limit = {
	#					any_demesne_title = {
	#						OR = {
	#							holy_order = yes
	#							mercenary = yes
	#						}
	#					}
	#				}
	#				hidden_tooltip = {
	#					liege = {
	#						save_event_target_as = liege_target
	#					}
	#					create_character = {
	#						age = 38
	#						dynasty = random
	#						religion = ROOT
	#						culture = ROOT
	#						random_traits = yes
	#					}
	#					new_character = {
	#						save_event_target_as = new_holder
	#					}
	#				}
	#				any_demesne_title = {
	#					limit = {
	#						OR = {
	#							holy_order = yes
	#							mercenary = yes
	#						}
	#					}
	#					grant_title = event_target:new_holder
	#					holder_scope = {
	#						any_vassal = {
	#							set_defacto_liege = event_target:liege_target
	#						}
	#					}
	#				}
	#				hidden_tooltip = {
	#					set_defacto_liege = event_target:liege_target
	#				}
	#			}
	#			hidden_effect = {
	#				character_event = { id = asmodeusevent.1 }
  #                  any_realm_province = {
  #                  if = {
  #                      limit = { has_province_modifier = secret_infernal_community }
  #                      religion = infernal
  #                      remove_province_modifier = secret_infernal_community
  #                    }
  #                  }
	#				any_society_member = {
	#					if = {
	#						limit = {
	#							NOT = {
	#								character = ROOT
	#							}
	#							same_society_as = ROOT
	#							same_realm = ROOT
	#						}
	#						character_event = { id = asmodeusevent.2 } # Convert cultists
	#					}
	#				}
	#				ROOT = { # previously was top_liege
	#					any_realm_character = {
	#						if = {
	#							limit = {
	#								NOT = {
	#									same_society_as = ROOT
	#								}
	#								OR = {
	#									has_prevs_secret_religion_truly_trigger = yes
	#									has_sympathy_for_true_religion_of_prev_trigger = yes
	#								}
	#							}
	#							character_event = { id = asmodeusevent.3 } # Allow sympathisers the chance to flip
	#						}
	#						if = {
	#							limit = {
	#								is_ruler = yes
	#								any_demesne_province = {
	#									has_province_modifier = secret_infernal_community
	#									ROOT = {
	#										society_member_of = the_satanists
	#									}
	#								}
	#							}
	#							if = {
	#								limit = { NOT = { has_character_flag = currently_part_of_secret_religion_uncovering } }
	#								character_event = { id = asmodeusevent.4 } # Flip provinces with local cult modifier
	#							}
	#							if = {
	#								limit = { has_character_flag = currently_part_of_secret_religion_uncovering }
	#								ROOT = {
	#									trigger_switch = {
	#										on_trigger = society_member_of
	#										the_satanists = {
	#											PREV = {
	#												any_demesne_province = {
	#													limit = {
	#														has_province_modifier = secret_infernal_community
	#													}
	#													religion = infernal
	#													remove_province_modifier = secret_infernal_community
	#												}
	#											}
	#										}
	#									}
	#								}
	#							}
	#						}
	#					}
	#				}
	#				# flip_secret_religious_community_provinces = yes
	#				flip_to_secret_religion_effect = yes
	#				top_liege = {
	#					any_realm_lord = {
	#						character_event = { id = MNM.3830 } # Inform lieges unless they're part of the cult flipping, save a flag on previous events.
	#					}
	#					any_realm_character = {
	#						limit = {
	#							has_character_flag = currently_part_of_secret_religion_uncovering
	#						}
	#						clr_character_flag = currently_part_of_secret_religion_uncovering
	#					}
	#				}
	#			}
	#		}
	#	}
	#	ai_will_do = {
	#		factor = 1
	#		modifier = {
	#			factor = 0.1 # Slow down
	#		}
	#		modifier = {
	#			factor = 0
	#			is_landed = no
	#		}
	#		modifier = {
	#			factor = 0
	#			prisoner = yes
	#		}
	#		modifier = {
	#			factor = 0.001
	#			any_society_member = {
	#				NOT = { character = ROOT }
	#				same_realm = ROOT
	#				ai = no
	#			}
	#			NOT = {
	#				top_liege = {
	#					OR = {
	#						same_society_as = ROOT
	#						is_openly_of_roots_secret_religion_trigger = yes
	#					}
	#				}
	#			}
	#		}
	#		modifier = {
	#			factor = 0
	#			top_liege = {
	#				war = yes
	#			}
	#		}
	#		modifier = { #Don't do it unless you are confident in support
	#			factor = 0
	#			NOR = {
	#				AND = { # The Top Liege is in the Secret Cult, and at least 3 of the Liege's direct vassals are also members
	#					top_liege = {
	#						OR = {
	#							same_society_as = ROOT
	#							is_openly_of_roots_secret_religion_trigger = yes
	#						}
	#					}
	#					top_liege = {
	#						any_vassal = {
	#							count = 3
	#							higher_tier_than = BARON
	#							prisoner = no
	#							OR = {
	#								same_society_as = ROOT
	#								is_openly_of_roots_secret_religion_trigger = yes
	#							}
	#						}
	#					}
	#				}
	#				top_liege = { # At least 5 direct vassals of the Top Liege is in the Secret Cult
	#					any_vassal = {
	#						count = 5
	#						higher_tier_than = BARON
	#						prisoner = no
	#						OR = {
	#							same_society_as = ROOT
	#							is_openly_of_roots_secret_religion_trigger = yes
	#						}
	#					}
	#				}
	#				top_liege = { # All direct vassals of the Top Liege are in the Secret Cult
	#					NOT = {
	#						any_vassal = {
	#							higher_tier_than = BARON
	#							NOR = {
	#								same_society_as = ROOT
	#								is_openly_of_roots_secret_religion_trigger = yes
	#							}
	#						}
	#					}
	#				}
	#				top_liege = {
	#					realm_character_percent = {
	#						target = 0.30
	#						OR = {
	#							same_society_as = ROOT
	#							is_openly_of_prevs_secret_religion_trigger = yes
	#						}
	#					}
	#				}
	#				AND = {
	#					top_liege = {
	#						realm_character_percent = {
	#							target = 0.25
	#							OR = {
	#								same_society_as = ROOT
	#								is_openly_of_prevs_secret_religion_trigger = yes
	#							}
	#						}
	#					}
	#					liege = {
	#						OR = {
	#							same_society_as = ROOT
	#							is_openly_of_prevs_secret_religion_trigger = yes
	#						}
	#					}
	#				}
	#				AND = {
	#					top_liege = {
	#						realm_character_percent = {
	#							target = 0.20
	#							OR = {
	#								same_society_as = ROOT
	#								is_openly_of_prevs_secret_religion_trigger = yes
	#							}
	#						}
	#					}
	#					top_liege = {
	#						OR = {
	#							same_society_as = ROOT
	#							is_openly_of_prevs_secret_religion_trigger = yes
	#						}
	#					}
	#					liege = {
	#						OR = {
	#							same_society_as = ROOT
	#							is_openly_of_prevs_secret_religion_trigger = yes
	#						}
	#					}
	#				}
	#				AND = {
	#					top_liege = {
	#						realm_character_percent = {
	#							target = 0.15
	#							OR = {
	#								same_society_as = ROOT
	#								is_openly_of_prevs_secret_religion_trigger = yes
	#							}
	#						}
	#					}
	#					any_vassal = {
	#						OR = {
	#							same_society_as = ROOT
	#							is_openly_of_prevs_secret_religion_trigger = yes
	#						}
	#					}
	#					top_liege = {
	#						OR = {
	#							same_society_as = ROOT
	#							is_openly_of_prevs_secret_religion_trigger = yes
	#						}
	#					}
	#					liege = {
	#						OR = {
	#							same_society_as = ROOT
	#							is_openly_of_prevs_secret_religion_trigger = yes
	#						}
	#					}
	#				}
	#			}
	#		}
	#	}
	#}
}

decisions = {
	#revive_the_asmodeans = {
	#	only_playable = yes
	#	is_high_prio = yes
	#	ai_check_interval = 120
	#	potential = {
	#		not_casting = yes
  #          has_dlc = "Mystics"
  #          secret_religion = infernal
	#		the_satanists = { # Has no members
	#			NOT = {
	#				any_society_member = { always = yes }
	#			}
	#		}
	#		NOT = {
	#			has_game_rule = {
	#				name = secret_cults
	#				value = none
	#			}
	#		}
  #          NOT = {
  #              has_game_rule = {
  #                  name = devil_worshipers
  #                  value = none
  #              }
  #          }
	#	}
	#	allow = {
	#		is_adult = yes
	#		prestige = 250
	#		NOT = { is_in_society = yes }
	#		prisoner = no
	#		NOT = { trait = incapable }
	#		NOT = { is_inaccessible_trigger = yes }
	#	}
	#	effect = {
	#		prestige = -250
	#		join_society = the_satanists
	#		set_society_grandmaster = yes # Set character as Grand Master
	#		hidden_tooltip = { add_society_currency_massive_effect = yes } # Give the Grand Master a start-up capital to induct members
	#	}
	#	ai_will_do = {
	#		factor = 0.1
	#		modifier = {
	#			factor = 0.03 # Slow down
	#		}
	#		modifier = {
	#			factor = 2
	#			OR = {
	#				top_liege = { # If the characters top liege is a player
	#					ai = no
	#				}
	#				top_liege = {
	#					any_realm_lord = { # If there is a player vassal in the same realm that is not secretly religious
	#						ai = no
	#						independent = no
	#						has_secret_religion_trait_trigger = no
	#					}
	#				}
	#			}
	#		}
	#		modifier = {
	#			factor = 0.1
	#			NOT = {
	#				trait = zealous
	#			}
	#		}
	#		modifier = {
	#			factor = 0.1
	#			OR = {
	#				trait = content
	#				trait = trusting
	#				trait = shy
	#			}
	#		}
	#		modifier = {
	#			factor = 0
	#			any_player = {
  #                  secret_religion = infernal
	#			}
	#		}
	#	}
	#}
}

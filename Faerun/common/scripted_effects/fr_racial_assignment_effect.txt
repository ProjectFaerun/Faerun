#This whole file is dedicated to this one effect

#It *has* to be within a mother_even_if_dead or father_even_if_dead scope.

#The point of it is to give a child (PREV) the graphical culture of their parent.

#Can't use graphical_culture = PREV because it actually uses the graphics of the actual culture (rather than the ethnicity) of the parent. So a Hadhar-cultured dwarf parent who would be targeted by graphical_culture = PREV would result in a human-portrait child. Which is a no-no.

tb_graph_culture_racial = {
	if = {
		limit = { has_undead_portrait = no }
		gfx_culture_scope = {
			save_event_target_as = gfx_target
			PREVPREV = {
				set_graphical_culture = event_target:gfx_target
			}
		}
	}
}

# Standard racial inheritance for common humanoids.
# 50% chance for either parents creature trait and graphical culture.
default_race_inheritance = {
	random_list = {
		12 = {
			trigger = {
				true_father_even_if_dead = { trait = creature_human }
			}
			add_trait = creature_human
			true_father_even_if_dead = { tb_graph_culture_racial = yes }
		}
		12 = {
			trigger = {
				mother_even_if_dead = { trait = creature_human }
			}
			add_trait = creature_human
			mother_even_if_dead = { tb_graph_culture_racial = yes }
		}
		3 = {
			trigger = {
				true_father_even_if_dead = {
					OR = {
						trait = creature_half_elf
						trait = creature_half_dwarf
						trait = creature_half_orc
						trait = creature_half_giant
						trait = creature_half_ogre
						trait = creature_half_gnoll
						trait = creature_hagspawn
					}
				}
			}
			add_trait = creature_human
			human_racial = yes
		}
		3 = {
			trigger = {
				mother_even_if_dead = {
					OR = {
						trait = creature_half_elf
						trait = creature_half_dwarf
						trait = creature_half_orc
						trait = creature_half_giant
						trait = creature_half_ogre
						trait = creature_half_gnoll
						trait = creature_hagspawn
					}
				}
			}
			add_trait = creature_human
			human_racial = yes
		}
		12 = {
			trigger = {
				true_father_even_if_dead = { trait = creature_elf }
			}
			add_trait = creature_elf
			true_father_even_if_dead = { tb_graph_culture_racial = yes }
		}
		12 = {
			trigger = {
				mother_even_if_dead = { trait = creature_elf }
			}
			add_trait = creature_elf
			mother_even_if_dead = { tb_graph_culture_racial = yes }
		}
		12 = {
			trigger = {
				true_father_even_if_dead = { trait = creature_drow }
			}
			add_trait = creature_drow
			true_father_even_if_dead = { tb_graph_culture_racial = yes }
		}
		12 = {
			trigger = {
				mother_even_if_dead = { trait = creature_drow }
			}
			add_trait = creature_drow
			mother_even_if_dead = { tb_graph_culture_racial = yes }
		}
		9 = {
			trigger = {
				true_father_even_if_dead = { trait = creature_half_elf }
			}
			add_trait = creature_half_elf
			true_father_even_if_dead = { tb_graph_culture_racial = yes }
		}
		9 = {
			trigger = {
				mother_even_if_dead = { trait = creature_half_elf }
			}
			add_trait = creature_half_elf
			mother_even_if_dead = { tb_graph_culture_racial = yes }
		}
		12 = {
			trigger = {
				OR = {
					true_father_even_if_dead = { trait = creature_feyri }
					mother_even_if_dead = { trait = creature_feyri }
				}
			}
			add_trait = creature_feyri
			set_graphical_culture = feyri
		}
		12 = {
			trigger = {
				OR = {
					true_father_even_if_dead = { trait = creature_draegloth }
					mother_even_if_dead = { trait = creature_draegloth }
				}
			}
			add_trait = creature_draegloth
			set_graphical_culture = draegloth
		}
		12 = {
			trigger = {
				true_father_even_if_dead = { trait = creature_dwarf }
			}
			add_trait = creature_dwarf
			true_father_even_if_dead = { tb_graph_culture_racial = yes }
		}
		12 = {
			trigger = {
				mother_even_if_dead = { trait = creature_dwarf }
			}
			add_trait = creature_dwarf
			mother_even_if_dead = { tb_graph_culture_racial = yes }
		}
		9 = {
			trigger = {
				true_father_even_if_dead = { trait = creature_half_dwarf }
			}
			add_trait = creature_half_dwarf
			true_father_even_if_dead = { tb_graph_culture_racial = yes }
		}
		9 = {
			trigger = {
				mother_even_if_dead = { trait = creature_half_dwarf }
			}
			add_trait = creature_half_dwarf
			mother_even_if_dead = { tb_graph_culture_racial = yes }
		}
		12 = {
			trigger = {
				true_father_even_if_dead = { trait = creature_gnome }
			}
			add_trait = creature_gnome
			true_father_even_if_dead = { tb_graph_culture_racial = yes }
		}
		12 = {
			trigger = {
				mother_even_if_dead = { trait = creature_gnome }
			}
			add_trait = creature_gnome
			mother_even_if_dead = { tb_graph_culture_racial = yes }
		}
		12 = {
			trigger = {
				true_father_even_if_dead = { trait = creature_halfling }
			}
			add_trait = creature_halfling
			true_father_even_if_dead = { tb_graph_culture_racial = yes }
		}
		12 = {
			trigger = {
				mother_even_if_dead = { trait = creature_halfling }
			}
			add_trait = creature_halfling
			mother_even_if_dead = { tb_graph_culture_racial = yes }
		}
		12 = {
			trigger = {
				true_father_even_if_dead = { trait = creature_spirit_folk }
			}
			add_trait = creature_spirit_folk
			true_father_even_if_dead = { tb_graph_culture_racial = yes }
		}
		12 = {
			trigger = {
				mother_even_if_dead = { trait = creature_spirit_folk }
			}
			add_trait = creature_spirit_folk
			mother_even_if_dead = { tb_graph_culture_racial = yes }
		}
		12 = {
			trigger = {
				true_father_even_if_dead = { trait = creature_orc }
			}
			add_trait = creature_orc
			true_father_even_if_dead = { tb_graph_culture_racial = yes }
		}
		12 = {
			trigger = {
				mother_even_if_dead = { trait = creature_orc }
			}
			add_trait = creature_orc
			mother_even_if_dead = { tb_graph_culture_racial = yes }
		}
		9 = {
			trigger = {
				true_father_even_if_dead = { trait = creature_half_orc }
			}
			add_trait = creature_half_orc
			true_father_even_if_dead = { tb_graph_culture_racial = yes }
		}
		9 = {
			trigger = {
				mother_even_if_dead = { trait = creature_half_orc }
			}
			add_trait = creature_half_orc
			mother_even_if_dead = { tb_graph_culture_racial = yes }
		}
		12 = {
			trigger = {
				OR = {
					true_father_even_if_dead = { trait = creature_tanarukk }
					mother_even_if_dead = { trait = creature_tanarukk }
				}
			}
			add_trait = creature_tanarukk
			set_graphical_culture = tanarukk
		}
		12 = {
			trigger = {
				true_father_even_if_dead = { trait = creature_giant }
			}
			add_trait = creature_giant
			true_father_even_if_dead = { tb_graph_culture_racial = yes }
		}
		12 = {
			trigger = {
				mother_even_if_dead = { trait = creature_giant }
			}
			add_trait = creature_giant
			mother_even_if_dead = { tb_graph_culture_racial = yes }
		}
		9 = {
			trigger = {
				OR = {
					true_father_even_if_dead = { trait = creature_half_giant }
					mother_even_if_dead = { trait = creature_half_giant }
				}
			}
			add_trait = creature_half_giant
			goliath_race_inheritance = yes
		}
		12 = {
			trigger = {
				true_father_even_if_dead = { trait = creature_ogre }
			}
			add_trait = creature_ogre
			true_father_even_if_dead = { tb_graph_culture_racial = yes }
		}
		12 = {
			trigger = {
				mother_even_if_dead = { trait = creature_ogre }
			}
			add_trait = creature_ogre
			mother_even_if_dead = { tb_graph_culture_racial = yes }
		}
		9 = {
			trigger = {
				true_father_even_if_dead = { trait = creature_half_ogre }
			}
			add_trait = creature_half_ogre
			true_father_even_if_dead = { tb_graph_culture_racial = yes }
		}
		9 = {
			trigger = {
				mother_even_if_dead = { trait = creature_half_ogre }
			}
			add_trait = creature_half_ogre
			mother_even_if_dead = { tb_graph_culture_racial = yes }
		}
		12 = {
			trigger = {
				true_father_even_if_dead = { trait = creature_ogrillon }
			}
			add_trait = creature_ogrillon
			true_father_even_if_dead = { tb_graph_culture_racial = yes }
		}
		12 = {
			trigger = {
				mother_even_if_dead = { trait = creature_ogrillon }
			}
			add_trait = creature_ogrillon
			mother_even_if_dead = { tb_graph_culture_racial = yes }
		}
		12 = {
			trigger = {
				OR = {
					true_father_even_if_dead = { trait = creature_goliath }
					mother_even_if_dead = { trait = creature_goliath }
				}
			}
			add_trait = creature_goliath
			goliath_race_inheritance = yes
		}
		12 = {
			trigger = {
				true_father_even_if_dead = { trait = creature_gith }
			}
			add_trait = creature_gith
			true_father_even_if_dead = { tb_graph_culture_racial = yes }
		}
		12 = {
			trigger = {
				mother_even_if_dead = { trait = creature_gith }
			}
			add_trait = creature_gith
			mother_even_if_dead = { tb_graph_culture_racial = yes }
		}
		12 = {
			trigger = {
				true_father_even_if_dead = { trait = creature_goblin }
			}
			add_trait = creature_goblin
			true_father_even_if_dead = { tb_graph_culture_racial = yes }
		}
		12 = {
			trigger = {
				mother_even_if_dead = { trait = creature_goblin }
			}
			add_trait = creature_goblin
			mother_even_if_dead = { tb_graph_culture_racial = yes }
		}
		12 = {
			trigger = {
				OR = {
					true_father_even_if_dead = { trait = creature_hobgoblin }
					mother_even_if_dead = { trait = creature_hobgoblin }
				}
			}
			add_trait = creature_hobgoblin
			set_graphical_culture = hobgoblin
		}
		12 = {
			trigger = {
				OR = {
					true_father_even_if_dead = { trait = creature_bugbear }
					mother_even_if_dead = { trait = creature_bugbear }
				}
			}
			add_trait = creature_bugbear
			set_graphical_culture = bugbear
		}
		12 = {
			trigger = {
				OR = {
					true_father_even_if_dead = { trait = creature_kobold }
					mother_even_if_dead = { trait = creature_kobold }
				}
			}
			add_trait = creature_kobold
			set_graphical_culture = kobold
		}
		12 = {
			trigger = {
				OR = {
					true_father_even_if_dead = { trait = creature_gnoll }
					mother_even_if_dead = { trait = creature_gnoll }
				}
			}
			add_trait = creature_gnoll
			set_graphical_culture = gnoll
		}
		9 = {
			trigger = {
				OR = {
					true_father_even_if_dead = { trait = creature_half_gnoll }
					mother_even_if_dead = { trait = creature_half_gnoll }
				}
			}
			add_trait = creature_half_gnoll
			set_graphical_culture = half_gnoll
		}
		4 = {
			trigger = {
				OR = {
					true_father_even_if_dead = { trait = creature_centaur }
					mother_even_if_dead = { trait = creature_centaur }
				}
			}
			add_trait = creature_centaur
			set_graphical_culture = centaur
		}
		4 = {
			trigger = {
				OR = {
					true_father_even_if_dead = { trait = creature_wemic }
					mother_even_if_dead = { trait = creature_wemic }
				}
			}
			add_trait = creature_wemic
			set_graphical_culture = wemic
		}
		12 = {
			trigger = {
				OR = {
					true_father_even_if_dead = { trait = creature_minotaur }
					mother_even_if_dead = { trait = creature_minotaur }
				}
			}
			add_trait = creature_minotaur
			set_graphical_culture = minotaur
		}
		12 = {
			trigger = {
				OR = {
					true_father_even_if_dead = { trait = creature_yikarian }
					mother_even_if_dead = { trait = creature_yikarian }
				}
			}
			add_trait = creature_yikarian
			set_graphical_culture = yikarian
		}
		12 = {
			trigger = {
				true_father_even_if_dead = { trait = creature_pureblood }
			}
			random_list = {
				90 = {
					add_trait = creature_pureblood
					true_father_even_if_dead = { tb_graph_culture_racial = yes }
				}
				10 = {
					add_trait = creature_malison
					set_graphical_culture = halfblood
				}
			}
		}
		12 = {
			trigger = {
				mother_even_if_dead = { trait = creature_pureblood }
			}
			random_list = {
				90 = {
					add_trait = creature_pureblood
					mother_even_if_dead = { tb_graph_culture_racial = yes }
				}
				10 = {
					add_trait = creature_malison
					set_graphical_culture = halfblood
				}
			}
		}
		12 = {
			trigger = {
				OR = {
					true_father_even_if_dead = { trait = creature_malison }
					mother_even_if_dead = { trait = creature_malison }
				}
			}
			random_list = {
				25 = {
					add_trait = creature_pureblood
					set_graphical_culture = yuanti
				}
				25 = {
					add_trait = creature_malison
					set_graphical_culture = halfblood
				}
				25 = {
					add_trait = creature_malison
					set_graphical_culture = malison
				}
				25 = {
					add_trait = creature_abomination
					set_graphical_culture = abomination
				}
			}
		}
		12 = {
			trigger = {
				OR = {
					true_father_even_if_dead = { trait = creature_abomination }
					mother_even_if_dead = { trait = creature_abomination }
				}
			}
			random_list = {
				50 = {
					add_trait = creature_abomination
					set_graphical_culture = abomination
				}
				25 = {
					add_trait = creature_malison
					set_graphical_culture = malison
				}
				25 = {
					add_trait = creature_pureblood
					set_graphical_culture = yuanti
				}
			}
		}
		12 = {
			trigger = {
				OR = {
					true_father_even_if_dead = { trait = creature_sahuagin }
					mother_even_if_dead = { trait = creature_sahuagin }
				}
			}
			add_trait = creature_sahuagin
			set_graphical_culture = sahuagin
		}
		12 = {
			trigger = {
				OR = {
					true_father_even_if_dead = { trait = creature_malenti }
					mother_even_if_dead = { trait = creature_malenti }
				}
			}
			add_trait = creature_malenti
			set_graphical_culture = malenti
		}
		12 = {
			trigger = {
				true_father_even_if_dead = { trait = creature_treant }
			}
			add_trait = creature_treant
			true_father_even_if_dead = { tb_graph_culture_racial = yes }
		}
		12 = {
			trigger = {
				mother_even_if_dead = { trait = creature_treant }
			}
			add_trait = creature_treant
			mother_even_if_dead = { tb_graph_culture_racial = yes }
		}
		12 = {
			trigger = {
				OR = {
					true_father_even_if_dead = { trait = creature_satyr }
					mother_even_if_dead = { trait = creature_satyr }
				}
			}
			add_trait = creature_satyr
			set_graphical_culture = satyr
		}
		12 = {
			trigger = {
				OR = {
					true_father_even_if_dead = { trait = creature_hag }
					mother_even_if_dead = { trait = creature_hag }
				}
			}
			add_trait = creature_hag
			set_graphical_culture = hag
		}
		12 = {
			trigger = {
				OR = {
					true_father_even_if_dead = { trait = creature_hengeyokai }
					mother_even_if_dead = { trait = creature_hengeyokai }
				}
			}
			spawn_random_hengeyokai = yes
		}
		12 = {
			trigger = {
				OR = {
					true_father_even_if_dead = { trait = creature_tabaxi }
					mother_even_if_dead = { trait = creature_tabaxi }
				}
			}
			add_trait = creature_tabaxi
			set_graphical_culture = tabaxi
		}
		9 = {
			trigger = {
				OR = {
					true_father_even_if_dead = { trait = creature_hagspawn }
					mother_even_if_dead = { trait = creature_hagspawn }
				}
			}
			add_trait = creature_hagspawn
			set_graphical_culture = hagspawn
		}
		12 = {
			trigger = {
				OR = {
					true_father_even_if_dead = { trait = creature_deep_imaskari }
					mother_even_if_dead = { trait = creature_deep_imaskari }
				}
			}
			add_trait = creature_deep_imaskari
			set_graphical_culture = deep_imaskari
		}
		12 = {
			trigger = {
				true_father_even_if_dead = { trait = creature_genasi }
			}
			add_trait = creature_genasi
			true_father_even_if_dead = { tb_graph_culture_racial = yes }
		}
		12 = {
			trigger = {
				mother_even_if_dead = { trait = creature_genasi }
			}
			add_trait = creature_genasi
			mother_even_if_dead = { tb_graph_culture_racial = yes }
		}
		12 = {
			trigger = {
				true_father_even_if_dead = { trait = creature_tiefling }
			}
			add_trait = creature_tiefling
			true_father_even_if_dead = { tb_graph_culture_racial = yes }
		}
		12 = {
			trigger = {
				mother_even_if_dead = { trait = creature_tiefling }
			}
			add_trait = creature_tiefling
			mother_even_if_dead = { tb_graph_culture_racial = yes }
		}
		12 = {
			trigger = {
				true_father_even_if_dead = { trait = creature_aasimar }
			}
			add_trait = creature_aasimar
			true_father_even_if_dead = { tb_graph_culture_racial = yes }
			if = {
				limit = { race_part_animal = yes }
				spawn_random_ardling = yes
			}
		}
		12 = {
			trigger = {
				mother_even_if_dead = { trait = creature_aasimar }
			}
			add_trait = creature_aasimar
			mother_even_if_dead = { tb_graph_culture_racial = yes }
			if = {
				limit = { race_part_animal = yes }
				spawn_random_ardling = yes
			}
		}
		12 = {
			trigger = {
				true_father_even_if_dead = { trait = creature_dragonborn }
			}
			add_trait = creature_dragonborn
			true_father_even_if_dead = { tb_graph_culture_racial = yes }
		}
		12 = {
			trigger = {
				mother_even_if_dead = { trait = creature_dragonborn }
			}
			add_trait = creature_dragonborn
			mother_even_if_dead = { tb_graph_culture_racial = yes }
		}
		12 = {
			trigger = {
				true_father_even_if_dead = { trait = creature_lizardfolk }
			}
			add_trait = creature_lizardfolk
			true_father_even_if_dead = { tb_graph_culture_racial = yes }
		}
		12 = {
			trigger = {
				mother_even_if_dead = { trait = creature_lizardfolk }
			}
			add_trait = creature_lizardfolk
			mother_even_if_dead = { tb_graph_culture_racial = yes }
		}
		4 = {
			trigger = {
				OR = {
					true_father_even_if_dead = { trait = creature_naga }
					mother_even_if_dead = { trait = creature_naga }
				}
			}
			add_trait = creature_naga
			set_graphical_culture = naga
		}
		4 = {
			trigger = {
				OR = {
					true_father_even_if_dead = { trait = creature_lamia }
					mother_even_if_dead = { trait = creature_lamia }
				}
			}
			add_trait = creature_lamia
			set_graphical_culture = lamia
		}
		12 = {
			trigger = {
				OR = {
					true_father_even_if_dead = { trait = creature_kuotoa }
					mother_even_if_dead = { trait = creature_kuotoa }
				}
			}
			add_trait = creature_kuotoa
			set_graphical_culture = kuo_toa
		}
		12 = {
			trigger = {
				OR = {
					true_father_even_if_dead = { trait = creature_pterafolk }
					mother_even_if_dead = { trait = creature_pterafolk }
				}
			}
			add_trait = creature_pterafolk
			set_graphical_culture = pterafolk
		}
		12 = {
			trigger = {
				OR = {
					true_father_even_if_dead = { trait = creature_saurial }
					mother_even_if_dead = { trait = creature_saurial }
				}
			}
			add_trait = creature_saurial
			set_graphical_culture = saurial
		}
		2 = {
			trigger = {
				OR = {
					true_father_even_if_dead = { trait = creature_sarrukh }
					mother_even_if_dead = { trait = creature_sarrukh }
				}
			}
			add_trait = creature_sarrukh
			set_graphical_culture = sarrukh
		}
		12 = {
			trigger = {
				OR = {
					true_father_even_if_dead = { trait = creature_aarakocra }
					mother_even_if_dead = { trait = creature_aarakocra }
				}
			}
			add_trait = creature_aarakocra
			set_graphical_culture = aarakocra
		}
		12 = {
			trigger = {
				true_father_even_if_dead = { trait = creature_tengu }
			}
			add_trait = creature_tengu
			true_father_even_if_dead = { tb_graph_culture_racial = yes }
		}
		12 = {
			trigger = {
				mother_even_if_dead = { trait = creature_tengu }
			}
			add_trait = creature_tengu
			mother_even_if_dead = { tb_graph_culture_racial = yes }
		}
	}
}

halfelf_race_inheritance = {
	add_trait = creature_half_elf
	if = {
		limit = {
			OR = {
				true_father_even_if_dead = {
					OR = {
						graphical_culture = moonelfgfx
						graphical_culture = snowelfgfx
					}
				}
				mother_even_if_dead = {
					OR = {
						graphical_culture = moonelfgfx
						graphical_culture = snowelfgfx
					}
				}
			}
		}
		set_graphical_culture = half_moon_elf
	}
	else_if = {
		limit = {
			OR = {
				true_father_even_if_dead = {
					graphical_culture = asraigfx
				}
				mother_even_if_dead = {
					graphical_culture = asraigfx
				}
			}
		}
		set_graphical_culture = half_wood_elf
	}
	else_if = {
		limit = {
			OR = {
				true_father_even_if_dead = {
					OR = {
						graphical_culture = greenelfgfx
						graphical_culture = poscadargfx
						graphical_culture = darkelfgfx
					}
				}
				mother_even_if_dead = {
					OR = {
						graphical_culture = greenelfgfx
						graphical_culture = poscadargfx
						graphical_culture = darkelfgfx
					}
				}
			}
		}
		set_graphical_culture = half_green_elf
	}
	else_if = {
		limit = {
			OR = {
				true_father_even_if_dead = {
					OR = {
						graphical_culture = drowgfx
						graphical_culture = lorendrowgfx
						graphical_culture = aevendrowgfx
						graphical_culture = draeglothgfx
					}
				}
				mother_even_if_dead = {
					OR = {
						graphical_culture = drowgfx
						graphical_culture = lorendrowgfx
						graphical_culture = aevendrowgfx
						graphical_culture = draeglothgfx
					}
				}
			}
		}
		set_graphical_culture = crinti
	}
	else_if = {
		limit = {
			OR = {
				true_father_even_if_dead = {
					graphical_culture = seaelfgfx
				}
				mother_even_if_dead = {
					graphical_culture = seaelfgfx
				}
			}
		}
		set_graphical_culture = half_sea_elf
	}
	else_if = {
		limit = {
			OR = {
				true_father_even_if_dead = {
					graphical_culture = eladringfx
				}
				mother_even_if_dead = {
					graphical_culture = eladringfx
				}
			}
		}
		set_graphical_culture = half_eladrin
	}
	else_if = {
		limit = {
			OR = {
				true_father_even_if_dead = {
					graphical_culture = shadarkaigfx
				}
				mother_even_if_dead = {
					graphical_culture = shadarkaigfx
				}
			}
		}
		set_graphical_culture = half_shadar_kai
	}
	else_if = {
		limit = {
			OR = {
				true_father_even_if_dead = {
					graphical_culture = maraloigfx
				}
				mother_even_if_dead = {
					graphical_culture = maraloigfx
				}
			}
		}
		set_graphical_culture = maviddi
	}
	else = {
		set_graphical_culture = half_sun_elf
	}
}

# Inherit dragon type from full or secret dragon parent.
dragon_race_inheritance = {
	add_trait = creature_dragon
	random_list = {
		1 = {
			trigger = {
				mother_even_if_dead = { trait = creature_dragon }
			}
			mother_even_if_dead = {
				tb_graph_culture_racial = yes
			}
		}
		1 = {
			trigger = {
				true_father_even_if_dead = { trait = creature_dragon }
			}
			true_father_even_if_dead = {
				tb_graph_culture_racial = yes
			}
		}
		1 = {
			trigger = {
				OR = {
					mother_even_if_dead = { has_character_flag = is_red_dragon }
					true_father_even_if_dead = { has_character_flag = is_red_dragon }
				}
			}
			set_graphical_culture = red_dragon
		}
		1 = {
			trigger = {
				OR = {
					mother_even_if_dead = { has_character_flag = is_green_dragon }
					true_father_even_if_dead = { has_character_flag = is_green_dragon }
				}
			}
			set_graphical_culture = green_dragon
		}
		1 = {
			trigger = {
				OR = {
					mother_even_if_dead = { has_character_flag = is_blue_dragon }
					true_father_even_if_dead = { has_character_flag = is_blue_dragon }
				}
			}
			set_graphical_culture = blue_dragon
		}
		1 = {
			trigger = {
				OR = {
					mother_even_if_dead = { has_character_flag = is_black_dragon }
					true_father_even_if_dead = { has_character_flag = is_black_dragon }
				}
			}
			set_graphical_culture = black_dragon
		}
		1 = {
			trigger = {
				OR = {
					mother_even_if_dead = { has_character_flag = is_amethyst_dragon }
					true_father_even_if_dead = { has_character_flag = is_amethyst_dragon }
				}
			}
			set_graphical_culture = amethyst_dragon
		}
		1 = {
			trigger = {
				OR = {
					mother_even_if_dead = { has_character_flag = is_ruby_dragon }
					true_father_even_if_dead = { has_character_flag = is_ruby_dragon }
				}
			}
			set_graphical_culture = ruby_dragon
		}
		1 = {
			trigger = {
				OR = {
					mother_even_if_dead = { has_character_flag = is_gold_dragon }
					true_father_even_if_dead = { has_character_flag = is_gold_dragon }
				}
			}
			set_graphical_culture = gold_dragon
		}
		1 = {
			trigger = {
				OR = {
					mother_even_if_dead = { has_character_flag = is_silver_dragon }
					true_father_even_if_dead = { has_character_flag = is_silver_dragon }
				}
			}
			set_graphical_culture = silver_dragon
		}
		1 = {
			trigger = {
				OR = {
					mother_even_if_dead = { has_character_flag = is_bronze_dragon }
					true_father_even_if_dead = { has_character_flag = is_bronze_dragon }
				}
			}
			set_graphical_culture = bronze_dragon
		}
		1 = {
			trigger = {
				OR = {
					mother_even_if_dead = { has_character_flag = is_brass_dragon }
					true_father_even_if_dead = { has_character_flag = is_brass_dragon }
				}
			}
			set_graphical_culture = brass_dragon
		}
		1 = {
			trigger = {
				OR = {
					mother_even_if_dead = { has_character_flag = is_copper_dragon }
					true_father_even_if_dead = { has_character_flag = is_copper_dragon }
				}
			}
			set_graphical_culture = copper_dragon
		}
		1 = {
			trigger = {
				OR = {
					mother_even_if_dead = { has_character_flag = is_shadow_dragon }
					true_father_even_if_dead = { has_character_flag = is_shadow_dragon }
				}
			}
			set_graphical_culture = shadow_dragon
		}
		1 = {
			trigger = {
				OR = {
					mother_even_if_dead = { has_character_flag = is_song_dragon }
					true_father_even_if_dead = { has_character_flag = is_song_dragon }
				}
			}
			set_graphical_culture = song_dragon
		}
		1 = {
			trigger = {
				OR = {
					mother_even_if_dead = {
						has_character_flag = secret_dragon
						NOR = {
							has_character_flag = is_red_dragon
							has_character_flag = is_green_dragon
							has_character_flag = is_blue_dragon
							has_character_flag = is_black_dragon
							has_character_flag = is_amethyst_dragon
							has_character_flag = is_ruby_dragon
							has_character_flag = is_gold_dragon
							has_character_flag = is_silver_dragon
							has_character_flag = is_bronze_dragon
							has_character_flag = is_brass_dragon
							has_character_flag = is_copper_dragon
							has_character_flag = is_shadow_dragon
							has_character_flag = is_song_dragon
						}
					}
					true_father_even_if_dead = {
						has_character_flag = secret_dragon
						NOR = {
							has_character_flag = is_red_dragon
							has_character_flag = is_green_dragon
							has_character_flag = is_blue_dragon
							has_character_flag = is_black_dragon
							has_character_flag = is_amethyst_dragon
							has_character_flag = is_ruby_dragon
							has_character_flag = is_gold_dragon
							has_character_flag = is_silver_dragon
							has_character_flag = is_bronze_dragon
							has_character_flag = is_brass_dragon
							has_character_flag = is_copper_dragon
							has_character_flag = is_shadow_dragon
							has_character_flag = is_song_dragon
						}
					}
				}
			}
			set_graphical_culture = steel_dragon
		}
	}
}

# Select and set one of the aasimar subtypes.
spawn_random_aasimar = {
	add_trait = creature_aasimar
	random_list = {
		1 = {
			add_character_modifier = {
				name = angel_aasimar
				duration = -1
			}
			set_graphical_culture = aasimar
			random = {
				chance = 10
				set_graphical_culture = deva_aasimar
			}
		}
		10 = {
			trigger = {
				OR = {
					is_archon_summoning_culture = yes
					is_archon_summoning_religion = yes
				}
			}
			add_character_modifier = {
				name = archon_aasimar
				duration = -1
			}
			random_list = {
				2 = {
					spawn_random_ardling = yes
				}
				1 = {
					set_graphical_culture = aasimar
				}
			}
		}
		10 = {
			trigger = {
				OR = {
					is_asura_summoning_culture = yes
					is_asura_summoning_religion = yes
				}
			}
			add_character_modifier = {
				name = asura_aasimar
				duration = -1
			}
			set_graphical_culture = deva_aasimar
		}
		10 = {
			trigger = {
				OR = {
					is_eladrin_summoning_culture = yes
					is_eladrin_summoning_religion = yes
				}
			}
			add_character_modifier = {
				name = eladrin_aasimar
				duration = -1
			}
			set_graphical_culture = eladrin_aasimar
		}
		10 = {
			trigger = {
				OR = {
					is_einheriar_summoning_culture = yes
					is_einheriar_summoning_religion = yes
				}
			}
			add_character_modifier = {
				name = einheriar_aasimar
				duration = -1
			}
			set_graphical_culture = einheriar
		}
		10 = {
			trigger = {
				OR = {
					is_moonmaiden_summoning_culture = yes
					is_moonmaiden_summoning_religion = yes
				}
			}
			add_character_modifier = {
				name = moonmaiden_aasimar
				duration = -1
			}
			set_graphical_culture = moonmaiden
		}
		10 = {
			trigger = {
				OR = {
					is_guardinal_summoning_culture = yes
					is_guardinal_summoning_religion = yes
					is_arvoral_summoning_culture = yes
					is_arvoral_summoning_religion = yes
				}
			}
			add_character_modifier = {
				name = guardinal_aasimar
				duration = -1
			}
			spawn_random_ardling = yes
		}
		5 = {
			trigger = {
				culture_group = mulan_group
			}
			add_character_modifier = {
				name = divine_aasimar
				duration = -1
			}
			random_list = {
				5 = {
					set_graphical_culture = aasimar
				}
				1 = {
					modifier = {
						factor = 4
						culture = mulhorandi
					}
					spawn_random_ardling = yes
				}
			}
		}
	}
	# Just random ardlings.
	#random = {
	#	chance = 20
	#	spawn_random_ardling = yes
	#}
}

# Select and set one of the archon subtypes.
spawn_random_archon = {
	add_trait = creature_angel
	random_list = {
		80 = { # Hound archon
			set_graphical_culture = archon
		}
		10 = { # Trumpet and Sword archons
			set_graphical_culture = angel
		}
		10 = { # Warden archons
			set_graphical_culture = warden_archon
		}
	}
}

# Select and set one of the baatezu subtypes.
spawn_random_baatezu = {
	add_trait = creature_fiend
	random_list = {
		65 = {
			mult_modifier = {
				factor = 0.5
				OR = {
					is_ruler = yes
					is_or_was_offmap_power_ruler = yes
					has_opinion_modifier = {
						who = ROOT
						name = planar_binding_mod
					}
				}
			}
			set_graphical_culture = cornugon
		}
		20 = {
			mult_modifier = {
				factor = 0.25
				NOR = {
					is_ruler = yes
					is_lowborn = no
					has_opinion_modifier = {
						who = ROOT
						name = planar_binding_mod
					}
				}
			}
			set_graphical_culture = baatezu
			add_trait = greater_fiend
		}
		10 = {
			mult_modifier = {
				factor = 0.25
				NOR = {
					is_ruler = yes
					is_lowborn = no
					has_opinion_modifier = {
						who = ROOT
						name = planar_binding_mod
					}
				}
			}
			set_graphical_culture = gelugon
			add_trait = greater_fiend
		}
		10 = {
			trigger = {
				is_female = yes
			}
			set_graphical_culture = erinyes
		}
		5 = {
			set_graphical_culture = tiefling
		}
	}
}

# Select and set one of the genasi subtypes.
spawn_random_genasi = {
	add_trait = creature_genasi
	random_list = {
		25 = {
			modifier = {
				factor = 4
				OR = {
					culture = calishite
					culture = borderer
					culture = shoon
					culture = untheric
					culture = efreet
					culture = fire_primordial
				}
			}
			add_character_modifier = {
				name = fire_genasi
				duration = -1
			}
		}
		25 = {
			modifier = {
				factor = 4
				OR = {
					culture = calishite
					culture = borderer
					culture = shoon
					culture = djinn
				}
			}
			add_character_modifier = {
				name = air_genasi
				duration = -1
			}
		}
		25 = {
			modifier = {
				factor = 4
				OR = {
					culture = chessentan
					culture = chultan
					culture = nelanthern
					culture = reacher
					culture = tashalan
					culture = thinguth
					culture = marid
				}
			}
			add_character_modifier = {
				name = water_genasi
				duration = -1
			}
		}
		25 = {
			modifier = {
				factor = 4
				OR = {
					culture = mulhorandi
					culture = dao
					culture = earth_primordial
				}
			}
			add_character_modifier = {
				name = earth_genasi
				duration = -1
			}
		}
		1 = {
			add_character_modifier = {
				name = smoke_genasi
				duration = -1
			}
		}
		1 = {
			add_character_modifier = {
				name = magma_genasi
				duration = -1
			}
		}
		1 = {
			add_character_modifier = {
				name = dust_genasi
				duration = -1
			}
		}
		1 = {
			modifier = {
				factor = 100
				OR = {
					culture = qorrashi
					culture = xixecal
				}
			}
			add_character_modifier = {
				name = ice_genasi
				duration = -1
			}
		}
		1 = {
			add_character_modifier = {
				name = ooze_genasi
				duration = -1
			}
		}
		1 = {
			add_character_modifier = {
				name = steam_genasi
				duration = -1
			}
		}
	}
	set_genasi_subtype = yes
}

# Select and set one of the guardinal subtypes.
spawn_random_guardinal = {
	add_trait = creature_angel
	random_list = {
		10 = { # Ursinal
			set_graphical_culture = guardinal
		}
		10 = {
			set_graphical_culture = equinal
		}
		10 = {
			set_graphical_culture = arvoral
		}
		10 = {
			set_graphical_culture = cervidal
		}
		10 = {
			set_graphical_culture = musteval
		}
	}
}

# Select and set one of the hengeyokai subtypes.
spawn_random_hengeyokai = {
	add_trait = creature_hengeyokai
	random_list = {
		65 = { # default static gfx
			set_graphical_culture = hengeyokai # kitsune, mujina, and usagi
		}
		5 = {
			set_graphical_culture = cat # neko
		}
		5 = {
			set_graphical_culture = hedgehog_culture # harinezumi
		}
		5 = {
			set_graphical_culture = duck_culture # kamo
		}
		5 = {
			set_graphical_culture = red_panda # panda
		}
		5 = {
			set_graphical_culture = tengu # kurasu
		}
		5 = {
			set_graphical_culture = tabaxi # ura
		}
		5 = {
			set_graphical_culture = musteval # nezumi
		}
		5 = {
			trigger = {
				location = {
					OR = {
						is_coastal = yes
						borders_major_river = yes
						borders_lake = yes
					}
				}
			}
			set_graphical_culture = sahuagin # koi
		}
	}
}
# Select an animal face for an ardling
spawn_random_ardling = {
	random_list = {
		5 = {
			set_graphical_culture = tabaxi # cat
		}
		5 = {
			set_graphical_culture = tengu # crow
		}
		5 = {
			set_graphical_culture = malison # snake
		}
		5 = {
			set_graphical_culture = equinal # horse
		}
		5 = { 
			set_graphical_culture = guardinal # bear
		}
		5 = {
			set_graphical_culture = arvoral # bird
		}
		5 = {
			set_graphical_culture = cervidal # goat
		}
		5 = {
			set_graphical_culture = musteval # rodent
		}
		5 = {
			set_graphical_culture = dog_culture # dog
		}
	}
}

# Select and set one of the oni subtypes.
spawn_random_oni = {
	add_trait = creature_ogre
	random_list = {
		80 = { # ogre magi
			set_graphical_culture = ogre_magi
		}
		40 = { # common oni
			modifier = {
				factor = 2.3
				location = {
					region = kara_tur_region
				}
			}
			set_graphical_culture = red_oni
		}
		15 = { # go-zu-oni
			trigger = {
				OR = {
					is_ruler = yes
					is_lowborn = no
				}
			}
			set_graphical_culture = minotaur
			add_trait = strong
		}
		5 = { # me-zu-oni
			trigger = {
				OR = {
					is_ruler = yes
					is_lowborn = no
				}
			}
			set_graphical_culture = equinal
			add_trait = strong
			add_trait = robust
			add_trait = duelist
		}
	}
}

# Select and set one of the tanarri subtypes.
spawn_random_tanarri = {
	add_trait = creature_fiend
	random_list = {
		45 = { # Vrock
			mult_modifier = {
				factor = 0.5
				OR = {
					is_ruler = yes
					is_or_was_offmap_power_ruler = yes
					has_opinion_modifier = {
						who = ROOT
						name = planar_binding_mod
					}
				}
			}
			set_graphical_culture = tanarri
		}
		20 = {
			set_graphical_culture = glabrezu
		}
		20 = {
			set_graphical_culture = succubus
		}
		10 = {
			mult_modifier = {
				factor = 0.25
				NOR = {
					is_ruler = yes
					is_lowborn = no
					has_opinion_modifier = {
						who = ROOT
						name = planar_binding_mod
					}
				}
			}
			set_graphical_culture = nalfeshnee
			add_trait = greater_fiend
		}
		10 = { # Marilith
			trigger = { is_female = yes }
			mult_modifier = {
				factor = 0.25
				NOR = {
					is_ruler = yes
					is_lowborn = no
					has_opinion_modifier = {
						who = ROOT
						name = planar_binding_mod
					}
				}
			}
			set_graphical_culture = marilith
			add_trait = greater_fiend
		}
		5 = { # Balor
			mult_modifier = {
				factor = 0.25
				NOR = {
					is_ruler = yes
					is_lowborn = no
					has_opinion_modifier = {
						who = ROOT
						name = planar_binding_mod
					}
				}
			}
			set_graphical_culture = balor
			add_trait = greater_fiend
		}
		2 = {
			mult_modifier = {
				factor = 0.25
				NOR = {
					is_ruler = yes
					is_lowborn = no
					has_opinion_modifier = {
						who = ROOT
						name = planar_binding_mod
					}
				}
			}
			set_graphical_culture = yugoloth # or nycaloths
			add_trait = greater_fiend
		}
		2 = {
			set_graphical_culture = cambion
		}
	}
}

# Select and set one of the tiefling subtypes.
spawn_random_tiefling = {
	add_trait = creature_tiefling
	random_list = {
		2 = {
			modifier = {
				factor = 100
				OR = {
					culture = baatezu
					religion = infernal
					secret_religion = infernal
					religion = thasmudyanic
					secret_religion = thasmudyanic
				}
			}
			add_character_modifier = {
				name = devil_tiefling
				duration = -1
			}
			set_graphical_culture = tiefling
		}
		2 = {
			modifier = {
				factor = 100
				OR = {
					culture = tanarri
					religion = abyssal_cult
					secret_religion = abyssal_cult
					religion = lolth_cult
					secret_religion = lolth_cult
					religion = ghaunadaur
					secret_religion = ghaunadaur
				}
			}
			add_character_modifier = {
				name = demon_tiefling
				duration = -1
			}
			set_graphical_culture = tiefling
		}
		1 = {
			modifier = {
				factor = 100
				OR = {
					culture = yugoloth
					religion = shadow_gods
					secret_religion = shadow_gods
				}
			}
			add_character_modifier = {
				name = yugoloth_tiefling
				duration = -1
			}
			set_graphical_culture = cambion
		}
		1 = {
			modifier = {
				factor = 100
				culture = gehreleth
			}
			add_character_modifier = {
				name = demodand_tiefling
				duration = -1
			}
			set_graphical_culture = tiefling
		}
		1 = {
			trigger = {
				culture_group = mulan_group
			}
			add_character_modifier = {
				name = divine_tiefling
				duration = -1
			}
			set_graphical_culture = tiefling
			add_trait = hornless
		}
		10 = {
			trigger = {
				culture = rakshasa
			}
			add_character_modifier = {
				name = rakshasa_tiefling
				duration = -1
			}
			set_graphical_culture = wemic
			add_trait = hornless
		}
		10 = {
			trigger = {
				OR = {
					culture = marrashi
					religion = faceless_god
				}
			}
			add_character_modifier = {
				name = marrashi_tiefling
				duration = -1
			}
			set_graphical_culture = half_gnoll
			add_trait = hornless
		}
	}
}

# Select and set one of the yuan-ti subtypes.
spawn_random_yuanti = {
	random_list = {
		75 = {
			add_trait = creature_pureblood
			if = {
				limit = { gfx_culture_scope = { evilcat_is_human_cultured = no } }
				set_graphical_culture = yuanti
			}
		}
		8 = {
			add_trait = creature_malison
			set_graphical_culture = malison
		}
		12 = {
			add_trait = creature_malison
			set_graphical_culture = halfblood
		}
		5 = {
			add_trait = creature_abomination
			set_graphical_culture = abomination
		}
	}
}

# Select and set one of the yugoloth subtypes.
spawn_random_yugoloth = {
	add_trait = creature_fiend
	random_list = {
		20 = { # Nycaloth
			set_graphical_culture = yugoloth
		}
		20 = { # Ultroloth
			set_graphical_culture = ultroloth
		}
		60 = { # Mezzoloth
			mult_modifier = {
				factor = 0.5
				OR = {
					is_ruler = yes
					has_opinion_modifier = {
						who = ROOT
						name = planar_binding_mod
					}
				}
			}
			set_graphical_culture = mezzoloth
		}
		10 = { # Hydroloth
			set_graphical_culture = kuo_toa
		}
	}
}

# Find the nearest human to base a half-human child on.
human_racial = {
	if = {
		limit = {
			mother_even_if_dead = {
				trait = creature_human
				has_undead_portrait = no
			}
		}
		mother_even_if_dead = {
			tb_graph_culture_racial = yes
		}
	}
	else_if = {
		limit = {
			true_father_even_if_dead = {
				trait = creature_human
				has_undead_portrait = no
			}
		}
		true_father_even_if_dead = {
			tb_graph_culture_racial = yes
		}
	}
	else_if = {
		limit = {
			any_close_relative = {
				trait = creature_human
				has_undead_portrait = no
			}
		}
		random_close_relative = {
			limit = {
				trait = creature_human
				has_undead_portrait = no
			}
			tb_graph_culture_racial = yes
		}
	}
	else_if = {
		limit = {
			evilcat_is_human_cultured = yes
		}
		set_graphical_culture = ROOT
	}
	else_if = {
		limit = {
			true_father_even_if_dead = { evilcat_is_human_cultured = yes }
		}
		true_father_even_if_dead = {
			ROOT = { set_graphical_culture = PREV }
		}
	}
	else_if = {
		limit = {
			mother_even_if_dead = { evilcat_is_human_cultured = yes }
		}
		mother_even_if_dead = {
			ROOT = { set_graphical_culture = PREV }
		}
	}
	else_if = {
		limit = {
			any_dynasty_member = {
				trait = creature_human
				has_undead_portrait = no
			}
		}
		random_dynasty_member = {
			limit = {
				trait = creature_human
				has_undead_portrait = no
			}
			tb_graph_culture_racial = yes
		}
	}
	else_if = {
		limit = {
			any_realm_lord = {
				trait = creature_human
				has_undead_portrait = no
			}
		}
		random_realm_lord = {
			limit = {
				trait = creature_human
				has_undead_portrait = no
			}
			tb_graph_culture_racial = yes
		}
	}
	else_if = {
		limit = {
			any_realm_province = {
				evilcat_is_human_cultured = yes
			}
		}
		random_realm_province = {
			limit = {
				evilcat_is_human_cultured = yes
			}
			ROOT = { set_graphical_culture = PREV }
		}
	}
	else_if = {
		limit = {
			any_realm_province = {
				any_neighbor_province = {
					evilcat_is_human_cultured = yes
				}
			}
		}
		random_realm_province = {
			limit = {
				any_neighbor_province = {
					evilcat_is_human_cultured = yes
				}
			}
			random_neighbor_province = {
				limit = {
					evilcat_is_human_cultured = yes
				}
				ROOT = { set_graphical_culture = PREV }
			}
		}
	}
	else = {
		random_character = {
			limit = {
				trait = creature_human
				has_undead_portrait = no
			}
			tb_graph_culture_racial = yes
		}
	}
}

# Turn a character undead and change to the matching undead graphical culture.
turn_undead_effect = {
	add_trait = undead
	if = {
		limit = {
			trait = infirm
		}
		remove_trait = infirm
	}
	hidden_effect = {
		if = {
			limit = { has_horns = yes }
			add_trait = horned
		}

		if = {
			limit = {
				OR = {
					race_is_elven = yes
					trait = creature_gnome
					trait = creature_centaur
					trait = creature_gith
					trait = creature_malenti
				}
			}
			set_graphical_culture = undeadelf
		}
		else_if = {
			limit = {
				race_is_dwarven = yes
			}
			set_graphical_culture = dwarfvampire
		}
		else_if = {
			limit = {
				OR = {
					trait = creature_naga
					trait = creature_abomination
					trait = creature_sarrukh
				}
			}
			set_graphical_culture = bone_naga
		}
		else_if = {
			limit = {
				trait = creature_giant
				NOR = {
					graphical_culture = earthtitangfx
					graphical_culture = fomoriangfx
				}
			}
			set_graphical_culture = undeadgiant
		}
		else_if = {
			limit = {
				trait = creature_ogre
			}
			set_graphical_culture = undeadogre
		}
		else_if = {
			limit = {
				OR = {
					race_is_orcish = yes
					race_is_goblinoid = yes
					trait = creature_gnoll
					trait = creature_half_gnoll
					trait = creature_kobold
					trait = creature_lizardfolk
					trait = creature_saurial
					trait = creature_sahuagin
					trait = creature_dragonborn
					trait = creature_wemic
					trait = creature_malison
				}
			}
			set_graphical_culture = undead_creature
		}
		else_if = {
			limit = {
				is_humanoid = yes
			}
			if = {
				limit = {
					OR = {
						is_lowborn = no
						is_ruler = yes
						is_special_courtier = yes
						z_has_class = yes
					}
				}
				set_graphical_culture = wight
			}
			else = {
				set_graphical_culture = undead_human
			}
		}
		else_if = {
			limit = {
				trait = creature_dragon
			}
			set_graphical_culture = dracolich
		}
	}
}

# Turn a character into a lich and change to the matching undead graphical culture.
turn_lich_effect = {
	add_artifact = lich_phylactery_artf
	if = {
		limit = {
			trait = infirm
		}
		remove_trait = infirm
	}
	hidden_effect = {
		if = {
			limit = { has_horns = yes }
			add_trait = horned
		}

		if = {
			limit = {
				NOR = {
					trait = lich
					trait = archlich
					trait = lich_baelnorn
				}
			}
			add_trait = lich
		}

		if = {
			limit = {
				OR = {
					race_is_elven = yes
					trait = creature_genasi
					trait = creature_gith
					trait = creature_centaur
					trait = creature_pureblood
					trait = creature_malenti
				}
			}
			set_graphical_culture = lichelf
		}
		else_if = {
			limit = {
				race_is_dwarven = yes
			}
			set_graphical_culture = dwarfvampire
		}
		else_if = {
			limit = {
				trait = creature_gnome
			}
			set_graphical_culture = svirfneblin
		}
		else_if = {
			limit = {
				OR = {
					trait = creature_naga
					trait = creature_abomination
					trait = creature_sarrukh
				}
			}
			set_graphical_culture = bone_naga
		}
		else_if = {
			limit = {
				trait = creature_giant
				NOR = {
					graphical_culture = earthtitangfx
					graphical_culture = fomoriangfx
				}
			}
			set_graphical_culture = undeadgiant
		}
		else_if = {
			limit = {
				trait = creature_ogre
			}
			set_graphical_culture = undeadogre
		}
		else_if = {
			limit = {
				OR = {
					race_is_orcish = yes
					race_is_goblinoid = yes
					trait = creature_gnoll
					trait = creature_half_gnoll
					trait = creature_kobold
					trait = creature_lizardfolk
					trait = creature_saurial
					trait = creature_sahuagin
					trait = creature_dragonborn
					trait = creature_wemic
					trait = creature_malison
				}
			}
			set_graphical_culture = undead_creature
		}
		else_if = {
			limit = {
				is_humanoid = yes
			}
			set_graphical_culture = lich
		}
		else_if = {
			limit = {
				trait = creature_dragon
			}
			set_graphical_culture = dracolich
		}
	}
}

# Turn a character into a vampire and change to the matching undead graphical culture.
turn_vampire_effect = {
	if = {
		limit = {
			trait = infirm
		}
		remove_trait = infirm
	}
	hidden_effect = {
		if = {
			limit = {
				NOR = {
					trait = vampire
					trait = vampire_spawn
				}
			}
			add_trait = vampire
		}

		update_hidden_modifiers = yes

		if = {
			limit = { has_horns = yes }
			add_trait = horned
		}

		if = {
			limit = {
				OR = {
					race_is_elven = yes
					trait = creature_genasi
					trait = creature_gith
					trait = creature_centaur
					trait = creature_malenti
				}
			}
			set_graphical_culture = undeadelf
		}
		else_if = {
			limit = {
				race_is_dwarven = yes
			}
			set_graphical_culture = dwarfvampire
		}
		else_if = {
			limit = {
				trait = creature_gnome
			}
			set_graphical_culture = svirfneblin
		}
		else_if = {
			limit = {
				OR = {
					trait = creature_naga
					trait = creature_abomination
					trait = creature_sarrukh
				}
			}
			set_graphical_culture = bone_naga
		}
		else_if = {
			limit = {
				trait = creature_giant
				NOR = {
					graphical_culture = earthtitangfx
					graphical_culture = fomoriangfx
				}
			}
			set_graphical_culture = undeadgiant
		}
		else_if = {
			limit = {
				trait = creature_ogre
			}
			set_graphical_culture = undeadogre
		}
		else_if = {
			limit = {
				OR = {
					race_is_orcish = yes
					race_is_goblinoid = yes
					trait = creature_gnoll
					trait = creature_half_gnoll
					trait = creature_kobold
					trait = creature_lizardfolk
					trait = creature_saurial
					trait = creature_sahuagin
					trait = creature_dragonborn
					trait = creature_wemic
					trait = creature_malison
				}
			}
			set_graphical_culture = undead_creature
		}
		else_if = {
			limit = {
				is_humanoid = yes
			}
			set_graphical_culture = vampire
		}
	}
}

# Add freckles to new characters.
set_freckles_effect = {
	if = {
		limit = {
			OR = {
				race_is_part_human = yes
				race_is_elven = yes
				race_is_dwarven = yes
				race_is_orcish = yes
				race_is_giantkin = yes
				race_is_ogrekin = yes
				trait = creature_pureblood
				trait = creature_gnome
				trait = creature_halfling
				trait = creature_centaur
				trait = creature_satyr
				trait = creature_wemic
				trait = creature_hag
			}
		}
		random_list = {
			2 = { add_trait = freckles_5 }
			6 = { add_trait = freckles_4 }
			7 = { add_trait = freckles }
			7 = { add_trait = freckles_2 }
			10 = { add_trait = freckles_3 }
			4500 = {
				modifier = {
					factor = 0.02
					graphical_culture = ffolkgfx
				}
				modifier = {
					factor = 0.03
					OR = {
						graphical_culture = northlandergfx
						graphical_culture = lantannagfx
					}
				}
				modifier = {
					factor = 0.04
					OR = {
						graphical_culture = highcoastergfx
						graphical_culture = reghedgfx
						graphical_culture = aasimargfx
					}
				}
				modifier = {
					factor = 0.06
					OR = {
						graphical_culture = tethyriangfx
						graphical_culture = hobbitsgfx
						graphical_culture = dwarfgfx
						graphical_culture = norsedwarfgfx
						graphical_culture = satyrgfx
					}
				}
				modifier = {
					factor = 0.08
					OR = {
						graphical_culture = cormyreangfx
						graphical_culture = westerngfx
						graphical_culture = gnomesgfx
					}
				}
				modifier = {
					factor = 0.1
					OR = {
						graphical_culture = illuskangfx
						graphical_culture = uthgardtgfx
						graphical_culture = southerngfx
						graphical_culture = asraigfx
					}
				}
				modifier = {
					factor = 0.2
					OR = {
						graphical_culture = draevengfx
						graphical_culture = golddwarfgfx
						graphical_culture = wilddwarfgfx
						graphical_culture = centaurgfx
						graphical_culture = woodgiantgfx
					}
				}
				modifier = {
					factor = 0.5
					OR = {
						graphical_culture = chondathangfx
						graphical_culture = dalesmengfx
						graphical_culture = moonelfgfx
						graphical_culture = greenelfgfx
						graphical_culture = giantgfx
						graphical_culture = halfwoodelfgfx
						graphical_culture = halfgreenelfgfx
						graphical_culture = devaasimargfx
						graphical_culture = caledoriangfx
					}
				}
				modifier = {
					factor = 0.75
					OR = {
						graphical_culture = westernslavicgfx
						graphical_culture = croatsouthslavicgfx
						graphical_culture = serbsouthslavicgfx
						graphical_culture = calishitegfx
						graphical_culture = netheresegfx
						graphical_culture = ulutiungfx
						graphical_culture = halfsunelfgfx
						graphical_culture = halfmoonelfgfx
						graphical_culture = halfseaelfgfx
						graphical_culture = halfeladringfx
						graphical_culture = greenaasimargfx
					}
				}
			}
		}
	}
}

aasimar_race_inheritance = { # Set on the aasimar themselves, will check their parents and some other stuff.
	add_trait = creature_aasimar
	if = {
		limit = {
			OR = {
				true_father_even_if_dead = {
					graphical_culture = planetargfx
				}
				mother_even_if_dead = {
					graphical_culture = planetargfx
				}
			}
		}
		set_graphical_culture = planetar_aasimar
	}
	else_if = {
		limit = {
			OR = {
				true_father_even_if_dead = {
					graphical_culture = houndgfx
				}
				mother_even_if_dead = {
					graphical_culture = houndgfx
				}
			}
		}
		set_graphical_culture = dog_culture
	}
	else_if = {
		limit = {
			OR = {
				true_father_even_if_dead = {
					graphical_culture = wardengfx
				}
				mother_even_if_dead = {
					graphical_culture = wardengfx
				}
			}
		}
		set_graphical_culture = guardinal
	}
	else_if = {
		limit = {
			OR = {
				true_father_even_if_dead = {
					graphical_culture = asuragfx
				}
				mother_even_if_dead = {
					graphical_culture = asuragfx
				}
			}
		}
		set_graphical_culture = deva_aasimar
	}
	else_if = {
		limit = {
			OR = {
				true_father_even_if_dead = {
					graphical_culture = celestialeladringfx
				}
				mother_even_if_dead = {
					graphical_culture = celestialeladringfx
				}
			}
		}
		set_graphical_culture = eladrin_aasimar
	}
	else_if = {
		limit = {
			OR = {
				true_father_even_if_dead = {
					graphical_culture = einheriargfx
				}
				mother_even_if_dead = {
					graphical_culture = einheriargfx
				}
			}
		}
		set_graphical_culture = einheriar
	}
	else_if = {
		limit = {
			OR = {
				true_father_even_if_dead = {
					graphical_culture = moonmaidengfx
				}
				mother_even_if_dead = {
					graphical_culture = moonmaidengfx
				}
			}
		}
		set_graphical_culture = moonmaiden
	}
	else_if = {
		limit = {
			OR = {
				true_father_even_if_dead = {
					race_part_animal = yes
				}
				mother_even_if_dead = {
					race_part_animal = yes
				}
			}
		}
		spawn_random_ardling = yes
	}
	else = {
		set_graphical_culture = aasimar
		random = {
			chance = 10
			set_graphical_culture = deva_aasimar
		}
	}
}

goliath_race_inheritance = {
	set_graphical_culture = half_giant
	random_list = {
		2 = {
			trigger = {
				OR = {
					true_father_even_if_dead = {
						OR = {
							graphical_culture = stormgoliathgfx
							graphical_culture = watergenasigfx
						}
					}
					mother_even_if_dead = {
						OR = {
							graphical_culture = stormgoliathgfx
							graphical_culture = watergenasigfx
						}
					}
				}
			}
			set_graphical_culture = storm_goliath
		}
		2 = {
			trigger = {
				OR = {
					true_father_even_if_dead = {
						OR = {
							graphical_culture = cloudgoliathgfx
							graphical_culture = airgenasigfx
						}
					}
					mother_even_if_dead = {
						OR = {
							graphical_culture = cloudgoliathgfx
							graphical_culture = airgenasigfx
						}
					}
				}
			}
			set_graphical_culture = cloud_goliath
		}
		2 = {
			trigger = {
				OR = {
					true_father_even_if_dead = {
						OR = {
							graphical_culture = goliathgfx
							graphical_culture = earthgenasigfx
						}
					}
					mother_even_if_dead = {
						OR = {
							graphical_culture = goliathgfx
							graphical_culture = earthgenasigfx
						}
					}
				}
			}
			set_graphical_culture = goliath
		}
		2 = {
			trigger = {
				OR = {
					true_father_even_if_dead = {
						OR = {
							graphical_culture = firegoliathgfx
							graphical_culture = firegenasigfx
						}
					}
					mother_even_if_dead = {
						OR = {
							graphical_culture = firegoliathgfx
							graphical_culture = firegenasigfx
						}
					}
				}
			}
			set_graphical_culture = fire_goliath
		}
		2 = {
			trigger = {
				OR = {
					true_father_even_if_dead = {
						OR = {
							graphical_culture = frostgoliathgfx
							graphical_culture = watergenasigfx
						}
					}
					mother_even_if_dead = {
						OR = {
							graphical_culture = frostgoliathgfx
							graphical_culture = watergenasigfx
						}
					}
				}
			}
			set_graphical_culture = frost_goliath
		}
		2 = {
			trigger = {
				OR = {
					true_father_even_if_dead = {
						OR = {
							graphical_culture = halfgiantgfx
							graphical_culture = halfogregfx
						}
					}
					mother_even_if_dead = {
						OR = {
							graphical_culture = halfgiantgfx
							graphical_culture = halfogregfx
						}
					}
				}
			}
			set_graphical_culture = half_giant
		}
		1 = {
			trigger = {
				OR = {
					true_father_even_if_dead = {
						trait = creature_human
					}
					mother_even_if_dead = {
						trait = creature_human
					}
				}
			}
			set_graphical_culture = half_giant
		}
		8 = {
			trigger = {
				OR = {
					true_father_even_if_dead = {
						OR = {
							graphical_culture = stormgiantgfx
							graphical_culture = watergeniegfx
						}
					}
					mother_even_if_dead = {
						OR = {
							graphical_culture = stormgiantgfx
							graphical_culture = watergeniegfx
						}
					}
				}
			}
			set_graphical_culture = storm_goliath
		}
		8 = {
			trigger = {
				OR = {
					true_father_even_if_dead = {
						OR = {
							graphical_culture = cloudgiantgfx
							graphical_culture = airgeniegfx
						}
					}
					mother_even_if_dead = {
						OR = {
							graphical_culture = cloudgiantgfx
							graphical_culture = airgeniegfx
						}
					}
				}
			}
			set_graphical_culture = cloud_goliath
		}
		8 = {
			trigger = {
				OR = {
					true_father_even_if_dead = {
						OR = {
							graphical_culture = stonegiantgfx
							graphical_culture = ashgiantgfx
							graphical_culture = earthtitangfx
							graphical_culture = earthgeniegfx
							gfx_culture_scope = { culture = brown_dragon }
						}
					}
					mother_even_if_dead = {
						OR = {
							graphical_culture = stonegiantgfx
							graphical_culture = ashgiantgfx
							graphical_culture = earthtitangfx
							graphical_culture = earthgeniegfx
							gfx_culture_scope = { culture = brown_dragon }
						}
					}
				}
			}
			set_graphical_culture = goliath
		}
		8 = {
			trigger = {
				OR = {
					true_father_even_if_dead = {
						OR = {
							graphical_culture = firegiantgfx
							graphical_culture = firegeniegfx
							graphical_culture = fireprimordialgfx
							graphical_culture = balorgfx
							gfx_culture_scope = { culture = red_dragon }
						}
					}
					mother_even_if_dead = {
						OR = {
							graphical_culture = firegiantgfx
							graphical_culture = firegeniegfx
							graphical_culture = fireprimordialgfx
							graphical_culture = balorgfx
							gfx_culture_scope = { culture = red_dragon }
						}
					}
				}
			}
			set_graphical_culture = fire_goliath
		}
		8 = {
			trigger = {
				OR = {
					true_father_even_if_dead = {
						OR = {
							graphical_culture = frostgiantgfx
							graphical_culture = watergeniegfx
							graphical_culture = xixecalgfx
							graphical_culture = qorrashigfx
							graphical_culture = gelugongfx
							gfx_culture_scope = { culture = white_dragon }
						}
					}
					mother_even_if_dead = {
						OR = {
							graphical_culture = frostgiantgfx
							graphical_culture = watergeniegfx
							graphical_culture = xixecalgfx
							graphical_culture = qorrashigfx
							graphical_culture = gelugongfx
							gfx_culture_scope = { culture = white_dragon }
						}
					}
				}
			}
			set_graphical_culture = frost_goliath
		}
		4 = {
			trigger = {
				OR = {
					true_father_even_if_dead = {
						OR = {
							graphical_culture = giantgfx
							graphical_culture = woodgiantgfx
							graphical_culture = desertgiantgfx
							graphical_culture = junglegiantgfx
							graphical_culture = reefgiantgfx
						}
					}
					mother_even_if_dead = {
						OR = {
							graphical_culture = giantgfx
							graphical_culture = woodgiantgfx
							graphical_culture = desertgiantgfx
							graphical_culture = junglegiantgfx
							graphical_culture = reefgiantgfx
						}
					}
				}
			}
			set_graphical_culture = half_giant
		}
		4 = {
			trigger = {
				OR = {
					true_father_even_if_dead = {
						OR = {
							trait = creature_ogre
							trait = creature_ogrillon
							trait = creature_minotaur
							graphical_culture = cyclopsgfx
							graphical_culture = fomoriangfx
						}
					}
					mother_even_if_dead = {
						OR = {
							trait = creature_ogre
							trait = creature_ogrillon
							trait = creature_minotaur
							graphical_culture = cyclopsgfx
							graphical_culture = fomoriangfx
						}
					}
				}
			}
			set_graphical_culture = half_ogre
		}
	}
}

tiefling_race_inheritance = { # Set on the tiefling themselves, will check their parents and some other stuff.
	add_trait = creature_tiefling
	if = {
		limit = {
			OR = {
				true_father_even_if_dead = {
					trait = creature_fiend
					OR = {
						graphical_culture = nycalothgfx
						graphical_culture = nurgleprincegfx
						graphical_culture = nalfeshneegfx
						graphical_culture = ultrolothgfx
						graphical_culture = mezzolothgfx
						graphical_culture = slanngfx
						graphical_culture = flamergfx
					}
				}
				mother_even_if_dead = {
					trait = creature_fiend
					OR = {
						graphical_culture = nycalothgfx
						graphical_culture = nurgleprincegfx
						graphical_culture = nalfeshneegfx
						graphical_culture = ultrolothgfx
						graphical_culture = mezzolothgfx
						graphical_culture = slanngfx
						graphical_culture = flamergfx
					}
				}
			}
		}
		set_graphical_culture = cambion
	}
	else_if = {
		limit = {
			OR = {
				true_father_even_if_dead = {
					graphical_culture = daemonettegfx
				}
				mother_even_if_dead = {
					graphical_culture = daemonettegfx
				}
			}
		}
		if = {
			limit = {
				mother_even_if_dead = { NOT = { trait = creature_fiend } }
			}
			mother_even_if_dead = {
				tb_graph_culture_racial = yes
			}
		}
		else = {
			true_father_even_if_dead = {
				tb_graph_culture_racial = yes
			}
		}
	}
	else_if = {
		limit = {
			OR = {
				true_father_even_if_dead = {
					graphical_culture = rakshasagfx
				}
				mother_even_if_dead = {
					graphical_culture = rakshasagfx
				}
			}
		}
		set_graphical_culture = wemic
	}
	else_if = {
		limit = {
			OR = {
				true_father_even_if_dead = {
					graphical_culture = marrashgfx
				}
				mother_even_if_dead = {
					graphical_culture = marrashgfx
				}
			}
		}
		set_graphical_culture = half_gnoll
	}
	else = {
		set_graphical_culture = tiefling
	}
}

set_genasi_subtype = {
	random_list = {
		1 = {
			trigger = {
				OR = {
					has_character_modifier = fire_genasi
					has_character_modifier = magma_genasi
					has_character_modifier = smoke_genasi
					has_character_modifier = steam_genasi
				}
			}
			set_graphical_culture = firegenasi
		}
		1 = {
			trigger = {
				OR = {
					has_character_modifier = air_genasi
					has_character_modifier = dust_genasi
					has_character_modifier = smoke_genasi
					has_character_modifier = ice_genasi
				}
			}
			set_graphical_culture = airgenasi
		}
		1 = {
			trigger = {
				OR = {
					has_character_modifier = water_genasi
					has_character_modifier = ice_genasi
					has_character_modifier = ooze_genasi
					has_character_modifier = steam_genasi
				}
			}
			set_graphical_culture = watergenasi
		}
		1 = {
			trigger = {
				OR = {
					has_character_modifier = earth_genasi
					has_character_modifier = magma_genasi
					has_character_modifier = dust_genasi
					has_character_modifier = ooze_genasi
				}
			}
			set_graphical_culture = earthgenasi
		}
	}
}

# Recalculate hidden combat strength modifiers.
update_hidden_modifiers = {
	hidden_effect = {
		remove_character_modifiers = {
			name = hidden_strength
			amount = 99
		}
		set_variable = {
			which = local_hiddenstrength
			value = 0
		}

		trigger_switch = {
			on_trigger = trait

			vampire = {
				change_variable = {
					which = local_hiddenstrength
					value = 2
				}
			}
			vampire_spawn = {
				change_variable = {
					which = local_hiddenstrength
					value = 1
				}
			}
		}
		trigger_switch = {
			on_trigger = trait

			werewolf = {
				change_variable = {
					which = local_hiddenstrength
					value = 7
				}
			}
			wererat = {
				change_variable = {
					which = local_hiddenstrength
					value = 5
				}
			}
			weretiger = {
				change_variable = {
					which = local_hiddenstrength
					value = 10
				}
			}
			werecrocodile = {
				change_variable = {
					which = local_hiddenstrength
					value = 10
				}
			}
		}
		if = {
			limit = {
				OR = {
					society_member_of = eldreth_veluuthra
					society_member_of = everlasting
				}
			}
			if = {
				limit = { society_rank == 1 }
				change_variable = {
					which = local_hiddenstrength
					value = 1
				}
			}
			else_if = {
				limit = { society_rank == 2 }
				change_variable = {
					which = local_hiddenstrength
					value = 3
				}
			}
			else_if = {
				limit = { society_rank == 3 }
				change_variable = {
					which = local_hiddenstrength
					value = 6
				}
			}
			else_if = {
				limit = { society_rank == 4 }
				change_variable = {
					which = local_hiddenstrength
					value = 10
				}
			}
		}
		if = {
			limit = { has_character_modifier = vampire_blood_fed }
			change_variable = {
				which = local_hiddenstrength
				value = 5
			}
		}
		if = {
			limit = { has_character_modifier = shadow_telflamm_walker_modifier }
			change_variable = {
				which = local_hiddenstrength
				value = 10
			}
		}
		if = {
			limit = { has_character_modifier = fighter_combat5 }
			change_variable = {
				which = local_hiddenstrength
				value = 5
			}
		}
		if = {
			limit = { has_character_modifier = fighter_combat10 }
			change_variable = {
				which = local_hiddenstrength
				value = 10
			}
		}
		if = {
			limit = { has_character_modifier = hardened_resolve }
			change_variable = {
				which = local_hiddenstrength
				value = 5
			}
		}

		while = {
			limit = {
				check_variable = {
					which = local_hiddenstrength
					value > 0
				}
			}
			subtract_variable = {
				which = local_hiddenstrength
				value = 1
			}
			add_character_modifier = {
				name = hidden_strength
				duration = -1
				stacking = yes
				hidden = yes
			}
		}
	}
}

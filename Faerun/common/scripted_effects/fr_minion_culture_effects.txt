# PREV is a character
change_province_culture_to_PREV_effect = {
	if = {
		limit = { PREV = { culture_group = fiendish_group } }

		change_province_culture_to_fiendish_effect = yes
	}
	else_if = {
		limit = { PREV = { culture_group = draconic_culture_group } }

		change_province_culture_to_draconic_effect = yes
	}
	else = {
		culture = PREV
	}
	refresh_minion_culture_province_modifiers_effect = yes
}

change_province_culture_to_fiendish_effect = {
	if = {
		limit = { culture_group = orc_group }

		culture = tanarukk
	}
	else_if = {
		limit = { 
			OR = {
				culture_group = high_elf_group
				culture_group = sylvan_elf_group
				culture_group = eladrin_group
			}
		}

		culture = feyri
	}
	else_if = {
		limit = { culture_group = dark_elf_group }

		culture = draegloth
	}
	else_if = {
		limit = { culture_group = plant_group }

		culture = blight
	}
	else = {
		culture = tiefling
	}
}

change_province_culture_to_draconic_effect = {
	if = {
		limit = { owner = { persistent_event_target:minion_culture_primary_persist = { always = yes } } }

		custom_tooltip = {
			text = PROVINCE_CHANGES_TO_PRIMARY_MINION

			owner = { persistent_event_target:minion_culture_primary_persist = { save_event_target_as = culture_source } }
			culture = event_target:culture_source
			clear_event_target = culture_source
		}
	}
	else = {
		culture = kobold
	}
}

remove_minion_culture_province_modifiers_effect = {
	if = { limit = { has_province_modifier = minion_culture_fiend_modifier } remove_province_modifier = minion_culture_fiend_modifier }
	if = { limit = { has_province_modifier = minion_culture_dragon_modifier } remove_province_modifier = minion_culture_dragon_modifier }
	if = { limit = { has_province_modifier = minion_culture_celestial_modifier } remove_province_modifier = minion_culture_celestial_modifier }
}

add_minion_culture_province_modifiers_effect = {
	if = {
		limit = {
			owner = { 
				trait = creature_fiend 
				culture_group = fiendish_group
			}
			is_minion_culture_for_fiend_trigger = yes
		}

		add_province_modifier = {
			name = minion_culture_fiend_modifier
			duration = -1
		}
	}
	else_if = {
		limit = {
			owner = { 
				trait = creature_dragon
				culture_group = draconic_culture_group
				is_master_dragon_for_PREV_trigger = yes
			}
		}

		add_province_modifier = {
			name = minion_culture_dragon_modifier
			duration = -1
		}
	}
	else_if = {
		limit = {
			owner = { 
				trait = creature_celestial
				culture_group = celestial_group
				olrox_is_good_religion_trigger = yes
			}
			is_minion_culture_for_celestial_trigger = yes
		}

		add_province_modifier = {
			name = minion_culture_celestial_modifier
			duration = -1
		}
	}
}

refresh_minion_culture_province_modifiers_effect = {
	hidden_effect = {
		remove_minion_culture_province_modifiers_effect = yes
		add_minion_culture_province_modifiers_effect = yes
	}
}

minion_culture_maint_dragon_effect = {
	if = {
		limit = { trait = creature_dragon culture_group = draconic_culture_group }

		if = {
			limit = { persistent_event_target:minion_culture_primary_persist = { always = yes ROOT = { is_master_dragon_for_PREV_trigger = no } } }

			clear_persistent_event_target = minion_culture_primary_persist
		}

		if = {
			limit = { persistent_event_target:minion_culture_1_persist = { always = yes ROOT = { is_innate_master_dragon_for_PREV_trigger = yes } } }

			clear_persistent_event_target = minion_culture_1_persist
		}
		if = {
			limit = { persistent_event_target:minion_culture_2_persist = { always = yes ROOT = { is_innate_master_dragon_for_PREV_trigger = yes } } }

			clear_persistent_event_target = minion_culture_2_persist
		}
		if = {
			limit = { persistent_event_target:minion_culture_3_persist = { always = yes ROOT = { is_innate_master_dragon_for_PREV_trigger = yes } } }

			clear_persistent_event_target = minion_culture_3_persist
		}

		if = {
			limit = { 
				OR = {
					is_save_game = no
					ai = yes
				}
			}

			capital_scope = {
				culture_scope = {
					ROOT = {
						if = {
							limit = { 
								is_master_dragon_for_PREV_trigger = no 
								trigger_if = {
									limit = {
										is_save_game = yes
										ai = yes
									}
									
									prestige >= 1000
								}
							}

							if = {
								limit = {
									OR = {
										NOT = { persistent_event_target:minion_culture_1_persist = { always = yes } }
										AND = {
											persistent_event_target:minion_culture_1_persist = { always = yes }
											persistent_event_target:minion_culture_2_persist = { always = yes }
											persistent_event_target:minion_culture_3_persist = { always = yes }
										}
										NOR = {
											trait = dragon_adult
											trait = dragon_ancient
										}
									}
								}

								save_persistent_event_target = {
									name = minion_culture_1_persist
									scope = PREV
								}
							}
							else_if = {
								limit = { 
									OR = {
										NOT = { persistent_event_target:minion_culture_2_persist = { always = yes } } 
										NOT = { trait = dragon_ancient }
									}
								}

								save_persistent_event_target = {
									name = minion_culture_2_persist
									scope = PREV
								}
							}
							else = {
								save_persistent_event_target = {
									name = minion_culture_3_persist
									scope = PREV
								}
							}

							if = {
								limit = {
									is_save_game = yes
									ai = yes
								}

								prestige = -1000
							}		
						}
					}
				}
			}

			if = {
				limit = {
					trigger_if = {
						limit = { persistent_event_target:minion_culture_primary_persist = { always = yes } }

						persistent_event_target:minion_culture_primary_persist = {
							ROOT = {
								capital_scope = {
									NOT = { culture = PREVPREV }
									ROOT = {
										is_master_dragon_for_PREV_trigger = yes
									}
								}
							}
						}
					}
					trigger_else = {
						ROOT = {
							capital_scope = {
								ROOT = {
									is_master_dragon_for_PREV_trigger = yes
								}
							}
						}
					}
					
				}

				capital_scope = {
					culture_scope = {
						ROOT = {
							save_persistent_event_target = {
								name = minion_culture_primary_persist
								scope = PREV
							}
						}
					}
				}
			}
			else_if = {
				limit = {
					OR = {
						NOT = { persistent_event_target:minion_culture_primary_persist = { always = yes } }

						persistent_event_target:minion_culture_primary_persist = {
							ROOT = {
								capital_scope = {
									ROOT = {
										is_master_dragon_for_PREV_trigger = no
									}
								}
							}
							NOT = { culture = kobold }
						}
					}
				}

				kobold = {
					ROOT = {
						save_persistent_event_target = {
							name = minion_culture_primary_persist
							scope = PREV
						}
					}
				}
			}
		}
	}
}
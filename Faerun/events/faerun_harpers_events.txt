namespace = HRP

#################################DECISIONS######################################

# support people
	character_event = {
		id = HRP.100
		desc = EVTDESC_HRP_100
		picture = GFX_evt_noble_in_castle

		is_triggered_only = yes

		# Tax discount on random demesne province
		option = {
			name = EVTOPTA_HRP_100

			ai_chance = {
				factor = 100
			}

			trigger = {
				event_target:tax_discount_target = { always = yes }
			}

			character_event = {	id = HRP.101 }
	  }
	}

	# Tax Discount on Demesne Province
	character_event = {
		id = HRP.101
		desc = EVTDESC_HRP_101
		picture = GFX_evt_noble_haughty_talking_to_peasants

		is_triggered_only = yes

		# first option High stewardship can trade vassal opinion for less sacrifice
		option = {
			name = EVTOPTA_HRP_101
			tooltip_info = stewardship
			trigger = {
				stewardship = 15
			}
			if = {
				limit = {
					trait = cruel
				}
				remove_trait = cruel
				add_trait = stressed
			}
			any_vassal = {
	      opinion = {
	        modifier = opinion_disappointed
	        who = FROM
	        years = 5
	      }
	    }
			event_target:tax_discount_target = {
				show_scope_change = no
				add_province_modifier = {
					modifier = support_people_sneaky
					duration = 1825
				}
			}
	    custom_tooltip = {
	      text = increase_prosperity_harper_tooltip
	      hidden_tooltip = {
	        event_target:tax_discount_target = {
	          change_variable = { which = prosperity_value value = 15 }
	        }
	      }
	    }
		}
		# second option straight up tax concession
		option = {
			name = EVTOPTB_HRP_101
			if = {
				limit = {
					trait = cruel
				}
				remove_trait = cruel
				add_trait = stressed
			}
			else_if = {
				limit = {
					trait = greedy
				}
				remove_trait = greedy
				add_trait = stressed
			}
			event_target:tax_discount_target = {
				show_scope_change = no
				add_province_modifier = {
					modifier = support_people_direct
					duration = 1825
				}
			}
	    custom_tooltip = {
	      text = increase_prosperity_harper_tooltip
	      hidden_tooltip = {
	        event_target:tax_discount_target = {
	          change_variable = { which = prosperity_value value = 15 }
	        }
	      }
	    }
		}
	  # third option High diplomacy fundraising
	  option = {
	    name = EVTOPTC_HRP_101
	    tooltip_info = diplomacy
	    trigger = {
	      diplomacy = 18
	    }
			if = {
				limit = {
					trait = cruel
				}
				remove_trait = cruel
				add_trait = stressed
			}
	    event_target:tax_discount_target = {
				show_scope_change = no
	      add_province_modifier = {
	        modifier = support_people_fundraising
	        duration = 1825
	      }
	    }
	    custom_tooltip = {
	      text = increase_prosperity_harper_tooltip
	      hidden_tooltip = {
	        event_target:tax_discount_target = {
	          change_variable = { which = prosperity_value value = 15 }
	        }
	      }
	    }
	  }
	}

# start sponsoring arts
	character_event = {
		id = HRP.200
		desc = EVTDESC_HRP_200
		picture = GFX_evt_market

		is_triggered_only = yes

		immediate  = {
			capital_scope = {
				add_province_modifier = {
					name = tribal_festival_modifier
					months = 5
				}
			}
		}

		# Circus
		option = {
			name = EVTOPTA_HRP_200

			add_character_modifier = {
				modifier = friendly_circuses
				duration = 1825
			}

			character_event = { id = HRP.201 days = 14 }
	  }
		# Artists
		option = {
			name = EVTOPTB_HRP_200

			add_character_modifier = {
				modifier = friendly_artists
				duration = 1825
			}

			character_event = { id = HRP.203 days = 14 }
	  }
		# Scholars
		option = {
			name = EVTOPTC_HRP_200

			add_character_modifier = {
				modifier = friendly_scholars
				duration = 1825
			}

			character_event = { id = HRP.205 days = 14 }
	  }
	}

	# circus 1
	character_event = {
		id = HRP.201
		desc = EVTDESC_HRP_201
		picture = GFX_evt_jugglers

		is_triggered_only = yes

		# make contacts
		option = {
			name = EVTOPTA_HRP_201

			add_character_modifier = {
				modifier = contacts_circuses
				duration = 1825
			}

			character_event = { id = HRP.202 days = 20 }
	  }
		# have fun
		option = {
			name = EVTOPTB_HRP_201

			add_character_modifier = {
				modifier = fun_circuses
				duration = 1825
			}

			character_event = { id = HRP.202 days = 20 }
	  }
	}

	# circus 2
	character_event = {
		id = HRP.202
		desc = EVTDESC_HRP_202
		picture = GFX_evt_jugglers

		is_triggered_only = yes

		# let them go
		option = {
			name = EVTOPTA_HRP_202

			add_character_modifier = {
				modifier = network_circuses
				duration = 1825
			}
			character_event = { id = HRP.207 days = 7 }
	  }
		# keep them around
		option = {
			name = EVTOPTB_HRP_202

			add_character_modifier = {
				modifier = homeland_circuses
				duration = 1825
			}
			character_event = { id = HRP.207 days = 7 }
	  }
	}

	# art 1
	character_event = {
		id = HRP.203
		desc = EVTDESC_HRP_203
		picture = GFX_evt_feast

		is_triggered_only = yes

		# beauty
		option = {
			name = EVTOPTA_HRP_203

			add_character_modifier = {
				modifier = beauty_artists
				duration = 1825
			}

			character_event = { id = HRP.204 days = 20 }
	  }
		# architecture
		option = {
			name = EVTOPTB_HRP_203

			add_character_modifier = {
				modifier = buildings_artists
				duration = 1825
			}

			character_event = { id = HRP.204 days = 20 }
	  }
	}

	# art 2
	character_event = {
		id = HRP.204
		desc = EVTDESC_HRP_204
		picture = GFX_evt_feast

		is_triggered_only = yes

		# share art
		option = {
			name = EVTOPTA_HRP_204

			add_character_modifier = {
				modifier = share_artists
				duration = 1825
			}
			character_event = { id = HRP.207 days = 7 }
	  }
		# keep art
		option = {
			name = EVTOPTB_HRP_204

			add_character_modifier = {
				modifier = keep_artists
				duration = 1825
			}
			character_event = { id = HRP.207 days = 7 }
	  }
	}

	# scholar 1
	character_event = {
		id = HRP.205
		desc = EVTDESC_HRP_205
		picture = GFX_evt_gathering_of_minds

		is_triggered_only = yes

		# research
		option = {
			name = EVTOPTA_HRP_205

			add_character_modifier = {
				modifier = researcher_scholars
				duration = 1825
			}

			character_event = { id = HRP.206 days = 20 }
	  }
		# literature
		option = {
			name = EVTOPTB_HRP_205

			add_character_modifier = {
				modifier = history_scholars
				duration = 1825
			}

			character_event = { id = HRP.206 days = 20 }
	  }
	}

	# scholar 2
	character_event = {
		id = HRP.206
		desc = EVTDESC_HRP_206
		picture = GFX_evt_gathering_of_minds

		is_triggered_only = yes

		# research
		option = {
			name = EVTOPTA_HRP_206

			add_character_modifier = {
				modifier = employ_scholars
				duration = 1825
			}
			character_event = { id = HRP.207 days = 7 }
	  }
		# literature
		option = {
			name = EVTOPTB_HRP_206

			add_character_modifier = {
				modifier = monetizing_scholars
				duration = 1825
			}
			character_event = { id = HRP.207 days = 7 }
	  }
	}

	# festival ends
	character_event = {
		id = HRP.207
		desc = EVTDESC_HRP_207
		picture = GFX_evt_market

		is_triggered_only = yes

		# end prosperity
		option = {
			name = EVTOPTA_HRP_207
			custom_tooltip = {
				text = capital_prospers_custom_tooltip
				hidden_tooltip = {
					capital_scope = {
						change_variable = { which = prosperity_value value = 10 }
					}
				}
			}
	  }
	}

# harper training
	character_event = {
		id = HRP.300
		desc = EVTDESC_HRP_300
		picture = GFX_evt_melee

		is_triggered_only = yes

		# twenty xp
		option = {
			name = EVTOPTA_HRP_300
			if = {
				limit = {
					z_barbarian = yes
					NOT = { trait = legendary_barbarian }
				}
				hidden_tooltip = {
					change_variable = { which = barbarian_xp value = 20 }
				}
			}
			if = {
				limit = {
					z_bard = yes
					NOT = { trait = legendary_bard }
				}
				hidden_tooltip = {
					change_variable = { which = bard_xp value = 20 }
				}
			}
			if = {
				limit = {
					z_cleric = yes
					NOT = { trait = legendary_cleric }
				}
				hidden_tooltip = {
					change_variable = { which = cleric_xp value = 20 }
				}
			}
			if = {
				limit = {
					z_druid = yes
					NOT = { trait = legendary_druid }
				}
				hidden_tooltip = {
					change_variable = { which = druid_xp value = 20 }
				}
			}
			if = {
				limit = {
					z_fighter = yes
					NOT = { trait = legendary_fighter }
				}
				hidden_tooltip = {
					change_variable = { which = fighter_xp value = 20 }
				}
			}
			if = {
				limit = {
					z_monk = yes
					NOT = { trait = legendary_monk }
				}
				hidden_tooltip = {
					change_variable = { which = monk_xp value = 20 }
				}
			}
			if = {
				limit = {
					z_paladin = yes
					NOT = { trait = legendary_paladin }
				}
				hidden_tooltip = {
					change_variable = { which = paladin_xp value = 20 }
				}
			}
			if = {
				limit = {
					z_ranger = yes
					NOT = { trait = legendary_ranger }
				}
				hidden_tooltip = {
					change_variable = { which = ranger_xp value = 20 }
				}
			}
			if = {
				limit = {
					z_rogue = yes
					NOT = { trait = legendary_rogue }
				}
				hidden_tooltip = {
					change_variable = { which = rogue_xp value = 20 }
				}
			}
			if = {
				limit = {
					z_shadow = yes
					NOT = { trait = legendary_shadow }
				}
				hidden_tooltip = {
					change_variable = { which = shadow_xp value = 20 }
				}
			}
			if = {
				limit = {
					z_sorcerer = yes
					NOT = { trait = legendary_sorcerer }
				}
				hidden_tooltip = {
					change_variable = { which = sorcerer_xp value = 20 }
				}
			}
			if = {
				limit = {
					z_warlock = yes
					NOT = { trait = legendary_warlock }
				}
				hidden_tooltip = {
					change_variable = { which = warlock_xp value = 20 }
				}
			}
			if = {
				limit = {
					z_wizard = yes
					NOT = { trait = legendary_wizard }
				}
				hidden_tooltip = {
					change_variable = { which = wizard_xp value = 20 }
				}
			}
			if = {
				limit = {
					z_psion = yes
					NOT = { trait = legendary_psion }
				}
				hidden_tooltip = {
					change_variable = { which = psion_xp value = 20 }
				}
			}
	  }
	}

#Invasion events, adapted from PeculiarJard nomadic horde ones
# Clean up event if no longer harper
character_event = {
    id = HRP.1
    desc = HRP_desc.1
		picture = GFX_evt_adventurers_2
    is_triggered_only = yes

		trigger = {
			has_character_flag = harp_prep_invader
			NOT = { society_member_of = harpers }
		}

    immediate = {
		set_character_flag = prepared_invasion_over
		remove_character_modifier = launched_prepared_invasion
		remove_opinion = {
			who = persistent_event_target:prep_invader_target
			modifier = preparing_to_invade
		}
		persistent_event_target:prep_invader_target = {
			remove_opinion = {
				who = ROOT
				modifier = preparing_to_invade_me
			}
    		clr_character_flag = prep_inv_target
    		character_event = { id = HRP.16 }
		}
		disband_event_forces = prepared_invasion
    }
	option = {
		name = {
			text = EVTOPTB62310
		}
	}
}

# Clean up event if you don't wage a war in 2 years after starting preparations
narrative_event = {
	id = HRP.2
	desc = HRP_desc.2
	title = HRP_desc.2a
	picture = GFX_evt_adventurers_2
	border = GFX_event_narrative_frame_war
	is_triggered_only = yes
	has_character_flag = harp_prep_invader
	trigger = {
		NOT = { has_character_flag = prepared_invasion_over }
        NOT = {
            any_war = {
                attacker = { character = ROOT }
                using_cb = harper_invasion # Not Already Invading
            }
        }
	}

	immediate = {
		set_character_flag = prepared_invasion_over
		remove_character_modifier = launched_prepared_invasion
		remove_opinion = {
			who = persistent_event_target:prep_invader_target
			modifier = preparing_to_invade
		}
		persistent_event_target:prep_invader_target = {
			remove_opinion = {
				who = ROOT
				modifier = preparing_to_invade_me
			}
    		clr_character_flag = prep_inv_target
    		character_event = { id = HRP.16 }
		}
		disband_event_forces = prepared_invasion
	}

	option = {
		name = {
			text = EVTOPTB62310
		}
		prestige = -200
	}
}

# Clean up when a prepared invader dies
character_event = {
	id = HRP.3 # HF.49208
	hide_window = yes
	is_triggered_only = yes
	has_character_flag = harp_prep_invader

	immediate = {
		disband_event_forces = prepared_invasion
    	persistent_event_target:prep_invader_target = {
    		clr_character_flag = prep_inv_target
    		character_event = { id = HRP.16 days = 1 }
    	}
	}
}

# If another CB is used before Prepared Invasion
# Called from on_action: on_war_started
# The Attacker is FROM
character_event = {

	id = HRP.4
	desc = HRP_desc.4
  has_character_flag = prep_inv_target
	picture = GFX_evt_adventurers_2
	border = GFX_event_normal_frame_war

	is_triggered_only = yes

	trigger = {
		FROM = { has_character_flag = harp_prep_invader }
		ROOT = { has_opinion_modifier = { who = FROM name = preparing_to_invade_me } }
		NOT = {
			any_war = {
				defender = { character = ROOT }
				using_cb = harper_invasion # Declared invasion
			}
		}
	}

	immediate = {
		FROM = { narrative_event = { id = HRP.17 }	}
	}

	option = {
		name = {
			text = HRP_desc_opt.4a
		}
	}
}

## Prepared Invasion Ticker ## Adapted from the Reconquista Ticker
character_event = {
    id = HRP.5
    hide_window = yes
    is_triggered_only = yes
    trigger = {
    	persistent_event_target:prep_invader_target = { NOT = { war_with = ROOT } }
    	persistent_event_target:prep_invader_target = { independent = yes }
    	#persistent_event_target:prep_invader_target = { any_realm_title = { is_valid_viking_invasion_target = PREV } }
			persistent_event_target:prep_invader_target = {
				OR = {
					tier = EMPEROR
					tier = KING
					tier = DUKE
				}
				any_demesne_title = {
					higher_tier_than = COUNT
					controls_religion = no
				}
			}
			persistent_event_target:prep_invader_target = { has_opinion_modifier = { who = ROOT name = preparing_to_invade_me } }
    }

    fail_trigger_effect = {
    	character_event = { id = HRP.15 }
    }

    immediate = {
		ROOT = { change_variable = { which = prep_invasion_duration value = 1 } }
		if = {
			limit = {
				check_variable = { which = prep_invasion_duration value == 12 }
			}
			ROOT = {
				character_event = { id = HRP.12 }
			}
			persistent_event_target:prep_invader_target = {
				character_event = { id = HRP.12 }
			}
		}
		if = {
			limit = {
				check_variable = { which = prep_invasion_duration value == 18 }
			}
			ROOT = {
				character_event = { id = HRP.13 }
			}
			persistent_event_target:prep_invader_target = {
				character_event = { id = HRP.13 }
			}
		}
		if = {
			limit = {
				check_variable = { which = prep_invasion_duration value == 22 }
			}
			ROOT = {
				character_event = { id = HRP.14 }
			}
			persistent_event_target:prep_invader_target = {
				character_event = { id = HRP.14 }
			}
		}
		if = {
			limit = {
				ai = yes
				prisoner = no
				is_incapable = no
				check_variable = { which = prep_invasion_duration value == 23 }
                NOT = {
                    any_war = {
                        attacker = { character = ROOT }
                        using_cb = harper_invasion # Not Already Invading
                    }
                }
			}
			#persistent_event_target:prep_invader_target = {
			#	random_realm_title = {
      #              limit = { is_valid_viking_invasion_target = PREV }
      #              save_event_target_as = ai_prep_invasion_target
      #          }
			#}
			ROOT = {
				war = { target = persistent_event_target:prep_invader_target casus_belli = harper_invasion thirdparty_title = event_target:ai_prep_invasion_target tier = KING }
			}
		}
    	random_list = {
    		# Nothing
    		15 = {
    		}
    		# A small force flocks to your banner
    		15 = {
                modifier = {
                    factor = 1.25
                    martial = 15
                }
                modifier = {
                    factor = 1.25
                    martial = 20
                }
                modifier = {
                    factor = 1.25
                    diplomacy = 15
                }
                modifier = {
                    factor = 1.25
                    diplomacy = 20
                }
                modifier = {
                    factor = 1.25
                    prestige = 1000
                }
                modifier = {
                    factor = 0.75
                    NOT = { martial = 10 }
                }
                modifier = {
                    factor = 0.5
                    NOT = { martial = 7 }
                }
                modifier = {
                    factor = 0.75
                    NOT = { diplomacy = 10 }
                }
                modifier = {
                    factor = 0.5
                    NOT = { diplomacy = 7 }
                }
                modifier = {
                    factor = 0.5
                    NOT = { prestige = 100 }
                }
                modifier = {
                    factor = 0.75
                    lower_tier_than = DUKE
                }
                modifier = {
                    factor = 0
                    relative_power = {
                        who = persistent_event_target:prep_invader_target
                        power = 8.0
                    }
                }
                modifier = {
                    factor = 0.5
                    relative_power = {
                        who = persistent_event_target:prep_invader_target
                        power = 4.0
                    }
                }
                modifier = {
                    factor = 0.25
                    relative_power = {
                        who = persistent_event_target:prep_invader_target
                        power = 6.0
                    }
                }
    			character_event = { id = HRP.8 }
    		}
    		# A significant force flocks to your banner
    		15 = {
    			trigger = {
    			}
                modifier = {
                    factor = 1.25
                    martial = 15
                }
                modifier = {
                    factor = 1.25
                    martial = 20
                }
                modifier = {
                    factor = 1.25
                    diplomacy = 15
                }
                modifier = {
                    factor = 1.25
                    diplomacy = 20
                }
                modifier = {
                    factor = 1.25
                    prestige = 1000
                }
                modifier = {
                    factor = 0.75
                    NOT = { martial = 10 }
                }
                modifier = {
                    factor = 0.5
                    NOT = { martial = 7 }
                }
                modifier = {
                    factor = 0.75
                    NOT = { diplomacy = 10 }
                }
                modifier = {
                    factor = 0.5
                    NOT = { diplomacy = 7 }
                }
                modifier = {
                    factor = 0.5
                    NOT = { prestige = 100 }
                }
                modifier = {
                    factor = 0.75
                    lower_tier_than = DUKE
                }
                modifier = {
                    factor = 0
                    relative_power = {
                        who = persistent_event_target:prep_invader_target
                        power = 8.0
                    }
                }
                modifier = {
                    factor = 0.5
                    relative_power = {
                        who = persistent_event_target:prep_invader_target
                        power = 4.0
                    }
                }
                modifier = {
                    factor = 0.25
                    relative_power = {
                        who = persistent_event_target:prep_invader_target
                        power = 6.0
                    }
                }
    			character_event = { id = HRP.6 }
    		}
    		# A Hero joins your cause with his retinue
    		2 = {
                modifier = {
                    factor = 1.25
                    martial = 15
                }
                modifier = {
                    factor = 1.25
                    martial = 20
                }
                modifier = {
                    factor = 1.25
                    diplomacy = 15
                }
                modifier = {
                    factor = 1.25
                    diplomacy = 20
                }
                modifier = {
                    factor = 1.25
                    prestige = 1000
                }
                modifier = {
                    factor = 0.75
                    NOT = { martial = 10 }
                }
                modifier = {
                    factor = 0.5
                    NOT = { martial = 7 }
                }
                modifier = {
                    factor = 0.75
                    NOT = { diplomacy = 10 }
                }
                modifier = {
                    factor = 0.5
                    NOT = { diplomacy = 7 }
                }
                modifier = {
                    factor = 0.5
                    NOT = { prestige = 100 }
                }
                modifier = {
                    factor = 0.75
                    lower_tier_than = DUKE
                }
                modifier = {
                    factor = 0
                    relative_power = {
                        who = persistent_event_target:prep_invader_target
                        power = 8.0
                    }
                }
                modifier = {
                    factor = 0.5
                    relative_power = {
                        who = persistent_event_target:prep_invader_target
                        power = 4.0
                    }
                }
                modifier = {
                    factor = 0.25
                    relative_power = {
                        who = persistent_event_target:prep_invader_target
                        power = 6.0
                    }
                }
    			character_event = { id = HRP.7 }
    		}
    	}
    }

    after = {
    	character_event = { id = HRP.5 days = 30 }
    }
}

# Troops flock to your banner
character_event = {
	id = HRP.6 # 62320
	desc = HRP_desc.6
	picture = GFX_evt_adventurers_3
	border = GFX_event_normal_frame_war

	is_triggered_only = yes

	option = {
		name = EVTOPTA62320
		capital_scope = {
			ROOT = {
				spawn_unit = {
					province = PREV
					owner = ROOT
					match_character = ROOT
					match_mult = 0.1
					earmark = prepared_invasion
					attrition = 1.0
				}
				spawn_fleet = {
					province = closest_to_capital
					owner = ROOT
					match_character = ROOT
					match_mult = 0.1
					match_min = 7
					earmark = prepared_invasion
				}
			}
		}
	}
}

# A hero and their retinue appear in your court
character_event = {
	id = HRP.7 # 62321
	desc = HRP_desc.7
	picture = GFX_evt_adventurers_3

	hide_from = yes

	border = GFX_event_normal_frame_war

	is_triggered_only = yes

	option = {
		name = EVTOPTA62321
		capital_scope = {
			create_character = {
				random_traits = yes
				dynasty = NONE
				religion = ROOT
				culture = ROOT
				female = 50
				age = 30
				attributes = {
					martial = 8
					intrigue = 12
					diplomacy = 5
					learning = 5
					stewardship = 4
				}
				trait = brave
				trait = brilliant_strategist
			}
			new_character = {
				join_society = harpers
				remove_trait = weak
				remove_trait = slow
				remove_trait = idiot
				remove_trait = imbecile
				remove_trait = dull
				remove_trait = delicate
				random_list = {
					30 = { religion = joyful }
					30 = { religion = solar }
					30 = { religion = inventive }
					20 = { religion = arcane }
					20 = { religion = chauntean_faith }
					20 = { religion = natural }
					15 = { religion = elven_pantheon }
					10 = { religion = triadic }
				}
				random_list = {
					20 = { add_trait = expert_ranger }
					20 = { add_trait = expert_bard }
					20 = { add_trait = expert_wizard }
					20 = { add_trait = expert_rogue }
					20 = { add_trait = expert_fighter }
				}

				spawn_unit = {
					province = PREV
					owner = ROOT
					match_character = ROOT
					match_mult = 0.15
					earmark = prepared_invasion
					attrition = 1.0
				}
			}
		}

		spawn_fleet = {
			province = closest_to_capital
			owner = ROOT
			match_character = ROOT
			match_mult = 0.15
			match_min = 10
			earmark = prepared_invasion
		}
	}
}

# A smaller force arrives for the invasion
character_event = {
	id = HRP.8 # 62322
	desc = HRP_desc.6
	picture = GFX_evt_adventurers_3
	border = GFX_event_normal_frame_war

	is_triggered_only = yes

	option = {
		name = EVTOPTA62320
		capital_scope = {
			ROOT = {
				spawn_unit = {
					province = PREV
					owner = ROOT
					match_character = ROOT
					match_mult = 0.075
					earmark = prepared_invasion
					attrition = 1.0
				}
				spawn_fleet = {
					province = closest_to_capital
					owner = ROOT
					match_character = ROOT
					match_mult = 0.075
					match_min = 5
					earmark = prepared_invasion
				}
			}
		}
	}
}

## Prepared Invasion Announcement Events ##
character_event = {
    id = HRP.9 # Prepared Invasion notification for everyone else
    title = HRP_desc.9a
		picture = GFX_evt_adventurers
    border = GFX_event_normal_frame_war
    is_triggered_only = yes

		desc = {
			trigger = { NOT = { society_member_of = harpers } }
			text = HRP_desc.9
		}
		desc = {
			trigger = { society_member_of = harpers }
			text = HRP_desc.9_alt
		}

    option = {
				name = {
					text = fr_prepared_invasion_desc_opt.9a
					trigger = { NOT = { society_member_of = harpers } }
				}
				name = {
					text = fr_prepared_invasion_desc_opt_harp.9a
					trigger = { society_member_of = harpers }
				}
    }
    option = {
        name = fr_prepared_invasion_desc_opt.9b
        custom_tooltip = { text = prep_inv_opt_out_char_tt }
				set_character_flag = prep_inv_no_warning
    }
    option = {
        name = fr_prepared_invasion_desc_opt.9c
        custom_tooltip = { text = prep_inv_opt_out_global_tt }
				set_global_flag = prep_inv_no_warning
    }
}

character_event = { # Prepared Invader's first notification
    id = HRP.10
    title = HRP_desc.9a
		desc = HRP_desc.10
		picture = GFX_evt_adventurers
    border = GFX_event_normal_frame_war
    is_triggered_only = yes

	immediate = {
		persistent_event_target:prep_invader_target = { character_event = { id = HRP.11 } }
		any_player = {
			limit = {
				is_within_diplo_range = ROOT
				NOT = { has_global_flag = prep_inv_no_warning }
				NOT = { has_character_flag = prep_inv_no_warning }
				NOT = { character = persistent_event_target:prep_invader_target }
				NOT = { character = ROOT }
			}
			character_event = { id = HRP.9 }
		}
	}


    option = {
        name = fr_prepared_invasion_desc_opt.10a
    }
}

character_event = { # Prepared Invader Target's first notification
    id = HRP.11
    title = HRP_desc.9a
		desc = HRP_desc.11
		picture = GFX_evt_adventurers
    border = GFX_event_normal_frame_war
    is_triggered_only = yes


    option = {
        name = fr_prepared_invasion_desc_opt.11a
    }
}

character_event = { # Notification for 1 year left
	id = HRP.12
	desc = HRP_desc.12
	picture = GFX_evt_adventurers_3

	is_triggered_only = yes

	option = {
		name = fr_prepared_invasion_desc_opt.12a
	}
}

character_event = { # Notification for 6 months left
	id = HRP.13
	desc = HRP_desc.13
	picture = GFX_evt_adventurers_3

	is_triggered_only = yes

	option = {
		name = fr_prepared_invasion_desc_opt.12a
	}
}

character_event = { # Notification for a month left
	id = HRP.14
	desc = HRP_desc.14
	picture = GFX_evt_adventurers_3

	is_triggered_only = yes

	option = {
		name = fr_prepared_invasion_desc_opt.12a
	}
}

character_event = { # Prepared Invasion abort check
    id = HRP.15
		hide_window = yes
    is_triggered_only = yes

	immediate = {
		if = {
            limit = {
                NOT = { has_character_flag = prepared_invasion_over }
                NOT = {
                    any_war = {
                        attacker = { character = ROOT }
                        using_cb = harper_invasion # Not Already Invading
                    }
                }
            }
            narrative_event = { id = HRP.17 }
        }
	}
}

character_event = { # Prepared Invasion Abort Notification for Target
	id = HRP.16
	picture = GFX_evt_adventurers_2
  desc = {
      trigger = {
      	FROM = { war_with = ROOT }
      }
      text = fr_prepared_invasion_desc.16b
  }
  desc = {
      trigger = {
      	ROOT = { independent = no }
      }
      text = fr_prepared_invasion_desc.16c
  }
  desc = {
      trigger = {
      	#ROOT = { NOT = { any_realm_title = { is_valid_viking_invasion_target = PREV } } }
				ROOT = {
					NOT = {
						OR = {
							tier = EMPEROR
							tier = KING
							tier = DUKE
						}
						any_demesne_title = {
							higher_tier_than = COUNT
							controls_religion = no
						}
					}
				}
				ROOT = { realm_size < 51 }
      }
      text = fr_prepared_invasion_desc.16f
  }
  desc = {
      trigger = {
      	FROM = { is_alive = no }
      }
      text = fr_prepared_invasion_desc.16g
  }

	is_triggered_only = yes

	option = {
		name = fr_prepared_invasion_desc_opt.16a
	}
}

narrative_event = { # Prepared Invasion Abort Notification
    id = HRP.17
    title = HRP_desc.17a
		picture = GFX_evt_adventurers_2
    desc = {
        trigger = {
        	persistent_event_target:prep_invader_target = { war_with = ROOT }
        }
        text = HRP_desc.17b
    }
    desc = {
        trigger = {
        	persistent_event_target:prep_invader_target = { independent = no }
        }
        text = HRP_desc.17c
    }
    desc = {
        trigger = {
        	#persistent_event_target:prep_invader_target = { NOT = { any_realm_title = { is_valid_viking_invasion_target = PREV } } }
					persistent_event_target:prep_invader_target = {
						NOT = {
							OR = {
								tier = EMPEROR
								tier = KING
								tier = DUKE
							}
							any_demesne_title = {
								higher_tier_than = COUNT
								controls_religion = no
							}
						}
					}
        	persistent_event_target:prep_invader_target = { realm_size < 51 }
        }
        text = HRP_desc.17f
    }
    border = GFX_event_narrative_frame_war
    is_triggered_only = yes

	immediate = {
		set_character_flag = prepared_invasion_over
		remove_character_modifier = launched_prepared_invasion
		remove_opinion = {
			who = persistent_event_target:prep_invader_target
			modifier = preparing_to_invade
		}
		persistent_event_target:prep_invader_target = {
			remove_opinion = {
				who = ROOT
				modifier = preparing_to_invade_me
			}
    		clr_character_flag = prep_inv_target
    		character_event = { id = HRP.16 }
		}
		disband_event_forces = prepared_invasion
	}

	option = {
		name = {
			text = EVTOPTB62310
		}
		prestige = -200
	}
}

# Transfers prepared invasion eligibility on death
character_event = {
	id = HRP.18
	hide_window = yes
    is_triggered_only = yes
    has_character_flag = prep_inv_target
    only_independent = yes

    immediate = {
    	current_heir = { save_event_target_as = prepared_invasion_target_heir set_character_flag = prep_inv_target }
    	any_opinion_modifier_target = {
    		limit = { reverse_has_opinion_modifier = { who = PREV modifier = preparing_to_invade_me } }
    		save_persistent_event_target = { name = prep_invader_target scope = event_target:prepared_invasion_target_heir }
    	}
    }
}

#Unlanded AI High Harper asks ruler to depose tyrant

#event for the AI High Harper
character_event = {
	id = HRP.500
	hide_window = yes

	is_triggered_only = yes
	is_in_society = yes
	only_capable = yes

	trigger = {
		society_member_of = harpers
		society_rank == 4
		is_playable = no
		NOT = { is_inaccessible_trigger = yes }
		OR = {
			NOT = { has_character_flag = instigated_harper_invasion }
			had_character_flag = { flag = instigated_harper_invasion years = 100 }
		}

		any_independent_ruler = {
			NOT = { has_truce = ROOT }
			is_within_diplo_range = ROOT
			NOT = { character = ROOT }
			NOT = { is_liege_or_above_of = ROOT }
			OR = {
				has_character_modifier = true_villain_modifier
				has_character_modifier = undead_realm_lord
				AND = {
					OR = {
						realm_size >= 50
						num_of_count_titles_in_realm >= 20
					}
					OR = {
						trait = cruel
						trait = impaler
						is_evil_religion = yes
					}
					NOR = {
						trait = kind
						trait = just
					}
				}
			}
			NOT = { has_character_flag = prep_inv_target }
			OR = {
				tier = EMPEROR
				tier = KING
				tier = DUKE
			}
			any_demesne_title = {
				higher_tier_than = COUNT
				controls_religion = no
			}
		}
	}

	immediate = {
		random_independent_ruler = {
			limit = {
				NOT = { has_truce = ROOT }
				is_within_diplo_range = ROOT
				NOT = { character = ROOT }
				NOT = { is_liege_or_above_of = ROOT }
				OR = {
					has_character_modifier = true_villain_modifier
					has_character_modifier = undead_realm_lord
					AND = {
						OR = {
							realm_size >= 50
							num_of_count_titles_in_realm >= 20
						}
						OR = {
							trait = cruel
							trait = impaler
							is_evil_religion = yes
						}
						NOR = {
							trait = kind
							trait = just
						}
					}
				}
				NOT = { has_character_flag = prep_inv_target }
				OR = {
					tier = EMPEROR
					tier = KING
					tier = DUKE
				}
				any_demesne_title = {
					higher_tier_than = COUNT
					controls_religion = no
				}
			}
			save_event_target_as = harper_invasion_target
			capital_scope = {
				save_event_target_as = harper_invasion_target_capital
			}
		}
		random_independent_ruler = {
			limit = {
				NOR = {
					war = yes
					trait = cruel
					trait = impaler
					is_evil_religion = yes
					has_character_modifier = undead_realm_lord
					has_character_modifier = true_villain_modifier
				}
				NOT = { has_truce = event_target:harper_invasion_target }
				is_within_diplo_range = event_target:harper_invasion_target
				capital_scope = {
					can_land_path_to = {
						target = event_target:harper_invasion_target_capital
					}
				}
			}
			letter_event = { id = HRP.501 }
		}
	}
}
#landed ruler is asked to wage war
letter_event = {
	id = HRP.501
  desc = EVTDESC_HRP_501

	trigger = {
		event_target:harper_invasion_target = {
			is_alive = yes
		}
	}

	is_triggered_only = yes

	option = {
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				war = yes
			}
			modifier = {
				factor = 2
				relative_power = {
					who = event_target:harper_invasion_target
					power >= 1
				}
			}
			modifier = {
				factor = 0.5
				relative_power = {
					who = event_target:harper_invasion_target
					power <= 0.4
				}
			}
			modifier = {
				factor = 0.4
				relative_power = {
					who = event_target:harper_invasion_target
					power <= 0.3
				}
			}
			modifier = {
				factor = 0.3
				relative_power = {
					who = event_target:harper_invasion_target
					power <= 0.2
				}
			}
			modifier = {
				factor = 0.2
				relative_power = {
					who = event_target:harper_invasion_target
					power <= 0.1
				}
			}
		}
		name = ACCEPT

		event_target:harper_invasion_target = {
			reverse_unsafe_war = {
				target = ROOT
				casus_belli = harper_invasion
			}
		}

		capital_scope = {
			tooltip = {
				ROOT = {
					spawn_unit = {
						province = PREV
						owner = ROOT
						match_character = event_target:harper_invasion_target
						match_mult = 0.17
						attrition = 1.0
					}
					spawn_unit = {
						province = PREV
						owner = ROOT
						match_character = event_target:harper_invasion_target
						match_mult = 0.17
						attrition = 1.0
					}
					spawn_unit = {
						province = PREV
						owner = ROOT
						match_character = event_target:harper_invasion_target
						match_mult = 0.17
						attrition = 1.0
					}
				}
			}

			hidden_tooltip = {
				create_character = {
					random_traits = yes
					dynasty = NONE
					religion = ROOT
					culture = ROOT
					female = 50
					age = 25
					attributes = {
						martial = 8
						intrigue = 12
						diplomacy = 5
						learning = 5
						stewardship = 4
					}
					trait = brave
					trait = brilliant_strategist
				}
				new_character = {
					join_society = harpers
					remove_trait = weak
					remove_trait = slow
					remove_trait = idiot
					remove_trait = imbecile
					remove_trait = dull
					remove_trait = delicate
					random_list = {
						30 = { religion = joyful }
						30 = { religion = solar }
						30 = { religion = inventive }
						20 = { religion = arcane }
						20 = { religion = chauntean_faith }
						20 = { religion = natural }
						15 = { religion = elven_pantheon }
						10 = { religion = triadic }
					}
					random_list = {
						20 = { add_trait = expert_ranger }
						20 = { add_trait = expert_bard }
						20 = { add_trait = expert_wizard }
						20 = { add_trait = expert_rogue }
						20 = { add_trait = expert_fighter }
					}
					spawn_unit = {
						province = PREV
						owner = ROOT
						match_character = event_target:harper_invasion_target
						match_mult = 0.17
						earmark = harper_loyalists
						attrition = 1.0
						disband_on_peace = yes
					}
				}
				create_character = {
					random_traits = yes
					dynasty = NONE
					religion = ROOT
					culture = ROOT
					female = 50
					age = 30
					attributes = {
						martial = 8
						intrigue = 12
						diplomacy = 5
						learning = 5
						stewardship = 4
					}
					trait = brave
					trait = brilliant_strategist
				}
				new_character = {
					join_society = harpers
					remove_trait = weak
					remove_trait = slow
					remove_trait = idiot
					remove_trait = imbecile
					remove_trait = dull
					remove_trait = delicate
					random_list = {
						30 = { religion = joyful }
						30 = { religion = solar }
						30 = { religion = inventive }
						20 = { religion = arcane }
						20 = { religion = chauntean_faith }
						20 = { religion = natural }
						15 = { religion = elven_pantheon }
						10 = { religion = triadic }
					}
					random_list = {
						20 = { add_trait = expert_ranger }
						20 = { add_trait = expert_bard }
						20 = { add_trait = expert_wizard }
						20 = { add_trait = expert_rogue }
						20 = { add_trait = expert_fighter }
					}
					spawn_unit = {
						province = PREV
						owner = ROOT
						match_character = event_target:harper_invasion_target
						match_mult = 0.17
						earmark = harper_loyalists
						attrition = 1.0
						disband_on_peace = yes
					}
				}
				create_character = {
					random_traits = yes
					dynasty = NONE
					religion = ROOT
					culture = ROOT
					female = 50
					age = 35
					attributes = {
						martial = 8
						intrigue = 12
						diplomacy = 5
						learning = 5
						stewardship = 4
					}
					trait = brave
					trait = brilliant_strategist
				}
				new_character = {
					join_society = harpers
					remove_trait = weak
					remove_trait = slow
					remove_trait = idiot
					remove_trait = imbecile
					remove_trait = dull
					remove_trait = delicate
					random_list = {
						30 = { religion = joyful }
						30 = { religion = solar }
						30 = { religion = inventive }
						20 = { religion = arcane }
						20 = { religion = chauntean_faith }
						20 = { religion = natural }
						15 = { religion = elven_pantheon }
						10 = { religion = triadic }
					}
					random_list = {
						20 = { add_trait = expert_ranger }
						20 = { add_trait = expert_bard }
						20 = { add_trait = expert_wizard }
						20 = { add_trait = expert_rogue }
						20 = { add_trait = expert_fighter }
					}
					spawn_unit = {
						province = PREV
						owner = ROOT
						match_character = event_target:harper_invasion_target
						match_mult = 0.17
						earmark = harper_loyalists
						attrition = 1.0
						disband_on_peace = yes
					}
				}
			}
		}
		if = {
			limit = {
				society_member_of = harpers
			}
			add_society_currency_major_effect = yes
		}

		event_target:harper_invasion_target = {
			set_character_flag = appear_in_option
			clr_character_flag = appear_in_option
		}
		hidden_tooltip = { FROM = { set_character_flag = instigated_harper_invasion } }
	}
	option = {
		ai_chance = {
			factor = 1
			modifier = {
        factor = 0.5
        opinion = { who = event_target:harper_invasion_target value <= 0 }
      }
			modifier = {
        factor = 2
        opinion = { who = event_target:harper_invasion_target value >= 20 }
      }
			modifier = {
        factor = 4
        opinion = { who = event_target:harper_invasion_target value >= 40 }
      }
		}
		name = DECLINE
	}
}


########################AI JOIN AND AI RANK UP###########################

character_event = { #force the AI to join a society
  id = HRP.110
  hide_window = yes
  is_triggered_only = yes

	immediate = {
		if = {
			limit = { #if he's already a member, will force a rank up 25% of the time
				ai = yes
				prisoner = no
				NOT = { trait = incapable }
				higher_tier_than = BARON
				society_member_of = harpers
				society_rank <= 3
				society_can_rank_up = yes
			}
			random_list = {
				75 = {}
				25 = {
					society_rank_up = 1
				}
			}
		}
		if = { #force the joining event on AI
			limit = {
				ai = yes
				prisoner = no
				NOT = { trait = incapable }
        is_adult = yes
        is_in_society = no
        controls_religion = no
				block_general_event_trigger = no
			}
			character_event = { id = HRP.111 }
		}
	}
}

character_event = { #AI join event
	id = HRP.111
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		random_list = {
			60 = { # do nothing
			}
			40 = {
				trigger = {
					can_join_society = harpers
				}
				modifier = {
					factor = 2
					OR = {
						trait = scholar
						trait = socializer
						trait = schemer
					}
				}
				modifier = {
					factor = 2
					trait = just
				}
				modifier = {
					factor = 2
					trait = charitable
				}
				modifier = {
					factor = 2
					trait = patient
				}
				modifier = {
					factor = 2
					trait = diligent
				}
				modifier = {
					factor = 2
					trait = erudite
				}
				modifier = {
					factor = 2
					trait = kind
				}
				modifier = {
					factor = 2
					trait = brave
				}
				modifier = {
					factor = 0
					trait = cruel
				}
				modifier = {
					factor = 0
					is_evil_trigger = yes
				}
				modifier = {
					factor = 0.5
					trait = craven
				}
				modifier = {
					factor = 0.2
					trait = greedy
				}
				modifier = {
					factor = 0.1
					trait = lich
				}
				modifier = {
					factor = 0.1
					is_landed = no
				}
				join_society = harpers
				random_list = { # Artificially increase society influence for balance purposes, not really useful in my opinion.
					75 = {
						modifier = {
							factor = 0
							society_influence >= 30
						}
					}
					25 = {
					}
				}
				if = { # Make grandmaster is there is none
					limit = {
						NOT = {
							society = {
								any_society_member = {
									is_society_grandmaster = yes
								}
							}
						}
					}
					set_society_grandmaster = yes
				}
			}
		}
	}
}

###MISSIONS### (start on 1000)

#Mission tombola
character_event = {
	id = HRP.1000
	hide_window = yes

	is_triggered_only = yes
	is_in_society = yes
	only_capable = yes

	trigger = {
		OR = {
			society_member_of = harpers
			society_member_of = kuo_tan_society
		}
		has_any_quest = no
		NOT = { has_character_modifier = quest_cooldown_timer }
		NOT = { is_inaccessible_trigger = yes }
	}

	immediate = {
		random_society_member = {
			limit = {
				NOT = { character = ROOT }
				same_society_as = ROOT
			}
			save_event_target_as = quest_giver
		}

		random_list = {
			15 = {
				character_event = { id = HRP.1001 } #Agent Elimination
			}
			20 = { #Unlanded AI High Harper asks ruler to depose tyrant
				modifier = {
					factor = 0
					ai = no
				}
				modifier = {
					factor = 0
					NOT = { society_member_of = harpers }
				}
				modifier = {
					factor = 0
					society_rank < 4
				}
				modifier = {
					factor = 0
					total_years_played < 10
				}
				character_event = { id = HRP.500 }
			}
			20 = {
				modifier = {
					factor = 0
					ai = no
				}
				#Do nothing for AI
			}
		}
	}
}

#MISSION: #Agent Elimination
character_event = {
  id = HRP.1001
  hide_window = yes

  is_triggered_only = yes

  trigger = {
    any_realm_character = {
      NOT = {
        is_inaccessible_trigger = yes
        character = ROOT
      }
      prisoner = no
			OR = {
				society_member_of = arcane_brotherhood
				society_member_of = brotherhood_of_true_flame
				society_member_of = cult_of_the_dragon
				society_member_of = shadow_thieves
				society_member_of = night_masks
				society_member_of = shadow_telflamm
				society_member_of = twisted_rune
				society_member_of = kraken_society
				society_member_of = eldreth_veluuthra
				society_member_of = the_satanists
				society_member_of = black_network
				society_member_of = tsui_tong
				society_member_of = storm_rune_society
				society_member_of = warlock_knights
			}
    }
  }

	immediate = {
    random_realm_character = {
      limit = {
        NOT = { is_inaccessible_trigger = yes }
        NOT = { character = ROOT }
        prisoner = no
				OR = {
					society_member_of = arcane_brotherhood
					society_member_of = brotherhood_of_true_flame
					society_member_of = cult_of_the_dragon
					society_member_of = shadow_thieves
					society_member_of = night_masks
					society_member_of = shadow_telflamm
					society_member_of = twisted_rune
					society_member_of = kraken_society
					society_member_of = eldreth_veluuthra
					society_member_of = the_satanists
					society_member_of = black_network
					society_member_of = tsui_tong
					society_member_of = storm_rune_society
					society_member_of = warlock_knights
				}
      }
      save_event_target_as = elimination_target
    }

    if = {
			limit = {
				event_target:elimination_target = { always = yes }
				is_within_diplo_range = event_target:elimination_target
			}
			event_target:quest_giver = {
				character_event = { id = HRP.1002 }
			}
		}
	}
}

#Ping event for quest giver
character_event = {
	id = HRP.1002
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		if = {
			limit = { event_target:elimination_target = { always = yes } }
			FROM = { society_quest_event = { id = HRP.1003 days = 7 random = 7 } }
		}
	}
}

#You get your target
society_quest_event = {
	id = HRP.1003
	title = quest_agent_elimination
	quest_target = event_target:elimination_target
  desc = EVTDESC_HRP_1003

	trigger = {
		is_in_society = yes
		event_target:elimination_target = {
			is_alive = yes
      prisoner = no
		}
	}

	is_triggered_only = yes

	option = {
		name = ACCEPT

		event_target:elimination_target = {
			set_quest_target = {
				id = quest_agent_elimination
				holder = ROOT
			}
		}

		hidden_effect = {
			if = { #Makes sure the AI actually does the mission
				limit = { ai = yes }
				random_list = {
					20 = {
						trigger = {
							attribute_diff = { character = event_target:elimination_target attribute = intrigue value = 6 }
						}
						modifier = { intrigue = 12 factor = 1.2 }
						modifier = { intrigue = 14 factor = 1.2 }
						modifier = { intrigue = 16 factor = 1.2 }
						modifier = { intrigue = 18 factor = 1.2 }
						character_event = { id = HRP.1004 days = 150 random = 100 } #Triggers plot event
					}
					20 = {
						trigger = { attribute_diff = { character = event_target:elimination_target attribute = intrigue value = 3 } }
						modifier = { intrigue = 12 factor = 1.2 }
						modifier = { intrigue = 14 factor = 1.2 }
						modifier = { intrigue = 16 factor = 1.2 }
						modifier = { intrigue = 18 factor = 1.2 }
						character_event = { id = HRP.1004 days = 300 random = 100 } #Triggers plot event
					}
					20 = {
						modifier = { intrigue = 12 factor = 1.2 }
						modifier = { intrigue = 14 factor = 1.2 }
						modifier = { intrigue = 16 factor = 1.2 }
						modifier = { intrigue = 18 factor = 1.2 }
						character_event = { id = HRP.1004 days = 500 random = 300 } #Triggers plot event
					}
					40 = {
						modifier = { event_target:elimination_target = { intrigue = 12 } factor = 1.2 }
						modifier = { event_target:elimination_target = { intrigue = 14 } factor = 1.2 }
						modifier = { event_target:elimination_target = { intrigue = 16 } factor = 1.2 }
						modifier = { event_target:elimination_target = { intrigue = 18 } factor = 1.2 }
						modifier = { event_target:elimination_target = { tier = COUNT } factor = 1.5 }
						modifier = { event_target:elimination_target = { tier = DUKE } factor = 2 }
						modifier = { event_target:elimination_target = { tier = KING } factor = 2.5 }
						modifier = { event_target:elimination_target = { tier = EMPEROR } factor = 5 }
						character_event = { id = HRP.1005 } #Clears quest
					}
				}
			}
		}
		event_target:elimination_target = {
			set_character_flag = appear_in_option
			clr_character_flag = appear_in_option
		}
	}

	option = {
		name = DECLINE
		custom_tooltip = { text = decline_quest_tooltip }

		hidden_effect = {
			add_character_modifier = {
				name = quest_cooldown_timer
				hidden = yes
				days = 1000
			}
		}

		ai_chance = { factor = 0 }
	}
}

#Helps AI do mission
character_event = {
  id = HRP.1004
  hide_window = yes
  is_triggered_only = yes
  trigger = {
  	NOT = { plot_target_char = { is_quest_target_of = ROOT } }
  	has_quest = quest_agent_elimination
  }
  immediate = {
  	character_event = { id = HRP.1008 }
  }
}

#AI clean-up
character_event = {
    id = HRP.1005
    hide_window = yes
    is_triggered_only = yes
    trigger = {
    	NOT = { plot_target_char = { is_quest_target_of = ROOT } }
    	has_quest = quest_agent_elimination
    }
    immediate = {
    	clr_quest = {
    		id = quest_agent_elimination
    		failure = yes
    	}
    }
}

#AI mission assassination attempt
character_event = {
	id = HRP.1008
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		FROM = { save_event_target_as = assassin }
    random_list = {
      60 = { #Kill
        random_list = {
          75 = {	#Not discovered
            modifier = {
              event_target:assassin = { intrigue = 12 }
              factor = 1.5
            }
            modifier = {
              event_target:assassin = { intrigue = 15 }
              factor = 1.5
            }
            event_target:elimination_target = { death = { death_reason = death_murder_unknown killer = event_target:assassin } }
          }
          25 = {	#Discovered
            modifier = {
              event_target:assassin = { NOT = { intrigue = 8 } }
              factor = 1.5
            }
            modifier = {
              event_target:assassin = { NOT = { intrigue = 5 } }
              factor = 1.5
            }
            event_target:elimination_target = { death = { death_reason = death_murder killer = event_target:assassin } }
            event_target:assassin = { character_event = { id = 10 } }
          }
        }
        modifier = {
          factor = 3
          event_target:elimination_target = { trait = incapable }
        }
        modifier = {
          factor = 2
          event_target:elimination_target = { prisoner = yes }
        }
        modifier = {
          factor = 1.3
          FROM = { attribute_diff = { character = event_target:elimination_target attribute = intrigue value = 2 } }
        }
        modifier = {
          factor = 1.3
          FROM = { attribute_diff = { character = event_target:elimination_target attribute = intrigue value = 4 } }
        }
        modifier = {
          factor = 1.3
          FROM = { attribute_diff = { character = event_target:elimination_target attribute = intrigue value = 6 } }
        }
        modifier = {
          factor = 1.3
          FROM = { combat_rating_diff = { character = event_target:elimination_target value = 10 } }
        }
        modifier = {
          factor = 1.3
          FROM = { combat_rating_diff = { character = event_target:elimination_target value = 20 } }
        }
        modifier = {
          factor = 1.3
          FROM = { combat_rating_diff = { character = event_target:elimination_target value = 30 } }
        }
      }
      40 = { #No Kill
        random_list = {
          50 = {	#Not discovered
            modifier = {
              event_target:assassin = { intrigue = 12 }
              factor = 1.5
            }
            modifier = {
              event_target:assassin = { intrigue = 15 }
              factor = 1.5
            }
						event_target:assassin = {
							clr_quest = {
								id = quest_agent_elimination
								failure = yes
							}
						}
          }
          25 = {	#Discovered and wounded
            modifier = {
              event_target:assassin = { NOT = { intrigue = 8 } }
              factor = 1.5
            }
            modifier = {
              event_target:assassin = { NOT = { intrigue = 5 } }
              factor = 1.5
            }
						event_target:assassin = {
							clr_quest = {
								id = quest_agent_elimination
								failure = yes
							}
						}
            random_list = {
        			70 = {
        				event_target:assassin = {
        					tooltip = { add_trait = wounded }
        				}
        			}
        			30 = {
        				event_target:assassin = {
        					tooltip = { add_maimed_trait_effect = yes }
        				}
        			}
        		}
            event_target:assassin = { character_event = { id = 11 } }
          }
          25 = { #Assassin is Killed
            modifier = {
              factor = 1.3
              event_target:elimination_target = { combat_rating_diff = { character = event_target:assassin value = 10 } }
            }
            modifier = {
              factor = 1.3
              event_target:elimination_target = { combat_rating_diff = { character = event_target:assassin value = 20 } }
            }
            modifier = {
              factor = 1.3
              event_target:elimination_target = { combat_rating_diff = { character = event_target:assassin value = 30 } }
            }
            event_target:assassin = { death = { death_reason = death_battle killer = event_target:elimination_target } }
            event_target:assassin = { character_event = { id = 11 } }
          }
        }
        modifier = {
          factor = 1.3
          event_target:elimination_target = { attribute_diff = { character = event_target:assassin attribute = intrigue value = 2 } }
        }
        modifier = {
          factor = 1.3
          event_target:elimination_target = { attribute_diff = { character = event_target:assassin attribute = intrigue value = 4 } }
        }
        modifier = {
          factor = 1.3
          event_target:elimination_target = { attribute_diff = { character = event_target:assassin attribute = intrigue value = 6 } }
        }
        modifier = {
          factor = 1.3
          event_target:elimination_target = { combat_rating_diff = { character = event_target:assassin value = 10 } }
        }
        modifier = {
          factor = 1.3
          event_target:elimination_target = { combat_rating_diff = { character = event_target:assassin value = 20 } }
        }
        modifier = {
          factor = 1.3
          event_target:elimination_target = { combat_rating_diff = { character = event_target:assassin value = 30 } }
        }
      }
    }
	}
}




########################JOIN KUO-TAN########################

character_event = {
    id = HRP.250
		hide_window = yes
    is_triggered_only = yes
    trigger = {
    	FROM = { leader = { society_member_of = kuo_tan_society } }
    }
    immediate = {
    	if = { #Find a non-prisoner member
    		limit = { FROM = { leader = { prisoner = yes } } }
    		FROM = {
    			any_society_member = {
    				limit = {
    					society_member_of = kuo_tan_society
    					society_rank == 4
    					prisoner = no
    				}
    				character_event = { id = HRP.251 }
    				break = yes
    			}
    			any_society_member = {
    				limit = {
    					society_member_of = kuo_tan_society
    					society_rank == 3
    					prisoner = no
    				}
    				character_event = { id = HRP.251 }
    				break = yes
    			}
    			any_society_member = {
    				limit = {
    					society_member_of = kuo_tan_society
    					society_rank == 2
    					prisoner = no
    				}
    				character_event = { id = HRP.251 }
    				break = yes
    			}
    			any_society_member = {
    				limit = {
    					society_member_of = kuo_tan_society
    					society_rank == 1
    					prisoner = no
    				}
    				character_event = { id = HRP.251 }
    				break = yes
    			}
    		}
			#Everyone is somehow in prison so just use teh leader anyway
    	}
    	FROM = { leader = { character_event = { id = HRP.251 } } }
    }
}

#Ping event
character_event = {
    id = HRP.251
		hide_window = yes
    is_triggered_only = yes
    immediate = {
    	FROM = { letter_event = { id = HRP.252 } }
    }
}

#Welcome letter
letter_event = {
    id = HRP.252
    desc = EVTDESC_kuo_tan_invite
    border = GFX_event_letter_frame_religion

    is_triggered_only = yes

	immediate = { set_character_flag = society_join_block }

    option = {
        name = EVTOPTA_kuo_tan_invite

		join_society = kuo_tan_society

		clr_character_flag = society_join_block
    }
}

########################AI JOIN AND AI RANK UP KUO-TAN###########################

character_event = { #force the AI to join a society
  id = HRP.210
  hide_window = yes
  is_triggered_only = yes

	immediate = {
		if = {
			limit = { #if he's already a member, will force a rank up 25% of the time
				ai = yes
				prisoner = no
				NOT = { trait = incapable }
				higher_tier_than = BARON
				society_member_of = kuo_tan_society
				society_rank <= 3
				society_can_rank_up = yes
			}
			random_list = {
				75 = {}
				25 = {
					society_rank_up = 1
				}
			}
		}
		if = { #force the joining event on AI
			limit = {
				ai = yes
				prisoner = no
				NOT = { trait = incapable }
        is_adult = yes
        is_in_society = no
        controls_religion = no
				block_general_event_trigger = no
			}
			character_event = { id = HRP.211 }
		}
	}
}

character_event = { #AI join event
	id = HRP.211
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		random_list = {
			60 = { # do nothing
			}
			40 = {
				trigger = {
					can_join_society = kuo_tan_society
				}
				modifier = {
					factor = 2
					OR = {
						trait = scholar
						trait = socializer
						trait = schemer
					}
				}
				modifier = {
					factor = 2
					trait = just
				}
				modifier = {
					factor = 2
					trait = charitable
				}
				modifier = {
					factor = 2
					trait = patient
				}
				modifier = {
					factor = 2
					trait = diligent
				}
				modifier = {
					factor = 2
					trait = erudite
				}
				modifier = {
					factor = 2
					trait = kind
				}
				modifier = {
					factor = 2
					trait = brave
				}
				modifier = {
					factor = 0
					trait = cruel
				}
				modifier = {
					factor = 0
					is_evil_trigger = yes
				}
				modifier = {
					factor = 0.5
					trait = craven
				}
				modifier = {
					factor = 0.2
					trait = greedy
				}
				modifier = {
					factor = 0.1
					trait = lich
				}
				join_society = kuo_tan_society
				random_list = {
					75 = {
						modifier = {
							factor = 0
							society_influence >= 30
						}
					}
					25 = {
					}
				}
				if = { # Make grandmaster is there is none
					limit = {
						NOT = {
							society = {
								any_society_member = {
									is_society_grandmaster = yes
								}
							}
						}
					}
					set_society_grandmaster = yes
				}
			}
		}
	}
}

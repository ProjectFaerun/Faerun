namespace = BRO

#NEW DECISIONS

#long live the brotherhood
character_event = {
	id = BRO.8000
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	desc = EVTDESC_BRO_8000

	capable_only = yes
	prisoner = no

	is_triggered_only = yes

	trigger = {
		is_landed = yes
		primary_title = {
			is_landless_type_title = no
		}
		NOT = { is_inaccessible_trigger = yes }
		any_independent_ruler = {
			NOR = {
				is_inaccessible_trigger = yes
				war_with = ROOT
			}
			has_landed_title = k_a_brotherhood
			is_within_diplo_range = ROOT
		}
	}

	immediate = {
		ROOT = { capital_scope = { save_event_target_as = capital } }
		random_independent_ruler = {
			limit = {
				NOR = {
					is_inaccessible_trigger = yes
					war_with = ROOT
				}

				primary_title = {
					is_landless_type_title = no
				}
        has_landed_title = k_a_brotherhood
        is_within_diplo_range = ROOT
			}
			save_event_target_as = target_ruler
		}
	}

	option = {
		name = EVTOPTA_BRO_8000
		ai_chance = {
			factor = 100
		}
		show_portrait = event_target:target_ruler
		custom_tooltip = {
			text = EVTOPTA_BRO_8000_TOOLTIP
			hidden_tooltip = {
				event_target:target_ruler = {
					letter_event = { id = BRO.8001 days = 3 }
				}
			}
		}
	}

	option = {
		name = EVTOPTB_BRO_8000
		ai_chance = {
			factor = 0
		}
	}
}

#Suggestion to form alliance
letter_event = {
  id = BRO.8001
  picture = GFX_evt_feast
  desc = EVTDESC_BRO_8001

	is_triggered_only = yes

	#accept
	option = {
		name = EVTOPTA_BRO_8001
		ai_chance = {
			factor = 100
		}
		custom_tooltip = {
			text = EVTOPTA_BRO_8001_TOOLTIP
			hidden_tooltip = {
				FROM = {
					letter_event = { id = BRO.8002 days = 3 }
				}
			}
			opinion = {
				modifier = in_non_aggression_pact
				years = 10
				who = FROM
				origin_description = EVTTITLE_BRO_8001
			}
      FROM = {
        opinion = {
          modifier = in_non_aggression_pact
          years = 10
          who = ROOT
          origin_description = EVTTITLE_BRO_8001
        }
      }
    }
    add_alliance = {
      who = FROM
      years = 10
    }
	}
	#decline
	option = {
		name = EVTOPTB_BRO_8001
		ai_chance = {
			factor = 0
		}
		custom_tooltip = {
			text = EVTOPTB_BRO_8001_TOOLTIP
			FROM = {
				letter_event = { id = BRO.8003 days = 3 }
			}
		}
	}
}

#accepted the offer
letter_event = {
  id = BRO.8002
  picture = GFX_evt_feast
  desc = EVTDESC_BRO_8002

	is_triggered_only = yes

	#accept
	option = {
		name = EVTOPTA_BRO_8002
		custom_tooltip = {
			text = EVTOPTA_BRO_8002_TOOLTIP
		}
	}
}

#declined the offer
letter_event = {
  id = BRO.8003
  picture = GFX_evt_feast
  desc = EVTDESC_BRO_8003

	is_triggered_only = yes

	#accept
	option = {
		name = EVTOPTA_BRO_8003
	}
}

# Get claim on Archmage
character_event = {
  id = BRO.500
  is_triggered_only = yes
  desc = EVTDESC_BRO_500
  picture = GFX_evt_stressed_ruler
  border = GFX_event_normal_frame_economy

	option = { #get claim
		name = EVTOPTA_BRO_500
		ai_chance = {
			factor = 100
		}
		if = {
			limit = {
				AND = {
					independent = yes
					k_a_brotherhood = {
						has_holder = no
					}
				}
			}
			grant_title = k_a_brotherhood
		}
		else = {
			add_claim = k_a_brotherhood
		}
	}

  option = { #oopsie
    name = EVTOPTB_BRO_500
		#add paranoid
      if = {
        limit = {
          trait = trusting
          NOR = {
            trait = stressed
            trait = depressed
          }
        }
        random_list = {
          90 = { add_trait = stressed }
          10 = {
            add_trait = stressed
            add_trait = paranoid
          }
        }
      }
      else_if = {
        limit = {
          trait = trusting
          trait = stressed
          NOT = { trait = depressed }
        }
        random_list = {
          66 = { add_trait = depressed }
          33 = {
            add_trait = depressed
            add_trait = paranoid
          }
        }
      }
      else_if = {
        limit = {
          trait = trusting
          trait = depressed
          NOT = { trait = stressed }
        }
        random_list = {
          66 = { add_trait = stressed }
          33 = {
            add_trait = stressed
            add_trait = paranoid
          }
        }
      }
      else_if = {
        limit = {
          trait = trusting
          AND = {
            trait = stressed
            trait = depressed
          }
        }
        add_trait = paranoid
        random_list = {
          33 = {}
          33 = { remove_trait = stressed }
          33 = { remove_trait = depressed }
        }
      }
			else_if = {
				limit = {
					NOT = { trait = paranoid }
				}
				random_list = {
					66 = {}
					33 = { add_trait = paranoid }
				}
			}
  }
}

# start great ritual
character_event = {
	id = BRO.200
	desc = EVTDESC_BRO_200
	picture = GFX_evt_magic_ritual

	is_triggered_only = yes

	# Devil Pact
	option = {
		name = EVTOPTA_BRO_200

		character_event = { id = BRO.201 days = 14 }
  }
	# Genie Wish
	option = {
		name = EVTOPTB_BRO_200

		character_event = { id = BRO.202 days = 14 }
  }
}

# devil option
character_event = {
	id = BRO.201
	desc = EVTDESC_BRO_201
	picture = GFX_evt_magic_ritual

	is_triggered_only = yes

	# wish for strenght
	option = {
		name = EVTOPTA_BRO_201

		random_list = {
			50 = { character_event = { id = BRO.203 days = 1 tooltip = EVTTOOLTIP_BRO_203 } } #Stronger
			30 = { character_event = { id = BRO.204 days = 1 tooltip = EVTTOOLTIP_BRO_204 } } #Weaker
			20 = { character_event = { id = BRO.205 days = 1 tooltip = EVTTOOLTIP_BRO_205 } } #Minor health buff
		}
  }
	# wish for beauty
	option = {
		name = EVTOPTB_BRO_201

		random_list = {
			50 = { character_event = { id = BRO.206 days = 1 tooltip = EVTTOOLTIP_BRO_206 } } #prettier
			30 = { character_event = { id = BRO.207 days = 1 tooltip = EVTTOOLTIP_BRO_207 } } #uglier
			20 = { character_event = { id = BRO.208 days = 1 tooltip = EVTTOOLTIP_BRO_208 } } #Minor fertility buff
		}
  }

	# wish for int
	option = {
		name = EVTOPTC_BRO_201

		random_list = {
			50 = { character_event = { id = BRO.209 days = 1 tooltip = EVTTOOLTIP_BRO_209 } } #smarter
			30 = { character_event = { id = BRO.210 days = 1 tooltip = EVTTOOLTIP_BRO_210 } } #dumber
			20 = { character_event = { id = BRO.211 days = 1 tooltip = EVTTOOLTIP_BRO_211 } } #Minor tech buff
		}
  }

	# learning helps
	option = {
		name = EVTOPTD_BRO_201
		tooltip_info = learning
		trigger = {
			learning = 18
		}

		random_list = {
			25 = { character_event = { id = BRO.209 days = 1 tooltip = EVTTOOLTIP_BRO_209 } } #smarter
			8 = { character_event = { id = BRO.210 days = 1 tooltip = EVTTOOLTIP_BRO_210 } } #dumber
			25 = { character_event = { id = BRO.203 days = 1 tooltip = EVTTOOLTIP_BRO_203 } } #Stronger
			8 = { character_event = { id = BRO.204 days = 1 tooltip = EVTTOOLTIP_BRO_204 } } #Weaker
			25 = { character_event = { id = BRO.206 days = 1 tooltip = EVTTOOLTIP_BRO_206 } } #prettier
			8 = { character_event = { id = BRO.207 days = 1 tooltip = EVTTOOLTIP_BRO_207 } } #uglier
		}
  }
}

# genie option
character_event = {
	id = BRO.202
	desc = EVTDESC_BRO_202
	picture = GFX_evt_magic_ritual

	is_triggered_only = yes

	# wish for strenght
	option = {
		name = EVTOPTA_BRO_202

		random_list = {
			40 = { character_event = { id = BRO.203 days = 1 tooltip = EVTTOOLTIP_BRO_203 } } #Stronger
			20 = { character_event = { id = BRO.204 days = 1 tooltip = EVTTOOLTIP_BRO_204 } } #Weaker
			40 = { character_event = { id = BRO.205 days = 1 tooltip = EVTTOOLTIP_BRO_205 } } #Minor health buff
		}
  }
	# wish for beauty
	option = {
		name = EVTOPTB_BRO_202

		random_list = {
			40 = { character_event = { id = BRO.206 days = 1 tooltip = EVTTOOLTIP_BRO_206 } } #prettier
			20 = { character_event = { id = BRO.207 days = 1 tooltip = EVTTOOLTIP_BRO_207 } } #uglier
			40 = { character_event = { id = BRO.208 days = 1 tooltip = EVTTOOLTIP_BRO_208 } } #Minor fertility buff
		}
  }

	# wish for int
	option = {
		name = EVTOPTC_BRO_202

		random_list = {
			40 = { character_event = { id = BRO.209 days = 1 tooltip = EVTTOOLTIP_BRO_209 } } #smarter
			20 = { character_event = { id = BRO.210 days = 1 tooltip = EVTTOOLTIP_BRO_210 } } #dumber
			40 = { character_event = { id = BRO.211 days = 1 tooltip = EVTTOOLTIP_BRO_211 } } #Minor tech buff
		}
  }

	# intrigue helps
	option = {
		name = EVTOPTD_BRO_202
		tooltip_info = intrigue
		trigger = {
			intrigue = 18
		}

		random_list = {
			20 = { character_event = { id = BRO.209 days = 1 tooltip = EVTTOOLTIP_BRO_209 } } #smarter
			5 = { character_event = { id = BRO.210 days = 1 tooltip = EVTTOOLTIP_BRO_210 } } #dumber
			20 = { character_event = { id = BRO.203 days = 1 tooltip = EVTTOOLTIP_BRO_203 } } #Stronger
			5 = { character_event = { id = BRO.204 days = 1 tooltip = EVTTOOLTIP_BRO_204 } } #Weaker
			20 = { character_event = { id = BRO.206 days = 1 tooltip = EVTTOOLTIP_BRO_206 } } #prettier
			5 = { character_event = { id = BRO.207 days = 1 tooltip = EVTTOOLTIP_BRO_207 } } #uglier
			8 = { character_event = { id = BRO.205 days = 1 tooltip = EVTTOOLTIP_BRO_205 } } #Minor health buff
			8 = { character_event = { id = BRO.208 days = 1 tooltip = EVTTOOLTIP_BRO_208 } } #Minor fertility buff
			8 = { character_event = { id = BRO.211 days = 1 tooltip = EVTTOOLTIP_BRO_211 } } #Minor tech buff
		}
  }
}

# stronger
character_event = {
	id = BRO.203
	desc = EVTDESC_BRO_203
	picture = GFX_evt_magic_ritual

	is_triggered_only = yes

	option = {
		name = EVTOPTA_BRO_203

		if = {
			limit = {
				NOT = {
					trait = robust
				}
			}
			add_trait = robust
		}
		else_if = {
			limit = {
				NOR = {
					trait = hardy
					trait = tough
					trait = strong
				}
			}
			add_trait = hardy
		}
		else_if = {
			limit = {
				trait = hardy
			}
			remove_trait = hardy
			add_trait = tough
		}
		else = {
			remove_trait = tough
			add_trait = strong
		}

  }
}

# weaker
character_event = {
	id = BRO.204
	desc = EVTDESC_BRO_204
	picture = GFX_evt_magic_ritual

	is_triggered_only = yes

	option = {
		name = EVTOPTA_BRO_204

		if = {
			limit = {
				NOT = {
					trait = feeble
				}
			}
			add_trait = feeble
		}
		else_if = {
			limit = {
				NOR = {
					trait = soft
					trait = delicate
					trait = weak
				}
			}
			add_trait = soft
		}
		else_if = {
			limit = {
				trait = soft
			}
			remove_trait = soft
			add_trait = delicate
		}
		else = {
			remove_trait = delicate
			add_trait = weak
		}

  }
}

# health buff
character_event = {
	id = BRO.205
	desc = EVTDESC_BRO_205
	picture = GFX_evt_magic_ritual

	is_triggered_only = yes

	option = {
		name = EVTOPTA_BRO_205

		health = 1

  }
}

# prettier
character_event = {
	id = BRO.206
	desc = EVTDESC_BRO_206
	picture = GFX_evt_magic_ritual

	is_triggered_only = yes

	option = {
		name = EVTOPTA_BRO_206

		if = {
			limit = {
				NOT = {
					trait = groomed
				}
			}
			add_trait = groomed
		}
		else_if = {
			limit = {
				NOR = {
					trait = pretty
					trait = fair
					trait = beautiful
				}
			}
			add_trait = pretty
		}
		else_if = {
			limit = {
				trait = pretty
			}
			remove_trait = pretty
			add_trait = fair
		}
		else = {
			remove_trait = fair
			add_trait = beautiful
		}

  }
}

# uglier
character_event = {
	id = BRO.207
	desc = EVTDESC_BRO_207
	picture = GFX_evt_magic_ritual

	is_triggered_only = yes

	option = {
		name = EVTOPTA_BRO_207

		if = {
			limit = {
				NOT = {
					trait = uncouth
				}
			}
			add_trait = uncouth
		}
		else_if = {
			limit = {
				NOR = {
					trait = plain
					trait = ugly
					trait = unsightly
				}
			}
			add_trait = plain
		}
		else_if = {
			limit = {
				trait = plain
			}
			remove_trait = plain
			add_trait = ugly
		}
		else = {
			remove_trait = ugly
			add_trait = unsightly
		}

  }
}

# fertility buff
character_event = {
	id = BRO.208
	desc = EVTDESC_BRO_208
	picture = GFX_evt_magic_ritual

	is_triggered_only = yes

	option = {
		name = EVTOPTA_BRO_208

		fertility = 0.30

  }
}

# smarter
character_event = {
	id = BRO.209
	desc = EVTDESC_BRO_209
	picture = GFX_evt_magic_ritual

	is_triggered_only = yes

	option = {
		name = EVTOPTA_BRO_209

		if = {
			limit = {
				NOT = {
					trait = shrewd
				}
			}
			add_trait = shrewd
		}
		else_if = {
			limit = {
				NOR = {
					trait = quick
					trait = brilliant
					trait = genius
				}
			}
			add_trait = quick
		}
		else_if = {
			limit = {
				trait = quick
			}
			remove_trait = quick
			add_trait = brilliant
		}
		else = {
			remove_trait = brilliant
			add_trait = genius
		}

  }
}

# dumber
character_event = {
	id = BRO.210
	desc = EVTDESC_BRO_210
	picture = GFX_evt_magic_ritual

	is_triggered_only = yes

	option = {
		name = EVTOPTA_BRO_210

		if = {
			limit = {
				NOT = {
					trait = dull
				}
			}
			add_trait = dull
		}
		else_if = {
			limit = {
				NOR = {
					trait = slow
					trait = idiot
					trait = imbecile
				}
			}
			add_trait = slow
		}
		else_if = {
			limit = {
				trait = slow
			}
			remove_trait = slow
			add_trait = idiot
		}
		else = {
			remove_trait = idiot
			add_trait = imbecile
		}

  }
}

# tech buff
character_event = {
	id = BRO.211
	desc = EVTDESC_BRO_211
	picture = GFX_evt_magic_ritual

	is_triggered_only = yes

	option = {
		name = EVTOPTA_BRO_211

		military_techpoints = 100
		economy_techpoints = 100
		culture_techpoints = 100

  }
}

# start experiment
character_event = {
	id = BRO.300
	desc = EVTDESC_BRO_300
	picture = GFX_evt_gathering_of_minds

	is_triggered_only = yes

	# warlike
	option = {
		name = EVTOPTA_BRO_300
		trigger = { martial = 10 }
		tooltip_info = martial

		character_event = { id = BRO.301 days = 14 }
  }
	# economic
	option = {
		name = EVTOPTB_BRO_300
		trigger = { stewardship = 10 }
		tooltip_info = stewardship

		character_event = { id = BRO.305 days = 14 }
  }
	# research
	option = {
		name = EVTOPTC_BRO_300

		character_event = { id = BRO.308 days = 14 }
  }
}

# warlike
character_event = {
	id = BRO.301
	desc = EVTDESC_BRO_301
	picture = GFX_evt_gathering_of_minds

	is_triggered_only = yes

	# Risky
	option = {
		name = EVTOPTA_BRO_301

		random_list = {
			50 = { character_event = { id = BRO.302 days = 30 tooltip = EVTTOOLTIP_BRO_302 } } #Great warlike
			30 = { character_event = { id = BRO.303 days = 15 tooltip = EVTTOOLTIP_BRO_303 } } #Good warlike
			20 = { character_event = { id = BRO.304 days = 10 tooltip = EVTTOOLTIP_BRO_304 } } #Disaster
		}
  }
	# Safe
	option = {
		name = EVTOPTB_BRO_301

		random_list = {
			35 = { character_event = { id = BRO.302 days = 30 tooltip = EVTTOOLTIP_BRO_302 } } #Great warlike
			60 = { character_event = { id = BRO.303 days = 15 tooltip = EVTTOOLTIP_BRO_303 } } #Good warlike
			5 = { character_event = { id = BRO.304 days = 10 tooltip = EVTTOOLTIP_BRO_304 } } #Disaster
		}
  }
}

# Great warlike
character_event = {
	id = BRO.302
	desc = EVTDESC_BRO_302
	picture = GFX_evt_abyss_1

	is_triggered_only = yes

	option = {
		name = EVTOPTA_BRO_302

		capital_scope = {
			add_province_modifier = {
				name = fiendish_portal
				years = 30
			}
		}
  }
}

# Good warlike
character_event = {
	id = BRO.303
	desc = EVTDESC_BRO_303
	picture = GFX_evt_castle_3

	is_triggered_only = yes

	option = {
		name = EVTOPTA_BRO_303

		capital_scope = {
			add_province_modifier = {
				name = enchanted_ballistas
				years = 30
			}
		}
  }
}

# Disaster
character_event = {
	id = BRO.304
	desc = EVTDESC_BRO_304
	picture = GFX_evt_burning_house_arabic

	is_triggered_only = yes

	option = {
		name = EVTOPTA_BRO_304

		random_list = {
			20 = {
				add_trait = severely_injured
				add_trait = one_handed
			}
			20 = {
				add_trait = severely_injured
				add_trait = one_legged
			}
			20 = {
				add_trait = severely_injured
				add_trait = one_eyed
			}
			20 = {
				add_trait = severely_injured
			}
			10 = {
				add_trait = stressed
			}
			10 = {
				add_trait = mangled
			}
		}
  }
}

# economic
character_event = {
	id = BRO.305
	desc = EVTDESC_BRO_305
	picture = GFX_evt_gathering_of_minds

	is_triggered_only = yes

	# Risky
	option = {
		name = EVTOPTA_BRO_305

		random_list = {
			50 = { character_event = { id = BRO.306 days = 30 tooltip = EVTTOOLTIP_BRO_306 } } #Great economic
			30 = { character_event = { id = BRO.307 days = 15 tooltip = EVTTOOLTIP_BRO_307 } } #Good economic
			20 = { character_event = { id = BRO.304 days = 10 tooltip = EVTTOOLTIP_BRO_304 } } #Disaster
		}
  }
	# Safe
	option = {
		name = EVTOPTB_BRO_305

		random_list = {
			35 = { character_event = { id = BRO.306 days = 30 tooltip = EVTTOOLTIP_BRO_306 } } #Great economic
			60 = { character_event = { id = BRO.307 days = 15 tooltip = EVTTOOLTIP_BRO_307 } } #Good economic
			5 = { character_event = { id = BRO.304 days = 10 tooltip = EVTTOOLTIP_BRO_304 } } #Disaster
		}
  }
}

# Great economic
character_event = {
	id = BRO.306
	desc = EVTDESC_BRO_306
	picture = GFX_evt_spelljammer_1

	is_triggered_only = yes

	option = {
		name = EVTOPTA_BRO_306

		capital_scope = {
			add_province_modifier = {
				name = earth_plane_portal
				years = 30
			}
		}
  }
}

# Good economic
character_event = {
	id = BRO.307
	desc = EVTDESC_BRO_307
	picture = GFX_evt_modrons_1

	is_triggered_only = yes

	option = {
		name = EVTOPTA_BRO_307

		capital_scope = {
			add_province_modifier = {
				name = working_golems
				years = 30
			}
		}
  }
}

# research
character_event = {
	id = BRO.308
	desc = EVTDESC_BRO_308
	picture = GFX_evt_gathering_of_minds

	is_triggered_only = yes

	# Risky
	option = {
		name = EVTOPTA_BRO_308

		random_list = {
			50 = { character_event = { id = BRO.309 days = 30 tooltip = EVTTOOLTIP_BRO_309 } } #Great research
			30 = { character_event = { id = BRO.310 days = 15 tooltip = EVTTOOLTIP_BRO_310 } } #Good research
			20 = { character_event = { id = BRO.304 days = 10 tooltip = EVTTOOLTIP_BRO_304 } } #Disaster
		}
  }
	# Safe
	option = {
		name = EVTOPTB_BRO_308

		random_list = {
			35 = { character_event = { id = BRO.309 days = 30 tooltip = EVTTOOLTIP_BRO_309 } } #Great research
			60 = { character_event = { id = BRO.310 days = 15 tooltip = EVTTOOLTIP_BRO_310 } } #Good research
			5 = { character_event = { id = BRO.304 days = 10 tooltip = EVTTOOLTIP_BRO_304 } } #Disaster
		}
  }
}

# Great research
character_event = {
	id = BRO.309
	desc = EVTDESC_BRO_309
	picture = GFX_evt_wizard

	is_triggered_only = yes

	option = {
		name = EVTOPTA_BRO_309

		capital_scope = {
			add_province_modifier = {
				name = soul_repository
				years = 30
			}
		}
  }
}

# Good research
character_event = {
	id = BRO.310
	desc = EVTDESC_BRO_310
	picture = GFX_evt_scholar_1

	is_triggered_only = yes

	option = {
		name = EVTOPTA_BRO_310

		capital_scope = {
			add_province_modifier = {
				name = animated_quills
				years = 30
			}
		}
  }
}

########################AI JOIN AND AI RANK UP###########################

character_event = { #force the AI to join a society
  id = BRO.110
  hide_window = yes
  is_triggered_only = yes

	immediate = {
		if = {
			limit = { #if he's already a member, will force a rank up 25% of the time
				ai = yes
				prisoner = no
				NOT = { trait = incapable }
				higher_tier_than = BARON
				society_member_of = arcane_brotherhood
				society_rank <= 3
				society_can_rank_up = yes
			}
			random_list = {
				75 = {}
				25 = {
					society_rank_up = 1
				}
			}
		}
		if = { #force the joining event on AI
			limit = {
				ai = yes
				prisoner = no
				NOT = { trait = incapable }
        is_adult = yes
        is_in_society = no
        controls_religion = no
				block_general_event_trigger = no
			}
			character_event = { id = BRO.111 }
		}
	}
}

character_event = { #AI join event
	id = BRO.111
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		random_list = {
			60 = { # do nothing
			}
			40 = {
				trigger = {
					can_join_society = arcane_brotherhood
				}
				modifier = {
					factor = 2
					OR = {
						trait = schemer
						trait = scholar
						trait = impaler
						trait = mystic
					}
				}
				modifier = {
          factor = 2
          trait = cynical
        }
				modifier = {
          factor = 2
          trait = proud
        }
        modifier = {
          factor = 2
          trait = envious
        }
        modifier = {
          factor = 2
          trait = ambitious
        }
        modifier = {
          factor = 2
          trait = cruel
        }
				modifier = {
          factor = 2
          trait = erudite
        }
				modifier = {
          factor = 2
          trait = deceitful
        }
				modifier = {
          factor = 0.5
          z_wizard = no
        }
				modifier = {
					factor = 0
					is_benevolent_trigger = yes
				}
				modifier = {
					factor = 0.1
					OR = {
						trait = kind
						trait = honest
					}
				}
				join_society = arcane_brotherhood
				random_list = { # Artificially increase society influence for balance purposes, not really useful in my opinion.
					75 = {
						modifier = {
							factor = 0
							society_influence >= 30
						}
					}
					25 = {
					}
				}
				if = { # Make grandmaster is there is none
					limit = {
						NOT = {
							society = {
								any_society_member = {
									is_society_grandmaster = yes
								}
							}
						}
					}
					set_society_grandmaster = yes
				}
			}
		}
	}
}

###########MISSIONS###########

#Mission tombola
character_event = {
    id = BRO.1000
    hide_window = yes

    is_triggered_only = yes
    capable_only = yes
	is_in_society = yes

	trigger = {
		society_member_of = arcane_brotherhood
		has_any_quest = no
		NOT = { has_character_modifier = quest_cooldown_timer }
		NOT = { is_inaccessible_trigger = yes }
		prisoner = no
		society = {
			any_society_member = {
				NOT = { character = ROOT }
				prisoner = no
				is_within_diplo_range = ROOT
				opinion = { who = ROOT value = 0 }
			}
		}
	}

    immediate = {
    	#Picks out mission giver
    	random_list = {
    		20 = { #International society member
    			society = {
    				any_society_member = {
    					limit = {
							NOT = { character = ROOT }
							prisoner = no
    						is_within_diplo_range = ROOT
							opinion = { who = ROOT value = 0 }
    					}
    					save_event_target_as = hermetic_collaborator
    				}
    			}
    		}
    		40 = { #Realm society member
    			trigger = {
    				society = {
    					any_society_member = {
    						NOT = { character = ROOT }
    						prisoner = no
    						is_within_diplo_range = ROOT
							opinion = { who = ROOT value = 0 }
							same_realm = ROOT
    					}
    				}
    			}
    			society = {
    				any_society_member = {
    					limit = {
    						NOT = { character = ROOT }
    						prisoner = no
    						is_within_diplo_range = ROOT
							opinion = { who = ROOT value = 0 }
							same_realm = ROOT
    					}
    					save_event_target_as = hermetic_collaborator
    				}
    			}
    		}
    		40 = { #Apprentice
    			trigger = {
    				any_courtier_or_vassal = { has_minor_title =  title_brotherhood_apprentice prisoner = no }
					society_member_of = arcane_brotherhood
    			}
    			random_courtier_or_vassal = {
    				limit = { has_minor_title =  title_brotherhood_apprentice }
    				save_event_target_as = hermetic_collaborator
    			}
    		}
    	}


    	#Randomizes mission
    	random_list = {

    		25 = { #Find an apprentice
    			trigger = {
    				NOT = { any_courtier_or_vassal = { has_minor_title =  title_brotherhood_apprentice } }
    				ai = no
    			}
    			event_target:hermetic_collaborator = { character_event = { id = BRO.1404 days = 7 random = 7 } }
    		}

			25 = { #Build a laboratory
				trigger = {
					NOT = { has_character_flag = building_laboratory }
					NOT = { has_character_flag = built_laboratory }
					OR = {
    					ai = no
    					society_rank == 4
    				}
    				is_landed = yes
				}
				event_target:hermetic_collaborator = { character_event = { id = BRO.1120 days = 7 random = 7 } }
			}

			25 = { #Acquire/gather ingredients
				trigger = {
					is_landed = yes
					NOT = {
						any_artifact = {
							has_artifact_flag = ingredient
						}
					}
					event_target:hermetic_collaborator = { ai = yes }
				}
				event_target:hermetic_collaborator = { character_event = { id = BRO.1801 days = 7 random = 7 } }
			}

    		25 = { #Infiltrate lab
    			trigger = {
    				society = {
    					any_society_member = {
    						is_within_diplo_range = ROOT
    						NOR = {
    							character = ROOT
    							character = event_target:hermetic_collaborator
    							reverse_opinion = { who = event_target:hermetic_collaborator value = 20 }
    							reverse_opinion = { who = ROOT value = 20 }
    							has_character_flag = infiltration_rival
    							has_character_flag = infiltration_mutual_dislike
    							has_character_flag = infiltration_rich
    						}
    					}
    				}
    			}
    			event_target:hermetic_collaborator = { character_event = { id = BRO.1430 days = 7 random = 7 } }
    		}

			105 = { # AI bypasses missions at times
				modifier = {
					factor = 0
					ai = no
				}
				random_list = {
					70 = {
						modifier = {
							factor = 0.9
							society_influence >= 30
						}
						modifier = {
							factor = 0.9
							society_influence >= 40
						}
						modifier = {
							factor = 0.8
							society_influence >= 50
						}
						modifier = {
							factor = 0.7
							society_influence >= 70
						}
						modifier = {
							factor = 0.6
							society_influence >= 80
						}
						modifier = {
							factor = 0.5
							society_influence >= 90
						}
						add_mission_succeed_influence_effect = yes
					}
					30 = {
						add_mission_fail_influence_effect = yes
					}
				}
			}

			175 = {
				modifier = {
					factor = 0
					ai = no
				}
				#Do nothing for AI
			}
    	}
    }
}

#Mission: Building a Laboratory
#Flags:
#Temporary:
#building_laboratory (cleared at end)
#decided_on_glass (cleared at end)
#decided_on_crucibles (cleared at end)
#decided_on_tools (cleared at end)
#decided_on_books (cleared at end)
#Not Temporary:
#built_laboratory (not cleared -> set at end, marks this as done for this character)
#hidden_lab (not cleared -> to be used to weight stealing of secrets)
#very_hidden_lab (not cleared -> to be used to weight stealing of secrets)

character_event = {
	id = BRO.1100
	desc = EVTDESC_MNM_1100
	picture = GFX_evt_castle_construction
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1100
		hidden_tooltip = {
			character_event = { id = BRO.1101 days = 7 }
			set_variable = { which = laboratory_level value = 1 }
		}
	}
	option = {
		name = EVTOPTB_MNM_1100
		clr_character_flag = building_laboratory
		wealth = 50
	}
}

#Where should the Laboratory be built?
character_event = {
	id = BRO.1101
	desc = EVTDESC_MNM_1101
	picture = GFX_evt_castle_construction
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	trigger = {
		has_quest = quest_hermetics_build_laboratory
	}

	option = {
		name = EVTOPTA_MNM_1101 #In my Castle, hidden away
		custom_tooltip = {
			text = hidden_lab_tooltip
			set_character_flag = hidden_lab
		}
		hidden_effect = {
			change_variable = { which = laboratory_level value = 2 }
			character_event = { id = BRO.1102 days = 30 }
		}
	}
	option = {
		name = EVTOPTB_MNM_1101 #In an accessible place
		custom_tooltip = {
			text = accessible_lab_tooltip
		}
		hidden_effect = {
			change_variable = { which = laboratory_level value = 5 }
			character_event = { id = BRO.1102 days = 30 }
		}
	}
	option = {
		name = EVTOPTC_MNM_1101 #On an island or other very remote place
		trigger = {
			OR = {
				intrigue = 15
				trait = paranoid
			}
			capital_scope = { port = yes }
		}
		custom_tooltip = {
			text = very_hidden_lab_tooltip
			set_character_flag = very_hidden_lab
		}
		hidden_effect = {
			change_variable = { which = laboratory_level value = 3 }
			character_event = { id = BRO.1102 days = 30 }
		}
	}
	option = {
		name = EVTOPTD_MNM_1101 #On an island or other very remote place
		trigger = {
			OR = {
				intrigue = 15
				trait = paranoid
			}
			capital_scope = {
				port = no
			}
		}
		custom_tooltip = {
			text = very_hidden_lab_tooltip
			set_character_flag = very_hidden_lab
		}
		hidden_effect = {
			change_variable = { which = laboratory_level value = 3 }
			character_event = { id = BRO.1102 days = 30 }
		}
	}
}

#What kind of laboratory should we build?
character_event = {
	id = BRO.1102
	desc = EVTDESC_MNM_1102
	picture = GFX_evt_weaponsmith
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1102 #
		custom_tooltip = {
			text = cheap_laboratory_setup
		}
		hidden_effect = {
			change_variable = { which = laboratory_level value = 1 }
			set_variable = { which = lab_ambition value = 1 }
			random_list = {
				25 = {
					trigger = { NOT = { has_character_flag = decided_on_glass } }
					character_event = { id = BRO.1103 days = 60 }
				}
				25 = {
					trigger = { NOT = { has_character_flag = decided_on_crucibles } }
					character_event = { id = BRO.1104 days = 60 }
				}
				25 = {
					trigger = { NOT = { has_character_flag = decided_on_tools } }
					character_event = { id = BRO.1105 days = 60 }
				}
				25 = {
					trigger = { NOT = { has_character_flag = decided_on_books } }
					character_event = { id = BRO.1106 days = 60 }
				}
			}
			random_list = { #Accidents
				25 = { } #Nothing Happens
				25 = { character_event = { id = BRO.1113 days = 30 } }
				25 = { character_event = { id = BRO.1114 days = 30 } }
				25 = { character_event = { id = BRO.1115 days = 30 } }
			}
		}
	}
	option = {
		name = EVTOPTB_MNM_1102 #
		wealth = -20
		custom_tooltip = {
			text = efficient_laboratory_setup
		}
		hidden_effect = {
			change_variable = { which = laboratory_level value = 3 }
			set_variable = { which = lab_ambition value = 2 }
			random_list = {
				25 = {
					trigger = { NOT = { has_character_flag = decided_on_glass } }
					character_event = { id = BRO.1103 days = 30 }
				}
				25 = {
					trigger = { NOT = { has_character_flag = decided_on_crucibles } }
					character_event = { id = BRO.1104 days = 30 }
				}
				25 = {
					trigger = { NOT = { has_character_flag = decided_on_tools } }
					character_event = { id = BRO.1105 days = 30 }
				}
				25 = {
					trigger = { NOT = { has_character_flag = decided_on_books } }
					character_event = { id = BRO.1106 days = 30 }
				}
			}
			random_list = { #Accidents
				25 = { } #Nothing Happens
				25 = { character_event = { id = BRO.1113 days = 45 } }
				25 = { character_event = { id = BRO.1114 days = 45 } }
				25 = { character_event = { id = BRO.1115 days = 45 } }
			}
		}
	}
	option = {
		name = EVTOPTC_MNM_1102 #State of the Art.
		trigger = {
			OR = {
				learning = 15
				AND = { #Both master and apprentice have acceptable learning
					learning = 12
					any_courtier_or_vassal = {
						has_minor_title = title_brotherhood_apprentice
						learning = 12
					}
				}
			}
		}
		wealth = -35
		custom_tooltip = {
			text = large_laboratory_setup
		}
		hidden_effect = {
			change_variable = { which = laboratory_level value = 5 }
			set_variable = { which = lab_ambition value = 3 }
			random_list = {
				25 = {
					trigger = { NOT = { has_character_flag = decided_on_glass } }
					character_event = { id = BRO.1103 days = 30 }
				}
				25 = {
					trigger = { NOT = { has_character_flag = decided_on_crucibles } }
					character_event = { id = BRO.1104 days = 30 }
				}
				25 = {
					trigger = { NOT = { has_character_flag = decided_on_tools } }
					character_event = { id = BRO.1105 days = 30 }
				}
				25 = {
					trigger = { NOT = { has_character_flag = decided_on_books } }
					character_event = { id = BRO.1106 days = 30 }
				}
			}
			random_list = { #Accidents
				25 = { } #Nothing Happens
				25 = { character_event = { id = BRO.1113 days = 45 } }
				25 = { character_event = { id = BRO.1114 days = 45 } }
				25 = { character_event = { id = BRO.1115 days = 45 } }
			}
		}
	}
	option = {
		name = EVTOPTD_MNM_1102 #Experimental setup
		trigger = {
			OR = {
				learning = 25
				AND = { #Both have good learning
					learning = 15
					any_courtier_or_vassal = {
						has_minor_title = title_brotherhood_apprentice
						learning = 15
					}
				}
			}
		}
		wealth = -50
		custom_tooltip = {
			text = extravagant_laboratory_setup
		}
		hidden_effect = {
			change_variable = { which = laboratory_level value = 8 }
			set_variable = { which = lab_ambition value = 4 }
			random_list = {
				25 = {
					trigger = { NOT = { has_character_flag = decided_on_glass } }
					character_event = { id = BRO.1103 days = 30 }
				}
				25 = {
					trigger = { NOT = { has_character_flag = decided_on_crucibles } }
					character_event = { id = BRO.1104 days = 30 }
				}
				25 = {
					trigger = { NOT = { has_character_flag = decided_on_tools } }
					character_event = { id = BRO.1105 days = 30 }
				}
				25 = {
					trigger = { NOT = { has_character_flag = decided_on_books } }
					character_event = { id = BRO.1106 days = 30 }
				}
			}
			random_list = { #Accidents
				25 = { } #Nothing Happens
				25 = { character_event = { id = BRO.1113 days = 45 } }
				25 = { character_event = { id = BRO.1114 days = 45 } }
				25 = { character_event = { id = BRO.1115 days = 45 } }
			}
		}
	}
}

#What kind of equipment do we need?
#Variant 1 - Flasks, Alembics, test tubes, etc
character_event = {
	id = BRO.1103
	desc = EVTDESC_MNM_1103
	picture = GFX_evt_experiment
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			set_character_flag = decided_on_glass
		}
	}

	option = {
		name = EVTOPTA_MNM_1103 #
		custom_tooltip = {
			text = non_fancy_laboratory_glass_tooltip
		}
		hidden_effect = {
			change_variable = {
				which = laboratory_level value = 1
			}
			change_variable = { which = lab_ambition value = -1 }
			if = {
				limit = {
					check_variable = {
						which = lab_ambition
						value = 1
					}
				}
				random_list = {
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_glass } }
						character_event = { id = BRO.1103 days = 30 }
					}
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_crucibles } }
						character_event = { id = BRO.1104 days = 30 }
					}
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_tools } }
						character_event = { id = BRO.1105 days = 30 }
					}
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_books } }
						character_event = { id = BRO.1106 days = 30 }
					}
				}
			}
			if = {
				limit = {
					NOT = {
						check_variable = {
							which = lab_ambition
							value = 1
						}
					}
				}
				character_event = { id = BRO.1107 days = 60 }
			}
		}
	}
	option = {
		name = EVTOPTB_MNM_1103 #
		wealth = -20
		custom_tooltip = {
			text = fancy_laboratory_glass_tooltip
		}
		hidden_effect = {
			change_variable = { which = laboratory_level value = 2 }
			change_variable = { which = lab_ambition value = -1 }
			if = {
				limit = {
					check_variable = {
						which = lab_ambition
						value = 1
					}
				}
				random_list = {
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_glass } }
						character_event = { id = BRO.1103 days = 30 }
					}
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_crucibles } }
						character_event = { id = BRO.1104 days = 30 }
					}
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_tools } }
						character_event = { id = BRO.1105 days = 30 }
					}
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_books } }
						character_event = { id = BRO.1106 days = 30 }
					}
				}
			}
			if = {
				limit = {
					NOT = {
						check_variable = {
							which = lab_ambition
							value = 1
						}
					}
				}
				character_event = { id = BRO.1107 days = 60 }
			}
		}
	}
}

#Variant 2 - Crucibles
character_event = {
	id = BRO.1104
	desc = EVTDESC_MNM_1104
	picture = GFX_evt_experiment
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			set_character_flag = decided_on_crucibles
		}
	}

	option = {
		name = EVTOPTA_MNM_1104 #
		custom_tooltip = {
			text = non_fancy_laboratory_crucibles_tooltip
		}
		hidden_effect = {
			change_variable = { which = laboratory_level value = 1 }
			change_variable = { which = lab_ambition value = -1 }
			if = {
				limit = {
					check_variable = {
						which = lab_ambition
						value = 1
					}
				}
				random_list = {
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_glass } }
						character_event = { id = BRO.1103 days = 30 }
					}
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_crucibles } }
						character_event = { id = BRO.1104 days = 30 }
					}
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_tools } }
						character_event = { id = BRO.1105 days = 30 }
					}
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_books } }
						character_event = { id = BRO.1106 days = 30 }
					}
				}
			}
			if = {
				limit = {
					NOT = {
						check_variable = {
							which = lab_ambition
							value = 1
						}
					}
				}
				character_event = { id = BRO.1107 days = 60 }
			}
		}
	}
	option = {
		name = EVTOPTB_MNM_1104 #
		wealth = -20
		custom_tooltip = {
			text = fancy_laboratory_crucibles_tooltip
		}
		hidden_effect = {
			change_variable = { which = laboratory_level value = 2 }
			change_variable = { which = lab_ambition value = -1 }
			if = {
				limit = {
					check_variable = {
						which = lab_ambition
						value = 1
					}
				}
				random_list = {
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_glass } }
						character_event = { id = BRO.1103 days = 30 }
					}
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_crucibles } }
						character_event = { id = BRO.1104 days = 30 }
					}
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_tools } }
						character_event = { id = BRO.1105 days = 30 }
					}
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_books } }
						character_event = { id = BRO.1106 days = 30 }
					}
				}
			}
			if = {
				limit = {
					NOT = {
						check_variable = {
							which = lab_ambition
							value = 1
						}
					}
				}
				character_event = { id = BRO.1107 days = 60 }
			}
		}
	}
}

#Variant 3 - Iron Tools
character_event = {
	id = BRO.1105
	desc = EVTDESC_MNM_1105
	picture = GFX_evt_weaponsmith
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			set_character_flag = decided_on_tools
		}
	}

	option = {
		name = EVTOPTA_MNM_1105 #
		custom_tooltip = {
			text = non_fancy_laboratory_tools_tooltip
		}
		hidden_effect = {
			change_variable = { which = laboratory_level value = 1 }
			change_variable = { which = lab_ambition value = -1 }
			if = {
				limit = {
					check_variable = {
						which = lab_ambition
						value = 1
					}
				}
				random_list = {
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_glass } }
						character_event = { id = BRO.1103 days = 30 }
					}
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_crucibles } }
						character_event = { id = BRO.1104 days = 30 }
					}
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_tools } }
						character_event = { id = BRO.1105 days = 30 }
					}
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_books } }
						character_event = { id = BRO.1106 days = 30 }
					}
				}
			}
			if = {
				limit = {
					NOT = {
						check_variable = {
							which = lab_ambition
							value = 1
						}
					}
				}
				character_event = { id = BRO.1107 days = 60 }
			}
		}
	}
	option = {
		name = EVTOPTB_MNM_1105 #
		wealth = -20
		custom_tooltip = {
			text = fancy_laboratory_tools_tooltip
		}
		hidden_effect = {
			change_variable = { which = laboratory_level value = 2 }
			change_variable = { which = lab_ambition value = -1 }
			if = {
				limit = {
					check_variable = {
						which = lab_ambition
						value = 1
					}
				}
				random_list = {
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_glass } }
						character_event = { id = BRO.1103 days = 30 }
					}
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_crucibles } }
						character_event = { id = BRO.1104 days = 30 }
					}
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_tools } }
						character_event = { id = BRO.1105 days = 30 }
					}
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_books } }
						character_event = { id = BRO.1106 days = 30 }
					}
				}
			}
			if = {
				limit = {
					NOT = {
						check_variable = {
							which = lab_ambition
							value = 1
						}
					}
				}
				character_event = { id = BRO.1107 days = 60 }
			}
		}
	}
}

#Variant 4 - Books
#Herbals, Lapidarii, etc
character_event = {
	id = BRO.1106
	desc = EVTDESC_MNM_1106
	picture = GFX_evt_book_carolingian_script
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			set_character_flag = decided_on_books
		}
	}

	option = {
		name = EVTOPTA_MNM_1106 #
		custom_tooltip = {
			text = non_fancy_laboratory_books_tooltip
		}
		hidden_effect = {
			change_variable = { which = laboratory_level value = 1 }
			change_variable = { which = lab_ambition value = -1 }
			if = {
				limit = {
					check_variable = {
						which = lab_ambition
						value = 1
					}
				}
				random_list = {
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_glass } }
						character_event = { id = BRO.1103 days = 30 }
					}
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_crucibles } }
						character_event = { id = BRO.1104 days = 30 }
					}
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_tools } }
						character_event = { id = BRO.1105 days = 30 }
					}
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_books } }
						character_event = { id = BRO.1106 days = 30 }
					}
				}
			}
			if = {
				limit = {
					NOT = {
						check_variable = {
							which = lab_ambition
							value = 1
						}
					}
				}
				character_event = { id = BRO.1107 days = 60 }
			}
		}
	}
	option = {
		name = EVTOPTB_MNM_1106 #
		wealth = -20
		custom_tooltip = {
			text = fancy_laboratory_books_tooltip
		}
		hidden_effect = {
			change_variable = { which = laboratory_level value = 2 }
			change_variable = { which = lab_ambition value = -1 }
			if = {
				limit = {
					check_variable = {
						which = lab_ambition
						value = 1
					}
				}
				random_list = {
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_glass } }
						character_event = { id = BRO.1103 days = 30 }
					}
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_crucibles } }
						character_event = { id = BRO.1104 days = 30 }
					}
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_tools } }
						character_event = { id = BRO.1105 days = 30 }
					}
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_books } }
						character_event = { id = BRO.1106 days = 30 }
					}
				}
			}
			if = {
				limit = {
					NOT = {
						check_variable = {
							which = lab_ambition
							value = 1
						}
					}
				}
				character_event = { id = BRO.1107 days = 60 }
			}
		}
	}
}

#Work is done
character_event = {
	id = BRO.1107
	picture = GFX_evt_experiment
	border = GFX_event_normal_frame_religion

	hide_window = yes
	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			set_character_flag = built_laboratory
			clr_character_flag = building_laboratory
			clr_character_flag = decided_on_glass
			clr_character_flag = decided_on_crucibles
			clr_character_flag = decided_on_tools
			clr_character_flag = decided_on_books
			if = {
				limit = {
					NOT = {
						check_variable = {
							which = laboratory_level
							value = 6
						}
					}
				}
				character_event = { id = BRO.1108 } # Cheap Laboratory
			}
			if = {
				limit = {
					check_variable = {
						which = laboratory_level
						value = 6
					}
					NOT = {
						check_variable = {
							which = laboratory_level
							value = 12
						}
					}
				}
				character_event = { id = BRO.1109 } # Normal Laboratory
			}
			if = {
				limit = {
					check_variable = {
						which = laboratory_level
						value = 12
					}
					NOT = {
						check_variable = {
							which = laboratory_level
							value = 18
						}
					}
				}
				character_event = { id = BRO.1110 } # Good Laboratory
			}
			if = {
				limit = {
					check_variable = {
						which = laboratory_level
						value = 18
					}
					NOT = {
						check_variable = {
							which = laboratory_level
							value = 23
						}
					}
				}
				narrative_event = { id = BRO.1111 } # Great Laboratory
			}
			if = {
				limit = {
					check_variable = {
						which = laboratory_level
						value = 23
					}
				}
				narrative_event = { id = BRO.1112 } # Best Laboratory
			}
		}
	}
}

#Finished Cheap Lab
character_event = {
	id = BRO.1108
	desc = EVTDESC_MNM_1108
	picture = GFX_evt_experiment
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1108 #
		add_character_modifier = {
			name = "cheap_laboratory"
			duration = -1
		}
		hidden_effect = {
			character_event = { id = BRO.1122 }
		}
	}
}

#Finished Normal Lab
character_event = {
	id = BRO.1109
	desc = EVTDESC_MNM_1109
	picture = GFX_evt_experiment
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1109 #
		economy_techpoints = 5
		add_character_modifier = {
			name = "normal_laboratory"
			duration = -1
		}
		hidden_effect = {
			character_event = { id = BRO.1122 }
		}
	}
}

#Finished Good Lab
character_event = {
	id = BRO.1110
	desc = EVTDESC_MNM_1110
	picture = GFX_evt_experiment
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1110 #
		economy_techpoints = 15
		add_character_modifier = {
			name = "good_laboratory"
			duration = -1
		}
		hidden_effect = {
			character_event = { id = BRO.1122 }
		}
	}
}

#Finished Great Lab
narrative_event = {
	id = BRO.1111
	title = EVTNAME_MNM_1111
	desc = EVTDESC_MNM_1111
	picture = GFX_evt_experiment
	border = GFX_event_narrative_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1111 #
		economy_techpoints = 30
		add_character_modifier = {
			name = "great_laboratory"
			duration = -1
		}
		hidden_effect = {
			character_event = { id = BRO.1122 }
		}
	}
}

#Finished Best Lab
narrative_event = {
	id = BRO.1112
	title = EVTNAME_MNM_1112
	desc = EVTDESC_MNM_1112
	picture = GFX_evt_experiment
	border = GFX_event_narrative_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1112 #
		economy_techpoints = 50
		add_character_modifier = {
			name = "best_laboratory"
			duration = -1
		}
		hidden_effect = {
			character_event = { id = BRO.1122 }
		}
	}
}

#Laboratory Accidents

character_event = {
	id = BRO.1113
	desc = EVTDESC_MNM_1113
	picture = GFX_evt_burning_house_arabic
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			any_courtier = {
				score_value = { #Prioritizes selecting an interesting courtier...
		            value = 10
		            interesting_courtier_selection_score = yes
		            prev_dislikes_this_score = yes
		        }
				save_event_target_as = sacrifice_for_science
			}
		}
	}

	option = {
		name = EVTOPTA_MNM_1113 #
		hidden_effect = {
			change_variable = { which = laboratory_level value = -2 }
		}
		if = {
			limit = { has_character_flag = hidden_lab } #Lab built in castle
			event_target:sacrifice_for_science = {
				add_maimed_trait_effect = yes
				if = {
					limit = {
						is_close_relative = ROOT
						NOT = { trait = cruel }
					}
					random_list = {
						80 = { }
						20 = { ROOT = { add_trait_depressed_effect = yes } }
					}
				}
			}
		}
	}
	option = {
		name = EVTOPTB_MNM_1113 #
		custom_tooltip = {
			text = efforts_to_improve_lab_security_tooltip
		}
		hidden_effect = {
			change_variable = { which = laboratory_level value = -1 }
		}
		wealth = -10
		if = {
			limit = { has_character_flag = hidden_lab } #Lab built in castle
			event_target:sacrifice_for_science = {
				add_maimed_trait_effect = yes
				if = {
					limit = {
						is_close_relative = ROOT
						NOT = { trait = cruel }
					}
					random_list = {
						80 = { }
						20 = { ROOT = { add_trait_depressed_effect = yes } }
					}
				}
			}
		}
	}

	after = {
		#destroy ingredients
		if = {
			limit = {
				any_artifact = {
		    		has_artifact_flag = ingredient
	    		}
			}
			destroy_random_ingredients_effect = yes
		}
	}
}

# Locals are gossiping
character_event = {
	id = BRO.1114
	desc = EVTDESC_MNM_1114
	picture = GFX_evt_riots_byzantine
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1114 #
		custom_tooltip = {
			text = accomodate_gossipers_tooltip
		}
		hidden_effect = {
			change_variable = { which = laboratory_level value = -2 }
		}

	}
	option = {
		name = EVTOPTB_MNM_1114 #
		prestige = -50
	}
}

#Rotting Ingredients
character_event = {
	id = BRO.1115
	desc = EVTDESC_MNM_1115
	picture = GFX_evt_experiment
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1115 #
		hidden_effect = {
			change_variable = { which = laboratory_level value = -1 }
		}
	}
	option = {
		name = EVTOPTB_MNM_1115 #
		wealth = -25
		hidden_effect = {
			change_variable = { which = laboratory_level value = 1 }
		}
	}

	after = {
		#destroy ingredients
		if = {
			limit = {
				OR = {
					has_a_herb_ingredient_trigger = yes
					has_an_animal_part_ingredient_trigger = yes
				}
			}
			custom_tooltip = {
				text = random_ingredients_are_destroyed_tt
				destroy_random_herb_or_animal_part_ingredients_effect = yes
			}
		}
	}
}

#Mission: Build a Laboratory
character_event = {
    id = BRO.1120
    hide_window = yes
    is_triggered_only = yes
    immediate = {
		FROM = {
			society_quest_event = { id = BRO.1121 days = 7 random = 7 }
		}
	}
}

#Letter from quest giver
society_quest_event = {
    id = BRO.1121

	desc = {
		text = EVTDESC_MNM_1121
		trigger = {
			event_target:hermetic_collaborator = {
				NOT = { has_minor_title = title_brotherhood_apprentice }
			}
		}
	}
	desc = {
		text = EVTDESC_MNM_1121_apprentice
		trigger = {
			event_target:hermetic_collaborator = {
				has_minor_title = title_brotherhood_apprentice
			}
		}
	}

    is_triggered_only = yes

    option = {
		name = ACCEPT
		ai_chance = { factor = 100 }
		set_quest = quest_hermetics_build_laboratory
	}

	option = {
		name = DECLINE
		ai_chance = { factor = 0 }
		custom_tooltip = { text = decline_quest_tooltip }
		add_character_modifier = {
			name = quest_cooldown_timer
			hidden = yes
			days = 1000
		}
	}
}

#Quest Completed
character_event = {
    id = BRO.1122
    picture = GFX_evt_experiment
    border = GFX_event_normal_frame_religion

    is_triggered_only = yes

	desc = {
		text = EVTDESC_MNM_1122_normal
		trigger = {
			FROM = {
				NOT = { has_character_modifier = good_laboratory }
				NOT = { has_character_modifier = great_laboratory }
				NOT = { has_character_modifier = best_laboratory }
			}
		}
	}

	desc = {
		text = EVTDESC_MNM_1122_rich
		trigger = {
			FROM = {
				OR = {
					has_character_modifier = good_laboratory
					has_character_modifier = great_laboratory
					has_character_modifier = best_laboratory
				}
			}
		}
	}

	trigger = { has_quest = quest_hermetics_build_laboratory }

    option = {
        name = EVTOPTA_MNM_1122

        clr_quest = quest_hermetics_find_apprentice
		sound_effect = hermetic_society_perform_experiment

        if = {
        	limit = {
				FROM = {
					NOT = { has_character_modifier = good_laboratory }
					NOT = { has_character_modifier = great_laboratory }
					NOT = { has_character_modifier = best_laboratory }
				}
			}
 			add_society_currency_minor_effect = yes
        }
        if = {
        	limit = {
				FROM = {
					OR = {
						has_character_modifier = good_laboratory
						has_character_modifier = great_laboratory
					}
				}
			}
 			add_society_currency_medium_effect = yes
        }
		if = {
			limit = { FROM = { has_character_modifier = best_laboratory } }
			add_society_currency_major_effect = yes
		}
    }
}


#Mission: Find an apprentice
character_event = {
    id = BRO.1404
    hide_window = yes
    is_triggered_only = yes
    immediate = { FROM = { society_quest_event = { id = BRO.1405 days = 7 random = 7 } } }
}

society_quest_event = {
    id = BRO.1405
    desc = EVTDESC_MNM_1405

    is_triggered_only = yes

    option = {
		name = ACCEPT

		set_quest = quest_hermetics_find_apprentice

		hidden_effect = { character_event = { id = BRO.1406 days = 150 random = 50 } }
	}

	option = {
		name = DECLINE
		custom_tooltip = { text = decline_quest_tooltip }

		add_character_modifier = {
			name = quest_cooldown_timer
			hidden = yes
			days = 1000
		}

		ai_chance = { factor = 0 }
	}
}

#Still no apprentice? Make one
character_event = {
    id = BRO.1406
    hide_window = yes
    is_triggered_only = yes
    trigger = { has_quest = quest_hermetics_find_apprentice }
    immediate = {
    	random_list = {
    		50 = {
    			modifier = {
    				is_female = no
    				factor = 1.5
    			}
    			create_random_priest = {
    				random_traits = yes
    				dynasty = none
    				female = yes
    				age = 28
    			}
    			new_character = {
    				save_event_target_as = apprentice_candidate
    			}
    		}
    		50 = {
    			modifier = {
    				is_female = yes
    				factor = 1.5
    			}
    			create_random_priest = {
    				random_traits = yes
    				dynasty = none
    				female = no
    				age = 28
    			}
    			new_character = {
    				save_event_target_as = apprentice_candidate
    			}
    		}
    	}

    	event_target:apprentice_candidate = {
    		remove_trait = slow
    		remove_trait = imbecile
    		remove_trait = inbred
    		remove_trait = dull
    		remove_trait = zealous
    		remove_trait = cynical
    		remove_trait = genius
    		remove_trait = quick
    		remove_trait = shrewd
    		remove_trait = slothful

    		#Add great trait
    		random_list = {
    			10 = { add_trait = genius }
    			10 = { add_trait = quick }
    			10 = { add_trait = shrewd }
    			10 = { add_trait = scholar }
    			10 = { add_trait = mystic }
    			10 = { add_trait = gardener }
    			10 = { trigger = { has_dlc = Reapers} add_trait = physician }
    			40 = { } #Nothing
    		}

    		#Add good trait
    		random_list = {
    			10 = { add_trait = erudite }
    			10 = { add_trait = diligent }
    			10 = {
    				add_trait = patient
    				remove_trait = wroth
    			}
    			10 = {
    				add_trait = chaste
    				remove_trait = lustful
    			}
    			30 = {
    				add_trait = ambitious
    				remove_trait = content
    			}
    		}

    		while = {
    			limit = { NOT = { learning = 10 } }
    			change_learning = 1
    		}

    		character_event = { id = BRO.1407 }
    	}
    }
}

character_event = {
    id = BRO.1407
    hide_window = yes
    is_triggered_only = yes
    immediate = { FROM = { character_event = { id = BRO.1408 } } }
}

#What about this servant?
character_event = {
    id = BRO.1408
    desc = EVTDESC_MNM_1408
    picture = GFX_evt_experiment
    border = GFX_event_normal_frame_religion

    is_triggered_only = yes

    immediate = {

    }

    option = {
        name = EVTOPTA_MNM_1408

 		FROM = { give_minor_title = title_brotherhood_apprentice }

 		clr_quest = quest_hermetics_find_apprentice
		sound_effect = hermetic_society_perform_experiment
 		add_society_currency_minor_effect = yes
    }

    option = {
        name = EVTOPTB_MNM_1408
        custom_tooltip = { text = EVTOPTB_MNM_1408_TT }
    }
}

#You completed the quest by assigning someone the title
character_event = {
    id = BRO.1409
    desc = EVTDESC_MNM_1409
    picture = GFX_evt_experiment
    border = GFX_event_normal_frame_religion

    is_triggered_only = yes

    option = {
        name = EVTOPTA_MNM_1409

        clr_quest = quest_hermetics_find_apprentice
		sound_effect = hermetic_society_perform_experiment

        if = {
        	limit = { FROM = { NOT = { learning = 12 } } }
 			add_society_currency_minor_effect = yes
        }
        if = {
        	limit = { FROM = { learning = 12 } }
 			add_society_currency_medium_effect = yes
        }
    }
}



#Mission: Infiltrate laboratory
character_event = {
    id = BRO.1430
    hide_window = yes
    is_triggered_only = yes
    immediate = {
    	FROM = { society_quest_event = { id = BRO.1431 days = 7 random = 7 } }
    }
}

society_quest_event = {
    id = BRO.1431

    desc = {
    	trigger = { event_target:infiltration_target = { has_character_flag = infiltration_rival } }
    	text = EVTDESC_MNM_1431_A
    }
    desc = {
    	trigger = { event_target:infiltration_target = { has_character_flag = infiltration_mutual_dislike } }
    	text = EVTDESC_MNM_1431_B
    }
    desc = {
    	trigger = { event_target:infiltration_target = { has_character_flag = infiltration_rich } }
    	text = EVTDESC_MNM_1431_C
    }

    is_triggered_only = yes

    quest_target = event_target:infiltration_target

    immediate = {
    	random_list = {
    		30 = { #Their nemesis
    			trigger = {
    				society = {
    					any_society_member = {
    						is_within_diplo_range = ROOT
    						NOR = {
    							has_character_flag = infiltration_rival
    							has_character_flag = infiltration_mutual_dislike
    							has_character_flag = infiltration_rich
    						}
    						is_rival = FROM
    						NOT = { reverse_opinion = { who = ROOT value = 20 } }
    					}
    				}
    			}
    			society = {
    				random_society_member = {
    					limit = {
    						is_within_diplo_range = ROOT
    						NOR = {
    							has_character_flag = infiltration_rival
    							has_character_flag = infiltration_mutual_dislike
    							has_character_flag = infiltration_rich
    						}
    						is_rival = FROM
    						NOT = { reverse_opinion = { who = ROOT value = 20 } }
    					}
    					save_event_target_as = infiltration_target
    					set_character_flag = infiltration_rival
    				}
    			}
    		}
    		10 = { #Shared dislike
    			trigger = {
    				society = {
    					any_society_member = {
    						is_within_diplo_range = ROOT
    						NOR = {
    							has_character_flag = infiltration_rival
    							has_character_flag = infiltration_mutual_dislike
    							has_character_flag = infiltration_rich
    						}
    						NOT = { reverse_opinion = { who = ROOT value = 0 } }
    						NOT = { reverse_opinion = { who = FROM value = 0 } }
    					}
    				}
    			}
    			society = {
    				random_society_member = {
    					limit = {
    						is_within_diplo_range = ROOT
    						NOR = {
    							has_character_flag = infiltration_rival
    							has_character_flag = infiltration_mutual_dislike
    							has_character_flag = infiltration_rich
    						}
    						NOT = { reverse_opinion = { who = ROOT value = 0 } }
    						NOT = { reverse_opinion = { who = FROM value = 0 } }
    					}
    					save_event_target_as = infiltration_target
    					set_character_flag = infiltration_mutual_dislike
    				}
    			}
    		}
    		10 = { #Rich target
    			trigger = {
    				society = {
    					any_society_member = {
    						is_within_diplo_range = ROOT
    						NOR = {
    							has_character_flag = infiltration_rival
    							has_character_flag = infiltration_mutual_dislike
    							has_character_flag = infiltration_rich
    						}
    						NOT = { reverse_opinion = { who = ROOT value = 20 } }
    						NOT = { reverse_opinion = { who = FROM value = 20 } }
    						OR = {
    							any_artifact = { has_artifact_flag = hermetic }
    							wealth = 200
    							has_character_modifier = best_laboratory
    							has_character_modifier = great_laboratory
    						}
    					}
    				}
    			}
    			modifier = {
    				OR = {
    					trait = greedy
    					trait = ambitious
    				}
    				factor = 2
    			}
    			society = {
    				random_society_member = {
    					limit = {
    						is_within_diplo_range = ROOT
    						NOR = {
    							has_character_flag = infiltration_rival
    							has_character_flag = infiltration_mutual_dislike
    							has_character_flag = infiltration_rich
    						}
    						NOT = { reverse_opinion = { who = ROOT value = 20 } }
    						NOT = { reverse_opinion = { who = FROM value = 20 } }
    						OR = {
    							any_artifact = {
    								has_artifact_flag = hermetic
    								has_artifact_flag = text
    							}
    							wealth = 200
    							has_character_modifier = best_laboratory
    							has_character_modifier = great_laboratory
    						}
    					}
    					save_event_target_as = infiltration_target
    					set_character_flag = infiltration_rich
    				}
    			}
    		}
    		1 = { #Fallback
    			society = {
    				random_society_member = {
    					limit = {
    						is_within_diplo_range = ROOT
    						NOR = {
    							reverse_opinion = { who = FROM value = 20 }
    							reverse_opinion = { who = ROOT value = 20 }
    							has_character_flag = infiltration_rival
    							has_character_flag = infiltration_mutual_dislike
    							has_character_flag = infiltration_rich
    						}
    					}
    					save_event_target_as = infiltration_target
    					set_character_flag = infiltration_rich
    				}
    			}
    		}
    	}
    }

    option = {
		name = ACCEPT
		ai_chance = { factor = 100 }

		event_target:infiltration_target = {
			set_quest_target = {
				id = quest_hermetics_infiltrate_laboratory
				holder = ROOT
			}
		}

		hidden_effect = {
			FROM = {
				save_event_target_as = infiltration_companion
				opinion = { who = ROOT modifier = opinion_infiltration_companion months = 100 }
				character_event = { id = BRO.1432 days = 14 }
			}
			event_target:infiltration_target = { character_event = { id = BRO.1456 days = 150 } }
		}
	}

	option = {
		name = DECLINE
		ai_chance = { factor = 0 }
		custom_tooltip = { text = decline_quest_tooltip }
		add_character_modifier = {
			name = quest_cooldown_timer
			hidden = yes
			days = 1000
		}
		hidden_effect = { event_target:infiltration_target = { character_event = { id = BRO.1456 } } }
	}
}

#Search for lab or skip to security, done by collaborator
character_event = {
    id = BRO.1432
    hide_window = yes
    is_triggered_only = yes
    immediate = {

    	if = {
    		limit = {
    			event_target:infiltration_target = {
    				OR = {
    					has_character_flag = hidden_lab
    					has_character_flag = very_hidden_lab
    				}
    			}
    		}
    		FROM = { letter_event = { id = BRO.1433 } }
    	}
    	if = {
    		limit = {
    			event_target:infiltration_target = {
    				NOR = {
    					has_character_flag = hidden_lab
    					has_character_flag = very_hidden_lab
    				}
    			}
    		}
    		FROM = { character_event = { id = BRO.1435 } }
    	}
    }
}

#Find out where the laboratory is hid
letter_event = {
    id = BRO.1433
    desc = EVTDESC_MNM_1433
    border = GFX_event_letter_frame_intrigue

    is_triggered_only = yes


    option = {
        name = EVTOPTA_MNM_1433
        custom_tooltip = { text = EVTOPTA_MNM_1433_TT }

        hidden_effect = {
        	random_list = {
        		33 = { #It goes fast
        			modifier = { FROM = { intrigue = 12 } factor = 1.2 }
        			modifier = { FROM = { intrigue = 14 } factor = 1.2 }
        			modifier = { FROM = { intrigue = 16 } factor = 1.2 }
        			modifier = { FROM = { intrigue = 18 } factor = 1.2 }
        			FROM = { character_event = { id = BRO.1434 days = 15 random = 10 } }

        		}
        		33 = { #It goes slowly
					modifier = { event_target:infiltration_target = { has_character_flag = hidden_lab } factor = 1.5 }
					modifier = { FROM = { intrigue = 12 } factor = 1.1 }
        			modifier = { FROM = { intrigue = 14 } factor = 1.1 }
        			modifier = { FROM = { intrigue = 16 } factor = 1.1 }
        			modifier = { FROM = { intrigue = 18 } factor = 1.1 }
        			FROM = { character_event = { id = BRO.1434 days = 45 random = 30 } }
        		}
        		33 = { #It goes super slow
        			modifier = { event_target:infiltration_target = { has_character_flag = very_hidden_lab } factor = 2 }
        			FROM = { character_event = { id = BRO.1434 days = 90 random = 45 } }
        		}
        	}
        }
    }
}


character_event = {
    id = BRO.1434
    hide_window = yes
    is_triggered_only = yes

    trigger = { FROM = { has_quest = quest_hermetics_infiltrate_laboratory } }

    immediate = { FROM = { character_event = { id = BRO.1435 } } }
}


#Get past the guards
character_event = {
    id = BRO.1435
    picture = GFX_evt_eavesdropping
    border = GFX_event_normal_frame_intrigue

	trigger = { has_quest = quest_hermetics_infiltrate_laboratory }

	immediate = {
		# Will select two ingredients, by prioritizing from the top, until it hits two available ones...
		select_random_hermetic_ingredient_herb_effect = yes
		select_random_hermetic_ingredient_animal_part_effect = yes
		select_random_hermetic_ingredient_powder_effect = yes
		select_random_hermetic_ingredient_liquid_effect = yes
		select_random_hermetic_ingredient_herb_effect = yes
		select_random_hermetic_ingredient_powder_effect = yes
		select_random_hermetic_ingredient_animal_part_effect = yes
		select_random_hermetic_ingredient_liquid_effect = yes
	}

    desc = {
    	trigger = { event_target:infiltration_target = { has_character_flag = very_hidden_lab } }
    	text = EVTDESC_MNM_1435_A
    }
    desc = {
    	trigger = { event_target:infiltration_target = { has_character_flag = hidden_lab } }
    	text = EVTDESC_MNM_1435_B
    }
    desc = {
    	trigger = {
    		event_target:infiltration_target = {
    			NOR = {
    				has_character_flag = very_hidden_lab
    				has_character_flag = hidden_lab
    			}
    		}
    	}
    	text = EVTDESC_MNM_1435_C
    }

    is_triggered_only = yes

    #Bribe
    option = {
    	trigger = {
    		OR = {
    			ai = no
    			scaled_wealth = 0.5
    		}
    		diplomacy = 12
    	}
        name = EVTOPTA_MNM_1435
        custom_tooltip = { text = EVTOPTA_MNM_1435_TT }
        tooltip_info = diplomacy

        if = {
        	limit = { event_target:infiltration_target = { has_character_flag = very_hidden_lab } }
        	scaled_wealth = { value = -0.75 min = -75 }
        }
        if = {
        	limit = { event_target:infiltration_target = { has_character_flag = hidden_lab } }
        	scaled_wealth = { value = -0.5 min = -50 }
        }
        if = {
        	limit = {
        		NOR = {
        			event_target:infiltration_target = { has_character_flag = very_hidden_lab }
        			event_target:infiltration_target = { has_character_flag = hidden_lab }
        		}
        	}
        	scaled_wealth = { value = -0.3 min = -30 }
        }

        set_character_flag = bribed_guards
        character_event = { id = BRO.1436 days = 7 }
    }

    #Make a sleeping potion (potentially great effect)
    option = {
    	tooltip_info = yes
        name = EVTOPTB_MNM_1435
        custom_tooltip = { text = multiple_ingredient_option_available_tt }
        custom_tooltip = { text = EVTOPTB_MNM_1435_TT }

        random_list = {
        	60 = {
        		modifier = { learning = 10 factor = 1.2 }
        		modifier = { learning = 12 factor = 1.2 }
        		modifier = { learning = 14 factor = 1.2 }
        		modifier = { learning = 16 factor = 1.2 }
        		modifier = { learning = 18 factor = 1.2 }
        		modifier = {
        			factor = 1.1
        			has_selected_herb_ingredient_1_trigger = yes
        		}
        		modifier = {
        			factor = 1.1
        			has_selected_herb_ingredient_2_trigger = yes
        		}
        		modifier = {
        			factor = 1.1
        			has_selected_animal_part_ingredient_1_trigger = yes
        		}
        		modifier = {
        			factor = 1.1
        			has_selected_animal_part_ingredient_2_trigger = yes
        		}
        		modifier = {
        			factor = 1.5
        			selected_ingredient_is_sleep_inducing_trigger = yes
        		}
        		custom_tooltip = { text = EVTOPTX_MNM_1435_SUCCESS_TT character_event = { id = BRO.1436 days = 7 } }
        	}
        	40 = {
        		modifier = { event_target:infiltration_target = { has_character_flag = hidden_lab } factor = 1.2 }
        		modifier = { event_target:infiltration_target = { has_character_flag = very_hidden_lab } factor = 1.5 }
        		custom_tooltip = {
	        		text = EVTOPTX_MNM_1435_FAIL_TT
	        		hidden_effect = {
		        		random_list = {
		        			50 = {
		        				character_event = { id = BRO.1436 days = 7 } #You get deteced later, but continue for now
		        				set_character_flag = guards_wake_up
		        			}
		        			50 = {
		        				character_event = { id = BRO.1437 days = 7 } #Hard fail
		        			}
		        		}
	        		}
	        	}
        	}
        }

        destroy_selected_ingredient_1_and_2_effect = yes

        trigger = {
        	any_artifact = {
        		count = 2
        		has_artifact_flag = ingredient
        	}
        }
    }

    #Make a sleeping potion (mild effect)
    option = {
    	tooltip_info = yes
        name = EVTOPTB_MNM_1435_single_ingredient
        custom_tooltip = { text = ingredient_option_available_tt }
        custom_tooltip = { text = EVTOPTB_MNM_1435_TT }

        random_list = {
        	50 = {
        		modifier = { learning = 10 factor = 1.2 }
        		modifier = { learning = 12 factor = 1.2 }
        		modifier = { learning = 14 factor = 1.2 }
        		modifier = { learning = 16 factor = 1.2 }
        		modifier = { learning = 18 factor = 1.2 }
         		modifier = {
        			factor = 1.2
        			selected_ingredient_is_sleep_inducing_trigger = yes
        		}
        		custom_tooltip = { text = EVTOPTX_MNM_1435_SUCCESS_TT character_event = { id = BRO.1436 days = 7 } }
        	}
        	50 = {
        		modifier = { event_target:infiltration_target = { has_character_flag = hidden_lab } factor = 1.2 }
        		modifier = { event_target:infiltration_target = { has_character_flag = very_hidden_lab } factor = 1.5 }
        		custom_tooltip = {
	        		text = EVTOPTX_MNM_1435_FAIL_TT
	        		hidden_effect = {
		        		random_list = {
		        			50 = {
		        				character_event = { id = BRO.1436 days = 7 } #You get deteced later, but continue for now
		        				set_character_flag = guards_wake_up
		        			}
		        			50 = {
		        				character_event = { id = BRO.1437 days = 7 } #Hard fail
		        			}
		        		}
	        		}
	        	}
        	}
        }

        destroy_selected_ingredient_1_effect = yes

        trigger = {
        	any_artifact = {
        		has_artifact_flag = ingredient
        	}
        }
    }

    #Distraction
    option = {
        name = EVTOPTC_MNM_1435
        custom_tooltip = { text = EVTOPTC_MNM_1435_TT }

        random_list = {
        	60 = {
        		modifier = { FROM = { intrigue = 10 } factor = 1.2 }
        		modifier = { FROM = { intrigue = 12 } factor = 1.2 }
        		modifier = { FROM = { intrigue = 14 } factor = 1.2 }
        		modifier = { FROM = { intrigue = 16 } factor = 1.2 }
        		modifier = { FROM = { intrigue = 18 } factor = 1.2 }
        		custom_tooltip = { text = EVTOPTX_MNM_1435_SUCCESS_TT character_event = { id = BRO.1438 days = 7 } }
        	}
        	40 = {
        		modifier = { event_target:infiltration_target = { has_character_flag = hidden_lab } factor = 1.2 }
        		modifier = { event_target:infiltration_target = { has_character_flag = very_hidden_lab } factor = 1.5 }
        		custom_tooltip = {
	        		text = EVTOPTX_MNM_1435_FAIL_TT
	        		hidden_effect = {
		        		random_list = {
		        			50 = {
		        				character_event = { id = BRO.1438 days = 7 } #You get deteced later, but continue for now
		        				set_character_flag = distraction_failed
		        			}
		        			50 = {
		        				character_event = { id = BRO.1439 days = 7 } #Hard fail
		        			}
		        		}
	        		}
	        	}
        	}
        }
    }

    #Bad idea
    option = {
        name = EVTOPTD_MNM_1435
        custom_tooltip = { text = EVTOPTD_MNM_1435_TT }
        clr_quest = { id = quest_hermetics_infiltrate_laboratory failure = yes }
        reverse_opinion = {
        	who = FROM
        	modifier = opinion_very_disappointed
        	years = 10
        }
        hidden_effect = {
			FROM = { remove_opinion = { who = ROOT modifier = opinion_infiltration_companion } }
        }
    }

    after = {
    	remove_selection_of_ingredients_effect = yes
    }
}

#The sleeping potion worked/you bribed the guards
character_event = {
    id = BRO.1436
    picture = GFX_evt_drunk
    border = GFX_event_normal_frame_intrigue

	trigger = { has_quest = quest_hermetics_infiltrate_laboratory }

    desc = {
    	trigger = { has_character_flag = bribed_guards }
    	text = EVTDESC_MNM_1436_A
    	picture = GFX_evt_shady_meeting
    }
    desc = {
    	trigger = { NOT = { has_character_flag = bribed_guards } }
    	text = EVTDESC_MNM_1436_B
    	picture = GFX_evt_drunk
    }

    is_triggered_only = yes

    #You destroy, I will steal
    option = {
        name = EVTOPTA_MNM_1436
        custom_tooltip = { text = EVTOPTA_MNM_1436_TT }

        hidden_effect = {
        	if = {
        		limit = {
        			OR = {
        				has_character_flag =  guards_wake_up
	        			has_character_flag =  distraction_failed
        			}
        		}
        		set_character_flag = caught_stealing
        		character_event = { id = BRO.1440 days = 25 } #Guards catch you stealing
        	}
        	if = {
        		limit = {
        			NOR = {
	        			has_character_flag =  guards_wake_up
	        			has_character_flag =  distraction_failed
	        		}
        		}
        		character_event = { id = BRO.1441 days = 25 } #You steal
        		event_target:infiltration_companion = { character_event = { id = BRO.1445 days = 14 } }
        	}
        }
    }

    #I destroy, you steal
    option = {
        name = EVTOPTB_MNM_1436
        custom_tooltip = { text = EVTOPTA_MNM_1436_TT }

        hidden_effect = {
        	if = {
        		limit = {
        			OR = {
        				has_character_flag =  guards_wake_up
	        			has_character_flag =  distraction_failed
        			}
        		}
        		set_character_flag = caught_destroying
        		character_event = { id = BRO.1440 days = 25 } #Guards catch you destroying
        	}
        	if = {
        		limit = {
        			NOR = {
	        			has_character_flag =  guards_wake_up
	        			has_character_flag =  distraction_failed
	        		}
        		}
        		character_event = { id = BRO.1443 days = 25 } #You destroy
        		event_target:infiltration_companion = { character_event = { id = BRO.1447 days = 14 } }
        	}
        }
    }

    #We steal
    option = {
        name = EVTOPTC_MNM_1436
        custom_tooltip = { text = EVTOPTC_MNM_1436_TT }

        hidden_effect = {
        	if = {
        		limit = {
        			OR = {
        				has_character_flag =  guards_wake_up
	        			has_character_flag =  distraction_failed
        			}
        		}
        		set_character_flag = caught_stealing
        		character_event = { id = BRO.1440 days = 25 } #Guards catch you stealing
        	}
        	if = {
        		limit = {
        			NOR = {
	        			has_character_flag =  guards_wake_up
	        			has_character_flag =  distraction_failed
	        		}
        		}
        		character_event = { id = BRO.1441 days = 25 } #You steal
        	}
        }
    }

    #We destroy
    option = {
        name = EVTOPTD_MNM_1436
        custom_tooltip = { text = EVTOPTC_MNM_1436_TT }

        hidden_effect = {
        	if = {
        		limit = {
        			OR = {
        				has_character_flag =  guards_wake_up
	        			has_character_flag =  distraction_failed
        			}
        		}
        		set_character_flag = caught_destroying
        		character_event = { id = BRO.1440 days = 25 } #Guards catch you destroying
        	}
        	if = {
        		limit = {
        			NOR = {
	        			has_character_flag =  guards_wake_up
	        			has_character_flag =  distraction_failed
	        		}
        		}
        		character_event = { id = BRO.1443 days = 25 } #You destroy
        	}
        }
    }

    after = { hidden_effect = { clr_character_flag = bribed_guards } }
}

#You fail to make a sleeping potion
character_event = {
    id = BRO.1437
    desc = EVTDESC_MNM_1437
    picture = GFX_evt_quarrel
    border = GFX_event_normal_frame_intrigue

    is_triggered_only = yes

    trigger = { has_quest = quest_hermetics_infiltrate_laboratory }

    option = {
        name = EVTOPTA_MNM_1437

        clr_quest = { id = quest_hermetics_infiltrate_laboratory failure = yes }
        reverse_opinion = {
        	who = event_target:infiltration_companion
        	modifier = opinion_very_disappointed
        	years = 10
        }
        hidden_effect = {
			event_target:infiltration_companion = { remove_opinion = { who = ROOT modifier = opinion_infiltration_companion } }
        }
    }
}

#The distraction is successful
character_event = {
    id = BRO.1438
    desc = EVTDESC_MNM_1438
    picture = GFX_evt_shadowy_cabal
    border = GFX_event_normal_frame_intrigue

    is_triggered_only = yes

	trigger = { has_quest = quest_hermetics_infiltrate_laboratory }

    #Steal
    option = {
        name = EVTOPTA_MNM_1438

        hidden_effect = {
        	if = {
        		limit = {
        			OR = {
        				has_character_flag =  guards_wake_up
	        			has_character_flag =  distraction_failed
        			}
        		}
        		set_character_flag = caught_stealing
        		character_event = { id = BRO.1440 days = 25 } #Guards catch you stealing
        	}
        	if = {
        		limit = {
        			NOR = {
	        			has_character_flag =  guards_wake_up
	        			has_character_flag =  distraction_failed
	        		}
        		}
        		character_event = { id = BRO.1441 days = 25 } #You steal
        	}
        }
    }

    #Destroy
    option = {
        name = EVTOPTB_MNM_1438

        hidden_effect = {
        	if = {
        		limit = {
        			OR = {
        				has_character_flag =  guards_wake_up
	        			has_character_flag =  distraction_failed
        			}
        		}
        		set_character_flag = caught_destroying
        		character_event = { id = BRO.1440 days = 25 } #Guards catch you destroying
        	}
        	if = {
        		limit = {
        			NOR = {
	        			has_character_flag =  guards_wake_up
	        			has_character_flag =  distraction_failed
	        		}
        		}
        		character_event = { id = BRO.1443 days = 25 } #You destroy
        	}
        }
    }
}

#The diversion fails
character_event = {
    id = BRO.1439
    desc = EVTDESC_MNM_1439
    picture = GFX_evt_quarrel
    border = GFX_event_normal_frame_intrigue

	trigger = { has_quest = quest_hermetics_infiltrate_laboratory }

    is_triggered_only = yes

    option = {
        name = EVTOPTA_MNM_1439

        clr_quest = { id = quest_hermetics_infiltrate_laboratory failure = yes }
        hidden_effect = {
			event_target:infiltration_companion = { remove_opinion = { who = ROOT modifier = opinion_infiltration_companion } }
        }
    }
}

#You get caught
character_event = {
    id = BRO.1440
    picture = GFX_evt_into_the_dungeon
    border = GFX_event_normal_frame_intrigue

	trigger = { has_quest = quest_hermetics_infiltrate_laboratory }

    desc = {
    	trigger = {
    		has_character_flag = guards_wake_up
    		has_character_flag = caught_destroying
    	}
    	text = EVTDESC_MNM_1440_A
    }
    desc = {
    	trigger = {
    		OR = {
	    		AND = {
		    		has_character_flag = distraction_failed
		    		has_character_flag = caught_destroying
	    		}
	    		FROM = { has_character_flag = bad_theft }
	    	}
    	}
    	text = EVTDESC_MNM_1440_B
    }
    desc = {
    	trigger = {
    		has_character_flag = guards_wake_up
    		has_character_flag = caught_stealing
    	}
    	text = EVTDESC_MNM_1440_C
    }
    desc = {
    	trigger = {
    		has_character_flag = distraction_failed
    		has_character_flag = caught_stealing
    	}
    	text = EVTDESC_MNM_1440_D
    }

    is_triggered_only = yes

    option = {
        name = EVTOPTA_MNM_1440


        event_target:infiltration_target = {
        	if = {
	        	limit = { is_landed = yes }
	        	ROOT = { imprison = PREV }
	        	if = {
	        		limit = { event_target:infiltration_companion = { ai = yes } }
	        		event_target:infiltration_companion = { imprison = PREV }
	        	}
	        }

	        if = {
	        	limit = { is_landed = no }
	        	host = {
		        	ROOT = { imprison = PREV }
		        	if = {
		        		limit = { event_target:infiltration_companion = { ai = yes } }
		        		event_target:infiltration_companion = { imprison = PREV }
		        	}
	        	}
	        }
        }

        reverse_opinion = {
        	who = event_target:infiltration_target
        	modifier = opinion_thief
        	years = 20
        }
        hidden_effect = {
        	event_target:infiltration_companion = {
        		reverse_opinion = {
		        	who = event_target:infiltration_target
		        	modifier = opinion_thief
		        	years = 20
		        }
        	}
        }

        hidden_effect = {
        	clr_character_flag = distraction_failed
        	clr_character_flag = guards_wake_up
        	clr_character_flag = caught_stealing
        	clr_character_flag = caught_destroying
        	FROM  = { clr_character_flag = bad_theft }
        }
        clr_quest = { id = quest_hermetics_infiltrate_laboratory failure = yes }
        hidden_effect = {
        	event_target:infiltration_target = { character_event = { id = BRO.1451 days = 7 } }
			event_target:infiltration_companion = { remove_opinion = { who = ROOT modifier = opinion_infiltration_companion } }
        }
    }
}

#The captor decides what to do with you
character_event = {
    id = BRO.1451
    desc = EVTDESC_MNM_1451
    picture = GFX_evt_catching_heretic
    border = GFX_event_normal_frame_intrigue

    is_triggered_only = yes

    #Trade secrets for freedom
    option = {
    	trigger = {
    		FROM = {
				has_society_currency_medium_trigger = yes
				prisoner = yes
			}
		}
        name = EVTOPTA_MNM_1451

        tooltip = {
        	random_list = {
        		60 = {
        			modifier = { trait = craven factor = 1.5 }
        			add_society_currency_major_effect = yes
        		}
        		40 = {
        			modifier = {
		        		OR = {
		        			trait = greedy
		        			trait = ambitious
		        			trait = wroth
		        			trait = paranoid
		        		}
		        		factor = 2
		        	}
        			custom_tooltip = { text = EVTOPTA_MNM_1451_FAIL_TT }
        		}

        	}
        }

        hidden_effect = { FROM = { character_event = { id = BRO.1452 } } }

        ai_chance = {
        	factor = 60
        	modifier = {
        		OR = {
        			trait = greedy
        			trait = ambitious
        			learning = 14
        		}
        		factor = 2
        	}
        }
    }

    #Let them rot
    option = {
        name = EVTOPTB_MNM_1451

        if = {
        	limit = { NOT = { is_rival = FROM } }
        	tooltip = { add_rival = FROM }
        }
        if = {
        	limit = { NOT = { is_rival = event_target:infiltration_companion } }
        	tooltip = { add_rival = event_target:infiltration_companion }
        }

        hidden_effect = { FROM = { character_event = { id = BRO.1455 } } }

        ai_chance = {
        	factor = 40
        	modifier = {
        		is_rival = FROM
        		factor = 2
        	}
        }
    }
}

#Give me secrets, I will let you out
character_event = {
    id = BRO.1452
    desc = EVTDESC_MNM_1452
    picture = GFX_evt_catching_heretic
    border = GFX_event_normal_frame_intrigue

    is_triggered_only = yes

    trigger = { prisoner = yes }

    #Alright...
    option = {
        name = EVTOPTA_MNM_1452

        detract_society_currency_medium_effect = yes

        tooltip = { imprison = no }

        hidden_effect = { FROM = { character_event = { id = BRO.1453 days = 3 } } }

        ai_chance = {
        	modifier = { trait = craven factor = 1.5 }
        	factor = 60
        }
    }

    #Never!
    option = {
        name = EVTOPTB_MNM_1452
        custom_tooltip = { text = EVTOPTB_MNM_1452_TT }

        if = {
        	limit = { NOT = { is_rival = FROM } }
        	tooltip = { add_rival = FROM }
        }

        hidden_effect = { FROM = { character_event = { id = BRO.1454 days = 3 } } }

        ai_chance = {
        	modifier = {
        		OR = {
        			trait = greedy
        			trait = ambitious
        			trait = wroth
        			trait = paranoid
        		}
        		factor = 2
        	}
        	factor = 40
        }
    }
}

#Infiltration target get their secrets
character_event = {
    id = BRO.1453
    desc = EVTDESC_MNM_1453
    picture = GFX_evt_dark_prayer
    border = GFX_event_normal_frame_intrigue

    is_triggered_only = yes

    option = {
        name = EVTOPTA_MNM_1453

       	add_society_currency_major_effect = yes

       	FROM = { imprison = no }
    }
}

#Infiltration target is denied
character_event = {
    id = BRO.1454
    desc = EVTDESC_MNM_1454
    picture = GFX_evt_into_the_dungeon
    border = GFX_event_normal_frame_intrigue

    is_triggered_only = yes

    option = {
        name = EVTOPTA_MNM_1454

       	if = {
        	limit = { NOT = { is_rival = FROM } }
        	add_rival = FROM
        }
    }
}

#Infiltration target wants you to rot
character_event = {
    id = BRO.1455
    desc = EVTDESC_MNM_1455
    picture = GFX_evt_catching_heretic
    border = GFX_event_normal_frame_intrigue

    is_triggered_only = yes

    option = {
        name = EVTOPTA_MNM_1455

       	if = {
        	limit = { NOT = { is_rival = FROM } }
        	add_rival = FROM
        }
    }
}

#You steal
character_event = {
    id = BRO.1441
    picture = GFX_evt_library
    border = GFX_event_normal_frame_intrigue

    desc = {
    	trigger = { has_character_flag = great_theft }
    	text = EVTDESC_MNM_1441_A
    }
    desc = {
    	trigger = { has_character_flag = good_theft }
    	text = EVTDESC_MNM_1441_B
    }
    desc = {
    	trigger = { has_character_flag = ok_theft }
    	text = EVTDESC_MNM_1441_C
    }

    is_triggered_only = yes
    hide_from = yes

    trigger = { has_quest = quest_hermetics_infiltrate_laboratory }

    immediate = {
    	random_list = {
    		33 = { #Great theft
    			trigger = {
    				event_target:infiltration_target = {
    					any_artifact = {
    						has_artifact_flag = hermetics
    						has_artifact_flag = text
    					}
    				}
    			}
    			modifier = { learning = 12 factor = 1.2 }
    			modifier = { learning = 13 factor = 1.2 }
    			modifier = { learning = 16 factor = 1.2 }
    			modifier = { learning = 18 factor = 1.2 }
    			modifier = { event_target:infiltration_target = { ai = no } factor = 0.5 }
    			set_character_flag = great_theft
    		}
    		33 = { #Good theft
    			trigger = {
    				event_target:infiltration_target = {
		    			any_artifact = {
							has_artifact_flag = hermetics
							has_artifact_flag = ingredient
						}
					}
    			}
    			modifier = { learning = 10 factor = 1.2 }
    			modifier = { learning = 12 factor = 1.1 }
    			modifier = { learning = 13 factor = 1.1 }
    			modifier = { learning = 16 factor = 1.1 }
    			modifier = { learning = 18 factor = 1.1 }
    			set_character_flag = good_theft
    		}
    		33 = { #Ok theft
    			modifier = { event_target:infiltration_target = { has_character_flag = hidden_lab } factor = 1.2 }
        		modifier = { event_target:infiltration_target = { has_character_flag = very_hidden_lab } factor = 1.5 }
    			set_character_flag = ok_theft
    		}
    	}
    }

    #Great theft
    option = {
    	trigger = {  has_character_flag = great_theft }
        name = EVTOPTA_MNM_1441

	    custom_tooltip = { text = EVTOPTA_MNM_1441_steal_text }

    	if = {
    		limit = {
    			event_target:infiltration_target = {
        			any_artifact = {
        				has_artifact_flag = hermetics
						has_artifact_flag = ingredient
					}
				}
    		}
    		custom_tooltip = { text = EVTOPTA_MNM_1441_steal_ingredient }
        }

        #Money and knowledge
        transfer_scaled_wealth = { from = event_target:infiltration_target value = 0.5 min = 50 }
        add_society_currency_massive_effect = yes
    }

    #Good theft
    option = {
    	trigger = {  has_character_flag = good_theft }
        name = EVTOPTA_MNM_1441

        #You get artifacts
	    custom_tooltip = { text = EVTOPTA_MNM_1441_steal_ingredient }

        #Money and knowledge
        transfer_scaled_wealth = { from = event_target:infiltration_target value = 0.25 min = 25 }
        add_society_currency_major_effect = yes
    }

    option = {
    	trigger = {  has_character_flag = ok_theft }
        name = EVTOPTC_MNM_1441

        #Money and knowledge
        transfer_scaled_wealth = { from = event_target:infiltration_target value = 0.1 min = 10 }
        add_society_currency_medium_effect = yes
    }

    after = {
    	hidden_effect = {
    		event_target:infiltration_target = { character_event = { id = BRO.1442 } }
    		character_event = { id = BRO.1450 days = 40 }
    	}
    }
}

#Person who gets stolen from gets notified
character_event = {
    id = BRO.1442
    picture = GFX_evt_burning_house
    border = GFX_event_normal_frame_intrigue

    desc = {
    	trigger = { FROM = { has_character_flag = great_theft } }
    	text = EVTDESC_MNM_1442_A
    }
    desc = {
    	trigger = { FROM = { has_character_flag = good_theft } }
    	text = EVTDESC_MNM_1442_B
    }
    desc = {
    	trigger = { FROM = { has_character_flag = ok_theft } }
    	text = EVTDESC_MNM_1442_C
    }

    hide_from = yes
    is_triggered_only = yes


    option = {
        name = CURSES

        #Artifacts get stolen
        if = {
        	limit = { FROM = { has_character_flag = great_theft } }
        	random_artifact = {
	    		limit = {
	    			has_artifact_flag = hermetics
					has_artifact_flag = text
	    		}

	    		tooltip = { destroy_artifact = yes }
	    		hidden_effect = {
		    		transfer_artifact = {
		    			from = ROOT
		    			to = FROM
		    		}
	    		}
	    	}
        }

        if = {
        	limit = {
        		FROM = {
        			OR = {
        				has_character_flag = great_theft
        				has_character_flag = good_theft
        			}
        		}
        	}
        	if = {
	    		limit = {
	    			any_artifact = {
	    				has_artifact_flag = hermetics
						has_artifact_flag = ingredient
					}
	    		}
	    		random_artifact = {
	        		limit = {
	        			has_artifact_flag = hermetics
	    				has_artifact_flag = ingredient
	        		}
	        		tooltip = { destroy_artifact = yes }
		    		hidden_effect = {
			    		transfer_artifact = {
			    			from = ROOT
			    			to = FROM
			    		}
		    		}
	        	}
	    	}
        }

       	#Money
       	if = {
       		limit = { FROM = { has_character_flag = great_theft } }
       		tooltip = { scaled_wealth = { value = -0.5 min = -50 } }
       	}
       	if = {
       		limit = { FROM = { has_character_flag = good_theft } }
       		tooltip = { scaled_wealth = { value = -0.25 min = -25 } }
       	}
       	if = {
       		limit = { FROM = { has_character_flag = ok_theft } }
       		tooltip = { scaled_wealth = { value = -0.1 min = -10 } }
       	}

       	hidden_effect = {
       		FROM = {
       			clr_character_flag = great_theft
       			clr_character_flag = good_theft
       			clr_character_flag = ok_theft
       		}
       	}
    }
}

#You destroy
character_event = {
    id = BRO.1443
    picture = GFX_evt_burning_house
    border = GFX_event_normal_frame_intrigue

    is_triggered_only = yes
    hide_from = yes

    desc = {
    	trigger = { has_character_flag = lab_destruction }
    	text = EVTDESC_MNM_1443_A
    }
    desc = {
    	trigger = { has_character_flag = lab_damage }
    	text = EVTDESC_MNM_1443_B
    }
    desc = {
    	trigger = { has_character_flag = lab_explosion_death }
    	text = EVTDESC_MNM_1443_C
    }

    trigger = { has_quest = quest_hermetics_infiltrate_laboratory }

    immediate = {
    	random_list = {
	    	40 = { #Total destruction
	    		trigger = { event_target:infiltration_target = { has_character_flag = built_laboratory } }
	    		modifier = { learning = 12 factor = 1.2 }
				modifier = { learning = 13 factor = 1.2 }
				modifier = { learning = 16 factor = 1.2 }
				modifier = { learning = 18 factor = 1.2 }
				set_character_flag = lab_destruction
	    	}
	    	55 = { #Major damage
	    		modifier = { learning = 10 factor = 1.2 }
				modifier = { learning = 12 factor = 1.1 }
				modifier = { learning = 13 factor = 1.1 }
				modifier = { learning = 16 factor = 1.1 }
				modifier = { learning = 18 factor = 1.1 }
				set_character_flag = lab_damage
	    	}
	    	5 = { #You die in an accident
	    		modifier = { event_target:infiltration_target = { has_character_flag = hidden_lab } factor = 1.2 }
	        	modifier = { event_target:infiltration_target = { has_character_flag = very_hidden_lab } factor = 1.5 }
	    		trigger = { event_target:infiltration_target = { has_character_flag = built_laboratory } }
	    		modifier = { NOT = { learning = 10 } factor = 1.5 }
	    		modifier = { NOT = { learning = 8 } factor = 2 }
	    		modifier = { NOT = { learning = 6 } factor = 2 }
	    		set_character_flag = lab_explosion_death
	    	}
	    }
    }

    option = {
    	trigger = { has_character_flag = lab_destruction }
        name = EVTOPTA_MNM_1443

        event_target:infiltration_target = {
        	tooltip = {
        		trigger_switch = {
        			on_trigger = has_character_modifier
        			cheap_laboratory 	= { remove_character_modifier = cheap_laboratory }
        			normal_laboratory 	= { remove_character_modifier = normal_laboratory }
        			good_laboratory 	= { remove_character_modifier = good_laboratory }
        			great_laboratory 	= { remove_character_modifier = great_laboratory }
        			best_laboratory 	= { remove_character_modifier = best_laboratory }
        		}
        		destroy_all_ingredients_effect = yes
        	}
        }

        add_society_currency_major_effect = yes
    }

    option = {
    	trigger = { has_character_flag = lab_damage }
        name = EVTOPTA_MNM_1443

        tooltip = {
        	event_target:infiltration_target = {
        		scaled_wealth = { value = -0.3 min = -30 }
        		destroy_random_ingredients_effect = yes
        	}
        }

        add_society_currency_medium_effect = yes
    }

    option = {
    	trigger = { has_character_flag = lab_explosion_death }
        name = EVTOPTC_MNM_1443
        death = { death_reason = death_accident }
    }

    after = {
    	hidden_effect = {
    		event_target:infiltration_target = { character_event = { id = BRO.1444 } }
    		character_event = { id = BRO.1450 days = 40 }
    	}
    }
}

#Infiltration target gets notified of destroyed lab
character_event = {
    id = BRO.1444
    picture = GFX_evt_burning_house
    border = GFX_event_normal_frame_intrigue

    desc = {
    	trigger = { FROM = { has_character_flag = lab_destruction } }
    	text = EVTDESC_MNM_1444_A
    }
    desc = {
    	trigger = { FROM = { has_character_flag = lab_damage } }
    	text = EVTDESC_MNM_1444_B
    }
    desc = {
    	trigger = {
    		FROM = {
    			NOR = {
    				has_character_flag = lab_destruction
    				has_character_flag = lab_damage
    			}
    		}
    	}
    	text = EVTDESC_MNM_1444_C
    }

    hide_from = yes

    is_triggered_only = yes

    option = {
    	trigger = {
    		FROM = {
    			OR = {
    				has_character_flag = lab_destruction
    				has_character_flag = lab_damage
    			}
    		}
    	}
        name = CURSES

        if = {
        	limit = { FROM = { has_character_flag = lab_destruction } }
        	destroy_all_ingredients_effect = yes
        	trigger_switch = {
    			on_trigger = has_character_modifier
    			cheap_laboratory 	= { remove_character_modifier = cheap_laboratory }
    			normal_laboratory 	= { remove_character_modifier = normal_laboratory }
    			good_laboratory 	= { remove_character_modifier = good_laboratory }
    			great_laboratory 	= { remove_character_modifier = great_laboratory }
    			best_laboratory 	= { remove_character_modifier = best_laboratory }
    		}
    		hidden_effect = {
    			clr_character_flag = built_laboratory
    			clr_character_flag = hidden_lab
    			clr_character_flag = very_hidden_lab
    		}
        }

        if = {
        	limit = { FROM = { has_character_flag = lab_damage } }
        	scaled_wealth = { value = -0.3 min = -30 }
        	destroy_random_ingredients_effect = yes
        }
    }

    option = {
        trigger = {
    		FROM = {
    			NOR = {
    				has_character_flag = lab_destruction
    				has_character_flag = lab_damage
    			}
    		}
    	}
    	name = EVTOPTB_MNM_1444
        FROM = { clr_character_flag = lab_explosion_death }
    }

   	after = {
   		hidden_effect = {
	   		FROM = {
	   			clr_character_flag = lab_destruction
	   			clr_character_flag = lab_damage
	   		}
   		}
  	}
}

#Companion attempts to steal
character_event = {
    id = BRO.1445
    hide_window = yes
    is_triggered_only = yes

    trigger = { FROM = { has_quest = quest_hermetics_infiltrate_laboratory } }

    immediate = {
    	random_list = {
			40 = { #Good theft
				trigger = {
	    			any_artifact = {
						has_artifact_flag = hermetics
						has_artifact_flag = ingredient
					}
				}
				modifier = { learning = 10 factor = 1.2 }
				modifier = { learning = 12 factor = 1.1 }
				modifier = { learning = 13 factor = 1.1 }
				modifier = { learning = 16 factor = 1.1 }
				modifier = { learning = 18 factor = 1.1 }
				set_character_flag = good_theft
				FROM = { character_event = { id = BRO.1446 days = 20 } }
			}
			40 = { #Ok theft
				set_character_flag = ok_theft
				FROM = { character_event = { id = BRO.1446 days = 20 } }
			}
			20 = { #Bad theft
				modifier = { event_target:infiltration_target = { has_character_flag = hidden_lab } factor = 1.2 }
        		modifier = { event_target:infiltration_target = { has_character_flag = very_hidden_lab } factor = 1.5 }
				modifier = { NOT = { learning = 10 } factor = 1.5 }
				modifier = { NOT = { learning = 8 } factor = 2 }
				modifier = { NOT = { intrigue = 10 } factor = 1.5 }
				modifier = { NOT = { intrigue = 8 } factor = 2 }
				set_character_flag = bad_theft
				FROM = { character_event = { id = BRO.1440 } }
			}
		}
    }
}

#Companion steal attempt good/ok outcome
character_event = {
    id = BRO.1446
    picture = GFX_evt_library
    border = GFX_event_normal_frame_intrigue

    desc = {
    	trigger = { FROM = { has_character_flag = good_theft } }
    	text = EVTDESC_MNM_1446_A
    }
    desc = {
    	trigger = { FROM = { has_character_flag = ok_theft } }
    	text = EVTDESC_MNM_1446_B
    }

    is_triggered_only = yes

    trigger = { has_quest = quest_hermetics_infiltrate_laboratory }

    option = {
    	trigger = { FROM = { has_character_flag = good_theft } }
        name = EVTOPTA_MNM_1446

        add_artifact = ingredient_metal_exotic5
       	add_society_currency_minor_effect = yes

       	hidden_effect = { FROM = { clr_character_flag = good_theft } }
    }

    option = {
    	trigger = { FROM = { has_character_flag = ok_theft } }
        name = EVTOPTA_MNM_1446

        add_society_currency_minor_effect = yes
        hidden_effect = { FROM = { clr_character_flag = ok_theft } }
    }
}

#Companion attempts to destroy
character_event = {
    id = BRO.1447
    hide_window = yes
    is_triggered_only = yes

    trigger = { FROM = { has_quest = quest_hermetics_infiltrate_laboratory } }

    immediate = {
    	random_list = {
			90 = { #Lab damage
				modifier = { learning = 10 factor = 1.2 }
				modifier = { learning = 12 factor = 1.1 }
				modifier = { learning = 13 factor = 1.1 }
				modifier = { learning = 16 factor = 1.1 }
				modifier = { learning = 18 factor = 1.1 }
				FROM = { character_event = { id = BRO.1448 days = 20 } }
			}
			10 = { #They die
				modifier = { event_target:infiltration_target = { has_character_flag = hidden_lab } factor = 1.2 }
        		modifier = { event_target:infiltration_target = { has_character_flag = very_hidden_lab } factor = 1.5 }
				modifier = { NOT = { learning = 10 } factor = 1.5 }
				modifier = { NOT = { learning = 8 } factor = 2 }
				modifier = { NOT = { intrigue = 10 } factor = 1.5 }
				modifier = { NOT = { intrigue = 8 } factor = 2 }
				FROM = { character_event = { id = BRO.1449 } }
			}
		}
    }
}

#Companion manages to damage lab
character_event = {
    id = BRO.1448
    desc = EVTDESC_MNM_1448
    picture = GFX_evt_burning_house
    border = GFX_event_normal_frame_intrigue

    is_triggered_only = yes

    trigger = { has_quest = quest_hermetics_infiltrate_laboratory }

    option = {
        name = EVTOPTA_MNM_1448

        add_society_currency_minor_effect = yes
    }
}

#Companion dies in an explotion
character_event = {
    id = BRO.1449
    desc = EVTDESC_MNM_1449
    picture = GFX_evt_burning_house
    border = GFX_event_normal_frame_intrigue

    is_triggered_only = yes

    trigger = { has_quest = quest_hermetics_infiltrate_laboratory }

    option = {
        name = EVTOPTA_MNM_1449

        FROM = { death = { death_reason = death_accident } }

        clr_quest = { id = quest_hermetics_infiltrate_laboratory failure = yes }
        hidden_effect = {
			event_target:infiltration_companion = { remove_opinion = { who = ROOT modifier = opinion_infiltration_companion } }
        }
    }
}

#You escape and mission is complete
character_event = {
    id = BRO.1450
    desc = EVTDESC_MNM_1450
    picture = GFX_evt_burning_house
    border = GFX_event_normal_frame_intrigue

    is_triggered_only = yes

    trigger = { has_quest = quest_hermetics_infiltrate_laboratory }

    option = {
        name = EVTOPTA_MNM_1450

        clr_quest = quest_hermetics_infiltrate_laboratory
		sound_effect = hermetic_society_perform_experiment
        hidden_effect = {
			event_target:infiltration_companion = { remove_opinion = { who = ROOT modifier = opinion_infiltration_companion } }
        }

        if = {
        	limit = {
        		opinion = { who = event_target:infiltration_companion value = 40 }
        		reverse_opinion = { who = event_target:infiltration_companion value = 40 }
        		NOT = { is_friend = event_target:infiltration_companion }
        	}
        	add_friend = event_target:infiltration_companion
        	break = yes
        }
        reverse_opinion = {
        	who = event_target:infiltration_companion
        	modifier = opinion_accomplice
        	years = 10
        }
        hidden_effect = {
        	opinion = {
	        	who = event_target:infiltration_companion
	        	modifier = opinion_accomplice
	        	years = 10
	        }
        }
    }
}

#Clears flags from infiltration target
character_event = {
    id = BRO.1456
    hide_window = yes
    is_triggered_only = yes
    immediate = {
    	clr_character_flag = infiltration_rival
    	clr_character_flag = infiltration_mutual_dislike
    	clr_character_flag = infiltration_rich
    }
}

############
# POWERS
############

###Power: Happiness potion
#Gating event to check amount of/which ingredients used
character_event = {
    id = BRO.5115
    picture = GFX_evt_experiment
    border = GFX_event_normal_frame_religion
    is_triggered_only = yes

    desc = {
    	text = EVTDESC_MNM_5115_self
    	trigger = { has_character_flag = potion_target_is_self }
    }
    desc = {
    	text = EVTDESC_MNM_5115_other
    	trigger = { NOT = { has_character_flag = potion_target_is_self } }
    }

    immediate = {
    	#Selects two ingredients...
    	select_random_hermetic_ingredient_effect = yes
    	select_random_hermetic_ingredient_effect = yes
    }

    option = { # I will use ingredient 1
		name = {
        	text = EVTOPTA_MNM_5115_herb
        	trigger = { has_selected_herb_ingredient_1_trigger = yes }
        }
        name = {
        	text = EVTOPTA_MNM_5115_animal_part
        	trigger = { has_selected_animal_part_ingredient_1_trigger = yes }
        }
        name = {
        	text = EVTOPTA_MNM_5115_powder
        	trigger = { has_selected_powder_ingredient_1_trigger = yes }
        }
        name = {
        	text = EVTOPTA_MNM_5115_liquid
        	trigger = { has_selected_liquid_ingredient_1_trigger = yes }
        }
		calculate_health_level_of_ingredient_1_effect = yes
		destroy_selected_ingredient_1_effect = yes

		ai_chance = { factor = 0 }

		trigger = {
			selected_ingredient_1_and_2_are_same = no
		}
    }

	option = { # I will use ingredient 2
		name = {
        	text = EVTOPTB_MNM_5115_herb
        	trigger = { has_selected_herb_ingredient_2_trigger = yes }
        }
        name = {
        	text = EVTOPTB_MNM_5115_animal_part
        	trigger = { has_selected_animal_part_ingredient_2_trigger = yes }
        }
        name = {
        	text = EVTOPTB_MNM_5115_powder
        	trigger = { has_selected_powder_ingredient_2_trigger = yes }
        }
        name = {
        	text = EVTOPTB_MNM_5115_liquid
        	trigger = { has_selected_liquid_ingredient_2_trigger = yes }
        }
		calculate_health_level_of_ingredient_2_effect = yes
        destroy_selected_ingredient_2_effect = yes

        ai_chance = { factor = 0 }

		trigger = {
        	has_selected_ingredient_2_trigger = yes
        	selected_ingredient_1_and_2_are_same = no
        }
    }

    option = { # I will only use one <ingredient_type_X> (IF DUPLICATE SELECTIONS)
		name = {
        	text = EVTOPTC_MNM_5115_herb
        	trigger = { has_selected_herb_ingredient_1_trigger = yes }
        }
        name = {
        	text = EVTOPTC_MNM_5115_animal_part
        	trigger = { has_selected_animal_part_ingredient_1_trigger = yes }
        }
        name = {
        	text = EVTOPTC_MNM_5115_powder
        	trigger = { has_selected_powder_ingredient_1_trigger = yes }
        }
        name = {
        	text = EVTOPTC_MNM_5115_liquid
        	trigger = { has_selected_liquid_ingredient_1_trigger = yes }
        }
		calculate_health_level_of_ingredient_1_effect = yes
        destroy_selected_ingredient_1_effect = yes

        ai_chance = { factor = 0 }

		trigger = {
        	has_selected_ingredient_2_trigger = yes
        	selected_ingredient_1_and_2_are_same = yes
        }
    }

    option = { #I will use ingredient 1 and 2
        name = {
        	text = EVTOPTD_MNM_5115
        	trigger = {	selected_ingredient_1_and_2_are_same = no }
        }
        name = {
        	text = EVTOPTD_MNM_5115_duplicate
        	trigger = {	selected_ingredient_1_and_2_are_same = yes }
        }

        calculate_health_level_of_ingredient_1_and_2_effect = yes

        destroy_selected_ingredient_1_and_2_effect = yes

        ai_chance = { factor = 25 }

        trigger = {
        	has_selected_ingredient_2_trigger = yes
        }
    }

    option = { #I'll throw a bit of everything in there!
        name = EVTOPTE_MNM_5115
        custom_tooltip = { text = EVTOPTE_MNM_5115_tt }

        calculate_health_level_of_all_ingredients_effect = yes

		destroy_all_ingredients_effect = yes

		ai_chance = { factor = 100 }

    	trigger = {
        	any_artifact = {
        		count = 4
        		has_artifact_flag = ingredient
        	}
        }
    }

    after = {
    	remove_selection_of_ingredients_effect = yes

    	hidden_effect = {
    		if = {
    			limit = { has_character_flag = potion_target_is_self }
    			character_event = { id = BRO.1400 days = 15 }
    		}
    		if = {
    			limit = { NOT = { has_character_flag = potion_target_is_self } }
    			clr_character_flag = preparing_potion
    			event_target:potion_target = { character_event = { id = BRO.1401 days = 10 } }
    		}
    		clr_character_flag = potion_target_is_self
    	}
    }
}

#Giving the potion to yourself
character_event = {
    id = BRO.1400
    desc = EVTDESC_MNM_1400
    picture = GFX_evt_experiment
    border = GFX_event_normal_frame_religion

    hide_from = yes

    is_triggered_only = yes

    option = {
        name = EVTOPTA_MNM_1400

        if = {
			limit = { trait = stressed }
			remove_trait = stressed
		}
		if = {
			limit = { trait = depressed }
			remove_trait = depressed
		}
		if = {
			limit = { has_character_modifier = apathetic }
			remove_character_modifier = apathetic
		}

		hidden_effect = {
			clr_character_flag = preparing_potion
			random = {
				chance = 40
				modifier = {
					factor = 0.5
					check_variable = { which = current_potion_quality value = 1 }
				}
				modifier = {
					factor = 0.5
					check_variable = { which = current_potion_quality value = 2 }
				}
				modifier = {
					factor = 0.5
					check_variable = { which = current_potion_quality value = 4 }
				}
				modifier = {
					factor = 0.5
					check_variable = { which = current_potion_quality value = 6 }
				}
				modifier = {
					factor = 1.1
					NOT = { check_variable = { which = current_potion_quality value = -1 } }
				}
				modifier = {
					factor = 1.2
					NOT = { check_variable = { which = current_potion_quality value = -2 } }
				}
				modifier = {
					factor = 1.3
					NOT = { check_variable = { which = current_potion_quality value = -4 } }
				}
				modifier = {
					factor = 1.4
					NOT = { check_variable = { which = current_potion_quality value = -6 } }
				}
				character_event = { id = BRO.1403 days = 150 random = 600 }
			}

        	set_variable = { # Reset potion quality
    			which = current_potion_quality
    			value = 0
    		}
		}
    }
}

#The other person gets offered a potion
character_event = {
    id = BRO.1401
    desc = EVTDESC_MNM_1401
    picture = GFX_evt_experiment
    border = GFX_event_normal_frame_religion

    is_triggered_only = yes

    option = {
        name = EVTOPTA_MNM_1401
        custom_tooltip = { text = EVTOPTA_MNM_1401_TT }

        tooltip = {
	        if = {
				limit = { trait = stressed }
				remove_trait = stressed
			}
			if = {
				limit = { trait = depressed }
				remove_trait = depressed
			}
			if = {
				limit = { has_character_modifier = apathetic }
				remove_character_modifier = apathetic
			}
        }

		hidden_effect = { FROM = { character_event = { id = BRO.1402 } } }

		ai_chance = {
			factor = 50
			modifier = {
				society_member_of = arcane_brotherhood
				factor = 3
			}
		}
    }

    option = {
        name = EVTOPTB_MNM_1401
        custom_tooltip = { text = EVTOPTB_MNM_1401_TT }

        reverse_opinion = {
        	who = FROM
        	modifier = opinion_ungrateful
        }
        #Does not give follow-up because if a player recieves this, the sender is a courtier

        ai_chance = {
			factor = 50
			modifier = {
				trait = zealous
				factor = 3
			}
			modifier = {
				liege = { character = FROM } #A player will always get a yes
				factor = 0
			}
		}
    }
}


#Giving the potion to someone else
character_event = {
    id = BRO.1402
    desc = EVTDESC_MNM_1402
    picture = GFX_evt_experiment
    border = GFX_event_normal_frame_religion

    is_triggered_only = yes

    option = {
        name = EVTOPTA_MNM_1402


    	FROM = {
	        if = {
				limit = { trait = stressed }
				remove_trait = stressed
			}
			if = {
				limit = { trait = depressed }
				remove_trait = depressed
			}
			if = {
				limit = { has_character_modifier = apathetic }
				remove_character_modifier = apathetic
			}

			hidden_effect = {
				random = {
					chance = 20
					modifier = {
						factor = 0.5
						ROOT = { check_variable = { which = current_potion_quality value = 1 } }
					}
					modifier = {
						factor = 0.5
						ROOT = { check_variable = { which = current_potion_quality value = 2 } }
					}
					modifier = {
						factor = 0.5
						ROOT = { check_variable = { which = current_potion_quality value = 4 } }
					}
					modifier = {
						factor = 0.5
						ROOT = { check_variable = { which = current_potion_quality value = 6 } }
					}
					modifier = {
						factor = 1.1
						ROOT = { NOT = { check_variable = { which = current_potion_quality value = -1 } } }
					}
					modifier = {
						factor = 1.2
						ROOT = { NOT = { check_variable = { which = current_potion_quality value = -2 } } }
					}
					modifier = {
						factor = 1.3
						ROOT = { NOT = { check_variable = { which = current_potion_quality value = -4 } } }
					}
					modifier = {
						factor = 1.4
						ROOT = { NOT = { check_variable = { which = current_potion_quality value = -6 } } }
					}
					character_event = { id = BRO.1403 days = 150 random = 600 }
				}
			}
    	}
        hidden_effect = {
        	set_variable = { # Reset potion quality
    			which = current_potion_quality
    			value = 0
    		}
    	}

        reverse_opinion = {
        	who = FROM
        	modifier = opinion_grateful
        }

    }
}

#The good effect didn't last
character_event = {
    id = BRO.1403
    desc = EVTDESC_MNM_1403
    picture = GFX_evt_illness
    border = GFX_event_normal_frame_religion

    is_triggered_only = yes

    trigger = { NOT = { trait = depressed } }

    option = {
        name = EVTOPTA_MNM_1403

        add_trait = depressed

        add_character_modifier = {
        	name = apathetic
        	years = 5
        }
    }
}

################
# INTERACTIONS
################
#The flags hidden_lab and very_hidden_lab can be used for events about stealing secrets from others/having your secrets stolen.


#MISC

###Become Society Grand Master (any society)###
character_event = {
	id = BRO.1750
	desc = EVTDESC_MNM_1750
	picture = GFX_evt_society_joining
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	trigger = {
		is_society_grandmaster = yes
		NOT = { days_in_society == 0 }
	}

	option = { name = EVTOPTA_MNM_1750 }
}

###MisGather ingredients
character_event = {
	id = BRO.1800
	desc = {
		text = EVTDESC_MNM_1800_A
		trigger = {
			NOT = { has_character_flag = quest_gathering_companion }
		}
	}
	desc = {
		text = EVTDESC_MNM_1800_B
		trigger = {
			has_character_flag = quest_gathering_companion
		}
	}
	picture = GFX_evt_experiment
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	has_dlc = "Mystics"

	immediate = {
		if = {
			limit = {
				event_target:hermetic_collaborator = {
					always = yes
				}
			}
			event_target:hermetic_collaborator = {
				save_event_target_as = gathering_companion
			}
			set_character_flag = quest_gathering_companion
			break = yes
		}
		# Find apprentice
		random_courtier_or_vassal = {
			limit = {
				OR = {
					has_minor_title = title_brotherhood_apprentice
					has_minor_title = title_flame_brotherhood_apprentice
				}
			}
			save_event_target_as = gathering_companion
			ROOT = { set_character_flag = apprentice_hermetic_gathering }
		}
	}

	option = { # Look for herbs
		name = EVTOPTA_MNM_1800
		character_event = { id = BRO.1810 days = 20 tooltip = EVTTOOLTIPA_MNM_1800 }
	}

	option = { # Hunt for animal parts
		name = EVTOPTB_MNM_1800
		character_event = { id = BRO.1815 days = 20 tooltip = EVTTOOLTIPB_MNM_1800 }
	}

	option = { # Shop for ingredients
		name = EVTOPTC_MNM_1800
		character_event = { id = BRO.1820 days = 20 tooltip = EVTTOOLTIPC_MNM_1800 }
	}

	option = {	# I don't have time for this now
		name = EVTOPTD_MNM_1800
		hidden_effect = {
			remove_character_modifier = acquire_ingredients_decision_cooldown_timer
		}
	}

	after = {
		set_character_flag = do_not_disturb
		clr_character_flag = quest_gathering_companion
		hidden_effect = { character_event = { id = BRO.1825 days = 140 } } # safety flag clearing
	}
}

character_event = { #quest ping
	id = BRO.1801
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		FROM = {
			is_alive = yes
			is_in_society = yes
		}
	}

	immediate = {
		FROM = { character_event = { id = BRO.1802 } }
	}
}

society_quest_event = {
    id = BRO.1802
    desc = EVTDESC_MNM_1802

    is_triggered_only = yes

    option = {
		name = ACCEPT

		tooltip = { set_quest = quest_hermetic_gather_ingredients }
		hidden_effect = {
			FROM = {
				set_quest_target = {
					id = quest_hermetic_gather_ingredients
					holder = ROOT
				}
			}
		}

		hidden_effect = { character_event = { id = BRO.1800 days = 5 } }
	}

	option = {
		name = DECLINE
		custom_tooltip = { text = decline_quest_tooltip }

		add_character_modifier = {
			name = quest_cooldown_timer
			hidden = yes
			days = 1000
		}

		ai_chance = { factor = 0 }
	}
}

character_event = {
	id = BRO.1810
	desc = EVTDESC_MNM_1810
	picture = GFX_evt_bandits
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	trigger = { event_target:gathering_companion = { is_alive = yes } }

	option = { # Head out with companion to find herbs.
		name = EVTOPTA_MNM_1810
		trigger = {
			stewardship = 11
			FROM = { stewardship = 11 }
		}
		hidden_effect = {
			event_target:gathering_companion = {
				character_event = { id = BRO.1811 days = 50 random = 40 }
			}
		}
	}

	option = { # Head out with companion to find herbs.
		name = EVTOPTB_MNM_1810
		trigger = {
			NOT = { stewardship = 11 }
			NOT = { FROM = { stewardship = 11 } }
			stewardship = 7
			FROM = { stewardship = 7 }
		}
		hidden_effect = {
			event_target:gathering_companion = {
				character_event = { id = BRO.1811 days = 50 random = 40 }
			}
		}
	}

	option = { # Head out with companion to find herbs.
		name = EVTOPTC_MNM_1810
		trigger = {
			NOT = { stewardship = 7 }
			NOT = { FROM = { stewardship = 7 } }
		}
		hidden_effect = {
			event_target:gathering_companion = {
				character_event = { id = BRO.1811 days = 50 random = 40 }
			}
		}
	}
}

# Calculate outcome for gathering herbs
character_event = {
	id = BRO.1811
	hide_window = yes

	is_triggered_only = yes

	trigger = { event_target:gathering_companion = { is_alive = yes } }

	immediate = {
		set_variable = {
			which = gath_try
			value = 5
		}
		set_variable = {
			which = gath_res
			value = 0
		}

		while = {
			limit = {
				check_variable = {
					which = gath_try
					value = 1
				}
			}
			random_list = {
				50 = { # Successful gathering
					modifier = {
						factor = 0.5
						FROM = { NOT = { stewardship = 4 } }
					}
					modifier = {
						factor = 0.5
						NOT = { stewardship = 4 }
					}
					modifier = {
						factor = 0.6
						FROM = { NOT = { stewardship = 6 } }
					}
					modifier = {
						factor = 0.6
						NOT = { stewardship = 6 }
					}
					modifier = {
						factor = 0.7
						FROM = { NOT = { stewardship = 8 } }
					}
					modifier = {
						factor = 0.7
						NOT = { stewardship = 8 }
					}
					modifier = {
						factor = 1.2
						FROM = { stewardship = 11 }
					}
					modifier = {
						factor = 1.2
						stewardship = 11
					}
					modifier = {
						factor = 1.2
						FROM = { stewardship = 13 }
					}
					modifier = {
						factor = 1.2
						stewardship = 13
					}
					modifier = {
						factor = 1.2
						FROM = { stewardship = 15 }
					}
					modifier = {
						factor = 1.2
						stewardship = 15
					}
					modifier = {
						factor = 1.2
						FROM = { trait = gardener }
					}
					modifier = {
						factor = 1.2
						trait = gardener
					}

					FROM = {
						change_variable = {
							which = gath_res
							value = 1
						}
					}
				}
				50 = { # Unsuccessful gathering
					modifier = {
						factor = 1.3
						trait = drunkard
					}
				}
			}


			subtract_variable = {
				which = gath_try
				value = 1
			}
		}

		FROM = {
			character_event = { id = BRO.1812 }
		}
	}
}

# Outcome and reaction gathering herbs
character_event = {
	id = BRO.1812
	desc = {
		text = EVTDESC_MNM_1812_A
		trigger = {
			check_variable = {
				which = gath_res
				value = 4
			}
		}
	}
	desc = {
		text = EVTDESC_MNM_1812_B
		trigger = {
			NOT = {
				check_variable = {
					which = gath_res
					value = 4
				}
			}
			check_variable = {
				which = gath_res
				value = 1
			}
		}
	}
	desc = {
		text = EVTDESC_MNM_1812_C
		trigger = {
			NOT = {
				check_variable = {
					which = gath_res
					value = 1
				}
			}
		}
	}
	picture = GFX_evt_bandits
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	trigger = { event_target:gathering_companion = { is_alive = yes } }

	option = {
		name = EVTOPTA_MNM_1812
		trigger = {
			check_variable = {
				which = gath_res
				value = 4
			}
		}

		if = {
			limit = {
				has_quest = quest_hermetic_gather_ingredients
			}
			clr_quest = quest_hermetic_gather_ingredients
			sound_effect = hermetic_society_acquire_seed
			add_society_currency_medium_effect = yes
		}
		custom_tooltip = { text = EVTTOOLTIP_MNM_1812 }
	}

	option = {
		name = EVTOPTB_MNM_1812
		trigger = {
			NOT = {
				check_variable = {
					which = gath_res
					value = 4
				}
			}
			check_variable = {
				which = gath_res
				value = 1
			}
		}

		if = {
			limit = {
				has_quest = quest_hermetic_gather_ingredients
			}
			clr_quest = quest_hermetic_gather_ingredients
			sound_effect = hermetic_society_acquire_seed
			add_society_currency_minor_effect = yes
		}
		custom_tooltip = { text = EVTTOOLTIP_MNM_1812 }
	}

	option = {
		name = EVTOPTC_MNM_1812
		trigger = {
			NOT = {
				check_variable = {
					which = gath_res
					value = 1
				}
			}
		}

		if = {
			limit = {
				has_quest = quest_hermetic_gather_ingredients
			}
			clr_quest = { id = quest_hermetic_gather_ingredients failure = yes }
		}
		random_list = {
			120 = { #no effect

			}
			60 = { #poisoned
				if = {
					limit = { has_dlc = "Reapers" }
					give_food_poisoning_effect = yes
					custom_tooltip = {
						text = EVTTOOLTIP_MNM_1812_ILL
					}
				}
				if = {
					limit = { NOT = { has_dlc = "Reapers" } }
					add_trait = ill
				}
			}
		}
	}

	after = {
		while = {
			limit = {
				check_variable = {
					which = gath_res
					value = 1
				}
			}
			hermetic_add_herbal_ingredient_effect = yes

			subtract_variable = {
				which = gath_res
				value = 1
			}
		}
		clr_character_flag = do_not_disturb
		clr_character_flag = apprentice_hermetic_gathering
	}
}

character_event = {
	id = BRO.1815
	desc = EVTDESC_MNM_1815
	picture = GFX_evt_hunt
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	trigger = { event_target:gathering_companion = { is_alive = yes } }

	option = { # Head out with companion to find animal parts.
		name = EVTOPTA_MNM_1815
		trigger = {
			martial = 11
			FROM = { martial = 11 }
		}
		hidden_effect = {
			event_target:gathering_companion = {
				character_event = { id = BRO.1816 days = 50 random = 40 }
			}
		}
	}

	option = { # Head out with companion to find animal parts.
		name = EVTOPTB_MNM_1815
		trigger = {
			NOT = { martial = 11 }
			NOT = { FROM = { martial = 11 } }
			martial = 7
			FROM = { martial = 7 }
		}
		hidden_effect = {
			event_target:gathering_companion = {
				character_event = { id = BRO.1816 days = 50 random = 40 }
			}
		}
	}

	option = { # Head out with companion to find animal parts.
		name = EVTOPTC_MNM_1815
		trigger = {
			NOT = { martial = 7 }
			NOT = { FROM = { martial = 7 } }
		}
		hidden_effect = {
			event_target:gathering_companion = {
				character_event = { id = BRO.1816 days = 50 random = 40 }
			}
		}
	}
}

# Calculate outcome for gathering animal parts
character_event = {
	id = BRO.1816
	hide_window = yes

	is_triggered_only = yes

	trigger = { event_target:gathering_companion = { is_alive = yes } }

	immediate = {
		set_variable = {
			which = gath_try
			value = 5
		}
		set_variable = {
			which = gath_res
			value = 0
		}

		while = {
			limit = {
				check_variable = {
					which = gath_try
					value = 1
				}
			}
			random_list = {
				50 = { # Successful gathering
					modifier = {
						factor = 0.5
						FROM = { NOT = { martial = 4 } }
					}
					modifier = {
						factor = 0.5
						NOT = { martial = 4 }
					}
					modifier = {
						factor = 0.6
						FROM = { NOT = { martial = 6 } }
					}
					modifier = {
						factor = 0.6
						NOT = { martial = 6 }
					}
					modifier = {
						factor = 0.7
						FROM = { NOT = { martial = 8 } }
					}
					modifier = {
						factor = 0.7
						NOT = { martial = 8 }
					}
					modifier = {
						factor = 1.2
						FROM = { martial = 11 }
					}
					modifier = {
						factor = 1.2
						martial = 11
					}
					modifier = {
						factor = 1.2
						FROM = { martial = 13 }
					}
					modifier = {
						factor = 1.2
						martial = 13
					}
					modifier = {
						factor = 1.2
						FROM = { martial = 15 }
					}
					modifier = {
						factor = 1.2
						martial = 15
					}
					modifier = {
						factor = 1.2
						FROM = { trait = hunter }
					}
					modifier = {
						factor = 1.2
						trait = hunter
					}

					FROM = {
						change_variable = {
							which = gath_res
							value = 1
						}
					}
				}
				50 = { # Unsuccessful gathering
					modifier = {
						factor = 1.3
						trait = drunkard
					}
				}
			}


			subtract_variable = {
				which = gath_try
				value = 1
			}
		}

		FROM = {
			character_event = { id = BRO.1817 }
		}
	}
}

# Outcome and reaction gathering animal parts
character_event = {
	id = BRO.1817
	desc = {
		text = EVTDESC_MNM_1817_A
		trigger = {
			check_variable = {
				which = gath_res
				value = 4
			}
		}
	}
	desc = {
		text = EVTDESC_MNM_1817_B
		trigger = {
			NOT = {
				check_variable = {
					which = gath_res
					value = 4
				}
			}
			check_variable = {
				which = gath_res
				value = 1
			}
		}
	}
	desc = {
		text = EVTDESC_MNM_1817_C
		trigger = {
			NOT = {
				check_variable = {
					which = gath_res
					value = 1
				}
			}
		}
	}
	picture = GFX_evt_hunt
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	trigger = { event_target:gathering_companion = { is_alive = yes } }

	option = {
		name = EVTOPTA_MNM_1817
		trigger = {
			check_variable = {
				which = gath_res
				value = 4
			}
		}

		if = {
			limit = {
				has_quest = quest_hermetic_gather_ingredients
			}
			clr_quest = quest_hermetic_gather_ingredients
			sound_effect = hermetic_society_acquire_seed
			add_society_currency_medium_effect = yes
		}
		custom_tooltip = { text = EVTTOOLTIP_MNM_1817 }
	}

	option = {
		name = EVTOPTB_MNM_1817
		trigger = {
			NOT = {
				check_variable = {
					which = gath_res
					value = 4
				}
			}
			check_variable = {
				which = gath_res
				value = 1
			}
		}

		if = {
			limit = {
				has_quest = quest_hermetic_gather_ingredients
			}
			clr_quest = quest_hermetic_gather_ingredients
			sound_effect = hermetic_society_acquire_seed
			add_society_currency_minor_effect = yes
		}
		custom_tooltip = { text = EVTTOOLTIP_MNM_1817 }
	}

	option = {
		name = EVTOPTC_MNM_1817
		trigger = {
			NOT = {
				check_variable = {
					which = gath_res
					value = 1
				}
			}
		}

		if = {
			limit = {
				has_quest = quest_hermetic_gather_ingredients
			}
			clr_quest = { id = quest_hermetic_gather_ingredients failure = yes }
		}
		prestige = -25
		add_character_modifier = {
			modifier = disappointing_hunt
			duration = 1095 #3 years
		}
	}

	after = {
		while = {
			limit = {
				check_variable = {
					which = gath_res
					value = 1
				}
			}
			hermetic_add_animal_ingredient_effect = yes

			subtract_variable = {
				which = gath_res
				value = 1
			}
		}
		clr_character_flag = do_not_disturb
		clr_character_flag = apprentice_hermetic_gathering
	}
}

character_event = {
	id = BRO.1820
	desc = EVTDESC_MNM_1820
	picture = GFX_evt_market
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	trigger = { event_target:gathering_companion = { is_alive = yes } }

	option = { # Head out with companion to shop misc ingredients.
		name = EVTOPTA_MNM_1820
		trigger = {
			diplomacy = 11
			FROM = { diplomacy = 11 }
		}
		hidden_effect = {
			event_target:gathering_companion = {
				character_event = { id = BRO.1821 days = 50 random = 40 }
			}
		}
	}

	option = { # Head out with companion to shop misc ingredients.
		name = EVTOPTB_MNM_1820
		trigger = {
			NOT = { diplomacy = 11 }
			NOT = { FROM = { diplomacy = 11 } }
			diplomacy = 7
			FROM = { diplomacy = 7 }
		}
		hidden_effect = {
			event_target:gathering_companion = {
				character_event = { id = BRO.1821 days = 50 random = 40 }
			}
		}
	}

	option = { # Head out with companion to shop misc ingredients.
		name = EVTOPTC_MNM_1820
		trigger = {
			NOT = { diplomacy = 7 }
			NOT = { FROM = { diplomacy = 7 } }
		}
		hidden_effect = {
			event_target:gathering_companion = {
				character_event = { id = BRO.1821 days = 50 random = 40 }
			}
		}
	}
}

# Calculate outcome for shopping for misc ingredients
character_event = {
	id = BRO.1821
	hide_window = yes

	is_triggered_only = yes

	trigger = { event_target:gathering_companion = { is_alive = yes } }

	immediate = {
		set_variable = {
			which = gath_try
			value = 5
		}
		set_variable = {
			which = gath_res
			value = 0
		}

		while = {
			limit = {
				check_variable = {
					which = gath_try
					value = 1
				}
			}
			random_list = {
				50 = { # Successful gathering
					modifier = {
						factor = 0.5
						FROM = { NOT = { diplomacy = 4 } }
					}
					modifier = {
						factor = 0.5
						NOT = { diplomacy = 4 }
					}
					modifier = {
						factor = 0.6
						FROM = { NOT = { diplomacy = 6 } }
					}
					modifier = {
						factor = 0.6
						NOT = { diplomacy = 6 }
					}
					modifier = {
						factor = 0.7
						FROM = { NOT = { diplomacy = 8 } }
					}
					modifier = {
						factor = 0.7
						NOT = { diplomacy = 8 }
					}
					modifier = {
						factor = 1.2
						FROM = { diplomacy = 11 }
					}
					modifier = {
						factor = 1.2
						diplomacy = 11
					}
					modifier = {
						factor = 1.2
						FROM = { diplomacy = 13 }
					}
					modifier = {
						factor = 1.2
						diplomacy = 13
					}
					modifier = {
						factor = 1.2
						FROM = { diplomacy = 15 }
					}
					modifier = {
						factor = 1.2
						diplomacy = 15
					}
					modifier = {
						factor = 1.2
						FROM = { trait = gregarious }
					}
					modifier = {
						factor = 1.2
						trait = gregarious
					}

					FROM = {
						change_variable = {
							which = gath_res
							value = 1
						}
					}
				}
				50 = { # Unsuccessful gathering
					modifier = {
						factor = 1.3
						trait = drunkard
					}
				}
			}


			subtract_variable = {
				which = gath_try
				value = 1
			}
		}

		FROM = {
			character_event = { id = BRO.1822 }
		}
	}
}

# Outcome and reaction shopping for misc ingredients
character_event = {
	id = BRO.1822
	desc = {
		text = EVTDESC_MNM_1822_A
		trigger = {
			check_variable = {
				which = gath_res
				value = 4
			}
		}
	}
	desc = {
		text = EVTDESC_MNM_1822_B
		trigger = {
			NOT = {
				check_variable = {
					which = gath_res
					value = 4
				}
			}
			check_variable = {
				which = gath_res
				value = 1
			}
		}
	}
	desc = {
		text = EVTDESC_MNM_1822_C
		trigger = {
			NOT = {
				check_variable = {
					which = gath_res
					value = 1
				}
			}
		}
	}
	picture = GFX_evt_market
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	trigger = { event_target:gathering_companion = { is_alive = yes } }

	option = {
		name = EVTOPTA_MNM_1822
		trigger = {
			check_variable = {
				which = gath_res
				value = 4
			}
		}
		wealth = -35

		if = {
			limit = {
				has_quest = quest_hermetic_gather_ingredients
			}
			clr_quest = quest_hermetic_gather_ingredients
			sound_effect = hermetic_society_acquire_seed
			add_society_currency_medium_effect = yes
		}
		custom_tooltip = { text = EVTTOOLTIP_MNM_1822 }
	}

	option = {
		name = EVTOPTB_MNM_1822
		trigger = {
			NOT = {
				check_variable = {
					which = gath_res
					value = 4
				}
			}
			check_variable = {
				which = gath_res
				value = 1
			}
		}
		wealth = -25

		if = {
			limit = {
				has_quest = quest_hermetic_gather_ingredients
			}
			clr_quest = quest_hermetic_gather_ingredients
			sound_effect = hermetic_society_acquire_seed
			add_society_currency_minor_effect = yes
		}
		custom_tooltip = { text = EVTTOOLTIP_MNM_1822 }
	}

	option = {
		name = EVTOPTC_MNM_1822
		trigger = {
			NOT = {
				check_variable = {
					which = gath_res
					value = 1
				}
			}
		}
		wealth = -15
		if = {
			limit = {
				has_quest = quest_hermetic_gather_ingredients
			}
			clr_quest = { id = quest_hermetic_gather_ingredients failure = yes }
		}
	}

	after = {
		while = {
			limit = {
				check_variable = {
					which = gath_res
					value = 1
				}
			}
			hermetic_add_misc_ingredient_effect = yes

			subtract_variable = {
				which = gath_res
				value = 1
			}
		}
		clr_character_flag = do_not_disturb
		clr_character_flag = apprentice_hermetic_gathering
	}
}

character_event = {
	id = BRO.1825
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		clr_character_flag = do_not_disturb
		clr_character_flag = apprentice_hermetic_gathering
		set_variable = { which = gath_try value = 0 }
		set_variable = { which = gath_res value = 0 }
	}
}

#Misc: apprenticeship
#Ping event for apprenticeship completion
character_event = {
    id = BRO.1413
    hide_window = yes
    is_triggered_only = yes
    trigger = {
    	liege = {
    		character = FROMFROM
    		is_alive = yes
    		society_member_of = arcane_brotherhood
    	}
    	has_minor_title = title_brotherhood_apprentice

    }
    immediate = { FROMFROM = { character_event = { id = BRO.1414 } } }
}

#Apprenticeship completion
character_event = {
    id = BRO.1414
    desc = EVTDESC_MNM_1414
    picture = GFX_evt_gathering_of_minds
    border = GFX_event_normal_frame_religion

    is_triggered_only = yes

    option = {
		name = EVTOPTA_MNM_1414

        add_society_currency_major_effect = yes

        FROM = {
        	set_character_flag = completed_apprenticeship
        	remove_title = title_brotherhood_apprentice
        	change_learning = 2
        }
    }
}

#Apprentice died
character_event = {
    id = BRO.1415
    hide_window = yes
    is_triggered_only = yes

    is_in_society = yes
    ai = yes

    trigger = {
    	society_member_of = arcane_brotherhood
    	has_minor_title = title_brotherhood_apprentice
		NOR = {
			death_no_trace_trigger = yes
			death_in_shou_lung_trigger = yes
		}
    }

    immediate = {
    	any_player = {
	    	limit = {
				ROOT = {
					has_opinion_modifier = {
						who = PREV
						modifier = opinion_hermetic_apprentice
					}
				}
			}
    		character_event = { id = BRO.1416 }
    		if = {
    			limit = { has_character_flag = apprentice_hermetic_gathering }
    			clear_delayed_event = { id = BRO.1825 }
    			character_event = { id = BRO.1825 }
    		}
    	}
    }
}

#Notification of dead apprentice
character_event = {
    id = BRO.1416
    picture = GFX_evt_death
    border = GFX_event_normal_frame_religion

    desc = {
    	trigger = {
    		NOR = {
    			NOT = { opinion = { value = 0 who = FROM } }
    			NOT = { FROM = { learning = 12 } }
    		}
    	}
    	text = EVTDESC_MNM_1416_A
    }
    desc = {
    	trigger = {
    		OR = {
    			NOT = { opinion = { value = 0 who = FROM } }
    			NOT = { FROM = { learning = 12 } }
    		}
    	}
    	text = EVTDESC_MNM_1416_B
    }

    is_triggered_only = yes

    option = {
        name = EVTOPTA_MNM_1416
    }
}


#Clear Apprentice title upon death or leaving Hermetics
character_event = {
	id = BRO.1611
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		society_member_of = arcane_brotherhood
	}

	immediate = {
		any_courtier_or_vassal = {
			limit = {
				has_minor_title = title_brotherhood_apprentice
			}
			remove_title = title_brotherhood_apprentice
		}
	}
}

###########################################################
#########    Inherited ingredient set-up event    #########
###########################################################
character_event = {
    id = BRO.5107
    hide_window = yes
    is_triggered_only = yes

    trigger = {
    	FROM = { has_artifact_flag = ingredient } #the artifact inherited must be an ingredient...
    	NOT = { has_character_flag = dealing_with_inherited_ingredients } #you mustn't already dealing with this...
    }

    immediate = {
    	set_character_flag = dealing_with_inherited_ingredients
    	FROMFROM = { save_event_target_as = previous_ingredient_owner } #does this work on dead folk?
    	character_event = { id = BRO.5108 }
    }
}

#Dealing with inherited ingredients - delays the visible event
character_event = {
    id = BRO.5108
    hide_window = yes
    is_triggered_only = yes

    immediate = {
    	if = {
    		limit = {
    			ai = yes
    			FROMFROM = { has_artifact_flag = ingredient }
    		}
    		FROMFROM = { destroy_artifact = yes }
    	}
    	if = {
    		limit = {
    			ai = no
    			NOT = { has_character_flag = owns_inherited_ingredients }
    		}
    		set_character_flag = owns_inherited_ingredients
    		character_event = { id = BRO.5108 days = 10 } #if this is the first instance of this event, send this event again to check if you ever inherited more than one ingredient...
    		break = yes
    	}
    	if = { #run second time around
    		limit = {
    			ai = no
    			has_character_flag = owns_inherited_ingredients
    			any_artifact = {
    				count = 2
    				has_artifact_flag = ingredient
    			}
    		}
    		repeat_event = { id = BRO.5109 } #send visible event
    	}
    }
}

#Inherited ingredients - keep or no?
character_event = {
    id = BRO.5109
    picture = GFX_evt_experiment
    border = GFX_event_normal_frame_religion
    is_triggered_only = yes

    desc = {
    	text = EVTDESC_MNM_5109_hermetic
    	trigger = {
				OR = {
	    		society_member_of = arcane_brotherhood
					society_member_of = brotherhood_of_true_flame
				}
    	}
    }
    desc = {
    	text = EVTDESC_MNM_5109_other_society
    	trigger = {
				NOR = {
					society_member_of = arcane_brotherhood
					society_member_of = brotherhood_of_true_flame
				}
    		is_in_society = yes
    	}
    }
    desc = {
    	text = EVTDESC_MNM_5109_no_society
    	trigger = {
    		is_in_society = no
    	}
    }
    desc = {
    	text = EVTDESC_MNM_5109_child
    	trigger = {
    		NOT = { age = 16 }
    	}
    }

    immediate = {
    	select_random_hermetic_ingredient_effect = yes
    	select_random_hermetic_ingredient_effect = yes
    }

    option = {
        name = EVTOPTA_MNM_5109
        destroy_selected_ingredient_1_and_2_effect = yes
        piety = 25
        ai_chance = { factor = 5 }
    }
    option = {
        name = EVTOPTB_MNM_5109
        destroy_all_ingredients_effect = yes
        piety = 25
        prestige = 25
        ai_chance = { factor = 100 }
    }
    option = {
        name = EVTOPTC_MNM_5109
    }

    after = {
    	remove_selection_of_ingredients_effect = yes
    	clr_character_flag = owns_inherited_ingredients
    	clr_character_flag = dealing_with_inherited_ingredients
    }
}

#Paranoid ward-making (random event, fired from on_society_bi_yearly_pulse)
character_event = {
    id = BRO.5110
    desc = EVTDESC_MNM_5110
    picture = GFX_evt_shady_meeting
    border = GFX_event_normal_frame_intrigue
    is_triggered_only = yes
    capable_only = yes

    trigger = {
    	has_dlc = "Mystics"
			OR = {
				society_member_of = arcane_brotherhood
				society_member_of = brotherhood_of_true_flame
			}
    	NOT = { has_character_flag = small_defense_against_dark_forces }
    	NOT = { has_character_flag = medium_defense_against_dark_forces }
    	NOT = { has_character_flag = large_defense_against_dark_forces }

    	OR = {
	    	NOT = {
		    	has_game_rule = {
					name = supernatural_events
					value = off
				}
			}
			NOT = {
		    	has_game_rule = {
					name = devil_worshipers
					value = none
				}
			}
    	}

		any_artifact = {
			count = 3
			has_artifact_flag = ingredient
		}
    }

    immediate = {
    	select_random_hermetic_ingredient_effect = yes
    	select_random_hermetic_ingredient_effect = yes
    }

    option = { #One ingredient is fine
        name = EVTOPTA_MNM_5110
        prestige = 15
        piety = -10
        destroy_selected_ingredient_1_effect = yes

    	clr_character_flag = small_defense_against_dark_forces
    	clr_character_flag = medium_defense_against_dark_forces
    	clr_character_flag = large_defense_against_dark_forces
        set_character_flag = small_defense_against_dark_forces

        ai_chance = { factor = 10 }
    }
    option = { #I want to use both ingredients
        name = EVTOPTB_MNM_5110
        prestige = 25
        piety = -20
        destroy_selected_ingredient_1_and_2_effect = yes

        clr_character_flag = small_defense_against_dark_forces
    	clr_character_flag = medium_defense_against_dark_forces
    	clr_character_flag = large_defense_against_dark_forces
        set_character_flag = medium_defense_against_dark_forces

        ai_chance = { factor = 10 }
    }
    option = { #I'll cover my quarters in these things!
        name = EVTOPTC_MNM_5110
        prestige = 35
        piety = -30
        destroy_all_ingredients_effect = yes

        clr_character_flag = small_defense_against_dark_forces
    	clr_character_flag = medium_defense_against_dark_forces
    	clr_character_flag = large_defense_against_dark_forces
        set_character_flag = large_defense_against_dark_forces

        ai_chance = { factor = 100 }
    }
    option = { #this is paranoia!
        name = EVTOPTD_MNM_5110
        ai_chance = { factor = 0 }
    }
    after = {
    	remove_selection_of_ingredients_effect = yes
    }
}

namespace = ZHE

#################################DECISIONS######################################

# ruthless taxation
character_event = {
	id = ZHE.21000
	desc = EVTDESC_ZHE_21000
	picture = GFX_evt_noble_in_castle

	is_triggered_only = yes

	# Extra Tax on peasants of a random Demesne Province
	option = {
		name = EVTOPTA_ZHE_21000

		ai_chance = {
			factor = 100
		}

		trigger = {
			event_target:extra_tax_target = { always = yes }
		}

    custom_tooltip = {
      text = extort_zhent_custom_tooltip
      hidden_tooltip = {
        any_realm_character = {
          limit = {
            OR = {
              olrox_is_good_religion_trigger = yes
              trait = kind
              trait = charitable
            }
            NOR = {
              trait = cruel
              trait = greedy
            }
          }
          opinion = {
            who = ROOT
            modifier = opinion_tyrant
            months = 60
          }
        }
      }
    }

		character_event = {	id = ZHE.21100 }
  }

  # Give Up
	option = {
		name = EVTOPTB_ZHE_21000

		ai_chance = {
			factor = 0
		}
    add_society_currency_minor_effect = yes
  }
}

# Extra Tax on Demesne Province
character_event = {
  id = ZHE.21100
  desc = EVTDESC_ZHE_21100
  picture = GFX_evt_noble_haughty_talking_to_peasants

  is_triggered_only = yes

  # first option High stewardship can trade revolt risk for less tax
  option = {
    name = EVTOPTA_ZHE_21100
    tooltip_info = stewardship

    trigger = {
      stewardship = 15
    }

    event_target:extra_tax_target = {
      add_province_modifier = {
        modifier = ruthless_tax_sneaky
        duration = 1825
      }
    }

		if = {
			limit = {
				trait = kind
			}
			remove_trait = kind
			add_trait = stressed
		}
		else_if = {
			limit = {
				trait = honest
			}
			remove_trait = honest
			add_trait = stressed
		}

    if = {
      limit = {
        event_target:extra_tax_target = {
          num_of_settlements = 7
        }
      }
      wealth = 150
      break = yes
    }
		if = {
			limit = {
				event_target:extra_tax_target = {
						num_of_settlements = 6
					}
				}
			wealth = 130
			break = yes
		}
		if = {
			limit = {
				event_target:extra_tax_target = {
						num_of_settlements = 5
					}
				}
			wealth = 110
			break = yes
		}
		if = {
			limit = {
				event_target:extra_tax_target = {
						num_of_settlements = 4
					}
				}
			wealth = 90
			break = yes
		}
		if = {
			limit = {
				event_target:extra_tax_target = {
						num_of_settlements = 3
					}
				}
			wealth = 70
			break = yes
		}
		if = {
			limit = {
				event_target:extra_tax_target = {
						num_of_settlements = 2
					}
				}
			wealth = 50
			break = yes
		}
    wealth = 30
  }

  # second option Peasants upset
  option = {
    name = EVTOPTB_ZHE_21100

		if = {
			limit = {
				trait = kind
			}
			remove_trait = kind
			add_trait = stressed
		}
		else_if = {
			limit = {
				trait = charitable
			}
			remove_trait = charitable
			add_trait = stressed
		}

    event_target:extra_tax_target = {
      add_province_modifier = {
        modifier = ruthless_tax
        duration = 1825
      }
    }

    if = {
      limit = {
        event_target:extra_tax_target = {
          num_of_settlements = 7
        }
      }
      wealth = 150
      break = yes
    }
		if = {
			limit = {
				event_target:extra_tax_target = {
						num_of_settlements = 6
					}
				}
			wealth = 130
			break = yes
		}
		if = {
			limit = {
				event_target:extra_tax_target = {
						num_of_settlements = 5
					}
				}
			wealth = 110
			break = yes
		}
		if = {
			limit = {
				event_target:extra_tax_target = {
						num_of_settlements = 4
					}
				}
			wealth = 90
			break = yes
		}
		if = {
			limit = {
				event_target:extra_tax_target = {
						num_of_settlements = 3
					}
				}
			wealth = 70
			break = yes
		}
		if = {
			limit = {
				event_target:extra_tax_target = {
						num_of_settlements = 2
					}
				}
			wealth = 50
			break = yes
		}
    wealth = 30
  }

  # third option High intrigue steal
  option = {
    name = EVTOPTC_ZHE_21100
    tooltip_info = intrigue

    trigger = {
      intrigue = 18
    }

    event_target:extra_tax_target = {
      add_province_modifier = {
        modifier = ruthless_tax_heist
        duration = 2555
      }
    }

		if = {
			limit = {
				trait = kind
			}
			remove_trait = kind
			add_trait = stressed
		}
		else_if = {
			limit = {
				trait = honest
			}
			remove_trait = honest
			add_trait = stressed
		}
		else_if = {
			limit = {
				trait = charitable
			}
			remove_trait = charitable
			add_trait = stressed
		}

    if = {
      limit = {
        event_target:extra_tax_target = {
          num_of_settlements = 7
        }
      }
      wealth = 150
      break = yes
    }
		if = {
			limit = {
				event_target:extra_tax_target = {
						num_of_settlements = 6
					}
				}
			wealth = 130
			break = yes
		}
		if = {
			limit = {
				event_target:extra_tax_target = {
						num_of_settlements = 5
					}
				}
			wealth = 110
			break = yes
		}
		if = {
			limit = {
				event_target:extra_tax_target = {
						num_of_settlements = 4
					}
				}
			wealth = 90
			break = yes
		}
		if = {
			limit = {
				event_target:extra_tax_target = {
						num_of_settlements = 3
					}
				}
			wealth = 70
			break = yes
		}
		if = {
			limit = {
				event_target:extra_tax_target = {
						num_of_settlements = 2
					}
				}
			wealth = 50
			break = yes
		}
    wealth = 30
  }
}

### Risky but profitable trade route
# Start of chain (hidden)
character_event = {
	id = ZHE.10100
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		job_marshal = {
			character_event = { id = ZHE.10101 }
		}
	}
}

# Start of chain (Marshal)
character_event = {
	id = ZHE.10101
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		save_event_target_as = marshal
		FROM = { character_event = { id = ZHE.10102 } }
	}
}

# Marshal presents an opportunity
character_event = {
	id = ZHE.10102
	is_triggered_only = yes
	picture = GFX_evt_council
	border = GFX_event_normal_frame_economy

  desc = {
		trigger = { society_member_of = black_network }
		text = EVTDESC_ZHE_10102
	}
	desc = {
		trigger = { NOT = { society_member_of = black_network } }
		text = EVTDESCB_ZHE_10102
	}

	option = {
		name = EVTOPTA_ZHE_10102
		set_character_flag = trade_route_progress
		if = {
			limit = {
				capital_scope = {
					port = no
				}
			}
			character_event = { id = ZHE.10103 }
			break = yes
		}
		character_event = { id = ZHE.10104 }
	}

	option = {
		name = EVTOPTB_ZHE_10102
		clr_character_flag = trade_route_progress
	}
}

# Land: setting up a land based trade route
character_event = {
	id = ZHE.10103
	is_triggered_only = yes
	desc = EVTDESC_ZHE_10103
	picture = GFX_evt_merchant_caravan
	border = GFX_event_normal_frame_economy

	option = { # hire crew
		name = EVTOPTA_ZHE_10103
		set_character_flag = trade_is_land
		if = {
			limit = { yearly_income = 200 }
			wealth = -200
		}
		if = {
			limit = {
				yearly_income = 25
				NOT = { yearly_income = 200 }
			}
			scaled_wealth = -1
		}
		if = {
			limit = { NOT = { yearly_income = 25 } }
			wealth = -25
		}
		hidden_tooltip = {
			character_event = { id = ZHE.10105 days = 3 }
		}
	}

	option = { # pillage as we go
		name = EVTOPTB_ZHE_10103
		tooltip_info = martial
    trigger = {
      martial = 15
    }
		set_character_flag = trade_is_land
		if = {
			limit = { yearly_income = 200 }
			wealth = -80
		}
		if = {
			limit = {
				yearly_income = 25
				NOT = { yearly_income = 200 }
			}
			scaled_wealth = -0.4
		}
		if = {
			limit = { NOT = { yearly_income = 25 } }
			wealth = -10
		}
		if = {
			limit = {
				NOT = { trait = kind }
			}
			add_trait = cruel
		}
		else_if = {
			limit = {
				trait = kind
			}
			remove_trait = kind
			add_trait = stressed
		}
    hidden_tooltip = {
      character_event = { id = ZHE.10105 days = 3 }
    }
	}

	option = { # this is too expensive
		name = EVTOPTC_ZHE_10103
		clr_character_flag = trade_route_progress
	}
}

# Naval: setting up a naval based trade route
character_event = {
	id = ZHE.10104
	is_triggered_only = yes
	desc = EVTDESC_ZHE_10104
	picture = GFX_evt_busy_trading_dock_republic
	border = GFX_event_normal_frame_economy

	option = { # hire crew
		name = EVTOPTA_ZHE_10104
		if = {
			limit = { yearly_income = 200 }
			wealth = -200
		}
		if = {
			limit = {
				yearly_income = 25
				NOT = { yearly_income = 200 }
			}
			scaled_wealth = -1
		}
		if = {
			limit = { NOT = { yearly_income = 25 } }
			wealth = -25
		}
		hidden_tooltip = {
			character_event = { id = ZHE.10105 days = 3 }
		}
	}

	option = { # piracy
		name = EVTOPTB_ZHE_10104
    tooltip_info = martial
    trigger = {
      martial = 15
    }
		if = {
			limit = { yearly_income = 200 }
			wealth = -80
		}
		if = {
			limit = {
				yearly_income = 25
				NOT = { yearly_income = 200 }
			}
			scaled_wealth = -0.4
		}
		if = {
			limit = { NOT = { yearly_income = 25 } }
			wealth = -10
		}
		if = {
			limit = {
				NOT = { trait = kind }
			}
			add_trait = cruel
		}
		else_if = {
			limit = {
				trait = kind
			}
			remove_trait = kind
			add_trait = stressed
		}
    hidden_tooltip = {
      character_event = { id = ZHE.10105 days = 3 }
    }
	}

	option = { # this is too expensive
		name = EVTOPTC_ZHE_10104
		clr_character_flag = trade_route_progress
	}
}

# Vassal wants some tribe killed and can finance some of the costs ## might be angered later
character_event = {
	id = ZHE.10105
	is_triggered_only = yes
	desc = EVTDESC_ZHE_10105
	picture = GFX_evt_council
	border = GFX_event_normal_frame_economy

	option = {
    name = EVTOPTA_ZHE_10105
		if = {
			limit = {
				NOT = { trait = kind }
			}
			add_trait = cruel
		}
		else_if = {
			limit = {
				trait = kind
			}
			remove_trait = kind
			add_trait = stressed
		}
    if = {
      limit = { yearly_income = 200 }
      wealth = 80
    }
    if = {
      limit = {
        yearly_income = 25
        NOT = { yearly_income = 200 }
      }
      scaled_wealth = 0.4
    }
    if = {
      limit = { NOT = { yearly_income = 25 } }
      wealth = 5
    }
    set_character_flag = trade_priest
    character_event = { id = ZHE.10111 days = 7 }
	}

	option = {
		name = EVTOPTB_ZHE_10105
		if = {
			limit = {
				trait = cruel
			}
			remove_trait = cruel
			add_trait = stressed
		}
		random_vassal = {
			opinion = {
				modifier = opinion_disappointed
				who = ROOT
				years = 5
			}
		}
		character_event = { id = ZHE.10111 days = 7 }
	}
}

# Heading out
character_event = {
	id = ZHE.10111
	is_triggered_only = yes
	picture = GFX_evt_market
	border = GFX_event_normal_frame_economy
	hide_from = yes

  desc = {
		trigger = { society_member_of = black_network }
		text = EVTDESC_ZHE_10111
	}
	desc = {
		trigger = { NOT = { society_member_of = black_network } }
		text = EVTDESCB_ZHE_10111
	}

	option = {
		name = EVTOPTA_ZHE_10111
		hidden_tooltip = {
			character_event = { id = ZHE.10112 days = 35 random = 15 }
		}
	}
}

# Arriving (hidden)
character_event = {
	id = ZHE.10112
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		random_independent_ruler = {
			limit = {
				ai = yes
				controls_religion = no
				is_adult = yes
				is_within_diplo_range = ROOT
				mercenary = no
				holy_order = no
				primary_title = {
					is_landless_type_title = no
				}
				NOR = {
          is_friend = ROOT
          is_lover = ROOT
          culture = monster
          trait = incapable
          prisoner = yes
          religion_group = ROOT
					ROOT = {
						any_liege = {
							character = PREVPREV
						}
					}
				}
			}
			character_event = { id = ZHE.10113 }
			break = yes
		}
		random_independent_ruler = {
			limit = {
				ai = yes
				controls_religion = no
				is_adult = yes
				is_within_diplo_range = ROOT
				mercenary = no
				holy_order = no
				primary_title = {
					is_landless_type_title = no
				}
				NOR = {
          is_friend = ROOT
          is_lover = ROOT
          culture = monster
          trait = incapable
          prisoner = yes
          religion = ROOT
					ROOT = {
						any_liege = {
							character = PREVPREV
						}
					}
				}
			}
			character_event = { id = ZHE.10113 }
			break = yes
		}
		random_independent_ruler = {
			limit = {
				ai = yes
				controls_religion = no
				is_adult = yes
				is_within_diplo_range = ROOT
				mercenary = no
				holy_order = no
				primary_title = {
					is_landless_type_title = no
				}
				NOR = {
          is_friend = ROOT
          is_lover = ROOT
          culture = monster
          trait = incapable
          prisoner = yes
					ROOT = {
						any_liege = {
							character = PREVPREV
						}
					}
				}
			}
			character_event = { id = ZHE.10113 }
			break = yes
		}
		random_independent_ruler = {
			limit = {
				ai = yes
				controls_religion = no
				is_adult = yes
				mercenary = no
				holy_order = no
				primary_title = {
					is_landless_type_title = no
				}
				NOT = {
					OR = {
            is_friend = ROOT
            is_lover = ROOT
            culture = monster
            trait = incapable
            prisoner = yes
						ROOT = {
							any_liege = {
								character = PREVPREV
							}
						}
					}
				}
			}
			character_event = { id = ZHE.10113 }
			break = yes
		}
		character_event = { id = WoL.10999 }
	}
}

# Arriving at destination - Host (hidden)
character_event = {
	id = ZHE.10113
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		FROM = { character_event = { id = ZHE.10114 } }
	}
}

# Foreign ruler interfering
character_event = {
	id = ZHE.10114
	is_triggered_only = yes
	picture = GFX_evt_market
	border = GFX_event_normal_frame_economy

  desc = {
		trigger = { society_member_of = black_network }
		text = EVTDESC_ZHE_10114
	}
	desc = {
		trigger = { NOT = { society_member_of = black_network } }
		text = EVTDESCB_ZHE_10114
	}

	option = {
		name = EVTOPTA_ZHE_10114
		wealth = -30
		FROM = {
			hidden_tooltip = {
				character_event = { id = ZHE.10115 }
			}
		}
	}

  option = {
    name = EVTOPTB_ZHE_10114
    tooltip_info = stewardship
    trigger = {
      stewardship = 15
    }
    FROM = {
      hidden_tooltip = {
        character_event = { id = ZHE.10115 }
      }
    }
  }

  option = {
    name = EVTOPTC_ZHE_10114
    tooltip_info = intrigue
    trigger = {
      intrigue = 17
    }
    hidden_tooltip = {
      FROM = {
        character_event = { id = ZHE.10115 }
      }
    }
  }

  option = {
    name = EVTOPTD_ZHE_10114
    random_list = {
      75 = {
        hidden_tooltip = {
          FROM = {
            character_event = { id = ZHE.10115 }
          }
        }
      }
      25 = {
        FROM = {
          hidden_tooltip = {
            character_event = { id = ZHE.10122 tooltip = EVTTOOLTIP_ZHE_10122 }
          }
        }
      }
    }
  }
}

# Foreign ruler responds (just bounce)
character_event = {
	id = ZHE.10115
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		FROM = {
			character_event = { id = ZHE.10116 days = 7 }
		}
	}
}

# Deal with guerrillas
character_event = {
	id = ZHE.10116
	is_triggered_only = yes
	desc = EVTDESC_ZHE_10116
	picture = GFX_evt_melee
	border = GFX_event_normal_frame_economy

	option = {
		name = EVTOPTA_ZHE_10116
		tooltip_info = martial
		trigger = {
			martial = 15
		}
		hidden_tooltip = {
			FROM = {
				character_event = { id = ZHE.10117 }
			}
		}
	}

	option = {
		name = EVTOPTB_ZHE_10116
		event_target:marshal = {
			opinion = {
				modifier = opinion_angry
				who = ROOT
				years = 1
			}
		}
		hidden_tooltip = {
			FROM = {
				character_event = { id = ZHE.10117 }
			}
		}
	}

  option = {
    name = EVTOPTC_ZHE_10116
    add_trait = severely_injured
		hidden_tooltip = {
			FROM = {
				character_event = { id = ZHE.10117 }
			}
		}
	}
}

# Foreign ruler (bounce)
character_event = {
	id = ZHE.10117
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		if = {
			limit = {
				FROM = { has_character_flag = trade_priest }
			}
			FROM = {
				character_event = { id = ZHE.10118 days = 7 }
			}
			break = yes
		}
		FROM = {
			character_event = { id = ZHE.10119 days = 7}
		}
	}
}

# Massacre local tribe or not
character_event = {
  id = ZHE.10118
  is_triggered_only = yes
  desc = EVTDESC_ZHE_10118
  picture = GFX_evt_melee
  border = GFX_event_normal_frame_economy

  option = {
    name = EVTOPTA_ZHE_10118
		if = {
			limit = {
				NOT = { trait = honest }
			}
			add_trait = deceitful
		}
		else_if = {
			limit = {
				trait = honest
			}
			remove_trait = honest
			add_trait = stressed
		}
		if = {
			limit = {
				trait = cruel
			}
			remove_trait = cruel
			add_trait = stressed
		}
    any_vassal = {
      opinion = {
        modifier = opinion_angry
        who = ROOT
        years = 5
      }
    }
    FROM = {
      hidden_tooltip = {
        character_event = { id = ZHE.10120 days = 7 }
      }
    }
  }

  option = {
    name = EVTOPTB_ZHE_10118
    tooltip_info = diplomacy
    trigger = {
      diplomacy = 15
    }
    FROM = {
      hidden_tooltip = {
        character_event = { id = ZHE.10120 days = 7 }
      }
    }
  }

  option = {
    name = EVTOPTC_ZHE_10118
    wealth = -50
    FROM = {
      hidden_tooltip = {
        character_event = { id = ZHE.10120 days = 7 }
      }
      }
    }
  }

  # Foreign ruler responds (just bounce from massacre)
  character_event = {
  id = ZHE.10120
  is_triggered_only = yes
  hide_window = yes

  immediate = {
    FROM = {
      character_event = { id = ZHE.10119 }
    }
  }
}

# Ambush
character_event = {
	id = ZHE.10119
	is_triggered_only = yes
	desc = EVTDESC_ZHE_10119
	picture = GFX_evt_melee
	border = GFX_event_normal_frame_economy

	option = {
		name = EVTOPTA_ZHE_10119
		tooltip_info = martial
		trigger = {
			martial = 12
		}
		hidden_tooltip = {
			FROM = {
				character_event = { id = ZHE.10121 }
			}
		}
	}

	option = {
    name = {
			text = EVTOPTB_ZHE_10119
			trigger = { society_member_of = black_network }
		}
		name = {
			text = EVTOPTBB_ZHE_10119
			trigger = { NOT = { society_member_of = black_network } }
		}
    tooltip_info = combat_rating
		trigger = {
			combat_rating = 50
		}
		hidden_tooltip = {
			FROM = {
				character_event = { id = ZHE.10121 }
			}
		}
	}

  option = {
    name = EVTOPTC_ZHE_10119
    random_list = {
      75 = {
        hidden_tooltip = {
          FROM = {
            character_event = { id = ZHE.10121 }
          }
        }
      }
      25 = {
        FROM = {
          hidden_tooltip = {
            character_event = { id = ZHE.10122 tooltip = EVTTOOLTIP_ZHE_10122 }
          }
        }
      }
    }
  }
}

# Foreign ruler responds (just bounce from ambush, success)
character_event = {
	id = ZHE.10121
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		FROM = {
			character_event = { id = ZHE.10125 days = 7 }
		}
	}
}

# Foreign ruler responds (just bounce, fail)
character_event = {
	id = ZHE.10122
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		FROM = {
			character_event = { id = ZHE.10128 days = 7 }
		}
	}
}

# Successful expedition
character_event = {
	id = ZHE.10125
	is_triggered_only = yes
	picture = GFX_evt_relaxed_ruler
	border = GFX_event_normal_frame_economy

  desc = {
		trigger = { society_member_of = black_network }
		text = EVTDESC_ZHE_10125
	}
	desc = {
		trigger = { NOT = { society_member_of = black_network } }
		text = EVTDESCB_ZHE_10125
	}

	option = {
		name = EVTOPTA_ZHE_10125
		if = {
			limit = { NOT = { yearly_income = 40 } }
			wealth = 100
		}
		if = {
			limit = {
				NOT = { yearly_income = 200 }
				yearly_income = 40
			}
			scaled_wealth = 2.5
		}
		if = {
			limit = { yearly_income = 200 }
			wealth = 500
		}
		prestige = 150
    add_rival = FROM
		set_character_flag = est_trade_route
		if = {
			limit = {
				ai = no
			}
			set_character_flag = achievement_were_in_business
		}
		clr_character_flag = trade_route_progress
		clr_character_flag = trade_priest
		capital_scope = {
			hidden_tooltip = {
				remove_province_modifier = trade_route
			}
			add_province_modifier = {
				name = trade_route
				duration = 10950
			}
			hidden_tooltip = {
				add_province_modifier = {
					name = refresh_trade_route_timer
					duration = 9125
					hidden = yes
				}
			}
			if = {
				limit = {
					has_dlc = "Reapers"
				}
				custom_tooltip = {
					text = capital_prospers_custom_tooltip
					hidden_tooltip = {
						change_variable = { which = prosperity_value value = 6 }
					}
				}
			}
		}

		hidden_tooltip = {
			character_event = { id = ZHE.10126 days = 5 }
		}
	}
}

# Reward marshal?
character_event = {
	id = ZHE.10126
	is_triggered_only = yes
	desc = EVTDESC_ZHE_10126
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_economy

	option = {
		name = EVTOPTA_ZHE_10126
		transfer_scaled_wealth = {
			to = event_target:marshal
			value = 0.5
			max = 200
		}
		event_target:marshal = {
			hidden_tooltip = {
				set_character_flag = trade_rewarded
				character_event = { id = ZHE.10127 }
			}
			opinion = {
				modifier = opinion_grateful
				who = ROOT
				years = 5
			}
		}
	}

	option = {
		name = EVTOPTB_ZHE_10126
		if = {
			limit = {
				NOT = { trait = charitable }
			}
			add_trait = greedy
		}
		else_if = {
			limit = {
				trait = charitable
			}
			remove_trait = charitable
			add_trait = stressed
		}
		event_target:marshal = {
			hidden_tooltip = {
				character_event = { id = ZHE.10127 }
			}
			opinion = {
				modifier = opinion_disappointed
				who = ROOT
				years = 5
			}
		}
	}
}

# Marshal conclusion
character_event = {
	id = ZHE.10127
	is_triggered_only = yes
	hide_window = yes ###fix if time

	option = {
		trigger = {
			has_character_flag = trade_rewarded
		}
		tooltip = {
			FROM = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 0.5
				}
			}
		}
		clr_character_flag = trade_rewarded
	}

	option = {
		trigger = {
			NOT = { has_character_flag = trade_rewarded }
		}
	}
}

# Failed expedition
character_event = {
	id = ZHE.10128
	is_triggered_only = yes
	desc = EVTDESC_ZHE_10128
	picture = GFX_evt_stressed_ruler
	border = GFX_event_normal_frame_economy

	option = {
		name = EVTOPTA_ZHE_10128
		clr_character_flag = trade_bandits_fail
		clr_character_flag = trade_bandits
		clr_character_flag = trade_is_land
		clr_character_flag = trade_priest
		clr_character_flag = trade_friend
		clr_character_flag = trade_success
		clr_character_flag = trade_rival
    add_rival = FROM
	}
}

# Get claim, choose faction
character_event = {
	id = ZHE.500
	is_triggered_only = yes
	desc = EVTDESC_ZHE_500
	picture = GFX_evt_stressed_ruler
	border = GFX_event_normal_frame_economy

	option = { #join banite faction
		name = EVTOPTA_ZHE_500
		ai_chance = {
			factor = 50
			modifier = {
				factor = 10
				religion = dead_three
			}
			modifier = {
				factor = 2
				trait = patient
			}
			modifier = {
				factor = 3
				trait = just
			}
			modifier = {
				factor = 3
				trait = honest
			}
		}

		if = {
			limit = {
				independent = yes
				e_zhentarim = {
					has_holder = no
				}
			}

			grant_title = e_zhentarim
		}
		else = {
			add_claim = e_zhentarim
		}
		religion = dead_three
		evilcat_remove_patrons = yes

		if = {
			limit = { has_global_flag = bane_returned }

			add_trait = patron_bane
		}
		else = { add_trait = patron_iyachtu_xvim }

		add_character_modifier = {
			modifier = open_zhent
			duration = 3650
		}
	}

	option = { #join cyricists faction
		name = EVTOPTB_ZHE_500
		ai_chance = {
			factor = 50
			modifier = {
				factor = 10
				religion = church_of_cyric
			}
			modifier = {
				factor = 2
				trait = wroth
			}
			modifier = {
				factor = 3
				trait = arbitrary
			}
			modifier = {
				factor = 3
				trait = lunatic
			}
		}

		if = {
			limit = {
				independent = yes
				e_zhentarim = {
					has_holder = no
				}
			}
			grant_title = e_zhentarim
		}
		else = {
			add_claim = e_zhentarim
		}
		evilcat_remove_patrons = yes
		religion = church_of_cyric

		add_character_modifier = {
			modifier = open_zhent
			duration = 3650
		}
	}

	option = { #oopsie
		name = EVTOPTC_ZHE_500
		if = {
			limit = { NOT = { trait = trusting } }

			add_trait = paranoid
		}
		else_if = {
			limit = { trait = trusting }

			remove_trait = trusting
			add_trait = stressed
		}

		increase_visibility_effect = yes
	}

	option = { #new faction
		name = EVTOPTD_ZHE_500
		trigger = {
			NOR = {
				religion = church_of_cyric
				religion = dead_three
			}
			is_evil_religion = yes
		}
		ai_chance = {
			factor = 1000
			modifier = {
				factor = 10
				trait = zealous
			}
			modifier = {
				factor = 0
				trait = cynical
			}
		}

		if = {
			limit = {
				independent = yes
				e_zhentarim = {
					has_holder = no
				}
			}
			grant_title = e_zhentarim
		}
		else = {
			add_claim = e_zhentarim
		}
		add_character_modifier = {
			modifier = zhent_pretender
			duration = 7300
		}

		add_character_modifier = {
			modifier = open_zhent
			duration = 3650
		}
	}
}

# Lose Zhent title if inadequate
character_event = {
	id = ZHE.501
  desc = EVTDESC_ZHE_501
  picture = GFX_evt_stressed_ruler

	is_triggered_only = yes
	only_playable = yes

	trigger = {
		has_landed_title = e_zhentarim
    NOR = {
			is_evil_religion = yes
			trait = cruel
			trait = impaler
		}
	}

	option = {
		name = EVTOPTA_ZHE_501
    destroy_landed_title = e_zhentarim
	}
}

## Power: Summon Commander
character_event = {
    id = ZHE.25000
    desc = EVTDESCZHE25000
    picture = GFX_evt_zhentilar_1

    border = GFX_event_normal_frame_war

    is_triggered_only = yes

  	option = {
  		name = EVTOPTCZHE25000

  		trigger = {
  			OR = {
  				NOT = { ROOT = { has_law = succ_byzantine_elective } }  #Either not Imperial...
  				NOT = { #...Or there are no valid vassal candidates that can be commanders.
  					any_vassal = {
  						higher_real_tier_than = BARON
  						NOT = {
  							primary_title = { temporary = yes }
  						}
  						OR = {
  							AND = {
  								OR = {
  									male_can_hold_minor_commander_title_trigger = yes
  									female_can_hold_minor_commander_title_trigger = yes
  								}
  								is_adult = yes
  							}
  							has_character_flag = special_marshal
  						}

  						prisoner = no
  						NOT = { trait = incapable }
  						NOT = { is_inaccessible_trigger = yes }
  						NOT = { has_character_flag = guru }
  						NOT = { has_character_modifier = refusing_to_lead }
  						NOR = {
  							has_job_title = job_chancellor
  							has_job_title = job_marshal
  							has_job_title = job_treasurer
  							has_job_title = job_spymaster
  							has_job_title = job_spiritual
  							has_minor_title = title_commander
  						}
  					}
  				}
  			}
  			any_realm_character = {
  				NOT = {
  					higher_tier_than = BARON
  				}
  				liege = { character = ROOT }
  				has_minor_title = title_commander
  				NOT = {
  					martial = 10
  				}
  			}
  			OR = {
  				AND = {
  					tier = COUNT
  					any_realm_character = {
  						count = 2
  						liege = { character = ROOT }
  						has_minor_title = title_commander
  					}
  				}
  				AND = {
  					tier = DUKE
  					any_realm_character = {
  						count = 4
  						liege = { character = ROOT }
  						has_minor_title = title_commander
  					}
  				}
  				AND = {
  					tier = KING
  					is_nomadic = no
  					any_realm_character = {
  						count = 6
  						liege = { character = ROOT }
  						has_minor_title = title_commander
  					}
  				}
  				AND = {
  					tier = EMPEROR
  					is_nomadic = no
  					any_realm_character = {
  						count = 8
  						liege = { character = ROOT }
  						has_minor_title = title_commander
  					}
  				}
  				AND = {
  					tier = KING
  					is_nomadic = yes
  					any_realm_character = {
  						count = 2
  						liege = { character = ROOT }
  						has_minor_title = title_commander
  					}
  				}
  				AND = {
  					tier = EMPEROR
  					is_nomadic = yes
  					any_realm_character = {
  						count = 4
  						liege = { character = ROOT }
  						has_minor_title = title_commander
  					}
  				}
  			}
  		}

  		random_realm_character = {
  			limit = {
  				NOT = {
  					higher_tier_than = BARON
  				}
  				liege = { character = ROOT }
  				has_minor_title = title_commander
  				NOT = {
  					martial = 12
  				}
  			}
  			opinion = {
  				modifier = insulted
  				who = ROOT
  				years = 2
  			}
  			remove_title = title_commander
  		}

  		event_target:invited_lodge_soldier = {
  			show_scope_change = no
  			opinion = {
  				modifier = opinion_loyal_servant
  				who = ROOT
  				years = 10
  			}
  			give_minor_title = title_commander
  		}
  	}
    option = {
        name = EVTOPTAZHE25000
        trigger = {
			OR = {
				NOT = { ROOT = { has_law = succ_byzantine_elective } }  #Either not Imperial...
				NOT = { #...Or there are no valid vassal candidates that can be commanders.
					any_vassal = {
						higher_real_tier_than = BARON
						NOT = {
							primary_title = { temporary = yes }
						}
						OR = {
							AND = {
								OR = {
									male_can_hold_minor_commander_title_trigger = yes
									female_can_hold_minor_commander_title_trigger = yes
								}
								is_adult = yes
							}
							has_character_flag = special_marshal
						}

						prisoner = no
						NOT = { trait = incapable }
						NOT = { is_inaccessible_trigger = yes }
						NOT = { has_character_flag = guru }
						NOT = { has_character_modifier = refusing_to_lead }
						NOR = {
							has_job_title = job_chancellor
							has_job_title = job_marshal
							has_job_title = job_treasurer
							has_job_title = job_spymaster
							has_job_title = job_spiritual
							has_minor_title = title_commander
						}
					}
				}
			}
            OR = {
                AND = {
                    tier = COUNT
                    NOT = {
                        any_realm_character = {
                            count = 2
                            liege = { character = ROOT }
                            has_minor_title = title_commander
                        }
                    }
                }
                AND = {
                    tier = DUKE
                    NOT = {
                        any_realm_character = {
                            count = 4
                            liege = { character = ROOT }
                            has_minor_title = title_commander
                        }
                    }
                }
                AND = {
                    tier = KING
                    is_nomadic = no
                    NOT = {
                        any_realm_character = {
                            count = 6
                            liege = { character = ROOT }
                            has_minor_title = title_commander
                        }
                    }
                }
                AND = {
                    tier = EMPEROR
                    is_nomadic = no
                    NOT = {
                        any_realm_character = {
                            count = 8
                            liege = { character = ROOT }
                            has_minor_title = title_commander
                        }
                    }
                }
                AND = {
                    tier = KING
                    is_nomadic = yes
                    NOT = {
                        any_realm_character = {
                            count = 2
                            liege = { character = ROOT }
                            has_minor_title = title_commander
                        }
                    }
                }
                AND = {
                    tier = EMPEROR
                    is_nomadic = yes
                    NOT = {
                        any_realm_character = {
                            count = 4
                            liege = { character = ROOT }
                            has_minor_title = title_commander
                        }
                    }
                }
            }
        }

        event_target:invited_lodge_soldier = {
			show_scope_change = no
            opinion = {
                modifier = opinion_loyal_servant
                who = ROOT
                years = 10
            }
            give_minor_title = title_commander
        }
    }
    option = {
        name = EVTOPTBZHE25000
        event_target:invited_lodge_soldier = {
            show_scope_change = no
            opinion = {
                modifier = opinion_loyal_servant
                who = ROOT
                years = 10
            }
        }
        ai_chance = {
            factor = 100
        }
    }
}

## Power: Become Tributary
letter_event = {
	id = ZHE.2000
	desc = EVTDESC_ZHE_2000

	is_triggered_only = yes

	option = {
		name = EVTOPTA_ZHE_2000
	}
}

###MISSIONS### (start on 1000)

#Mission tombola
character_event = {
	id = ZHE.1000
	hide_window = yes

	is_triggered_only = yes
	is_in_society = yes
	only_capable = yes

	trigger = {
		is_member_of_any_zhent_like_society_trigger = yes
		has_any_quest = no
		NOT = { has_character_modifier = quest_cooldown_timer }
		NOT = { is_inaccessible_trigger = yes }
	}

	immediate = {
		random_society_member = {
			limit = {
				NOT = { character = ROOT }
				same_society_as = ROOT
			}
			save_event_target_as = quest_giver
		}

		random_list = {
			15 = {
				character_event = { id = ZHE.1001 } #Agent Elimination
			}
			20 = {
				modifier = {
					factor = 0
					ai = no
				}
				#Do nothing for AI
			}
		}
	}
}

#MISSION: #Agent Elimination
character_event = {
  id = ZHE.1001
  hide_window = yes

  is_triggered_only = yes

  trigger = {
    any_realm_character = {
      NOT = {
        is_inaccessible_trigger = yes
        character = ROOT
      }
      prisoner = no
			OR = {
				society_member_of = arcane_brotherhood
				society_member_of = brotherhood_of_true_flame
				society_member_of = cult_of_the_dragon
				society_member_of = shadow_thieves
				society_member_of = night_masks
				society_member_of = shadow_telflamm
				society_member_of = harpers
				society_member_of = kuo_tan_society
				society_member_of = eldreth_veluuthra
				society_member_of = the_satanists
				society_member_of = twisted_rune
				society_member_of = kraken_society
				society_member_of = black_network
				society_member_of = tsui_tong
				society_member_of = storm_rune_society
				society_member_of = warlock_knights
			}
			NOT = { same_society_as = ROOT }
    }
  }

	immediate = {
    random_realm_character = {
      limit = {
        NOT = { is_inaccessible_trigger = yes }
        NOT = { character = ROOT }
        prisoner = no
				OR = {
					society_member_of = arcane_brotherhood
					society_member_of = brotherhood_of_true_flame
					society_member_of = cult_of_the_dragon
					society_member_of = shadow_thieves
					society_member_of = night_masks
					society_member_of = shadow_telflamm
					society_member_of = harpers
					society_member_of = kuo_tan_society
					society_member_of = eldreth_veluuthra
					society_member_of = the_satanists
					society_member_of = twisted_rune
					society_member_of = kraken_society
					society_member_of = black_network
					society_member_of = tsui_tong
					society_member_of = storm_rune_society
					society_member_of = warlock_knights
				}
				NOT = { same_society_as = ROOT }
      }
      save_event_target_as = elimination_target
    }

    if = {
			limit = {
				event_target:elimination_target = { always = yes }
				is_within_diplo_range = event_target:elimination_target
			}
			event_target:quest_giver = {
				character_event = { id = ZHE.1002 }
			}
		}
	}
}

#Ping event for quest giver
character_event = {
	id = ZHE.1002
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		if = {
			limit = { event_target:elimination_target = { always = yes } }
			FROM = { society_quest_event = { id = ZHE.1003 days = 7 random = 7 } }
		}
	}
}

#You get your target
society_quest_event = {
	id = ZHE.1003
	title = quest_agent_elimination
	quest_target = event_target:elimination_target
  desc = EVTDESC_ZHE_1003

	trigger = {
		is_in_society = yes
		event_target:elimination_target = {
			is_alive = yes
      prisoner = no
		}
	}

	is_triggered_only = yes

	option = {
		name = ACCEPT

		event_target:elimination_target = {
			set_quest_target = {
				id = quest_agent_elimination
				holder = ROOT
			}
		}

		hidden_effect = {
			if = { #Makes sure the AI actually does the mission
				limit = { ai = yes }
				random_list = {
					20 = {
						trigger = {
							attribute_diff = { character = event_target:elimination_target attribute = intrigue value = 6 }
						}
						modifier = { intrigue = 12 factor = 1.2 }
						modifier = { intrigue = 14 factor = 1.2 }
						modifier = { intrigue = 16 factor = 1.2 }
						modifier = { intrigue = 18 factor = 1.2 }
						character_event = { id = ZHE.1004 days = 150 random = 100 } #Triggers plot event
					}
					20 = {
						trigger = { attribute_diff = { character = event_target:elimination_target attribute = intrigue value = 3 } }
						modifier = { intrigue = 12 factor = 1.2 }
						modifier = { intrigue = 14 factor = 1.2 }
						modifier = { intrigue = 16 factor = 1.2 }
						modifier = { intrigue = 18 factor = 1.2 }
						character_event = { id = ZHE.1004 days = 300 random = 100 } #Triggers plot event
					}
					20 = {
						modifier = { intrigue = 12 factor = 1.2 }
						modifier = { intrigue = 14 factor = 1.2 }
						modifier = { intrigue = 16 factor = 1.2 }
						modifier = { intrigue = 18 factor = 1.2 }
						character_event = { id = ZHE.1004 days = 500 random = 300 } #Triggers plot event
					}
					40 = {
						modifier = { event_target:elimination_target = { intrigue = 12 } factor = 1.2 }
						modifier = { event_target:elimination_target = { intrigue = 14 } factor = 1.2 }
						modifier = { event_target:elimination_target = { intrigue = 16 } factor = 1.2 }
						modifier = { event_target:elimination_target = { intrigue = 18 } factor = 1.2 }
						modifier = { event_target:elimination_target = { tier = COUNT } factor = 1.5 }
						modifier = { event_target:elimination_target = { tier = DUKE } factor = 2 }
						modifier = { event_target:elimination_target = { tier = KING } factor = 2.5 }
						modifier = { event_target:elimination_target = { tier = EMPEROR } factor = 5 }
						character_event = { id = ZHE.1005 } #Clears quest
					}
				}
			}
		}
		event_target:elimination_target = {
			set_character_flag = appear_in_option
			clr_character_flag = appear_in_option
		}
	}

	option = {
		name = DECLINE
		custom_tooltip = { text = decline_quest_tooltip }

		hidden_effect = {
			add_character_modifier = {
				name = quest_cooldown_timer
				hidden = yes
				days = 1000
			}
		}

		ai_chance = { factor = 0 }
	}
}

#Helps AI do mission
character_event = {
  id = ZHE.1004
  hide_window = yes
  is_triggered_only = yes
  trigger = {
  	NOT = { plot_target_char = { is_quest_target_of = ROOT } }
  	has_quest = quest_agent_elimination
  }
  immediate = {
  	character_event = { id = ZHE.1008 }
  }
}

#AI clean-up
character_event = {
    id = ZHE.1005
    hide_window = yes
    is_triggered_only = yes
    trigger = {
    	NOT = { plot_target_char = { is_quest_target_of = ROOT } }
    	has_quest = quest_agent_elimination
    }
    immediate = {
    	clr_quest = {
    		id = quest_agent_elimination
    		failure = yes
    	}
    }
}

#AI mission assassination attempt
character_event = {
	id = ZHE.1008
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		FROM = { save_event_target_as = assassin }
    random_list = {
      60 = { #Kill
        random_list = {
          75 = {	#Not discovered
            modifier = {
              event_target:assassin = { intrigue = 12 }
              factor = 1.5
            }
            modifier = {
              event_target:assassin = { intrigue = 15 }
              factor = 1.5
            }
            event_target:elimination_target = { death = { death_reason = death_murder_unknown killer = event_target:assassin } }
          }
          25 = {	#Discovered
            modifier = {
              event_target:assassin = { NOT = { intrigue = 8 } }
              factor = 1.5
            }
            modifier = {
              event_target:assassin = { NOT = { intrigue = 5 } }
              factor = 1.5
            }
            event_target:elimination_target = { death = { death_reason = death_murder killer = event_target:assassin } }
            event_target:assassin = { character_event = { id = 10 } }
          }
        }
				modifier = {
					factor = 0
					event_target:assassin = { trait = incapable }
				}
				modifier = {
					factor = 0
					event_target:assassin = { prisoner = yes }
				}
        modifier = {
          factor = 3
          event_target:elimination_target = { trait = incapable }
        }
        modifier = {
          factor = 2
          event_target:elimination_target = { prisoner = yes }
        }
        modifier = {
          factor = 1.3
          FROM = { attribute_diff = { character = event_target:elimination_target attribute = intrigue value = 2 } }
        }
        modifier = {
          factor = 1.3
          FROM = { attribute_diff = { character = event_target:elimination_target attribute = intrigue value = 4 } }
        }
        modifier = {
          factor = 1.3
          FROM = { attribute_diff = { character = event_target:elimination_target attribute = intrigue value = 6 } }
        }
        modifier = {
          factor = 1.3
          FROM = { combat_rating_diff = { character = event_target:elimination_target value = 10 } }
        }
        modifier = {
          factor = 1.3
          FROM = { combat_rating_diff = { character = event_target:elimination_target value = 20 } }
        }
        modifier = {
          factor = 1.3
          FROM = { combat_rating_diff = { character = event_target:elimination_target value = 30 } }
        }
      }
      40 = { #No Kill
        random_list = {
          50 = {	#Not discovered
            modifier = {
              event_target:assassin = { intrigue = 12 }
              factor = 1.5
            }
            modifier = {
              event_target:assassin = { intrigue = 15 }
              factor = 1.5
            }
            event_target:assassin = {
              clr_quest = {
            		id = quest_agent_elimination
            		failure = yes
            	}
            }
          }
          25 = {	#Discovered and wounded
            modifier = {
              event_target:assassin = { NOT = { intrigue = 8 } }
              factor = 1.5
            }
            modifier = {
              event_target:assassin = { NOT = { intrigue = 5 } }
              factor = 1.5
            }
						modifier = {
							factor = 0
							event_target:assassin = { trait = incapable }
						}
						modifier = {
							factor = 0
							event_target:assassin = { prisoner = yes }
						}
            event_target:assassin = {
              clr_quest = {
            		id = quest_agent_elimination
            		failure = yes
            	}
            }
            random_list = {
        			70 = {
        				event_target:assassin = {
        					tooltip = { add_trait = wounded }
        				}
        			}
        			30 = {
        				event_target:assassin = {
        					tooltip = { add_maimed_trait_effect = yes }
        				}
        			}
        		}
            event_target:assassin = { character_event = { id = 11 } }
          }
          25 = { #Assassin is Killed
            modifier = {
              factor = 1.3
              event_target:elimination_target = { combat_rating_diff = { character = event_target:assassin value = 10 } }
            }
            modifier = {
              factor = 1.3
              event_target:elimination_target = { combat_rating_diff = { character = event_target:assassin value = 20 } }
            }
            modifier = {
              factor = 1.3
              event_target:elimination_target = { combat_rating_diff = { character = event_target:assassin value = 30 } }
            }
						modifier = {
							factor = 0
							event_target:assassin = { trait = incapable }
						}
						modifier = {
							factor = 0
							event_target:assassin = { prisoner = yes }
						}
            event_target:assassin = { death = { death_reason = death_battle killer = event_target:elimination_target } }
            event_target:assassin = { character_event = { id = 11 } }
          }
        }
        modifier = {
          factor = 1.3
          event_target:elimination_target = { attribute_diff = { character = event_target:assassin attribute = intrigue value = 2 } }
        }
        modifier = {
          factor = 1.3
          event_target:elimination_target = { attribute_diff = { character = event_target:assassin attribute = intrigue value = 4 } }
        }
        modifier = {
          factor = 1.3
          event_target:elimination_target = { attribute_diff = { character = event_target:assassin attribute = intrigue value = 6 } }
        }
        modifier = {
          factor = 1.3
          event_target:elimination_target = { combat_rating_diff = { character = event_target:assassin value = 10 } }
        }
        modifier = {
          factor = 1.3
          event_target:elimination_target = { combat_rating_diff = { character = event_target:assassin value = 20 } }
        }
        modifier = {
          factor = 1.3
          event_target:elimination_target = { combat_rating_diff = { character = event_target:assassin value = 30 } }
        }
      }
    }
	}
}

########################JOINING ZHENT############################

#From on_character_ask_to_join_society
character_event = {
    id = ZHE.100
    hide_window = yes
    is_triggered_only = yes
    trigger = {
    	FROM = { leader = { society_member_of = black_network } }
    }
    immediate = {
    	if = { #Find a non-prisoner member
    		limit = { FROM = { leader = { prisoner = yes } } }
    		FROM = {
    			any_society_member = {
    				limit = {
    					society_member_of = black_network
    					society_rank == 4
    					prisoner = no
    				}
    				character_event = { id = ZHE.101 }
    				break = yes
    			}
    			any_society_member = {
    				limit = {
    					society_member_of = black_network
    					society_rank == 3
    					prisoner = no
    				}
    				character_event = { id = ZHE.101 }
    				break = yes
    			}
    			any_society_member = {
    				limit = {
    					society_member_of = black_network
    					society_rank == 2
    					prisoner = no
    				}
    				character_event = { id = ZHE.101 }
    				break = yes
    			}
    			any_society_member = {
    				limit = {
    					society_member_of = black_network
    					society_rank == 1
    					prisoner = no
    				}
    				character_event = { id = ZHE.101 }
    				break = yes
    			}
    		}
			#Everyone is somehow in prison so just use teh leader anyway
    	}
    	FROM = { leader = { character_event = { id = ZHE.101 } } }
    }
}

#Ping event
character_event = {
    id = ZHE.101
    hide_window = yes
    is_triggered_only = yes
    immediate = {
    	FROM = { letter_event = { id = ZHE.102 } }
    }
}

#Welcome letter
letter_event = {
    id = ZHE.102
    desc = EVTDESC_ZHE_102
    border = GFX_event_letter_frame_religion

    is_triggered_only = yes

    immediate = { set_character_flag = society_join_block }

    option = {
      name = EVTOPTA_ZHE_102

      join_society = black_network

      clr_character_flag = society_join_block
    }
}

########################JOINING TSUI TONG############################

#From on_character_ask_to_join_society
character_event = {
    id = ZHE.200
    hide_window = yes
    is_triggered_only = yes
    trigger = {
    	FROM = { leader = { society_member_of = tsui_tong } }
    }
    immediate = {
    	if = { #Find a non-prisoner member
    		limit = { FROM = { leader = { prisoner = yes } } }
    		FROM = {
    			any_society_member = {
    				limit = {
    					society_member_of = tsui_tong
    					society_rank == 4
    					prisoner = no
    				}
    				character_event = { id = ZHE.201 }
    				break = yes
    			}
    			any_society_member = {
    				limit = {
    					society_member_of = tsui_tong
    					society_rank == 3
    					prisoner = no
    				}
    				character_event = { id = ZHE.201 }
    				break = yes
    			}
    			any_society_member = {
    				limit = {
    					society_member_of = tsui_tong
    					society_rank == 2
    					prisoner = no
    				}
    				character_event = { id = ZHE.201 }
    				break = yes
    			}
    			any_society_member = {
    				limit = {
    					society_member_of = tsui_tong
    					society_rank == 1
    					prisoner = no
    				}
    				character_event = { id = ZHE.201 }
    				break = yes
    			}
    		}
			#Everyone is somehow in prison so just use teh leader anyway
    	}
    	FROM = { leader = { character_event = { id = ZHE.201 } } }
    }
}

#Ping event
character_event = {
    id = ZHE.201
    hide_window = yes
    is_triggered_only = yes
    immediate = {
    	FROM = { letter_event = { id = ZHE.202 } }
    }
}

#Welcome letter
letter_event = {
    id = ZHE.202
    desc = EVTDESC_ZHE_202
    border = GFX_event_letter_frame_religion

    is_triggered_only = yes

    immediate = { set_character_flag = society_join_block }

    option = {
      name = EVTOPTA_ZHE_202

      join_society = tsui_tong

      clr_character_flag = society_join_block
    }
}

########################JOINING STORM RUNE############################

#From on_character_ask_to_join_society
character_event = {
    id = ZHE.300
    hide_window = yes
    is_triggered_only = yes
    trigger = {
    	FROM = { leader = { society_member_of = storm_rune_society } }
    }
    immediate = {
    	if = { #Find a non-prisoner member
    		limit = { FROM = { leader = { prisoner = yes } } }
    		FROM = {
    			any_society_member = {
    				limit = {
    					society_member_of = storm_rune_society
    					society_rank == 4
    					prisoner = no
    				}
    				character_event = { id = ZHE.301 }
    				break = yes
    			}
    			any_society_member = {
    				limit = {
    					society_member_of = storm_rune_society
    					society_rank == 3
    					prisoner = no
    				}
    				character_event = { id = ZHE.301 }
    				break = yes
    			}
    			any_society_member = {
    				limit = {
    					society_member_of = storm_rune_society
    					society_rank == 2
    					prisoner = no
    				}
    				character_event = { id = ZHE.301 }
    				break = yes
    			}
    			any_society_member = {
    				limit = {
    					society_member_of = storm_rune_society
    					society_rank == 1
    					prisoner = no
    				}
    				character_event = { id = ZHE.301 }
    				break = yes
    			}
    		}
			#Everyone is somehow in prison so just use teh leader anyway
    	}
    	FROM = { leader = { character_event = { id = ZHE.301 } } }
    }
}

#Ping event
character_event = {
    id = ZHE.301
    hide_window = yes
    is_triggered_only = yes
    immediate = {
    	FROM = { letter_event = { id = ZHE.302 } }
    }
}

#Welcome letter
letter_event = {
    id = ZHE.302
    desc = EVTDESC_ZHE_302
    border = GFX_event_letter_frame_religion

    is_triggered_only = yes

    immediate = { set_character_flag = society_join_block }

    option = {
      name = EVTOPTA_ZHE_302

      join_society = storm_rune_society

      clr_character_flag = society_join_block
    }
}

########################JOINING WARLOCK KNIGHTS############################

#From on_character_ask_to_join_society
character_event = {
    id = ZHE.400
    hide_window = yes
    is_triggered_only = yes
    trigger = {
    	FROM = { leader = { society_member_of = warlock_knights } }
    }
    immediate = {
    	if = { #Find a non-prisoner member
    		limit = { FROM = { leader = { prisoner = yes } } }
    		FROM = {
    			any_society_member = {
    				limit = {
    					society_member_of = warlock_knights
    					society_rank == 4
    					prisoner = no
    				}
    				character_event = { id = ZHE.401 }
    				break = yes
    			}
    			any_society_member = {
    				limit = {
    					society_member_of = warlock_knights
    					society_rank == 3
    					prisoner = no
    				}
    				character_event = { id = ZHE.401 }
    				break = yes
    			}
    			any_society_member = {
    				limit = {
    					society_member_of = warlock_knights
    					society_rank == 2
    					prisoner = no
    				}
    				character_event = { id = ZHE.401 }
    				break = yes
    			}
    			any_society_member = {
    				limit = {
    					society_member_of = warlock_knights
    					society_rank == 1
    					prisoner = no
    				}
    				character_event = { id = ZHE.401 }
    				break = yes
    			}
    		}
			#Everyone is somehow in prison so just use teh leader anyway
    	}
    	FROM = { leader = { character_event = { id = ZHE.401 } } }
    }
}

#Ping event
character_event = {
    id = ZHE.401
    hide_window = yes
    is_triggered_only = yes
    immediate = {
    	FROM = { letter_event = { id = ZHE.402 } }
    }
}

#Welcome letter
letter_event = {
    id = ZHE.402
    desc = EVTDESC_ZHE_402
    border = GFX_event_letter_frame_religion

    is_triggered_only = yes

    immediate = { set_character_flag = society_join_block }

    option = {
      name = EVTOPTA_ZHE_402

      join_society = warlock_knights

      clr_character_flag = society_join_block
    }
}

########################AI JOIN AND AI RANK UP###########################
#FOR ZHENT, TSUI TONG, STORM RUNE, LOCK KNIGHTS. CHANGE WITH NEW SOCIETIES

character_event = { #force the AI to join a society
  id = ZHE.110
  hide_window = yes
  is_triggered_only = yes

	immediate = {
		if = {
			limit = { #if he's already a member, will force a rank up 25% of the time
				ai = yes
				prisoner = no
				NOT = { trait = incapable }
				higher_tier_than = BARON
        is_member_of_any_zhent_like_society_trigger = yes
				society_rank <= 3
				society_can_rank_up = yes
			}
			random_list = {
				75 = {}
				25 = {
					society_rank_up = 1
				}
			}
		}
		if = { #ZHENT AI join event
      limit = {
        ai = yes
        prisoner = no
        NOT = { trait = incapable }
        is_adult = yes
        is_in_society = no
        controls_religion = no
        block_general_event_trigger = no

        #society specific conditions below
				capital_scope = {
					NOR = {
						region = kara_tur_region
						region = laerakond_region
						region = bloodstone_lands_region
					}
				}
      }
      character_event = { id = ZHE.111 }
    }
    else_if = { #TSUI TONG AI join event
      limit = {
        ai = yes
        prisoner = no
        NOT = { trait = incapable }
        is_adult = yes
        is_in_society = no
        controls_religion = no
        block_general_event_trigger = no

        #society specific conditions below
        capital_scope = {
    			region = kara_tur_region
    		}
      }
			character_event = { id = ZHE.112 }
		}
    else_if = { #STORM RUNE AI join event
      limit = {
        ai = yes
        prisoner = no
        NOT = { trait = incapable }
        is_adult = yes
        is_in_society = no
        controls_religion = no
        block_general_event_trigger = no

        #society specific conditions below
        capital_scope = {
    			region = laerakond_region
    		}
      }
      character_event = { id = ZHE.113 }
    }
    else_if = { #WARLOCK KNIGHTS AI join event
      limit = {
        ai = yes
        prisoner = no
        NOT = { trait = incapable }
        is_adult = yes
        is_in_society = no
        controls_religion = no
        block_general_event_trigger = no

        #society specific conditions below
        capital_scope = {
          region = bloodstone_lands_region
        }
      }
      character_event = { id = ZHE.114 }
    }
	}
}

character_event = { #ZHENT AI join event
	id = ZHE.111
	hide_window = yes

	is_triggered_only = yes

  immediate = {
    random_list = {
      60 = { # do nothing
      }
      40 = {
        trigger = {
          can_join_society = black_network
        }
        modifier = {
          factor = 2
          OR = {
            trait = impaler
            trait = schemer
          }
        }
        modifier = {
          factor = 2
          trait = ambitious
        }
        modifier = {
          factor = 2
          trait = proud
        }
        modifier = {
          factor = 2
          trait = greedy
        }
        modifier = {
          factor = 2
          trait = cruel
        }
        modifier = {
          factor = 2
          trait = deceitful
        }
        modifier = {
          factor = 0
          trait = kind
        }
        modifier = {
          factor = 0
          is_benevolent_trigger = yes
        }
        modifier = {
          factor = 0.1
          is_landed = no
        }
        modifier = {
          factor = 0.5
          trait = honest
        }
        modifier = {
          factor = 0.2
          trait = charitable
        }
        modifier = {
          factor = 0.1
          OR = {
            culture = drow
            culture = shadovar
          }
        }
        modifier = {
          factor = 0
          NOT = { trait = cruel }
          NOT = { religion_group = evil_human_pantheon_group }
          NOT = { has_landed_title = e_zhentarim }
          NOT = {
            any_liege = {
              has_landed_title = e_zhentarim
            }
          }
        }
        join_society = black_network
        random_list = { # Artificially increase society influence for balance purposes, not really useful in my opinion.
          75 = {
            modifier = {
              factor = 0
              society_influence >= 30
            }
          }
          25 = {
          }
        }
        if = { # Make grandmaster is there is none
          limit = {
            NOT = {
              society = {
                any_society_member = {
                  is_society_grandmaster = yes
                }
              }
            }
          }
          set_society_grandmaster = yes
        }
      }
    }
  }
}
character_event = { #TSUI TONG AI join event
	id = ZHE.112
	hide_window = yes

	is_triggered_only = yes

  immediate = {
    random_list = {
      60 = { # do nothing
      }
      40 = {
        trigger = {
          can_join_society = tsui_tong
        }
        modifier = {
          factor = 2
          OR = {
            trait = impaler
            trait = schemer
          }
        }
        modifier = {
          factor = 2
          trait = ambitious
        }
        modifier = {
          factor = 2
          trait = proud
        }
        modifier = {
          factor = 2
          trait = greedy
        }
        modifier = {
          factor = 2
          trait = cruel
        }
        modifier = {
          factor = 2
          trait = deceitful
        }
        modifier = {
          factor = 0
          trait = kind
        }
        modifier = {
          factor = 0
          is_benevolent_trigger = yes
        }
        modifier = {
          factor = 0.1
          is_landed = no
        }
        modifier = {
          factor = 0.5
          trait = honest
        }
        modifier = {
          factor = 0.2
          trait = charitable
        }
        join_society = tsui_tong
        random_list = {
          75 = {
            modifier = {
              factor = 0
              society_influence >= 30
            }
          }
          25 = {
          }
        }
        if = { # Make grandmaster is there is none
          limit = {
            NOT = {
              society = {
                any_society_member = {
                  is_society_grandmaster = yes
                }
              }
            }
          }
          set_society_grandmaster = yes
        }
      }
    }
  }
}
character_event = { #STORM AI join event
	id = ZHE.113
	hide_window = yes

	is_triggered_only = yes

  immediate = {
    random_list = {
      60 = { # do nothing
      }
      40 = {
        trigger = {
          can_join_society = storm_rune_society
        }
        modifier = {
          factor = 2
          OR = {
            trait = impaler
            trait = schemer
          }
        }
        modifier = {
          factor = 2
          trait = ambitious
        }
        modifier = {
          factor = 2
          trait = proud
        }
        modifier = {
          factor = 2
          trait = greedy
        }
        modifier = {
          factor = 2
          trait = cruel
        }
        modifier = {
          factor = 2
          trait = deceitful
        }
        modifier = {
          factor = 0
          trait = kind
        }
        modifier = {
          factor = 0
          is_benevolent_trigger = yes
        }
        modifier = {
          factor = 0.1
          is_landed = no
        }
        modifier = {
          factor = 0.5
          trait = honest
        }
        modifier = {
          factor = 0
          trait = charitable
        }
        join_society = storm_rune_society
        random_list = {
          75 = {
            modifier = {
              factor = 0
              society_influence >= 30
            }
          }
          25 = {
          }
        }
        if = { # Make grandmaster is there is none
          limit = {
            NOT = {
              society = {
                any_society_member = {
                  is_society_grandmaster = yes
                }
              }
            }
          }
          set_society_grandmaster = yes
        }
      }
    }
  }
}
character_event = { #WARLOCKS AI join event
	id = ZHE.114
	hide_window = yes

	is_triggered_only = yes

  immediate = {
    random_list = {
      60 = { # do nothing
      }
      40 = {
        trigger = {
          can_join_society = warlock_knights
        }
        modifier = {
          factor = 2
          z_warlock = yes
        }
        modifier = {
          factor = 2
          OR = {
            trait = impaler
            trait = schemer
          }
        }
        modifier = {
          factor = 2
          trait = ambitious
        }
        modifier = {
          factor = 2
          trait = proud
        }
        modifier = {
          factor = 2
          trait = greedy
        }
        modifier = {
          factor = 2
          trait = cruel
        }
        modifier = {
          factor = 2
          trait = deceitful
        }
        modifier = {
          factor = 0
          trait = kind
        }
        modifier = {
          factor = 0.5
          trait = honest
        }
        modifier = {
          factor = 0.2
          trait = charitable
        }
        join_society = warlock_knights
        random_list = {
          75 = {
            modifier = {
              factor = 0
              society_influence >= 30
            }
          }
          25 = {
          }
        }
        if = { # Make grandmaster is there is none
          limit = {
            NOT = {
              society = {
                any_society_member = {
                  is_society_grandmaster = yes
                }
              }
            }
          }
          set_society_grandmaster = yes
        }
      }
    }
  }
}

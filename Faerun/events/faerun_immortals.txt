namespace = frimmortal

# Vampire hunter
character_event = {
	id = frimmortal.1
	desc = FRIMMORTAL.1.D
	picture = GFX_evt_bad_news
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	trigger = {
		OR = {
			trait = vampire
			trait = vampire_spawn
		}
		location = { has_owner = yes } # not commanding troops in sea
		trigger_if = {
			limit = {
				OR = {
					is_landed = yes
					is_patrician = yes
				}
			}

			capital_scope = { has_province_modifier = vampire_hunters_prov_modifier }
		}
		trigger_else_if = {
			limit = { 
				is_ruler = no
				liege = {
					OR = {
						is_landed = yes
						is_patrician = yes
					}
					OR = {
						trait = vampire
						trait = vampire_spawn
					}
				}
			}

			liege = { capital_scope = { has_province_modifier = vampire_hunters_prov_modifier } }
		}
		trigger_else = { 
			OR = {
				has_character_modifier = known_vamp_modifier
				location = { has_province_modifier = vampire_hunters_prov_modifier }
			}
		}

		OR = {
			NOT = { has_character_flag = vampire_hunter_spawned }
			had_character_flag = {
				flag = vampire_hunter_spawned
				years > 5
			}
		}
		NOT = { has_character_modifier = recent_duel_timer }
		is_inaccessible_or_incapable_trigger = no
	}
	
	weight_multiplier = {
		factor = 1

		mult_modifier = {
			factor = 0.5
			trait = vampire_spawn
		}
		mult_modifier = {
			factor = 2
			is_ruler = no
		}
		mult_modifier = {
			factor = 1.5
			has_character_modifier = known_vamp_modifier
		}
		mult_modifier = {
			factor = 0.5
			intrigue >= 10
		}
		mult_modifier = {
			factor = 0.5 # stacks with the above
			intrigue >= 15
		}
		mult_modifier = {
			factor = 0.5 # stacks with the above
			intrigue >= 20
		}
		mult_modifier = {
			factor = 0.5 # stacks with the above
			intrigue >= 25
		}
		mult_modifier = {
			factor = 0.5 # stacks with the above
			intrigue >= 30
		}
		mult_modifier = {
			factor = 2
			intrigue < 6
		}
		mult_modifier = {
			factor = 4
			intrigue < 1
		}
	}
	
	immediate = {
		set_character_flag = vampire_hunter_spawned
		location = { save_event_target_as = vamp_location }
	}
	
	option = {
		trigger = {
			is_ruler = yes
			wealth > 0
		}
		name = FRIMMORTAL.1.Oa
		ai_chance = {
			factor = 3
		}

		wealth = -50
		hidden_tooltip = {
			random_list = {
				1 = {
					mult_modifier = { # these should all stack
						factor = 1.5
						intrigue >= 7
					}
					mult_modifier = {
						factor = 1.5
						intrigue >= 10
					}
					mult_modifier = {
						factor = 1.5
						intrigue >= 15
					}
					mult_modifier = {
						factor = 1.5
						intrigue >= 20
					}
					mult_modifier = {
						factor = 1.5
						intrigue >= 25
					}
					mult_modifier = {
						factor = 1.5
						intrigue >= 30
					}
					hidden_tooltip = {
						character_event = { id = frimmortal.2 days = 10 }
					}
				}
				5 = {
					set_character_flag = failed_killing_vampire_hunter
					hidden_tooltip = {
						character_event = { id = frimmortal.3 days = 10 }
					}
				}
			}
		}
	}
	option = {
		name = FRIMMORTAL.1.Ob
		hidden_tooltip = {
			character_event = { id = frimmortal.3 days = 10 }
		}
	}
}

character_event = {
	id = frimmortal.2
	desc = FRIMMORTAL.2.D
	picture = GFX_evt_burning_house
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = FRIMMORTAL.2.Oa
	}
}

character_event = {
	id = frimmortal.3
	desc = {
		trigger = {
			NOT = { has_character_flag = failed_killing_vampire_hunter }
		}
		text = FRIMMORTAL.3.Da
	}
	desc = {
		trigger = {
			has_character_flag = failed_killing_vampire_hunter
		}
		text = FRIMMORTAL.3.Db
	}
	picture = GFX_evt_bandits
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = FRIMMORTAL.3.Oa
		clr_character_flag = failed_killing_vampire_hunter
		add_character_modifier = {
			modifier = recent_duel_timer
			hidden = yes
			months = 3
		}
		pacifists_lose_piety_effect = yes
        if = {
            limit = { #Warriors like a warrior who acts like one...
                is_member_of_any_warrior_lodge_trigger = yes
            }
            add_legend_progress_trivial_effect = yes
        }
		set_character_flag = is_in_duel
		set_character_flag = add_duel_xp
		save_event_target_as = combatant_1
		set_character_flag = flag_duel_no_draws
		event_target:vamp_location = {
			create_character = {
				attributes = {
					martial = 10
					intrigue = 10
				}
				add_trait = brave
				add_trait = hunter
				random_traits = yes
				female = random
				dynasty = actually_culture
				flag = do_not_undead
			}
			new_character = { save_event_target_as = combatant_2 }
		}
		event_target:combatant_2 = {
			religion = triadic
			add_trait = patron_tyr
			if = {
				limit = {
					ROOT = {
						OR = {
							z_basic_class = yes
							z_has_class = no
						}
					}
				}

				random_list = {
					5 = { }
					3 = { set_variable = { which = local_class_selection_lvl value = 1 } }
					1 = { set_variable = { which = local_class_selection_lvl value = 2 } }
				}
			}
			else_if = {
				limit = {
					ROOT = {
						OR = {
							z_trained_class = yes
							z_journeyman_class = yes
						}
					}
				}

				random_list = {
					5 = { }
					4 = { set_variable = { which = local_class_selection_lvl value = 1 } }
					3 = { set_variable = { which = local_class_selection_lvl value = 2 } }
					1 = { set_variable = { which = local_class_selection_lvl value = 3 } }
				}
			}
			else = {
				random_list = {
					5 = { set_variable = { which = local_class_selection_lvl value = 2 } }
					4 = { set_variable = { which = local_class_selection_lvl value = 3 } }
					3 = { set_variable = { which = local_class_selection_lvl value = 4 } }
					1 = { set_variable = { which = local_class_selection_lvl value = 5 } }
				}
			}

			random_list = {
				1 = {
					become_cleric_effect = yes
				}
				1 = {
					become_paladin_effect = yes
				}
				1 = {
					become_ranger_effect = yes
				}
				1 = {
					become_fighter_effect = yes
				}
				1 = {
					become_rogue_effect = yes
				}
				1 = {
					become_monk_effect = yes
				}
			}

			if = {
				limit = {
					is_female = no
					trait = creature_human
					z_monk = yes
				}
				random = {
					chance = 1
					set_name = "Joseph"
				}
			}
			add_character_modifier = {
                modifier = recent_duel_timer
                hidden = yes
                months = 3
            }
			set_character_flag = is_in_duel
			set_character_flag = add_duel_xp
			character_event = { id = frimmortal.4 days = 2 }
		}
		character_event = { id = HFP.10100 }
	}
}

character_event = {
	id = frimmortal.4
	hide_window = yes
	
	is_triggered_only = yes

	trigger = {
		is_alive = yes
	}
	
	immediate = {
		leave_court_and_die_effect = yes
	}
}

character_event = {
	id = frimmortal.5
	desc = EVTDESC_FRIMMORTAL.5
	picture = GFX_evt_bad_news
	notification = yes
	
	is_triggered_only = yes

	only_playable = yes

	trigger = {
		OR = {
			trait = vampire
			trait = vampire_spawn
		}
		wealth < 0
		OR = {
			is_landed = yes
			is_patrician = yes
		}
		capital_scope = {
			NOT = { has_province_modifier = vampire_hunters_prov_modifier }
		}
	}

	weight_multiplier = {
		factor = 1

		mult_modifier = {
			factor = 2
			wealth < -50
		}
		mult_modifier = {
			factor = 2
			wealth < -100
		}
		mult_modifier = {
			factor = 2
			wealth < -150
		}
		mult_modifier = {
			factor = 2
			wealth < -200
		}
		mult_modifier = {
			factor = 2
			wealth < -300
		}
		mult_modifier = {
			factor = 2
			wealth < -500
		}
	}
	
	immediate = {
		capital_scope = {
			add_province_modifier = {
				name = vampire_hunters_prov_modifier
				years = 10
			}
		}
	}

	option = {
		name = UNFORTUNATE
	}
}
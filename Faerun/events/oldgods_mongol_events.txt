###################################
#
# THE OLD GODS
# - Mongol Events
#
###################################

# Written by Henrik Eklund

namespace = TOG

#######################
# Mongols sack cities # - removed for FR
#######################

##################
# The Great Hunt #
##################

### Starting Phase

# Organize the Hunt
character_event = {
	id = TOG.100
	desc = EVTDESC_TOG_100
	picture = GFX_evt_tengri_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy

	is_triggered_only = yes # hold_nerge, minor_decisions.txt
	hide_from = yes

	option = {
		name = EVTOPTA_TOG_100

		custom_tooltip = { text = EVTTOOLTIP_TOG_101 }

		any_vassal = {
			show_scope_change = no

			limit = {
				is_playable = yes
				practical_age < 55
				is_female = no
				block_general_event_trigger = no
				war = no
				is_maimed_trigger = no

				NOR = {
					trait = wounded
					trait = infirm
				}
			}

			set_character_flag = do_not_disturb

			character_event = { id = TOG.101 }

			character_event = {
				id = TOG.299 # Safety catch flag clearing
				days = 100
			}

			character_event = {
				id = TOG.103 # Hunt begins
				days = 10
			}
		}

		character_event = {
			id = TOG.102 # Hunt begins
			days = 10
		}
	}
}

# Invitation (Attendance is Mandatory)
character_event = {
	id = TOG.101
	desc = EVTDESC_TOG_101
	picture = GFX_evt_tengri_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy

	is_triggered_only = yes

	ai = no

	option = {
		name = EVTOPTA_TOG_101

		custom_tooltip = { text = nerge_assemble }
	}
}

# Khagan informed Hunt Begins!
character_event = {
	id = TOG.102
	desc = EVTDESC_TOG_102
	picture = GFX_evt_tengri_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy

	is_triggered_only = yes
	hide_from = yes

	immediate = {
		set_character_flag = khagan_holding_nerge
	}

	option = {
		name = EVTOPTA_TOG_102

		custom_tooltip = {
			text = nerge_starts

			character_event = {
				id = TOG.150 # Hunt Ends, Animals corralled, Khagan takes first shot
				days = 60
				random = 10
			}

			character_event = {
				id = TOG.158 # Exceptional Soldier brought to Khagan's attention
				days = 1
				random = 479
			}

			character_event = {
				id = TOG.159 # Exceptional Bear Captured
				days = 1
				random = 479
			}

			character_event = {
				id = TOG.109 # Nerge Hunt Event Tombola
				days = 14
			}
		}

		if = {
			limit = { ai = no }

			chronicle = {
				entry = CHRONICLE_HELD_NERGE
				picture = GFX_evt_tengri_throneroom_oldgods
			}
		}
	}
}

# Vassal informed Hunt Begins!
character_event = {
	id = TOG.103
	desc = EVTDESC_TOG_103
	picture = GFX_evt_tengri_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy

	is_triggered_only = yes

	immediate = {
		set_character_flag = vassal_holding_nerge
	}

	option = {
		name = EVTOPTA_TOG_102

		custom_tooltip = { text = nerge_starts }
	}
}

### During Hunt

# Nerge Hunt Event Tombola
character_event = {
	id = TOG.109

	is_triggered_only = yes
	hide_window = yes

	has_character_flag = khagan_holding_nerge

	immediate = {
		random_list = {
			100 = { } # No event

			25 = { # Vassal is injured
				any_vassal = {
					limit = {
						has_character_flag = vassal_holding_nerge
						is_incapable = no
						prisoner = no
					}

					score_value = {
						value = 100

						mult_modifier = {
							factor = 1.25
							martial < 8
						}

						mult_modifier = {
							factor = 1.25
							martial < 4
						}

						mult_modifier = {
							factor = 1.25
							trait = imbecile
						}

						mult_modifier = {
							factor = 0.8
							martial >= 10
						}

						mult_modifier = {
							factor = 0.67
							martial >= 14
						}
					}

					character_event = { id = TOG.110 }
				}
			}

			25 = { # Vassal comes to blow with another vassal
				trigger = {
					any_vassal = {
						count >= 2

						has_character_flag = vassal_holding_nerge
						is_incapable = no
						prisoner = no
					}
				}

				any_vassal = {
					limit = {
						has_character_flag = vassal_holding_nerge
						is_incapable = no
						prisoner = no
					}

					score_value = {
						value = 100

						mult_modifier = {
							factor = 1.67
							trait = wroth
						}

						mult_modifier = {
							factor = 0.7
							trait = kind
						}
					}

					save_event_target_as = quarreling_vassal
				}

				random_vassal = {
					limit = {
						has_character_flag = vassal_holding_nerge
						is_incapable = no
						prisoner = no
						NOT = { character = event_target:quarreling_vassal }
					}

					character_event = { id = TOG.112 }
				}
			}

			25 = { # Vassal's forces let wild game escape
				any_vassal = {
					limit = {
						has_character_flag = vassal_holding_nerge
						is_incapable = no
						prisoner = no
					}

					score_value = {
						value = 100

						mult_modifier = {
							factor = 1.25
							trait = slothful
						}

						mult_modifier = {
							factor = 1.25
							trait = imbecile
						}

						mult_modifier = {
							factor = 0.7
							trait = diligent
						}

						mult_modifier = {
							factor = 1.25
							martial < 8
						}

						mult_modifier = {
							factor = 1.25
							martial < 4
						}

						mult_modifier = {
							factor = 0.8
							martial >= 10
						}

						mult_modifier = {
							factor = 0.8
							martial >= 14
						}
					}

					character_event = { id = TOG.114 }
				}
			}

			25 = { # Vassal killed animal without permission
				any_vassal = {
					limit = {
						has_character_flag = vassal_holding_nerge
						is_incapable = no
						prisoner = no
					}

					score_value = {
						value = 100

						mult_modifier = {
							factor = 0.67
							trait = patient
						}

						mult_modifier = {
							factor = 1.25
							trait = greedy
						}

						mult_modifier = {
							factor = 1.25
							trait = arbitrary
						}

						mult_modifier = {
							factor = 1.25
							trait = imbecile
						}
					}

					character_event = { id = TOG.117 }
				}
			}
		}

		repeat_event = {
			id = TOG.109
			days = 14
		}
	}
}

# Vassal is injured
character_event = {
	id = TOG.110
	desc = EVTDESC_TOG_110
	picture = GFX_evt_tengri_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy

	is_triggered_only = yes

	option = {
		name = EVTOPTA_TOG_110

		add_trait = wounded

		liege = {
			character_event = { id = TOG.111 }
		}
	}
}

# Vassal is injured (Liege informed)
character_event = {
	id = TOG.111
	desc = EVTDESC_TOG_111
	picture = GFX_evt_tengri_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy

	is_triggered_only = yes

	ai = no

	option = {
		name = EVTOPTA_TOG_111

		tooltip = {
			FROM = {
				show_scope_change = no

				add_trait = wounded
			}
		}
	}
}

# Vassal comes to blow with another vassal
character_event = {
	id = TOG.112
	desc = EVTDESC_TOG_112
	picture = GFX_evt_tengri_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy
	portrait = event_target:quarreling_vassal

	is_triggered_only = yes

	option = {
		name = EVTOPTA_TOG_112

		liege = { character_event = { id = TOG.113 } }
		event_target:quarreling_vassal = { character_event = { id = TOG.120 } }

		opinion = {
			name = opinion_nerge_rival
			who = event_target:quarreling_vassal
		}
	}
}

# Vassal comes to blow with another vassal 2
character_event = {
	id = TOG.120
	desc = EVTDESC_TOG_112
	picture = GFX_evt_tengri_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy

	is_triggered_only = yes

	immediate = {
		FROM = { save_event_target_as = quarreling_vassal } # For loc
	}

	option = {
		name = EVTOPTA_TOG_112

		opinion = {
			name = opinion_nerge_rival
			who = FROM
		}
	}
}

# Vassal comes to blow with another vassal (Liege informed)
character_event = {
	id = TOG.113
	desc = EVTDESC_TOG_113
	picture = GFX_evt_tengri_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy

	is_triggered_only = yes

	option = {
		name = EVTOPTA_TOG_113

		tooltip = {
			FROM = {
				show_scope_change = no

				opinion = {
					name = opinion_nerge_rival
					who = event_target:quarreling_vassal
				}

				reverse_opinion = {
					name = opinion_nerge_rival
					who = event_target:quarreling_vassal
				}
			}
		}
	}
}

# Vassal's forces let wild game escape
character_event = {
	id = TOG.114
	desc = EVTDESC_TOG_114
	picture = GFX_evt_tengri_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy

	is_triggered_only = yes

	option = {
		name = EVTOPTA_TOG_114

		liege = {
			character_event = { id = TOG.115 }
		}
	}
}

# Vassal's forces let wild game escape (Liege informed)
character_event = {
	id = TOG.115
	desc = EVTDESC_TOG_115
	picture = GFX_evt_tengri_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy

	is_triggered_only = yes

	option = { # Punish
		name = EVTOPTA_TOG_115

		FROM = {
			show_scope_change = no

			character_event = {
				id = TOG.116
				tooltip = EVTTOOLTIP_TOG_116
			}

			opinion = {
				name = opinion_punished_nerge
				who = ROOT
			}

			tooltip = {
				add_trait = wounded
			}
		}
	}

	option = { # Do not punish
		name = EVTOPTB_TOG_115

		reverse_opinion = {
			name = opinion_grateful
			who = FROM
		}

		any_vassal = {
			show_scope_change = no

			limit = {
				has_character_flag = vassal_holding_nerge

				NOR = {
					character = FROM

					has_opinion_modifier = {
						name = opinion_disappointed
						who = ROOT
					}
				}
			}

			count = 2

			opinion = {
				name = opinion_disappointed
				who = ROOT
				years = 1
			}
		}
	}
}

# Vassal is punished
character_event = {
	id = TOG.116
	desc = EVTDESC_TOG_116
	picture = GFX_evt_tengri_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy

	is_triggered_only = yes

	option = {
		name = EVTOPTA_TOG_116

		add_trait_silently_wounded_effect = yes
	}
}

# Vassal killed animal without permission
character_event = {
	id = TOG.117
	desc = EVTDESC_TOG_117
	picture = GFX_evt_tengri_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy

	is_triggered_only = yes

	option = {
		name = EVTOPTA_TOG_117

		liege = {
			character_event = { id = TOG.118 }
		}
	}
}

# Vassal killed animal without permission (Liege informed)
character_event = {
	id = TOG.118
	desc = EVTDESC_TOG_118
	picture = GFX_evt_tengri_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy

	is_triggered_only = yes

	option = { # Punish
		name = EVTOPTA_TOG_118

		FROM = {
			show_scope_change = no

			character_event = {
				id = TOG.116
				tooltip = EVTTOOLTIP_TOG_116
			}

			opinion = {
				name = opinion_punished_nerge
				who = ROOT
			}

			tooltip = {
				add_trait = wounded
			}
		}
	}

	option = { # Do not punish
		name = EVTOPTB_TOG_118

		reverse_opinion = {
			name = opinion_grateful
			who = FROM
		}

		any_vassal = {
			show_scope_change = no

			limit = {
				has_character_flag = vassal_holding_nerge

				NOR = {
					character = FROM

					has_opinion_modifier = {
						name = opinion_disappointed
						who = ROOT
					}
				}
			}

			count = 2

			opinion = {
				name = opinion_disappointed
				who = ROOT
				years = 1
			}
		}
	}
}

### Hunt Ends

# Animals corralled, Khagan takes first shot
character_event = {
	id = TOG.150
	desc = EVTDESC_TOG_150
	picture = GFX_evt_tengri_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy

	is_triggered_only = yes
	hide_from = yes

	has_dlc = "The Old Gods"
	has_character_flag = khagan_holding_nerge

	immediate = {
		clear_delayed_event = { id = TOG.158 }
		clear_delayed_event = { id = TOG.159 }
		clr_character_flag = khagan_holding_nerge
		set_character_flag = khagan_finishing_nerge

		any_vassal = {
			limit = { has_character_flag = vassal_holding_nerge }

			clr_character_flag = vassal_holding_nerge
			set_character_flag = vassal_finishing_nerge
		}
	}

	option = {
		name = EVTOPTA_TOG_150

		custom_tooltip = {
			text = hunt_animals

			any_vassal = {
				limit = { has_character_flag = vassal_finishing_nerge }
				character_event = { id = TOG.151 }
			}

			if = {
				limit = { trait = hunter }

				character_event = {
					id = TOG.152
					days = 2
				}
			}
			else_if = {
				limit = { lifestyle_traits < 1 }

				random = {
					chance = 25

					character_event = {
						id = TOG.152
						days = 2
					}
				}
			}

			character_event = {
				id = TOG.169
				days = 10
			}
		}
	}
}

# Animals corralled, Vassals get their turn
character_event = {
	id = TOG.151
	desc = EVTDESC_TOG_151
	picture = GFX_evt_tengri_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy

	is_triggered_only = yes

	option = {
		name = EVTOPTA_TOG_151

		custom_tooltip = {
			text = hunt_animals

			if = {
				limit = { trait = hunter }

				character_event = {
					id = TOG.152
					days = 2
				}
			}
			else_if = {
				limit = { lifestyle_traits < 1 }

				random = {
					chance = 25

					character_event = {
						id = TOG.152
						days = 2
					}
				}
			}
		}
	}
}

# Hunt Over, Character did well
character_event = {
	id = TOG.152
	desc = EVTDESC_TOG_152
	picture = GFX_evt_tengri_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy

	hide_from = yes
	is_triggered_only = yes

	option = {
		name = EVTOPTA_TOG_152

		if = {
			limit = {
				lifestyle_traits < 1
				NOT = { has_dlc = "Way of Life" }
			}

			add_trait = hunter
		}

		prestige = 100
	}
}

# Hunt Over, Exceptional Soldier brought to Khagan's attention
character_event = {
	id = TOG.158
	desc = EVTDESC_TOG_158
	picture = GFX_evt_tengri_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy

	is_triggered_only = yes

	has_character_flag = khagan_holding_nerge
	only_capable = yes
	prisoner = no

	option = { # Bring to court
		name = EVTOPTA_TOG_158

		set_character_flag = exceptional_soldier
		pick_culture_for_spawned_courtier_effect = yes
		create_character = {
			random_traits = no
			dynasty = NONE
			female = random
			age = 26
			culture = event_target:picked_culture
			religion = event_target:picked_religion
			add_trait = diligent
			add_trait = quick
			add_trait = brave
			add_trait = brilliant_strategist

			attributes = {
				martial = 10
			}
			flag = invited_soldier
		}
	}

	option = { # Leave as soldier
		name = EVTOPTB_TOG_158
	}
}

# Hunt Over, Exceptional Bear Captured
character_event = {
	id = TOG.159
	desc = EVTDESC_TOG_159
	picture = GFX_evt_tengri_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy

	is_triggered_only = yes

	has_character_flag = khagan_holding_nerge
	only_capable = yes
	prisoner = no

	trigger = {
		NOT = { has_character_flag = pet_bear }
	}

	option = { # Keep as pet
		name = EVTOPTA_TOG_159

		custom_tooltip = {
			text = pet_bear
			set_character_flag = pet_bear
		}
	}

	option = { # Kill
		name = EVTOPTB_TOG_159

		custom_tooltip = { text = dead_bear }
	}
}

# Bear attacks courtier
character_event = {
	id = TOG.160
	picture = GFX_evt_tengri_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy

	desc = {
		text = EVTDESC_TOG_160
		trigger = { has_character_flag = bear_attack_wounds }
	}
	desc = {
		text = EVTDESC_TOG_161
		trigger = { has_character_flag = bear_attack_maims }
	}
	desc = {
		text = EVTDESC_TOG_162
		trigger = { has_character_flag = bear_attack_kills }
	}

	is_triggered_only = yes # on_bi_yearly_pulse, random_events, pet_bear_events

	only_playable = yes
	has_character_flag = pet_bear
	culture_group = taan_group
	has_dlc = "The Old Gods"
	only_capable = yes
	prisoner = no

	trigger = {
		any_courtier = {
			is_ruler = no
			is_adult = yes
			host = { character = ROOT }
			prisoner = no
			is_incapable = no
			is_primary_heir = no
			is_pretender = no
			in_command = no

			NOR = {
				is_married = ROOT
				is_close_relative = ROOT
				has_character_flag = pet_bear
			}
		}
	}

	immediate = {
		random_courtier = {
			limit = {
				is_ruler = no
				is_adult = yes
				host = { character = ROOT }
				prisoner = no
				is_incapable = no
				is_primary_heir = no
				is_pretender = no
				in_command = no

				NOR = {
					is_married = ROOT
					is_close_relative = ROOT
					has_character_flag = pet_bear
				}
			}

			save_event_target_as = bear_victim
		}

		random_list = {
			33 = { set_character_flag = bear_attack_wounds }
			33 = { set_character_flag = bear_attack_maims }
			33 = { set_character_flag = bear_attack_kills }
		}
	}

	option = {
		name = EVTOPTA_TOG_160

		trigger = { has_character_flag = bear_attack_wounds }

		event_target:bear_victim = {
			show_scope_change = no

			add_trait_silently_wounded_effect = yes
		}
	}

	option = {
		name = EVTOPTA_TOG_160

		trigger = { has_character_flag = bear_attack_maims }

		event_target:bear_victim = {
			show_scope_change = no

			add_maimed_trait_effect = yes
		}
	}

	option = {
		name = EVTOPTA_TOG_160

		trigger = { has_character_flag = bear_attack_kills }

		event_target:bear_victim = {
			show_scope_change = no

			death = { death_reason = death_accident_bear }
		}
	}

	after = {
		clear_flags_with_prefix = bear_attack_
	}
}

# Visiting dignitaries impressed by bear
character_event = {
	id = TOG.163
	desc = EVTDESC_TOG_163
	picture = GFX_evt_tengri_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy

	is_triggered_only = yes # on_bi_yearly_pulse, random_events, pet_bear_events

	only_playable = yes
	has_character_flag = pet_bear
	culture_group = taan_group
	has_dlc = "The Old Gods"
	only_capable = yes
	prisoner = no

	option = {
		name = EVTOPTA_TOG_163

		prestige = 200
	}
}

# Bear taught to dance
character_event = {
	id = TOG.164
	desc = EVTDESC_TOG_164
	picture = GFX_evt_tengri_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy

	is_triggered_only = yes # on_bi_yearly_pulse, random_events, pet_bear_events

	only_playable = yes
	has_character_flag = pet_bear
	culture_group = taan_group
	has_dlc = "The Old Gods"
	only_capable = yes
	prisoner = no

	trigger = {
		capital_scope = {
			NOR = {
				region = east_faerun_region
				region = kara_tur_region
			}
		}

		location = {
			county = {
				NOT = { region = east_faerun_region }
			}
		}
	}

	option = {
		name = EVTOPTA_TOG_164

		prestige = 200
	}
}

# Bear depressed
character_event = {
	id = TOG.165
	desc = EVTDESC_TOG_165
	picture = GFX_evt_tengri_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy

	is_triggered_only = yes # on_bi_yearly_pulse, random_events, pet_bear_events

	only_playable = yes
	has_character_flag = pet_bear
	culture_group = taan_group
	has_dlc = "The Old Gods"
	only_capable = yes
	prisoner = no

	option = { # Release
		name = EVTOPTA_TOG_165

		custom_tooltip = {
			text = bear_released
			clr_character_flag = pet_bear
		}

		prestige = -50
		add_trait_partially_silently_kind_effect = yes
	}

	option = { # Keep
		name = EVTOPTB_TOG_165

		custom_tooltip = {
			text = keep_bear
			set_character_flag = pet_bear_depressed
		}

		random = {
			chance = 33
			add_trait_fully_cruel_effect = yes
		}
	}
}

# Bear dies
character_event = {
	id = TOG.166
	desc = EVTDESC_TOG_166
	picture = GFX_evt_tengri_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy

	is_triggered_only = yes # on_bi_yearly_pulse, random_events, pet_bear_events

	only_playable = yes
	has_character_flag = pet_bear
	culture_group = taan_group
	has_dlc = "The Old Gods"
	only_capable = yes
	prisoner = no

	weight_multiplier = {
		factor = 1

		mult_modifier = {
			factor = 2
			has_character_flag = pet_bear_depressed
		}
	}

	option = {
		name = EVTOPTA_TOG_166

		custom_tooltip = {
			text = bear_passes_away

			clr_character_flag = pet_bear
			clr_character_flag = pet_bear_depressed
		}

		random = {
			chance = 20
			add_trait_depressed_effect = yes
		}
	}
}

# Per tradition, Khagan asked to spare remaining animals
character_event = {
	id = TOG.169
	desc = EVTDESC_TOG_169
	picture = GFX_evt_tengri_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy

	is_triggered_only = yes
	hide_from = yes

	option = { # Yes
		name = EVTOPTA_TOG_169

		random = {
			chance = 33
			add_trait_partially_kind_effect = yes
		}

		prestige = 25
	}

	option = { # No
		name = EVTOPTB_TOG_169

		add_trait_partially_silently_cruel_effect = yes
		prestige = -25
	}

	after = {
		character_event = {
			id = TOG.170
			days = 5
		}
	}
}

# Hunt over! Feast can commence! (Liege)
character_event = {
	id = TOG.170
	desc = EVTDESC_TOG_170
	picture = GFX_evt_tengri_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy

	is_triggered_only = yes
	hide_from = yes

	option = {
		name = EVTOPTA_TOG_170

		custom_tooltip = {
			text = feast_begins

			set_variable = {
				which = local_nerge_feast_events
				value = 0
			}

			character_event = {
				id = TOG.172 # Feast events tombola
				days = 3
			}

			any_vassal = {
				limit = { has_character_flag = vassal_finishing_nerge }

				set_character_flag = nerge_feast_vassal
				character_event = { id = TOG.171 }

				opinion = {
					name = opinion_held_nerge
					who = ROOT
				}
			}
		}
	}
}

# Hunt over! Feast can commence! (Vassals)
character_event = {
	id = TOG.171
	desc = EVTDESC_TOG_170
	picture = GFX_evt_tengri_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy

	is_triggered_only = yes

	ai = no

	option = {
		name = EVTOPTA_TOG_170
	}
}

# Feast over! The Nerge is completed (Liege)
character_event = {
	id = TOG.180
	desc = EVTDESC_TOG_180
	picture = GFX_evt_tengri_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy

	is_triggered_only = yes
	hide_from = yes

	immediate = {
		clr_character_flag = khagan_finishing_nerge
		clr_character_flag = holding_nerge
		clr_character_flag = do_not_disturb

		add_character_modifier = {
			name = held_nerge_timer
			years = 4
			hidden = yes
		}

		hidden_effect = {
			any_vassal = {
				limit = { has_character_flag = vassal_finishing_nerge }

				character_event = { id = TOG.179 }
				clr_character_flag = vassal_finishing_nerge
				clr_character_flag = nerge_feast_vassal
				clr_character_flag = do_not_disturb
			}
		}
	}

	option = {
		name = EVTOPTA_TOG_180

		add_character_modifier = {
			name = morale_from_nerge
			years = 2
		}
	}
}

# Feast over! The Nerge is completed (Vassal)
character_event = {
	id = TOG.179
	desc = EVTDESC_TOG_180
	picture = GFX_evt_tengri_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy

	is_triggered_only = yes

	ai = no

	option = {
		name = EVTOPTA_TOG_180
	}
}

# Nerge abandoned due to war
character_event = {
	id = TOG.183

	is_triggered_only = yes # on_war_started
	hide_window = yes

	immediate = {
		ROOT = {
			if = {
				limit = {
					OR = {
						has_character_flag = khagan_holding_nerge
						has_character_flag = khagan_finishing_nerge
					}
				}

				character_event = { id = TOG.181 }
			}
		}

		FROM = {
			if = {
				limit = {
					OR = {
						has_character_flag = khagan_holding_nerge
						has_character_flag = khagan_finishing_nerge
					}
				}

				character_event = { id = TOG.181 }
			}
		}
	}
}

character_event = {
	id = TOG.181
	desc = EVTDESC_TOG_181
	picture = GFX_evt_tengri_throneroom_oldgods
	border = GFX_event_normal_frame_war

	is_triggered_only = yes
	hide_from = yes

	immediate = {
		clear_delayed_event = { id = TOG.109 }
		clear_delayed_event = { id = TOG.158 }
		clear_delayed_event = { id = TOG.159 }
		clr_character_flag = khagan_holding_nerge
		clr_character_flag = khagan_finishing_nerge
		clr_character_flag = holding_nerge
		clr_character_flag = do_not_disturb

		hidden_effect = {
			any_vassal = {
				limit = {
					OR = {
						has_character_flag = vassal_holding_nerge
						has_character_flag = vassal_finishing_nerge
					}
				}

				character_event = { id = TOG.182 }
				clr_character_flag = vassal_holding_nerge
				clr_character_flag = vassal_finishing_nerge
				clr_character_flag = nerge_feast_vassal
				clr_character_flag = do_not_disturb
			}
		}
	}

	option = {
		name = EVTOPTA_TOG_181
	}
}

# Nerge abandoned due to war (for vassals)
character_event = {
	id = TOG.182
	desc = EVTDESC_TOG_181
	picture = GFX_evt_tengri_throneroom_oldgods
	border = GFX_event_normal_frame_war

	is_triggered_only = yes

	ai = no

	option = {
		name = EVTOPTA_TOG_181
	}
}

### Nerge Feast Events

# Drunkard (Guest)
character_event = {
	id = TOG.200
	desc = EVTDESC_TOG_650
	picture = GFX_evt_viking_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy
	
	only_playable = yes
	only_men = yes
	min_age = 16
	prisoner = no
	only_capable = yes
	has_character_flag = nerge_feast_vassal
	
	trigger = {
		has_dlc = "The Old Gods"
		NOT = { has_character_flag = feast_drunkard }
		liege = { 
			has_character_flag = khagan_finishing_nerge
			NOT = { has_character_flag = feast_drunkard }
		}
		trait = drunkard
	}
	
	mean_time_to_happen = {
		days = 60
		
		modifier = {
			factor = 1.1
			liege = { num_of_vassals = 10 }
		}
		modifier = {
			factor = 1.2
			liege = { num_of_vassals = 20 }
		}
		modifier = {
			factor = 1.3
			liege = { num_of_vassals = 30 }
		}
		modifier = {
			factor = 1.4
			liege = { num_of_vassals = 40 }
		}
		modifier = {
			factor = 1.5
			liege = { num_of_vassals = 50 }
		}
		modifier = {
			factor = 3
			liege = { num_of_vassals = 100 }
		}
	}
	
	option = {
		name = EVTOPTA_TOG_650
		tooltip_info = drunkard
		set_character_flag = feast_drunkard
		hidden_tooltip = {
			liege = {
				set_character_flag = feast_drunkard
				character_event = { id = TOG.201 }
				any_vassal = {
					limit = {
						has_character_flag = nerge_feast_vassal
						NOT = { character = ROOT }
					}
					character_event = { id = TOG.201 }
				}
			}
		}
		tooltip = {
			liege = {
				if = {
					limit = { NOT = { trait = drunkard } }
					opinion = {
						modifier = opinion_feast_scandal
						who = ROOT
					}
				}
				if = {
					limit = { trait = drunkard }
					opinion = {
						modifier = opinion_drinking_buddy
						who = ROOT
					}
				}
				any_vassal = {
					limit = {
						has_character_flag = nerge_feast_vassal
						NOT = { character = ROOT }
						NOT = { trait = drunkard }
					}
					opinion = {
						modifier = opinion_feast_scandal
						who = ROOT
					}
				}
				any_vassal = {
					limit = {
						has_character_flag = nerge_feast_vassal
						NOT = { character = ROOT }
						trait = drunkard
					}
					opinion = {
						modifier = opinion_drinking_buddy
						who = ROOT
					}
				}
			}
		}
	}
}

# Drunkard (Host and Other Guests)
character_event = {
	id = TOG.201
	desc = EVTDESC_TOG_651
	picture = GFX_evt_viking_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TOG_651
		trigger = { 
			NOT = { trait = drunkard } 
		}
		opinion = {
			modifier = opinion_feast_scandal
			who = FROM
		}
	}
	option = {
		name = EVTOPTB_TOG_651
		tooltip_info = drunkard
		trigger = { 
			trait = drunkard
		}
		opinion = {
			modifier = opinion_drinking_buddy
			who = FROM
		}
	}
}

# Gluttonous (Victim Hidden)
character_event = {
	id = TOG.202
	hide_window = yes
	
	only_playable = yes
	only_men = yes
	min_age = 16
	prisoner = no
	only_capable = yes
	has_character_flag = nerge_feast_vassal
	
	trigger = {
		has_dlc = "The Old Gods"
		liege = {
			has_character_flag = khagan_finishing_nerge
			NOT = { has_character_flag = feast_gluttonous }
			any_vassal = {
				has_character_flag = nerge_feast_vassal
				NOT = { has_character_flag = feast_gluttonous }
				trait = gluttonous
				NOT = { character = ROOT }
			}
		}
	}
	
	mean_time_to_happen = {
		days = 60
		
		modifier = {
			factor = 1.1
			liege = { num_of_vassals = 10 }
		}
		modifier = {
			factor = 1.2
			liege = { num_of_vassals = 20 }
		}
		modifier = {
			factor = 1.3
			liege = { num_of_vassals = 30 }
		}
		modifier = {
			factor = 1.4
			liege = { num_of_vassals = 40 }
		}
		modifier = {
			factor = 1.5
			liege = { num_of_vassals = 50 }
		}
		modifier = {
			factor = 3
			liege = { num_of_vassals = 100 }
		}
	}
	
	immediate = {
		liege = {
			set_character_flag = feast_gluttonous
			random_vassal = {
				limit = {
					has_character_flag = nerge_feast_vassal
					trait = gluttonous
					NOT = { character = ROOT }
				}
				character_event = { id = TOG.203 }
				set_character_flag = feast_gluttonous
			}
		}
	}
}

# Gluttonous (Guest)
character_event = {
	id = TOG.203
	desc = EVTDESC_TOG_653
	picture = GFX_evt_viking_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TOG_653
		tooltip_info = gluttonous
		FROM = {
			character_event = { id = TOG.204 tooltip = EVTTOOLTIP_TOG_654 }
		}	
		hidden_tooltip = {
			liege = {
				character_event = { id = TOG.205 }
				any_vassal = {
					limit = {
						has_character_flag = nerge_feast_vassal
						NOT = { 
							character = ROOT 
							character = FROM
						}
					}
					character_event = { id = TOG.205 }
				}
			}
		}
		tooltip = {
			FROM = {
				opinion = {
					modifier = opinion_vomit
					who = ROOT
				}
			}
			liege = {
				opinion = {
					modifier = opinion_feast_scandal
					who = ROOT
				}
				any_vassal = {
					limit = {
						has_character_flag = nerge_feast_vassal
						NOT = { 
							character = ROOT 
							character = FROM
						}
					}
					opinion = {
						modifier = opinion_feast_scandal
						who = ROOT
					}
				}
			}
		}
	}
}

# Gluttonous (Victim)
character_event = {
	id = TOG.204
	desc = EVTDESC_TOG_654
	picture = GFX_evt_viking_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TOG_654
		opinion = {
			modifier = opinion_vomit
			who = FROM
		}
	}
}

# Gluttonous (Host and Other Guests)
character_event = {
	id = TOG.205
	desc = EVTDESC_TOG_655
	picture = GFX_evt_viking_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TOG_655
		opinion = {
			modifier = opinion_feast_scandal
			who = FROM
		}
	}
}

# Lunatic (Guest)
character_event = {
	id = TOG.206
	desc = EVTDESC_TOG_656
	picture = GFX_evt_viking_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy
	
	only_playable = yes
	only_men = yes
	min_age = 16
	prisoner = no
	only_capable = yes
	has_character_flag = nerge_feast_vassal
	
	trigger = {
		has_dlc = "The Old Gods"
		NOT = { has_character_flag = feast_lunatic }
		liege = { 
			has_character_flag = khagan_finishing_nerge
			NOT = { has_character_flag = feast_lunatic }
		}
		trait = lunatic
	}
	
	mean_time_to_happen = {
		days = 60
		
		modifier = {
			factor = 1.1
			liege = { num_of_vassals = 10 }
		}
		modifier = {
			factor = 1.2
			liege = { num_of_vassals = 20 }
		}
		modifier = {
			factor = 1.3
			liege = { num_of_vassals = 30 }
		}
		modifier = {
			factor = 1.4
			liege = { num_of_vassals = 40 }
		}
		modifier = {
			factor = 1.5
			liege = { num_of_vassals = 50 }
		}
		modifier = {
			factor = 3
			liege = { num_of_vassals = 100 }
		}
	}
	
	option = {
		name = EVTOPTA_TOG_656
		tooltip_info = lunatic
		set_character_flag = feast_lunatic
		hidden_tooltip = {
			liege = {
				set_character_flag = feast_lunatic
				character_event = { id = TOG.207 }
				any_vassal = {
					limit = {
						has_character_flag = nerge_feast_vassal
						NOT = { character = ROOT }
					}
					character_event = { id = TOG.207 }
				}
			}
		}
		tooltip = {
			liege = {
				if = {
					limit = { NOT = { trait = lunatic } }
					opinion = {
						modifier = opinion_feast_scandal
						who = ROOT
					}
				}
				if = {
					limit = { trait = lunatic }
					opinion = {
						modifier = opinion_feast_friend
						who = ROOT
					}
				}
				any_vassal = {
					limit = {
						has_character_flag = nerge_feast_vassal
						NOT = { character = ROOT }
						NOT = { trait = lunatic }
					}
					opinion = {
						modifier = opinion_feast_scandal
						who = ROOT
					}
				}
				any_vassal = {
					limit = {
						has_character_flag = nerge_feast_vassal
						NOT = { character = ROOT }
						trait = lunatic
					}
					opinion = {
						modifier = opinion_feast_friend
						who = ROOT
					}
				}
			}
		}	
	}
}

# Lunatic (Host and Other Guests)
character_event = {
	id = TOG.207
	desc = EVTDESC_TOG_657
	picture = GFX_evt_viking_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TOG_657
		trigger = {
			NOT = { trait = lunatic }
		}
		opinion = {
			modifier = opinion_feast_scandal
			who = ROOT
		}
	}
	option = {
		name = EVTOPTB_TOG_657
		tooltip_info = lunatic
		trigger = {
			trait = lunatic
		}
		opinion = {
			modifier = opinion_feast_friend
			who = ROOT
		}
	}
}

# Lustful (Guest)
character_event = {
	id = TOG.208
	desc = EVTDESC_TOG_658
	picture = GFX_evt_viking_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy
	
	only_playable = yes
	only_men = yes
	min_age = 16
	prisoner = no
	only_capable = yes
	has_character_flag = nerge_feast_vassal
	
	trigger = {
		has_dlc = "The Old Gods"
		NOT = { has_character_flag = feast_lustful }
		liege = { 
			has_character_flag = khagan_finishing_nerge
			NOT = { has_character_flag = feast_lustful }
		}
		trait = lustful
	}
	
	mean_time_to_happen = {
		days = 60
		
		modifier = {
			factor = 1.1
			liege = { num_of_vassals = 10 }
		}
		modifier = {
			factor = 1.2
			liege = { num_of_vassals = 20 }
		}
		modifier = {
			factor = 1.3
			liege = { num_of_vassals = 30 }
		}
		modifier = {
			factor = 1.4
			liege = { num_of_vassals = 40 }
		}
		modifier = {
			factor = 1.5
			liege = { num_of_vassals = 50 }
		}
		modifier = {
			factor = 3
			liege = { num_of_vassals = 100 }
		}
	}
	
	option = {
		name = EVTOPTA_TOG_658
		tooltip_info = lustful
		set_character_flag = feast_lustful
		trigger = {
			is_married = no
		}
		hidden_tooltip = {
			liege = {
				set_character_flag = feast_lustful
				character_event = { id = TOG.209 }
				any_vassal = {
					limit = {
						has_character_flag = nerge_feast_vassal
						NOT = { character = ROOT }
					}
					character_event = { id = TOG.209 }
				}
			}
		}
		tooltip = {
			liege = {
				if = {
					limit = { NOT = { trait = lustful } }
					opinion = {
						modifier = opinion_feast_scandal
						who = ROOT
					}
				}
				if = {
					limit = { trait = lustful }
					opinion = {
						modifier = opinion_lustful_buddy
						who = ROOT
					}
				}
				any_vassal = {
					limit = {
						has_character_flag = nerge_feast_vassal
						NOT = { character = ROOT }
						NOT = { trait = lustful }
					}
					opinion = {
						modifier = opinion_feast_scandal
						who = ROOT
					}
				}
				any_vassal = {
					limit = {
						has_character_flag = nerge_feast_vassal
						NOT = { character = ROOT }
						trait = lustful
					}
					opinion = {
						modifier = opinion_lustful_buddy
						who = ROOT
					}
				}
			}
		}	
	}
	option = {
		name = EVTOPTB_TOG_658
		tooltip_info = lustful
		set_character_flag = feast_lustful
		trigger = {
			is_married = yes
		}
		hidden_tooltip = {
			liege = {
				set_character_flag = feast_lustful
				character_event = { id = TOG.209 }
				any_vassal = {
					limit = {
						has_character_flag = nerge_feast_vassal
						NOT = { character = ROOT }
					}
					character_event = { id = TOG.209 }
				}
			}
		}
		tooltip = {
			liege = {
				if = {
					limit = { NOT = { trait = lustful } }
					opinion = {
						modifier = opinion_feast_scandal
						who = ROOT
					}
				}
				if = {
					limit = { trait = lustful }
					opinion = {
						modifier = opinion_lustful_buddy
						who = ROOT
					}
				}
				any_vassal = {
					limit = {
						has_character_flag = nerge_feast_vassal
						NOT = { character = ROOT }
						NOT = { trait = lustful }
					}
					opinion = {
						modifier = opinion_feast_scandal
						who = ROOT
					}
				}
				any_vassal = {
					limit = {
						has_character_flag = nerge_feast_vassal
						NOT = { character = ROOT }
						trait = lustful
					}
					opinion = {
						modifier = opinion_lustful_buddy
						who = ROOT
					}
				}
			}
			any_spouse = {
				opinion = {
					modifier = opinion_mad_as_hell
					who = ROOT
					years = 1
				}
			}
		}	
	}
}

# Lustful (Host and Other Guests)
character_event = {
	id = TOG.209
	desc = EVTDESC_TOG_659
	picture = GFX_evt_viking_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TOG_659
		trigger = {
			NOT = { trait = lustful }
			NOT = { any_spouse = { character = FROM } }
		}
		opinion = {
			modifier = opinion_feast_scandal
			who = FROM
		}
	}
	option = {
		name = EVTOPTB_TOG_659
		tooltip_info = lustful
		trigger = {
			trait = lustful
			NOT = { any_spouse = { character = FROM } }
		}
		opinion = {
			modifier = opinion_lustful_buddy
			who = FROM
		}
	}
	option = {
		name = EVTOPTC_TOG_659
		trigger = {
			any_spouse = { character = FROM }
		}
		opinion = {
			modifier = opinion_mad_as_hell
			who = FROM
			years = 1
		}
	}
}

# Friendship Formed (Guest 1 Hidden)
character_event = {
	id = TOG.210
	hide_window = yes
	
	only_playable = yes
	only_men = yes
	min_age = 16
	prisoner = no
	only_capable = yes
	has_character_flag = nerge_feast_vassal
	
	trigger = {
		has_dlc = "The Old Gods"
		NOT = { has_character_flag = feast_friendship }
		liege = { 
			has_character_flag = khagan_finishing_nerge
			any_vassal = {
				has_character_flag = nerge_feast_vassal
				NOT = { has_character_flag = feast_friendship }
				NOT = { character = ROOT }
				opinion = { who = ROOT value =  20 }
			}		
		}
	}
	
	mean_time_to_happen = {
		days = 60
		
		modifier = {
			factor = 1.1
			liege = { num_of_vassals = 10 }
		}
		modifier = {
			factor = 1.2
			liege = { num_of_vassals = 20 }
		}
		modifier = {
			factor = 1.3
			liege = { num_of_vassals = 30 }
		}
		modifier = {
			factor = 1.4
			liege = { num_of_vassals = 40 }
		}
		modifier = {
			factor = 1.5
			liege = { num_of_vassals = 50 }
		}
		modifier = {
			factor = 3
			liege = { num_of_vassals = 100 }
		}
	}
	
	immediate = {
		set_character_flag = feast_friendship
		liege = { 
			random_vassal = {
				limit = {
					has_character_flag = nerge_feast_vassal
					NOT = { character = ROOT }
					opinion = { who = ROOT value =  20 }
				}
				character_event = { id = TOG.211 }
				set_character_flag = feast_friendship
				opinion = {
					modifier = opinion_feast_friend
					who = ROOT
				}
				reverse_opinion = {
					modifier = opinion_feast_friend
					who = ROOT
				}
			}		
		}
	}
}

# Friendship Formed (Guest 2)
character_event = {
	id = TOG.211
	desc = EVTDESC_TOG_661
	picture = GFX_evt_viking_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TOG_661
		hidden_tooltip = {
			FROM = {
				character_event = { id = TOG.212 }
			}
		}
		tooltip = {
			FROM = {
				opinion = {
					modifier = opinion_feast_friend
					who = ROOT
				}
			}
			opinion = {
				modifier = opinion_feast_friend
				who = FROM
			}
		}
	}
}

# Friendship Formed (Guest 1)
character_event = {
	id = TOG.212
	desc = EVTDESC_TOG_661
	picture = GFX_evt_viking_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TOG_661
		tooltip = {
			FROM = {
				opinion = {
					modifier = opinion_feast_friend
					who = ROOT
				}
			}
			opinion = {
				modifier = opinion_feast_friend
				who = FROM
			}
		}
	}
}

# Homosexual Male (Guest 1 Hidden)
character_event = {
	id = TOG.213
	hide_window = yes
	
	only_playable = yes
	only_men = yes
	min_age = 16
	prisoner = no
	only_capable = yes
	has_character_flag = nerge_feast_vassal
	
	trigger = {
		has_dlc = "The Old Gods"
		NOT = { has_character_flag = feast_homosexual }
		trait = homosexual
		is_female = no
		has_lover = no
		liege = { 
			has_character_flag = khagan_finishing_nerge
			NOT = { has_character_flag = feast_homosexual }
			any_vassal = {
				has_character_flag = nerge_feast_vassal
				NOT = { has_character_flag = feast_homosexual }
				NOT = { character = ROOT }
				opinion = { who = ROOT value =  0 }
				trait = homosexual
				is_female = no
				has_lover = no
			}		
		}
	}
	
	mean_time_to_happen = {
		days = 40
		
		modifier = {
			factor = 1.1
			liege = { num_of_vassals = 10 }
		}
		modifier = {
			factor = 1.2
			liege = { num_of_vassals = 20 }
		}
		modifier = {
			factor = 1.3
			liege = { num_of_vassals = 30 }
		}
		modifier = {
			factor = 1.4
			liege = { num_of_vassals = 40 }
		}
		modifier = {
			factor = 1.5
			liege = { num_of_vassals = 50 }
		}
		modifier = {
			factor = 3
			liege = { num_of_vassals = 100 }
		}
	}
	
	immediate = {
		set_character_flag = feast_homosexual
		liege = { 
			set_character_flag = feast_homosexual
			random_vassal = {
				limit = {
					has_character_flag = nerge_feast_vassal
					NOT = { has_character_flag = feast_homosexual }
					NOT = { character = ROOT }
					opinion = { who = ROOT value =  0 }
					OR = {
						trait = homosexual
						trait = bisexual
					}
					is_female = no
				}
				character_event = { id = TOG.214 }
				ROOT = { save_event_target_as = new_lover }
				new_lover_effect = yes
				set_character_flag = feast_homosexual
			}		
		}
	}
}

# Homosexual Male (Guest 2)
character_event = {
	id = TOG.214
	desc = EVTDESC_TOG_664
	picture = GFX_evt_viking_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TOG_664
		tooltip_info = homosexual
		hidden_tooltip = {
			FROM = {
				character_event = { id = TOG.215 }
			}
			liege = {
				character_event = { id = TOG.220 }
				any_vassal = {
					limit = {
						has_character_flag = nerge_feast_vassal
						NOT = {
							character = ROOT
							character = FROM
						}
					}
					character_event = { id = TOG.220 }
				}
			}
		}
		tooltip = {
			random = {
				chance = 50
				character_event = { id = TOG.219 tooltip = EVTTOOLTIP_TOG_669 }
			}
			FROM = { save_event_target_as = new_lover }
			new_lover_effect = yes
		}
	}
}

# Homosexual Male (Guest 1)
character_event = {
	id = TOG.215
	desc = EVTDESC_TOG_664
	picture = GFX_evt_viking_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TOG_664
		tooltip_info = homosexual
		random = {
			chance = 50
			character_event = { id = TOG.219 tooltip = EVTTOOLTIP_TOG_669 }
			hidden_tooltip = {
				FROM = {
					character_event = { id = TOG.219 }
				}
			}
		}
		tooltip = {
			FROM = { save_event_target_as = new_lover }
			new_lover_effect = yes
		}
	}
}

## Homosexual Female (Guest 1 Hidden)
#character_event = {
#	id = TOG.216
#	hide_window = yes
#	
#	only_playable = yes
#	only_women = yes
#	min_age = 16
#	prisoner = no
#	only_capable = yes
#	has_character_flag = nerge_feast_vassal
#	
#	trigger = {
#		has_dlc = "The Old Gods"
#		NOT = { has_character_flag = feast_homosexual }
#		trait = homosexual
#		is_female = yes
#		has_lover = no
#		liege = { 
#			NOT = { has_character_flag = feast_homosexual }
#			has_character_flag = khagan_finishing_nerge
#			any_vassal = {
#				has_character_flag = nerge_feast_vassal
#				NOT = { has_character_flag = feast_homosexual }
#				NOT = { character = ROOT }
#				opinion = { who = ROOT value =  0 }
#				trait = homosexual
#				is_female = yes
#				has_lover = no
#			}		
#		}
#	}
#	
#	mean_time_to_happen = {
#		days = 40
#		
#		modifier = {
#			factor = 1.1
#			liege = { num_of_vassals = 10 }
#		}
#		modifier = {
#			factor = 1.2
#			liege = { num_of_vassals = 20 }
#		}
#		modifier = {
#			factor = 1.3
#			liege = { num_of_vassals = 30 }
#		}
#		modifier = {
#			factor = 1.4
#			liege = { num_of_vassals = 40 }
#		}
#		modifier = {
#			factor = 1.5
#			liege = { num_of_vassals = 50 }
#		}
#		modifier = {
#			factor = 3
#			liege = { num_of_vassals = 100 }
#		}
#	}
#	
#	immediate = {
#		set_character_flag = feast_homosexual
#		liege = { 
#			set_character_flag = feast_homosexual
#			random_vassal = {
#				limit = {
#					has_character_flag = nerge_feast_vassal
#					NOT = { has_character_flag = feast_homosexual }
#					NOT = { character = ROOT }
#					opinion = { who = ROOT value =  0 }
#					trait = homosexual
#					is_female = yes
#				}
#				character_event = { id = TOG.217 }
#				set_character_flag = feast_homosexual
#				add_lover = ROOT
#			}		
#		}
#	}
#}
#
## Homosexual Female (Guest 2)
#character_event = {
#	id = TOG.217
#	desc = EVTDESC_TOG_664
#	picture = GFX_evt_viking_throneroom_oldgods
#	border = GFX_event_normal_frame_diplomacy
#	
#	is_triggered_only = yes
#	
#	option = {
#		name = EVTOPTA_TOG_664
#		tooltip_info = homosexual
#		hidden_tooltip = {
#			FROM = {
#				character_event = { id = TOG.218 }
#			}
#			liege = {
#				character_event = { id = TOG.220 }
#				any_vassal = {
#					limit = {
#						has_character_flag = nerge_feast_vassal
#						NOT = {
#							character = ROOT
#							character = FROM
#						}
#					}
#					character_event = { id = TOG.220 }
#				}
#			}			
#		}
#		tooltip = {
#			random = {
#				chance = 50
#				character_event = { id = TOG.219 tooltip = EVTTOOLTIP_TOG_669 }
#			}
#			add_lover = FROM
#		}
#	}
#}
#
## Homosexual Female (Guest 1)
#character_event = {
#	id = TOG.218
#	desc = EVTDESC_TOG_664
#	picture = GFX_evt_viking_throneroom_oldgods
#	border = GFX_event_normal_frame_diplomacy
#	
#	is_triggered_only = yes
#	
#	option = {
#		name = EVTOPTA_TOG_664
#		tooltip_info = homosexual
#		random = {
#			chance = 50
#			character_event = { id = TOG.219 tooltip = EVTTOOLTIP_TOG_669 }
#			hidden_tooltip = {
#				FROM = {
#					character_event = { id = TOG.219 }
#				}
#			}
#		}
#		tooltip = {
#			add_lover = FROM
#		}
#	}
#}

# Homosexual Caught
character_event = {
	id = TOG.219
	desc = EVTDESC_TOG_669
	picture = GFX_evt_viking_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TOG_669
		tooltip = {
			liege = {
				if = {
					limit = { NOT = { trait = homosexual } }
					opinion = {
						modifier = opinion_feast_scandal
						who = ROOT
					}
				}
				if = {
					limit = { trait = homosexual }
					opinion = {
						modifier = opinion_homosexual_sympathy
						who = ROOT
					}
				}
				any_vassal = {
					limit = {
						has_character_flag = nerge_feast_vassal
						NOT = { character = ROOT }
						NOT = { trait = homosexual }
					}
					opinion = {
						modifier = opinion_feast_scandal
						who = ROOT
					}
				}
				any_vassal = {
					limit = {
						has_character_flag = nerge_feast_vassal
						NOT = { character = ROOT }
						trait = homosexual
					}
					opinion = {
						modifier = opinion_homosexual_sympathy
						who = ROOT
					}
				}
			}
		}	
	}
}

# Homosexual Caught (Host and Other Guests)
character_event = {
	id = TOG.220
	desc = EVTDESC_TOG_670
	picture = GFX_evt_viking_throneroom_oldgods
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TOG_670
		trigger = {
			NOT = { trait = homosexual }
		}
		opinion = {
			modifier = opinion_feast_scandal
			who = FROM
		}
	}
	option = {
		name = EVTOPTB_TOG_670
		tooltip_info = homosexual
		trigger = {
			trait = homosexual
		}
		opinion = {
			modifier = opinion_homosexual_sympathy
			who = FROM
		}
	}
}

###########################################
# Flag management                         #
###########################################

# Safety catch - clears character flags and modifiers
character_event = {
	id = TOG.299

	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		clr_character_flag = do_not_disturb
		clr_character_flag = khagan_holding_nerge
		clr_character_flag = vassal_holding_nerge
		clr_character_flag = khagan_finishing_nerge
		clr_character_flag = vassal_finishing_nerge
		clr_character_flag = feast_drunkard
		clr_character_flag = feast_gluttonous
		clr_character_flag = feast_friendship
		clr_character_flag = feast_lunatic
		clr_character_flag = feast_lustful
		clr_character_flag = feast_homosexual
	}
}
